{
    "url": "https://api.github.com/repos/spack/spack/issues/21392",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/21392/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/21392/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/21392/events",
    "html_url": "https://github.com/spack/spack/issues/21392",
    "id": 796820611,
    "node_id": "MDU6SXNzdWU3OTY4MjA2MTE=",
    "number": 21392,
    "title": "r-testthat issue:An error is reported when the r-sf self-test suite is executed",
    "user": {
        "login": "Tom-python0121",
        "id": 77763324,
        "node_id": "MDQ6VXNlcjc3NzYzMzI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/77763324?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Tom-python0121",
        "html_url": "https://github.com/Tom-python0121",
        "followers_url": "https://api.github.com/users/Tom-python0121/followers",
        "following_url": "https://api.github.com/users/Tom-python0121/following{/other_user}",
        "gists_url": "https://api.github.com/users/Tom-python0121/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Tom-python0121/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Tom-python0121/subscriptions",
        "organizations_url": "https://api.github.com/users/Tom-python0121/orgs",
        "repos_url": "https://api.github.com/users/Tom-python0121/repos",
        "events_url": "https://api.github.com/users/Tom-python0121/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Tom-python0121/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2021-01-29T11:52:46Z",
    "updated_at": "2021-03-12T12:42:10Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\nI am having trouble about an error is reported when the **r-sf** self-test suite is executed because of the **r-testthat** question.\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n[root@centos8 ~]# spack install --keep-stage -v r-sf@0.7-7\r\n[root@centos8 ~]# spack install --keep-stage -v r-testthat@3.0.1\r\n[root@centos8 ~]# spack cd r-sf@0.7-7\r\n[root@centos8 spack-src]# spack load r-sf@0.7-7\r\n[root@centos8 spack-src]# spack load r-testthat@3.0.1\r\n[root@centos8 spack-src]# cd tests && Rscript testthat.R\r\nproj_create: Error -5 (unknown projection id)\r\nproj_create: Error -9 (unknown elliptical parameter name)\r\nOGR: Unsupported geometry type\r\nReading layer `nc' from data source `/home/spack/spack/opt/spack/linux-centos8-aarch64/gcc-8.3.1/r-sf-0.7-7-nzfcvpa4nwgrcbhxp4zwbxj37ysgh22u/rlib/R/library/sf/shape/nc.shp' using driver `ESRI Shapefile'\r\nSimple feature collection with 100 features and 14 fields\r\ngeometry type:  MULTIPOLYGON\r\ndimension:      XY\r\nbbox:           xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965\r\nepsg (SRID):    4267\r\nproj4string:    +proj=longlat +datum=NAD27 +no_defs\r\n\u2550\u2550 Skipped tests \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\u25cf \"OSM\" %in% st_drivers()$name && Sys.info()[\"sysname\"] != \"Darwin\" is not TRUE (1)\r\n\u25cf empty test (3)\r\n\u25cf sf_extSoftVersion()[[\"GDAL\"]] < \"2.5.0\" is not TRUE (3)\r\n\u25cf sf_extSoftVersion()[[\"proj.4\"]] < \"6.0.0\" is not TRUE (1)\r\n\u25cf sp cannot be loaded (1)\r\n\u25cf Sys.getenv(\"USER\") %in% c(\"edzer\", \"travis\") is not TRUE (1)\r\n\r\n\u2550\u2550 Warnings \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\u2500\u2500 Warning (test_crs.R:47:3): $.crs works \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nGDAL Message 1: +init=epsg:XXXX syntax is deprecated. It might return a CRS with a non-EPSG compliant axis order.\r\nBacktrace:\r\n 1. testthat::expect_true(is.numeric(st_crs(\"+init=epsg:3857\")$epsg)) test_crs.R:47:2\r\n 5. sf:::st_crs.character(\"+init=epsg:3857\")\r\n 6. sf:::make_crs(x)\r\n 7. sf:::CPL_crs_from_proj4string(x)\r\n\u2500\u2500 Warning (test_deprecated-db.R:15:1): (code run outside of `test_that()`) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nthere is no package called \u2018sp\u2019\r\nBacktrace:\r\n 1. base::require(\"sp\") test_deprecated-db.R:15:0\r\n 6. base::library(...)\r\n\u2500\u2500 Warning (test_deprecated-db.R:16:1): (code run outside of `test_that()`) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\ndata set \u2018meuse\u2019 not found\r\nBacktrace:\r\n 1. utils::data(meuse) test_deprecated-db.R:16:0\r\n\u2500\u2500 Warning (test_geos.R:257:2): binary operations work on sf objects with common column names \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nattribute variables are assumed to be spatially constant throughout all geometries\r\nBacktrace:\r\n 1. testthat::expect_is(st_intersection(sf1, sf2), \"sf\") test_geos.R:257:8\r\n 5. sf:::st_intersection.sf(sf1, sf2)\r\n 6. sf:::geos_op2_df(x, y, geos_op2_geom(\"intersection\", x, y))\r\n\r\n\u2550\u2550 Failed tests \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\u2500\u2500 Error (test_deprecated-db.R:17:1): (code run outside of `test_that()`) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: object 'meuse' not found\r\nBacktrace:\r\n    \u2588\r\n 1. \u2514\u2500sf::st_as_sf(meuse, coords = c(\"x\", \"y\"), crs = 28992) test_deprecated-db.R:17:0\r\n\u2500\u2500 Error (test_geos.R:5:3): st_relate works \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: there is no package called \u2018sp\u2019\r\nBacktrace:\r\n    \u2588\r\n 1. \u2514\u2500base::library(sp) test_geos.R:5:2\r\n\u2500\u2500 Error (test_geos.R:52:2): geos ops give warnings and errors on longlat \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: package lwgeom required, please install it first\r\nBacktrace:\r\n     \u2588\r\n  1. \u251c\u2500testthat::expect_silent(st_segmentize(l, 1e+05)) test_geos.R:52:8\r\n  2. \u2502 \u2514\u2500testthat:::quasi_capture(enquo(object), NULL, evaluate_promise)\r\n  3. \u2502   \u251c\u2500testthat:::.capture(...)\r\n  4. \u2502   \u2502 \u251c\u2500withr::with_output_sink(...)\r\n  5. \u2502   \u2502 \u2502 \u2514\u2500base::force(code)\r\n  6. \u2502   \u2502 \u251c\u2500base::withCallingHandlers(...)\r\n  7. \u2502   \u2502 \u2514\u2500base::withVisible(code)\r\n  8. \u2502   \u2514\u2500rlang::eval_bare(quo_get_expr(.quo), quo_get_env(.quo))\r\n  9. \u251c\u2500sf::st_segmentize(l, 1e+05)\r\n 10. \u2514\u2500sf:::st_segmentize.sfc(l, 1e+05)\r\n\u2500\u2500 Error (test_geos.R:79:3): st_area() works on GEOMETRY in longlat (#131) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: package lwgeom required, please install it first\r\nBacktrace:\r\n     \u2588\r\n  1. \u251c\u2500testthat::expect_silent(st_area(st_set_crs(w, 4326))) test_geos.R:79:2\r\n  2. \u2502 \u2514\u2500testthat:::quasi_capture(enquo(object), NULL, evaluate_promise)\r\n  3. \u2502   \u251c\u2500testthat:::.capture(...)\r\n  4. \u2502   \u2502 \u251c\u2500withr::with_output_sink(...)\r\n  5. \u2502   \u2502 \u2502 \u2514\u2500base::force(code)\r\n  6. \u2502   \u2502 \u251c\u2500base::withCallingHandlers(...)\r\n  7. \u2502   \u2502 \u2514\u2500base::withVisible(code)\r\n  8. \u2502   \u2514\u2500rlang::eval_bare(quo_get_expr(.quo), quo_get_env(.quo))\r\n  9. \u251c\u2500sf::st_area(st_set_crs(w, 4326))\r\n 10. \u2514\u2500sf:::st_area.sfc(st_set_crs(w, 4326))\r\n\u2500\u2500 Error (test_geos.R:259:2): binary operations work on sf objects with common column names \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: All columns in a tibble must be vectors.\r\n\u2716 Column `pol1` is a `sfc_POLYGON/sfc` object.\r\nBacktrace:\r\n    \u2588\r\n 1. \u251c\u2500sf::st_as_sf(tibble::as_tibble(sf1)) test_geos.R:259:8\r\n 2. \u251c\u2500tibble::as_tibble(sf1)\r\n 3. \u2514\u2500tibble:::as_tibble.data.frame(sf1)\r\n 4.   \u2514\u2500tibble:::lst_to_tibble(unclass(x), .rows, .name_repair)\r\n 5.     \u2514\u2500tibble:::check_valid_cols(x)\r\n\u2500\u2500 Error (test_postgis_ODBC.R:3:1): (code run outside of `test_that()`) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: there is no package called \u2018RPostgreSQL\u2019\r\n\u2026\u2026\r\nError: there is no package called \u2018blob\u2019\r\nBacktrace:\r\n    \u2588\r\n 1. \u2514\u2500blob::blob test_wkb.R:57:2\r\n 2.   \u2514\u2500base::getExportedValue(pkg, name)\r\n 3.     \u2514\u2500base::asNamespace(ns)\r\n 4.       \u2514\u2500base::getNamespace(ns)\r\n 5.         \u2514\u2500base::loadNamespace(name)\r\n 6.           \u2514\u2500base::withRestarts(stop(cond), retry_loadNamespace = function() NULL)\r\n 7.             \u2514\u2500base:::withOneRestart(expr, restarts[[1L]])\r\n 8.               \u2514\u2500base:::doWithOneRestart(return(expr), restart)\r\n\u2500\u2500 Error (test_write.R:3:1): (code run outside of `test_that()`) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\nError: there is no package called \u2018sp\u2019\r\nBacktrace:\r\n    \u2588\r\n 1. \u2514\u2500utils::data(meuse, package = \"sp\") test_write.R:3:0\r\n 2.   \u2514\u2500base::find.package(package, lib.loc, verbose = verbose)\r\n\r\n[ FAIL 23 | WARN 4 | SKIP 10 | PASS 510 ]\r\nError: Test failures\r\nExecution halted\r\n[root@centos8 spack-src]# cd tests/\r\n[root@centos8 tests]# ls\r\naggregate.R          cast.Rout.save  dist.Rout.save   empty.Rout.save      geos.Rout.save       grid.Rout.save  read.Rout.save       sfc.Rout.save  stars.Rout.save     units.R          zzz.R\r\naggregate.Rout.save  crs.R           dplyr.R          gdal_geom.R          graticule.R          plot.R          roundtrip.R          sfg.R          testthat            units.Rout.save  zzz.Rout.save\r\nbgmap.rda            crs.Rout.save   dplyr.Rout.save  gdal_geom.Rout.save  graticule.Rout.save  plot.Rout.save  roundtrip.Rout.save  sfg.Rout.save  testthat.R          wkb.R\r\ncast.R               dist.R          empty.R          geos.R               grid.R               read.R          sfc.R                stars.R        testthat.Rout.save  wkb.Rout.save\r\n```\r\nObviously, the test case is generated in **r-testthat**. After r-testthat is installed and updated, the **r-testthat** dependency problem still occurs after **Rscript testthat.R** is executed. I hope someone can provide guidance on how to solve the **r-testthat** dependency problem.\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n```console\r\n[root@centos8 tests]# spack debug report\r\n* **Spack:** 0.16.0-1044-d577b6fcdf\r\n* **Python:** 3.8.7\r\n* **Platform:** linux-centos8-aarch64\r\n* **Concretizer:** original\r\n```\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [ ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ ] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}