{
    "url": "https://api.github.com/repos/spack/spack/issues/24242",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/24242/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/24242/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/24242/events",
    "html_url": "https://github.com/spack/spack/issues/24242",
    "id": 917601312,
    "node_id": "MDU6SXNzdWU5MTc2MDEzMTI=",
    "number": 24242,
    "title": "`spack config rm` does not remove the `compilers` section from an env",
    "user": {
        "login": "arekfu",
        "id": 1193708,
        "node_id": "MDQ6VXNlcjExOTM3MDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1193708?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/arekfu",
        "html_url": "https://github.com/arekfu",
        "followers_url": "https://api.github.com/users/arekfu/followers",
        "following_url": "https://api.github.com/users/arekfu/following{/other_user}",
        "gists_url": "https://api.github.com/users/arekfu/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/arekfu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/arekfu/subscriptions",
        "organizations_url": "https://api.github.com/users/arekfu/orgs",
        "repos_url": "https://api.github.com/users/arekfu/repos",
        "events_url": "https://api.github.com/users/arekfu/events{/privacy}",
        "received_events_url": "https://api.github.com/users/arekfu/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2021-06-10T17:22:53Z",
    "updated_at": "2021-06-11T06:34:27Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack env create test\r\n$ GCC_DIR=$(spack location -i gcc@7.5.0)  # for example, any compiler will do\r\n$ spack env activate test\r\n$ spack compiler add --scope env:test ${GCC_DIR}\r\n```\r\nAfter this command, `$SPACK_ROOT/var/spack/environments/test/spack.yaml` should contain a `compilers` section.\r\n```console\r\n$ spack config --scope env:test get compilers\r\n# This is a Spack Environment file.\r\n#\r\n# It describes a set of packages to be installed, along with\r\n# configuration settings.\r\nspack:\r\n  # add package specs to the `specs` list\r\n  specs: []\r\n  view: true\r\n  compilers:\r\n  - compiler:\r\n      spec: gcc@7.5.0\r\n      paths:\r\n        cc: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/gcc\r\n        cxx: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/g++\r\n        f77: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/gfortran\r\n        fc: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/gfortran\r\n      flags: {}\r\n      operating_system: ubuntu16.04\r\n      target: x86_64\r\n      modules: []\r\n      environment: {}\r\n      extra_rpaths: []\r\n```\r\nNow I try to remove the section\r\n```console\r\n$ spack config --scope env:test rm config:compilers\r\n```\r\nThe command succeeds, but the `compilers` section is not removed from `spack.yaml`:\r\n```console\r\n$ spack config --scope env:test get compilers\r\n# This is a Spack Environment file.\r\n#\r\n# It describes a set of packages to be installed, along with\r\n# configuration settings.\r\nspack:\r\n  # add package specs to the `specs` list\r\n  specs: []\r\n  view: true\r\n  compilers:\r\n  - compiler:\r\n      spec: gcc@7.5.0\r\n      paths:\r\n        cc: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/gcc\r\n        cxx: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/g++\r\n        f77: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/gfortran\r\n        fc: /home/dm232107/src/spack/opt/spack/linux-ubuntu16.04-skylake/gcc-10.2.0/gcc-7.5.0-6xs6wkm7r2veak637opmyisphotmtsn2/bin/gfortran\r\n      flags: {}\r\n      operating_system: ubuntu16.04\r\n      target: x86_64\r\n      modules: []\r\n      environment: {}\r\n      extra_rpaths: []\r\n```\r\nThis gives an error instead:\r\n```console\r\n$ spack config --scope env:test rm compilers\r\n==> Error: pop from empty list\r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\n```console\r\n$ spack --debug --stacktrace config --scope env:test rm config:compilers\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-06-10-19:20:33.430115] Imported config from built-in commands\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-06-10-19:20:33.432503] Imported config from built-in commands\r\nlib/spack/spack/config.py:981 ==> [2021-06-10-19:20:33.433397] Reading config file /volatile/home/dm232107/src/spack/var/spack/environments/test/spack.yaml\r\n$ spack --debug --stacktrace config --scope env:test rm compilers\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-06-10-19:20:47.113600] Imported config from built-in commands\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-06-10-19:20:47.116044] Imported config from built-in commands\r\nlib/spack/spack/config.py:981 ==> [2021-06-10-19:20:47.117845] Reading config file /volatile/home/dm232107/src/spack/var/spack/environments/test/spack.yaml\r\nTraceback (most recent call last):\r\n  File \"/volatile/home/dm232107/src/spack/bin/spack\", line 76, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/volatile/home/dm232107/src/spack/lib/spack/spack/main.py\", line 774, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/volatile/home/dm232107/src/spack/lib/spack/spack/main.py\", line 498, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/volatile/home/dm232107/src/spack/lib/spack/spack/cmd/config.py\", line 472, in config\r\n    action[args.config_command](args)\r\n  File \"/volatile/home/dm232107/src/spack/lib/spack/spack/cmd/config.py\", line 217, in config_remove\r\n    existing = spack.config.get(path, scope=scope)\r\n  File \"/volatile/home/dm232107/src/spack/lib/spack/spack/config.py\", line 898, in get\r\n    return config.get(path, default, scope)\r\n  File \"/volatile/home/dm232107/src/spack/lib/spack/spack/config.py\", line 645, in get\r\n    section = parts.pop(0)\r\nIndexError: pop from empty list\r\n```\r\n\r\n### Information on your system\r\n\r\n```console\r\n$ spack debug report\r\n* **Spack:** 0.16.1-2696-f1c849c\r\n* **Python:** 3.8.1\r\n* **Platform:** linux-ubuntu16.04-skylake\r\n* **Concretizer:** original\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output",
    "performed_via_github_app": null
}