{
    "url": "https://api.github.com/repos/spack/spack/issues/20721",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/20721/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/20721/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/20721/events",
    "html_url": "https://github.com/spack/spack/issues/20721",
    "id": 781037589,
    "node_id": "MDU6SXNzdWU3ODEwMzc1ODk=",
    "number": 20721,
    "title": "Meson's `find_library` does not search dependencies",
    "user": {
        "login": "blue42u",
        "id": 17242663,
        "node_id": "MDQ6VXNlcjE3MjQyNjYz",
        "avatar_url": "https://avatars.githubusercontent.com/u/17242663?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/blue42u",
        "html_url": "https://github.com/blue42u",
        "followers_url": "https://api.github.com/users/blue42u/followers",
        "following_url": "https://api.github.com/users/blue42u/following{/other_user}",
        "gists_url": "https://api.github.com/users/blue42u/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/blue42u/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/blue42u/subscriptions",
        "organizations_url": "https://api.github.com/users/blue42u/orgs",
        "repos_url": "https://api.github.com/users/blue42u/repos",
        "events_url": "https://api.github.com/users/blue42u/events{/privacy}",
        "received_events_url": "https://api.github.com/users/blue42u/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2021-01-07T05:22:07Z",
    "updated_at": "2021-08-02T13:24:44Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "Tried packaging a Meson-based project that uses `find_library()` to find `libbfd` from `binutils` (needed since it doesn't ship a pkg-config or CMake file), but Meson will only search the system directories and not dependencies. Building outside Spack (using `spack load binutils`) works as desired.\r\n\r\n### Steps to reproduce the issue\r\n\r\nCreate a minimal Meson project that uses `find_library`:\r\n```console\r\n$ mkdir /tmp/bug-project && cd /tmp/bug-project\r\n$ cat > meson.build <<EOF\r\nproject('test', 'c')\r\nmeson.get_compiler('c').find_library('bfd', static: true)\r\nconfigure_file(configuration: {'TEST': 1}, output: 'test.h', install: true, install_dir: 'include')\r\nEOF\r\n$ spack create --skip-editor -fn bug\r\n$ cat > \"`spack location -p bug`\"/package.py <<EOF\r\nfrom spack import *\r\nclass Bug(MesonPackage):\r\n    url = \"https://example.com\"\r\n    version('master', url=\"file:///tmp/bug-project.tar\")\r\n    depends_on('binutils')\r\nEOF\r\n$ tar cf ../bug-project.tar -C .. bug-project\r\n$ spack install --only dependencies bug\r\n```\r\nConfiguring outside of Spack (using `LIBRARY_PATH`) works fine:\r\n```console\r\n$ LIBRARY_PATH=`spack location -i binutils`/lib64:`spack location -i binutils`/lib:$LIBRARY_PATH meson setup meson-build-1\r\nThe Meson build system\r\nVersion: 0.58.1\r\nSource dir: /tmp/bug-project\r\nBuild dir: /tmp/bug-project/meson-build-1\r\nBuild type: native build\r\nProject name: test\r\nProject version: undefined\r\nC compiler for the host machine: ccache cc (gcc 10.2.1 \"cc (Debian 10.2.1-6) 10.2.1 20210110\")\r\nC linker for the host machine: cc ld.bfd 2.35.2\r\nHost machine cpu family: x86_64\r\nHost machine cpu: x86_64\r\nLibrary bfd found: YES\r\nConfiguring test.h using configuration\r\nBuild targets in project: 0\r\n\r\nFound ninja-1.10.1 at /tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/ninja-1.10.2-ug54hcqtm4zwztp4yjviz5rc5jauxnfe/bin/ninja\r\n```\r\nConfiguring using `dev-build` or `install` however fails:\r\n```console\r\n$ spack --debug dev-build bug@master\r\n...\r\n==> [2021-08-02-08:12:15.668024] Installing bug-master-omnuvkajoxoeovenak52izbdia6pf5jc\r\n==> [2021-08-02-08:12:15.668050] Searching for binary cache of bug-master-omnuvkajoxoeovenak52izbdia6pf5jc\r\n==> [2021-08-02-08:12:15.668094] Reading config file /tmp/spack/etc/spack/defaults/mirrors.yaml\r\n==> [2021-08-02-08:12:16.003390] Did not find linux-debian11-zen2-gcc-11.1.0-bug-master-omnuvkajoxoeovenak52izbdia6pf5jc.spec.yaml on https://mirror.spack.io/build_cache/linux-debian11-zen2-gcc-11.1.0-bug-master-omnuvkajoxoeovenak52izbdia6pf5jc.spec.yaml\r\n  Download failed: HTTP Error 404: Not Found\r\n==> [2021-08-02-08:12:16.003567] No binary for bug-master-omnuvkajoxoeovenak52izbdia6pf5jc found: installing from source\r\n==> [2021-08-02-08:12:16.136936] '/usr/bin/git' 'describe' '--tags' '--match' 'v*'\r\n==> [2021-08-02-08:12:16.228274] [TOOLCHAIN] MATCH Gcc\r\n==> [2021-08-02-08:12:16.230568] Adding compiler bin/ paths: /tmp/spack/lib/spack/env /tmp/spack/lib/spack/env/case-insensitive /tmp/spack/lib/spack/env/gcc\r\n==> [2021-08-02-08:12:16.241962] No libraries found for tar\r\n==> [2021-08-02-08:12:16.242046] No headers found for tar\r\n==> [2021-08-02-08:12:16.245110] No libraries found for binutils\r\n==> [2021-08-02-08:12:16.264303] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=True, prefix=\"\"))'\r\n==> [2021-08-02-08:12:16.285693] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_inc; print(get_python_inc(plat_specific=False, prefix=\"\"))'\r\n==> [2021-08-02-08:12:16.307516] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=False, prefix=\"\"))'\r\n==> [2021-08-02-08:12:16.344070] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\n==> [2021-08-02-08:12:16.373854] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=False, prefix=\"\"))'\r\n==> [2021-08-02-08:12:16.409865] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=False, prefix=\"\"))'\r\n==> [2021-08-02-08:12:16.435559] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'CC'\"'\"'))'\r\n==> [2021-08-02-08:12:16.457622] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'LDSHARED'\"'\"'))'\r\n==> [2021-08-02-08:12:16.483819] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'CXX'\"'\"'))'\r\n==> [2021-08-02-08:12:16.505541] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'LDCXXSHARED'\"'\"'))'\r\n==> [2021-08-02-08:12:16.548110] A dependency has updated CPATH, this may lead pkg-config to assume that the package is part of the system includes and omit it when invoked with '--cflags'.\r\n==> [2021-08-02-08:12:16.569285] '/usr/bin/g++-11' '-v' '/tmp/user/1000/spack-implicit-link-infow20t0xhc/main.c' '-o' '/tmp/user/1000/spack-implicit-link-infow20t0xhc/output'\r\n==> [2021-08-02-08:12:16.600247] parsing implicit link info\r\n==> [2021-08-02-08:12:16.600581] linker line:  /usr/lib/gcc/x86_64-linux-gnu/11/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/user/1000/cckE52JK.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --eh-frame-hdr -m elf_x86_64 --hash-style=gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie -o /tmp/user/1000/spack-implicit-link-infow20t0xhc/output /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/11/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/11 -L/usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/11/../../.. /tmp/user/1000/cc3zIVwJ.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/lib/gcc/x86_64-linux-gnu/11/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/crtn.o\r\n==> [2021-08-02-08:12:16.600652] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11\r\n==> [2021-08-02-08:12:16.600683] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu\r\n==> [2021-08-02-08:12:16.600708] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib\r\n==> [2021-08-02-08:12:16.600731] linkdir: /lib/x86_64-linux-gnu\r\n==> [2021-08-02-08:12:16.600753] linkdir: /lib/../lib\r\n==> [2021-08-02-08:12:16.600775] linkdir: /usr/lib/x86_64-linux-gnu\r\n==> [2021-08-02-08:12:16.600797] linkdir: /usr/lib/../lib\r\n==> [2021-08-02-08:12:16.600819] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11/../../..\r\n==> [2021-08-02-08:12:16.600857] found raw link dirs: /usr/lib/gcc/x86_64-linux-gnu/11, /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu, /usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib, /lib/x86_64-linux-gnu, /lib/../lib, /usr/lib/x86_64-linux-gnu, /usr/lib/../lib, /usr/lib/gcc/x86_64-linux-gnu/11/../../..\r\n==> [2021-08-02-08:12:16.600933] found link dirs: /usr/lib/gcc/x86_64-linux-gnu/11, /usr/lib/x86_64-linux-gnu, /usr/lib, /lib/x86_64-linux-gnu, /lib\r\n==> [2021-08-02-08:12:16.602104] No need to fetch for DIY.\r\n==> [2021-08-02-08:12:16.602177] No checksum needed for DIY.\r\n==> [2021-08-02-08:12:16.602216] Sources for DIY stages are not cached\r\n==> [2021-08-02-08:12:16.602256] Using source directory: /tmp/bug-project\r\n==> [2021-08-02-08:12:16.602316] No patches needed for bug\r\n==> [2021-08-02-08:12:16.602372] bug: Building bug-master-omnuvkajoxoeovenak52izbdia6pf5jc [MesonPackage]\r\n==> [2021-08-02-08:12:16.605889] bug: Executing phase: 'meson'\r\n==> [2021-08-02-08:12:16.607756] 'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\nThe Meson build system\r\nVersion: 0.59.0\r\nSource dir: /tmp/bug-project\r\nBuild dir: /tmp/bug-project/spack-build\r\nBuild type: native build\r\nProject name: test\r\nProject version: undefined\r\nC compiler for the host machine: /tmp/spack/lib/spack/env/gcc/gcc (gcc 11.1.0 \"gcc-11 (Debian 11.1.0-3) 11.1.0\")\r\nC linker for the host machine: /tmp/spack/lib/spack/env/gcc/gcc ld.bfd 2.35.2\r\nHost machine cpu family: x86_64\r\nHost machine cpu: x86_64\r\n\r\n../meson.build:2:24: ERROR: C static library 'bfd' not found\r\n\r\nA full log can be found at /tmp/bug-project/spack-build/meson-logs/meson-log.txt\r\n==> [2021-08-02-08:12:17.032247] Error: ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\nSee build log for details:\r\n  /tmp/bug-project/spack-build-out.txt\r\n\r\nTraceback (most recent call last):\r\n  File \"/tmp/spack/lib/spack/spack/build_environment.py\", line 1013, in _setup_pkg_and_run\r\n    return_value = function(pkg, kwargs)\r\n  File \"/tmp/spack/lib/spack/spack/installer.py\", line 1792, in build_process\r\n    phase(pkg.spec, pkg.prefix)\r\n  File \"/tmp/spack/lib/spack/spack/package.py\", line 115, in phase_wrapper\r\n    phase(spec, prefix)\r\n  File \"/tmp/spack/lib/spack/spack/build_systems/meson.py\", line 162, in meson\r\n    inspect.getmodule(self).meson(*options)\r\n  File \"/tmp/spack/lib/spack/spack/util/executable.py\", line 225, in __call__\r\n    raise ProcessError('Command exited with status %d:' %\r\nspack.util.executable.ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\n==> [2021-08-02-08:12:17.037752] Flagging bug-master-omnuvkajoxoeovenak52izbdia6pf5jc as failed: ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\n==> [2021-08-02-08:12:17.039915] ChildError: ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-omnuvkajoxoeovenak52izbdia6pf5jc/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/bug-project' '--prefix=/tmp/spack/opt/spack/linux-debianunstable-zen2/gcc-10.2.0/bug-master-k74oxjaungxglzy4sohsnjsyyua56pdb' '--libdir=/tmp/spack/opt/spack/linux-debianunstable-zen2/gcc-10.2.0/bug-master-k74oxjaungxglzy4sohsnjsyyua56pdb/lib' '--buildtype=release' '--strip'\r\nSee build log for details:\r\n  /tmp/bug-project/spack-build-out.txt\r\n$ spack --debug install -nv bug\r\n...\r\n==> [2021-08-02-08:11:08.503172] Installing bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b\r\n==> [2021-08-02-08:11:08.503202] Searching for binary cache of bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b\r\n==> [2021-08-02-08:11:08.503248] Reading config file /tmp/spack/etc/spack/defaults/mirrors.yaml\r\n==> [2021-08-02-08:11:09.022763] Did not find linux-debian11-zen2-gcc-11.1.0-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b.spec.yaml on https://mirror.spack.io/build_cache/linux-debian11-zen2-gcc-11.1.0-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b.spec.yaml\r\n  Download failed: HTTP Error 404: Not Found\r\n==> [2021-08-02-08:11:09.022949] No binary for bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b found: installing from source\r\n==> [2021-08-02-08:11:09.138000] '/usr/bin/git' 'describe' '--tags' '--match' 'v*'\r\n==> [2021-08-02-08:11:09.254319] [TOOLCHAIN] MATCH Gcc\r\n==> [2021-08-02-08:11:09.255329] Adding compiler bin/ paths: /tmp/spack/lib/spack/env /tmp/spack/lib/spack/env/case-insensitive /tmp/spack/lib/spack/env/gcc\r\n==> [2021-08-02-08:11:09.264742] No libraries found for tar\r\n==> [2021-08-02-08:11:09.264824] No headers found for tar\r\n==> [2021-08-02-08:11:09.267850] No libraries found for binutils\r\n==> [2021-08-02-08:11:09.300777] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=True, prefix=\"\"))'\r\n==> [2021-08-02-08:11:09.338864] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_inc; print(get_python_inc(plat_specific=False, prefix=\"\"))'\r\n==> [2021-08-02-08:11:09.363554] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=False, prefix=\"\"))'\r\n==> [2021-08-02-08:11:09.386596] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\n==> [2021-08-02-08:11:09.423459] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=False, prefix=\"\"))'\r\n==> [2021-08-02-08:11:09.444999] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_python_lib; print(get_python_lib(plat_specific=False, standard_lib=False, prefix=\"\"))'\r\n==> [2021-08-02-08:11:09.486685] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'CC'\"'\"'))'\r\n==> [2021-08-02-08:11:09.507901] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'LDSHARED'\"'\"'))'\r\n==> [2021-08-02-08:11:09.530318] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'CXX'\"'\"'))'\r\n==> [2021-08-02-08:11:09.554881] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/python-3.8.11-jgjrqu6v64tnj7bqdghjh26ecgorn6er/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'LDCXXSHARED'\"'\"'))'\r\n==> [2021-08-02-08:11:09.606000] A dependency has updated CPATH, this may lead pkg-config to assume that the package is part of the system includes and omit it when invoked with '--cflags'.\r\n==> [2021-08-02-08:11:09.627120] '/usr/bin/g++-11' '-v' '/tmp/user/1000/spack-implicit-link-info75z_ohpc/main.c' '-o' '/tmp/user/1000/spack-implicit-link-info75z_ohpc/output'\r\n==> [2021-08-02-08:11:09.658627] parsing implicit link info\r\n==> [2021-08-02-08:11:09.658992] linker line:  /usr/lib/gcc/x86_64-linux-gnu/11/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/11/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/11/lto-wrapper -plugin-opt=-fresolution=/tmp/user/1000/cc4R5Dla.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --eh-frame-hdr -m elf_x86_64 --hash-style=gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie -o /tmp/user/1000/spack-implicit-link-info75z_ohpc/output /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/11/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/11 -L/usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/11/../../.. /tmp/user/1000/cc57jlJa.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/lib/gcc/x86_64-linux-gnu/11/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/crtn.o\r\n==> [2021-08-02-08:11:09.659076] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11\r\n==> [2021-08-02-08:11:09.659111] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu\r\n==> [2021-08-02-08:11:09.659139] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib\r\n==> [2021-08-02-08:11:09.659166] linkdir: /lib/x86_64-linux-gnu\r\n==> [2021-08-02-08:11:09.659194] linkdir: /lib/../lib\r\n==> [2021-08-02-08:11:09.659221] linkdir: /usr/lib/x86_64-linux-gnu\r\n==> [2021-08-02-08:11:09.659247] linkdir: /usr/lib/../lib\r\n==> [2021-08-02-08:11:09.659273] linkdir: /usr/lib/gcc/x86_64-linux-gnu/11/../../..\r\n==> [2021-08-02-08:11:09.659319] found raw link dirs: /usr/lib/gcc/x86_64-linux-gnu/11, /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu, /usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib, /lib/x86_64-linux-gnu, /lib/../lib, /usr/lib/x86_64-linux-gnu, /usr/lib/../lib, /usr/lib/gcc/x86_64-linux-gnu/11/../../..\r\n==> [2021-08-02-08:11:09.659404] found link dirs: /usr/lib/gcc/x86_64-linux-gnu/11, /usr/lib/x86_64-linux-gnu, /usr/lib, /lib/x86_64-linux-gnu, /lib\r\n==> [2021-08-02-08:11:09.661209] Checking existence of https://mirror.spack.io/bug/bug-master.tar\r\n==> [2021-08-02-08:11:10.050133] FailedDownloadError: Failed to fetch file from URL: https://mirror.spack.io/bug/bug-master.tar\r\n    Urllib fetch failed to verify url https://mirror.spack.io/bug/bug-master.tar\r\n==> [2021-08-02-08:11:10.050491] Checking existence of file:///tmp/bug-project.tar\r\n==> [2021-08-02-08:11:10.056139] Fetching file:///tmp/bug-project.tar\r\n==> [2021-08-02-08:11:10.057356] Fetching from https://mirror.spack.io/bug/bug-master.tar failed.\r\n==> [2021-08-02-08:11:10.057555] Staging archive: /tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/bug-project.tar\r\n==> [2021-08-02-08:11:10.058338] '/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/tar-1.34-veysxngydxddopehawssldbizsoumttv/bin/tar' '-oxf' '/tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/bug-project.tar'\r\n==> [2021-08-02-08:11:10.062922] Created stage in /tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b\r\n==> [2021-08-02-08:11:10.063102] No patches needed for bug\r\n==> [2021-08-02-08:11:10.063182] bug: Building bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b [MesonPackage]\r\n==> [2021-08-02-08:11:10.066952] bug: Executing phase: 'meson'\r\n==> [2021-08-02-08:11:10.068510] 'meson' '/tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/spack-src' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\nThe Meson build system\r\nVersion: 0.59.0\r\nSource dir: /tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/spack-src\r\nBuild dir: /tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/spack-src/spack-build\r\nBuild type: native build\r\nProject name: test\r\nProject version: undefined\r\nC compiler for the host machine: /tmp/spack/lib/spack/env/gcc/gcc (gcc 11.1.0 \"gcc-11 (Debian 11.1.0-3) 11.1.0\")\r\nC linker for the host machine: /tmp/spack/lib/spack/env/gcc/gcc ld.bfd 2.35.2\r\nHost machine cpu family: x86_64\r\nHost machine cpu: x86_64\r\n\r\n../meson.build:2:24: ERROR: C static library 'bfd' not found\r\n\r\nA full log can be found at /tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/spack-src/spack-build/meson-logs/meson-log.txt\r\n==> [2021-08-02-08:11:10.540303] Error: ProcessError: Command exited with status 1:\r\n    'meson' '/tmp/user/1000/deepthought/spack-stage/spack-stage-bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/spack-src' '--prefix=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b' '--libdir=/tmp/spack/opt/spack/linux-debian11-zen2/gcc-11.1.0/bug-master-7vl5srbcdnxds7obnqbox5n4xi2qny3b/lib' '-Dbuildtype=debugoptimized' '-Dstrip=false' '-Ddefault_library=shared'\r\n```\r\n\r\nNote that this error only occurs when the `static:` flag is passed:\r\n```console\r\n$ rm -r spack-* *-build*\r\n$ cat > meson.build <<EOF\r\nproject('test', 'c')\r\nmeson.get_compiler('c').find_library('bfd')\r\nconfigure_file(configuration: {'TEST': 1}, output: 'test.h', install: true, install_dir: 'include')\r\nEOF\r\n$ tar cf ../bug-project.tar -C .. bug-project\r\n$ spack --debug dev-build bug@master\r\n# ... Completes without error\r\n$ spack --debug install -nv bug\r\n# ... Completes without error\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.2-3754-ac8521e9b3\r\n* **Python:** 3.9.2\r\n* **Platform:** linux-debian11-zen2\r\n* **Concretizer:** original\r\n\r\n### Additional information\r\n\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output",
    "performed_via_github_app": null
}