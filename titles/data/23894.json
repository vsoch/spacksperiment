{
    "url": "https://api.github.com/repos/spack/spack/issues/23894",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/23894/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/23894/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/23894/events",
    "html_url": "https://github.com/spack/spack/issues/23894",
    "id": 901196447,
    "node_id": "MDU6SXNzdWU5MDExOTY0NDc=",
    "number": 23894,
    "title": "[visit] Recipe needs additional version constraints",
    "user": {
        "login": "KineticTheory",
        "id": 17579601,
        "node_id": "MDQ6VXNlcjE3NTc5NjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/17579601?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/KineticTheory",
        "html_url": "https://github.com/KineticTheory",
        "followers_url": "https://api.github.com/users/KineticTheory/followers",
        "following_url": "https://api.github.com/users/KineticTheory/following{/other_user}",
        "gists_url": "https://api.github.com/users/KineticTheory/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/KineticTheory/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/KineticTheory/subscriptions",
        "organizations_url": "https://api.github.com/users/KineticTheory/orgs",
        "repos_url": "https://api.github.com/users/KineticTheory/repos",
        "events_url": "https://api.github.com/users/KineticTheory/events{/privacy}",
        "received_events_url": "https://api.github.com/users/KineticTheory/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2021-05-25T18:28:04Z",
    "updated_at": "2021-05-25T18:28:04Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I was able to build visit on Ubuntu-20.04 with gcc@9.3.0 after some trial and error iterations.  The visit recipe is not properly constrained as it expects older versions of many dependencies. \r\n\r\nThis is a update/replacement of #16243 and is related to #16965 and #13555.\r\n\r\n### Steps to reproduce the issue\r\n\r\n* I'm working from spack hash 769e549cd91583d462d686e0a19b6469e593c40e with the classic concretizer.\r\n* `spack info` provides helpful information about how to specify older versions of dependencies: \r\n\r\n```console\r\n$ spack info visit\r\n\r\n    LINUX-------------------------------------------------------------------\r\n    spack install visit ^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0\r\n```\r\n\r\n* Why are these requirements not encoded in `visit/package.py`?  \r\n* BTW - if you don't use these extra constraints, the spack concretizer generates an error.  To make it easier to find this issue report, I've included the detailed error message below.\r\n\r\n```console\r\n$ spack spec visit\r\n--------------------------------\r\n==> Error: An unsatisfiable version constraint has been detected for spec:\r\n    python@2.7.18%gcc@9.3.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib arch=linux-ubuntu20.04-ivybridge\r\n        ^bzip2@1.0.8%gcc@9.3.0+shared arch=linux-ubuntu20.04-ivybridge\r\n            ^diffutils@3.7%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^libiconv@1.16%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^expat@2.3.0%gcc@9.3.0+libbsd arch=linux-ubuntu20.04-ivybridge\r\n            ^libbsd@0.11.3%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^libmd\r\n        ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n            ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-ivybridge\r\n                    ^pkgconf@1.7.4%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^gettext@0.21%gcc@9.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-ubuntu20.04-ivybridge\r\n            ^libxml2@2.9.10%gcc@9.3.0~python arch=linux-ubuntu20.04-ivybridge\r\n                ^xz@5.2.5%gcc@9.3.0~pic arch=linux-ubuntu20.04-ivybridge\r\n                ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-ivybridge\r\n            ^tar\r\n        ^libffi@3.3%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^openssl@1.1.1k%gcc@9.3.0~docs+systemcerts arch=linux-ubuntu20.04-ivybridge\r\n            ^perl@5.32.1%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-ivybridge\r\n                ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl arch=linux-ubuntu20.04-ivybridge\r\n        ^sqlite@3.35.4%gcc@9.3.0+column_metadata+fts~functions~rtree arch=linux-ubuntu20.04-ivybridge\r\n        ^util-linux-uuid@2.36.2%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    py-setuptools@50.3.2%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n\r\npy-setuptools requires python version 3.5:, but spec asked for 2.7.18\r\n```\r\n\r\n### Fix 1 and a new error\r\n\r\n* Eliminate the above error by using the constraints provided by the package's info message:\r\n  * Add `^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0`\r\n\r\n```console\r\n$ spack spec visit ^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0 \r\n==> Error: An unsatisfiable variant constraint has been detected for spec:\r\n\r\n    binutils@2.36.1%gcc@9.3.0~gas+gold~headers~interwork~ld~libiberty~lto+nls~plugins arch=linux-ubuntu20.04-ivybridge\r\n        ^diffutils@3.7%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n            ^libiconv@1.16%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^gettext@0.21%gcc@9.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-ubuntu20.04-ivybridge\r\n            ^bzip2@1.0.8%gcc@9.3.0+shared arch=linux-ubuntu20.04-ivybridge\r\n            ^libxml2@2.9.10%gcc@9.3.0~python arch=linux-ubuntu20.04-ivybridge\r\n                ^pkgconf@1.7.4%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^xz@5.2.5%gcc@9.3.0~pic arch=linux-ubuntu20.04-ivybridge\r\n                ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-ivybridge\r\n            ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-ivybridge\r\n            ^tar\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    llvm@10.0.1%gcc@9.3.0~all_targets+clang~code_signing+compiler-rt~cuda~flang+gold+internal_unwind~ipo+libcxx+lld+lldb~llvm_dylib~mlir~omp_debug~omp_tsan+polly~python~shared_libs~split_dwarf build_type=Release cuda_arch=none arch=linux-ubuntu20.04-ivybridge\r\n        ^cmake@3.20.1%gcc@9.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-ivybridge\r\n            ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-ivybridge\r\n                ^pkgconf@1.7.4%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n            ^openssl@1.1.1k%gcc@9.3.0~docs+systemcerts arch=linux-ubuntu20.04-ivybridge\r\n                ^perl@5.32.1%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-ivybridge\r\n                    ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl arch=linux-ubuntu20.04-ivybridge\r\n                    ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                        ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-ivybridge\r\n        ^hwloc@2.4.1%gcc@9.3.0~cairo~cuda~gl~libudev+libxml2~netloc~nvml+pci+shared arch=linux-ubuntu20.04-ivybridge\r\n            ^libpciaccess\r\n                ^libtool@2.4.6%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                    ^m4@1.4.18%gcc@9.3.0+sigsegv arch=linux-ubuntu20.04-ivybridge\r\n                        ^libsigsegv@2.13%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^util-macros@1.19.1%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n            ^libxml2@2.9.10%gcc@9.3.0~python arch=linux-ubuntu20.04-ivybridge\r\n                ^libiconv@1.16%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                ^xz@5.2.5%gcc@9.3.0~pic arch=linux-ubuntu20.04-ivybridge\r\n        ^libedit@3.1-20210216%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^perl-data-dumper@2.173%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^python@2.7.18%gcc@9.3.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib arch=linux-ubuntu20.04-ivybridge\r\n            ^bzip2@1.0.8%gcc@9.3.0+shared arch=linux-ubuntu20.04-ivybridge\r\n                ^diffutils@3.7%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n            ^expat@2.3.0%gcc@9.3.0+libbsd arch=linux-ubuntu20.04-ivybridge\r\n                ^libbsd@0.11.3%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n                    ^libmd\r\n            ^gettext@0.21%gcc@9.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-ubuntu20.04-ivybridge\r\n                ^tar\r\n            ^libffi@3.3%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n            ^sqlite@3.35.4%gcc@9.3.0+column_metadata+fts~functions~rtree arch=linux-ubuntu20.04-ivybridge\r\n            ^util-linux-uuid@2.36.2%gcc@9.3.0 arch=linux-ubuntu20.04-ivybridge\r\n        ^swig\r\n            ^pcre@8.44%gcc@9.3.0~jit+multibyte+utf arch=linux-ubuntu20.04-ivybridge\r\n        ^z3\r\n\r\nllvm requires binutils variant +plugins, but spec asked for ~plugins\r\n```\r\n\r\n### Fix 2 and a new error\r\n\r\n* Fix the above concritzer error by adding the constraint `^binutils+plugins`\r\n\r\n```console\r\n$ spack spec -I visit ^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0 ^binutils+plugins\r\n[success]\r\n```\r\n\r\n* But I want some modifications, so add `^vtk+python+qt ^hdf5+hl`\r\n\r\n```console\r\n$ spack spec -I visit ^vtk+python+qt ^hdf5+hl ^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0 ^binutils+plugins\r\n[success]\r\n```\r\n\r\n* The `spec` command looks good.  Start the installation...\r\n\r\n```console\r\n$ spack install visit ^vtk+python+qt ^hdf5+hl ^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0 ^binutils+plugins\r\n```\r\n\r\n* Note: `glib@2.56.3` is deprecated by spack and will be removed in future releases.  This needs to be fixed, but, for now, allow it.\r\n\r\n```console\r\n==> Warning: glib@2.56.3 is deprecated and may be removed in a future Spack release.\r\n==>   Fetch anyway? [y/N] Y\r\n```\r\n\r\n* However, this build fails when compiling `vtk@8.1.2`:\r\n\r\n```console\r\n  >> 11779    /tmp/kellyt/spack-stage/spack-stage-vtk-8.1.2-esjetpny7oefdo7ykjzwidh4ma4r5gn7/spack-src/Rendering/FreeType/vtkFreeTypeT\r\n              ools.cxx:390:1: error: expected constructor, destructor, or type conversion before 'vtkFreeTypeToolsFaceRequester'\r\n     11780      390 | vtkFreeTypeToolsFaceRequester(FTC_FaceID face_id,\r\n     11781          | ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n```\t \r\n\r\n### Fix 3 \r\n\r\n* It appears that `freetype@2.10.4` is too new, force build to use an older version by adding the constraint `^freetype@2.10.1`.  Details about this requirement are at https://bugs.archlinux.org/task/68291.  \r\n* I am finally able to build visit:\r\n\r\n```console\r\n$ spack install visit ^vtk+python+qt ^hdf5+hl ^python+shared ^glib@2.56.3 ^py-setuptools@44.1.0 ^binutils+plugins ^freetype@2.10.1\r\n ==> success!\r\n```\r\n\r\n### Summary of issues.\r\n\r\n* visit requires: \r\n  * `^glib@2.56.3` which is deprecated by spack and is not encoded in `visit/package.py` (spack requires a manual override to install this old version). I'm not sure how to move forward on this.  We might need to get the Visit dev team involved.\r\n  * `^py-setuptools@44.1.0`, but this is not encoded in `visit/package.py`\r\n  *  `^binutils+plugins`, but this is not encoded in `visit/package.py`\r\n  * `^freetype@:2.10.1`, but this is not encoded in `vtk/package.py`\r\n* Hopefully, this detailed summary is useful for other people using spack and running into difficulty when building Visit.\r\n\r\n### Information on your system\r\n\r\n```console\r\n$ spack debug report\r\n* **Spack:** 0.16.1-2382-769e549cd9\r\n* **Python:** 3.8.5\r\n* **Platform:** linux-ubuntu20.04-ivybridge\r\n* **Concretizer:** original\r\n```\r\n",
    "performed_via_github_app": null
}