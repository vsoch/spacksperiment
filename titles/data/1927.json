{
    "url": "https://api.github.com/repos/spack/spack/issues/1927",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/1927/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/1927/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/1927/events",
    "html_url": "https://github.com/spack/spack/issues/1927",
    "id": 181309646,
    "node_id": "MDU6SXNzdWUxODEzMDk2NDY=",
    "number": 1927,
    "title": "RPATH for Python",
    "user": {
        "login": "citibeth",
        "id": 1924215,
        "node_id": "MDQ6VXNlcjE5MjQyMTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1924215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/citibeth",
        "html_url": "https://github.com/citibeth",
        "followers_url": "https://api.github.com/users/citibeth/followers",
        "following_url": "https://api.github.com/users/citibeth/following{/other_user}",
        "gists_url": "https://api.github.com/users/citibeth/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/citibeth/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/citibeth/subscriptions",
        "organizations_url": "https://api.github.com/users/citibeth/orgs",
        "repos_url": "https://api.github.com/users/citibeth/repos",
        "events_url": "https://api.github.com/users/citibeth/events{/privacy}",
        "received_events_url": "https://api.github.com/users/citibeth/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908756,
            "node_id": "MDU6TGFiZWw3MzkwODc1Ng==",
            "url": "https://api.github.com/repos/spack/spack/labels/feature",
            "name": "feature",
            "color": "84b6eb",
            "default": false,
            "description": null
        },
        {
            "id": 446619758,
            "node_id": "MDU6TGFiZWw0NDY2MTk3NTg=",
            "url": "https://api.github.com/repos/spack/spack/labels/python",
            "name": "python",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 446779717,
            "node_id": "MDU6TGFiZWw0NDY3Nzk3MTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/rpath",
            "name": "rpath",
            "color": "bfdadc",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2016-10-06T02:19:04Z",
    "updated_at": "2020-08-25T22:30:32Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Spack is great because it includes RPATH in everything it builds.... except when it doesn't.  The two cases I've seen where RPATH is not consistently included are:\n1. Compiled Python extensions.  In their infinite wisdom, the Python folks with distutils/setuptools invented a new build system that lacks the features and flexibility of CMake, Autotools and Scons (for example, it doesn't do `-j` AFAIK).  It also manages to build binaries with RPATH.\n2. Python code itself.  Python libraries don't use RPATH, of course; they use PYTHONPATH.  Which is functionally equivalent to setting LD_LIBRARY_PATH, the evil system that RPATH was designed to replace.\n\nBecause of these two issues, in practice when loading a Python module, one needs to load all the things it depends on too --- defeating one of the nice features of Spack.  Both of these requirements can be avoided by setting RPATH (or equivalent) in Python code:\n# RPATH in Extensions\n\nIt should be possible to use `patchelf` to re-write RPATH after-the-fact in an installed Python extension.\n# RPATH in Python Code\n\nAfter the Python build has installed its stuff, Spack should be able to in and much with it.  It would have to modify every file at the beginning and end of the file, something like:\n\n```\nimport sys\nsys.path = ....add RPATH to it...\n... <the original file> ...\n<remove RPATH from sys.path>\n```\n\nWith a little tinkering around, this would probably work.  Certainly most of the time, hopefully all the time.\n",
    "performed_via_github_app": null
}