{
    "url": "https://api.github.com/repos/spack/spack/issues/17694",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/17694/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/17694/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/17694/events",
    "html_url": "https://github.com/spack/spack/issues/17694",
    "id": 665231196,
    "node_id": "MDU6SXNzdWU2NjUyMzExOTY=",
    "number": 17694,
    "title": "Installation issue: CMake picks up wrong modules for Boost on Ubuntu 20.04",
    "user": {
        "login": "bassenj",
        "id": 16454215,
        "node_id": "MDQ6VXNlcjE2NDU0MjE1",
        "avatar_url": "https://avatars.githubusercontent.com/u/16454215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bassenj",
        "html_url": "https://github.com/bassenj",
        "followers_url": "https://api.github.com/users/bassenj/followers",
        "following_url": "https://api.github.com/users/bassenj/following{/other_user}",
        "gists_url": "https://api.github.com/users/bassenj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bassenj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bassenj/subscriptions",
        "organizations_url": "https://api.github.com/users/bassenj/orgs",
        "repos_url": "https://api.github.com/users/bassenj/repos",
        "events_url": "https://api.github.com/users/bassenj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bassenj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 508566016,
            "node_id": "MDU6TGFiZWw1MDg1NjYwMTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/cmake",
            "name": "cmake",
            "color": "c2e0c6",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2020-07-24T15:06:10Z",
    "updated_at": "2020-08-25T00:28:05Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\nSince an upgrade to Ubuntu 20.04, my system has a new directory with CMake modules for Boost 1.71.0  (`/usr/lib/x86_64-linux-gnu/cmake`) which seems to interfere with `CMakePackage`s such as `dakota`.\r\n\r\n```console\r\n$ spack install dakota ^boost@1.69.0+mpi cxxstd=11\r\n...\r\n==> Error: Failed to install dakota due to ChildError: ProcessError: Command exited with status 1:\r\n    'cmake' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:STRING=/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/dakota-6.11.0-w5kt3fz2k2kfvbgwdlblch54axvf5poq' '-DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=OFF' '-DCMAKE_INSTALL_RPATH:STRING=/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/dakota-6.11.0-w5kt3fz2k2kfvbgwdlblch54axvf5poq/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/dakota-6.11.0-w5kt3fz2k2kfvbgwdlblch54axvf5poq/lib64;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/boost-1.69.0-wflufr5wz352vzbf3oizpujrcnoaxorm/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/bzip2-1.0.8-av4shvbaq4sixpw44xfemkjlaqzvuqou/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/openmpi-3.1.6-cdvprwtqdupqhpi2we3rtnqa4zi3g7m7/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/hwloc-1.11.11-d4kdo2g7i6ogisdnl3537l57s6u3qihh/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/libpciaccess-0.13.5-hgyql7p5tywiuodlcqlxkpivalylrd7t/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/libxml2-2.9.10-gpdx7iqxt3x3q65em5ymdokjmkulted4/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/libiconv-1.16-dukcmslv5qzcajajpbldun56gxtdgkxp/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/xz-5.2.5-5vy25rbpwfa6eecfrnz7nfwbs5huyvub/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/zlib-1.2.11-2pwsgfxppopolmjj6tf34k5jsaqzpodo/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/numactl-2.0.12-v5lapba7rpzdyc73zlpm7nbyoxqh5gfu/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/hdf5-1.10.4-ithbdzfuad4zmalfz2xxqzt7j62egjr4/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/libszip-2.1.1-be2rks44gzruxfrhh4nxvfjrabvylv6c/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/netlib-lapack-3.8.0-5g2gncaywcygdkndhwwo4o7iwdyeutnn/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/python-3.7.0-ls3bwx4bpo3npzn2qcawby65khgoauol/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/expat-2.2.9-rseyo7zzfqwx2nkxuz6jas47ysqtykwe/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/libbsd-0.10.0-rgborisspqt77q3b62r4tfcc472tryiq/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/gdbm-1.18.1-5brqa4fwun6ku5eclsuorw3drx362cyo/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/readline-8.0-r4c2fzm4n4clqhgcgxyky5dqebi6q5sc/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/ncurses-6.2-l4seuemvhefwetlot2dbcnlaxtncqzqd/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/gettext-0.20.2-h7dugfqbetuxufnvjglwgusvv6gsi3sr/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/libffi-3.3-w7kerh7yaxffjeywq7esepw6d3tkrh47/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/openssl-1.1.1g-uw6p4ueyvylc7czgxhql3xau7ma4budw/lib;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/sqlite-3.31.1-kpahbpnzihrrtq5rax2lvhhf7bs4vcoa/lib' '-DCMAKE_PREFIX_PATH:STRING=/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/cmake-3.17.3-ushlaoo7byey4h73a5dfvo6tixyegdlz;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/python-3.7.0-ls3bwx4bpo3npzn2qcawby65khgoauol;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/netlib-lapack-3.8.0-5g2gncaywcygdkndhwwo4o7iwdyeutnn;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/openmpi-3.1.6-cdvprwtqdupqhpi2we3rtnqa4zi3g7m7;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/hdf5-1.10.4-ithbdzfuad4zmalfz2xxqzt7j62egjr4;/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/boost-1.69.0-wflufr5wz352vzbf3oizpujrcnoaxorm' '-DBUILD_SHARED_LIBS:BOOL=ON' '-DDAKOTA_PYTHON:BOOL=ON' '-DDAKOTA_PYTHON_NUMPY:BOOL=ON' '-DPYTHON_EXECUTABLE:FILEPATH=/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/python-3.7.0-ls3bwx4bpo3npzn2qcawby65khgoauol/bin/python3.7' '-DDAKOTA_HAVE_MPI:BOOL=ON' '-DMPI_CXX_COMPILER:STRING=/opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/openmpi-3.1.6-cdvprwtqdupqhpi2we3rtnqa4zi3g7m7/bin/mpic++' '-DDAKOTA_HAVE_HDF5:BOOL=ON' '/tmp/bassen/spack-stage/spack-stage-dakota-6.11.0-w5kt3fz2k2kfvbgwdlblch54axvf5poq/spack-src'\r\n5 errors found in build log:\r\n...\r\n  >> 48    CMake Error at /usr/lib/x86_64-linux-gnu/cmake/Boost-1.71.0/BoostConfig.cmake:182 (boost_find_component):\r\n     49      boost_find_component Macro invoked with incorrect arguments for macro\r\n     50      named: boost_find_component\r\n     51    Call Stack (most recent call first):\r\n     52      /opt/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/cmake-3.17.3-ushlaoo7byey4h73a5dfvo6tixyegdlz/share/cmake-3.17/Modules/FindBoost.cmake:444 (find_package)\r\n     53      CMakeLists.txt:363 (find_package)\r\n...\r\n```\r\n\r\nThe error message indicates that Spack's CMake module `FindBoost.cmake` interferes with parts of the system's CMake installation. I suspect this can be an issue for other `CMakePackage`s as well and think this should be handled by Spack. If `BoostConfig.cmake` was fully compatible between versions 1.69.0 and 1.71.0 of Boost, I wouldn't have noticed.\r\n\r\nI thought `mariadb` should have the same issue but there it is more subtle. It simply picks the wrong version using system CMake modules. In the case of `dakota` `find_package` fails because it is used with a list of components.\r\n\r\n```console\r\n$ spack install mariadb ^boost@1.69.0+mpi cxxstd=11\r\n...\r\n-- Found Boost: /usr/lib/x86_64-linux-gnu/cmake/Boost-1.71.0/BoostConfig.cmake (found suitable version \"1.71.0\", minimum required is \"1.40.0\")\r\n...\r\n```\r\n\r\nRenaming `/usr/lib/x86_64-linux-gnu/cmake` to `/usr/lib/x86_64-linux-gnu/_cmake` circumvents the issue.\r\n\r\n### Information on your system\r\n\r\n```console\r\n$ spack debug report\r\n* **Spack:** 0.15.1\r\n* **Python:** 3.8.2\r\n* **Platform:** linux-ubuntu20.04-zen2\r\n```\r\n\r\nI was previously running Ubuntu 19.10 on this machine. With the upgrade to Ubuntu 20.04 Boost comes in version 1.71.0 and CMake in version 3.16.3. Since this upgrade, the following directory is populated with CMake modules for Boost.\r\n\r\n```console\r\n$ ls /usr/lib/x86_64-linux-gnu/cmake\r\nBoost-1.71.0  BoostDetectToolset-1.71.0.cmake  boost_headers-1.71.0\r\n```\r\n\r\n### Additional information\r\n\r\n* [spack-build-out.txt](https://github.com/spack/spack/files/4972308/spack-build-out.txt)\r\n* [spack-build-env.txt](https://github.com/spack/spack/files/4972307/spack-build-env.txt)\r\n\r\n### General information\r\n\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [x] I have uploaded the build log and environment files\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n\r\nThis issue has similar symptoms with #12782 but seems to have a different cause.",
    "performed_via_github_app": null
}