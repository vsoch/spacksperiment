{
    "url": "https://api.github.com/repos/spack/spack/issues/15449",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/15449/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/15449/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/15449/events",
    "html_url": "https://github.com/spack/spack/issues/15449",
    "id": 579470023,
    "node_id": "MDU6SXNzdWU1Nzk0NzAwMjM=",
    "number": 15449,
    "title": "spack info errors out with multiple urls ",
    "user": {
        "login": "mwkrentel",
        "id": 3969036,
        "node_id": "MDQ6VXNlcjM5NjkwMzY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3969036?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mwkrentel",
        "html_url": "https://github.com/mwkrentel",
        "followers_url": "https://api.github.com/users/mwkrentel/followers",
        "following_url": "https://api.github.com/users/mwkrentel/following{/other_user}",
        "gists_url": "https://api.github.com/users/mwkrentel/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mwkrentel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mwkrentel/subscriptions",
        "organizations_url": "https://api.github.com/users/mwkrentel/orgs",
        "repos_url": "https://api.github.com/users/mwkrentel/repos",
        "events_url": "https://api.github.com/users/mwkrentel/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mwkrentel/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483297,
            "node_id": "MDU6TGFiZWw1MTI0ODMyOTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-low",
            "name": "impact-low",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 4,
    "created_at": "2020-03-11T18:41:44Z",
    "updated_at": "2020-03-12T08:21:20Z",
    "closed_at": "2020-03-12T08:21:20Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "@alalazo I think the urls extension from #13881 to allow backup urls\r\nfor fetching doesn't work.  I'm following the directions from:\r\n\r\nhttps://spack.readthedocs.io/en/latest/packaging_guide.html#mirrors-of-the-main-url\r\n\r\nHere's a simple example using bzip2.  I'm using spack 87e69eed1c48\r\nfrom today, 2020-03-11.\r\n\r\nUse bzip2, comment out all but version 1.0.8, and change url to urls\r\n(plural) to a list of two urls.\r\n\r\n```\r\n  urls = [\r\n      'https://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz',\r\n      'ftp://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz',\r\n  ]\r\n  ...\r\n  version('1.0.8', sha256='...')\r\n  # version('1.0.7', sha256='...')\r\n  # version('1.0.6', sha256='...')\r\n```\r\n\r\nThis case is just one version and two urls, that is, more urls than\r\nversions.  This case mostly works.\r\n\r\n```\r\nspack info bzip2\r\n\r\nPreferred version:  \r\n    1.0.8    https://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz\r\n\r\nSafe versions:  \r\n    1.0.8    ftp://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz\r\n```\r\n\r\nAlthough this mostly works (and does fetch with https), it's kinda\r\nwonky because 'preferred' says https and 'safe' says ftp for the same\r\nversion.\r\n\r\nBut now, return versions 1.0.7 and 1.0.6, so we have 3 versions and\r\ntwo urls and I get this error.\r\n\r\n```\r\nspack info bzip2\r\n\r\nPreferred version:  \r\n    1.0.8    https://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz\r\n\r\nSafe versions:  \r\n    1.0.8    ftp://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz\r\n==> Error: pop from empty list\r\n```\r\n\r\nThe problem seems to happen whenever there are more versions than\r\nurls.  This suggests that something is pairing the list of versions\r\nwith the list of urls.  That is, walking down both lists and\r\ncomplaining when urls runs out before versions.\r\n\r\nInstead, it should be more of a cross product.  That is, any version\r\nshould be fetchable from anything on the list of backup urls.\r\n\r\n",
    "performed_via_github_app": null
}