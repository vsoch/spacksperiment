{
    "url": "https://api.github.com/repos/spack/spack/issues/10907",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10907/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10907/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10907/events",
    "html_url": "https://github.com/spack/spack/issues/10907",
    "id": 421477715,
    "node_id": "MDU6SXNzdWU0MjE0Nzc3MTU=",
    "number": 10907,
    "title": "Installation issue: ior@3.2.0 +hdf5 +ncmpi broken compilation",
    "user": {
        "login": "bebosudo",
        "id": 1922124,
        "node_id": "MDQ6VXNlcjE5MjIxMjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1922124?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bebosudo",
        "html_url": "https://github.com/bebosudo",
        "followers_url": "https://api.github.com/users/bebosudo/followers",
        "following_url": "https://api.github.com/users/bebosudo/following{/other_user}",
        "gists_url": "https://api.github.com/users/bebosudo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bebosudo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bebosudo/subscriptions",
        "organizations_url": "https://api.github.com/users/bebosudo/orgs",
        "repos_url": "https://api.github.com/users/bebosudo/repos",
        "events_url": "https://api.github.com/users/bebosudo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bebosudo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-03-15T11:38:23Z",
    "updated_at": "2019-03-18T13:52:34Z",
    "closed_at": "2019-03-18T13:52:34Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack spec -vlfd ior@3.2.0%intel@18.0.3 +hdf5 +ncmpi\r\n...\r\nConcretized\r\n--------------------------------\r\n -   jrd2las  ior@3.2.0%intel@18.0.3 cflags=\"-O3\" cxxflags=\"-O3\" fflags=\"-O3\" +hdf5+ncmpi arch=linux-centos7-x86_64 \r\n[+]  gao5qxy      ^autoconf@2.69%gcc@4.8.5 cflags=\"-O2\" cxxflags=\"-O2\" fflags=\"-O2\"  arch=linux-centos7-x86_64 \r\n[+]  wvvqfi5      ^automake@1.13.4%gcc@4.8.5 cflags=\"-O2\" cxxflags=\"-O2\" fflags=\"-O2\"  arch=linux-centos7-x86_64 \r\n[+]  3bf4bbd      ^hdf5@1.10.4%intel@18.0.3 cflags=\"-O3\" cxxflags=\"-O3\" fflags=\"-O3\" ~cxx~debug+fortran+hl+mpi+pic+shared~szip~threadsafe arch=linux-centos7-x86_64 \r\n[+]  jxu2bom          ^intel-mpi@2018.3.222%intel@18.0.3 cflags=\"-O3\" cxxflags=\"-O3\" fflags=\"-O3\"  arch=linux-centos7-x86_64 \r\n[+]  xyf2e2b          ^numactl@2.0.12%gcc@7.2.1 cflags=\"-O2\" cxxflags=\"-O2\" fflags=\"-O2\"  arch=linux-centos7-x86_64 \r\n[+]  jwomt3l              ^libtool@2.4.2%gcc@4.8.5 cflags=\"-O2\" cxxflags=\"-O2\" fflags=\"-O2\"  arch=linux-centos7-x86_64 \r\n[+]  vtrqizy              ^m4@1.4.16%gcc@4.8.5 cflags=\"-O2\" cxxflags=\"-O2\" fflags=\"-O2\"  patches=c0a408fbffb7255fcc75e26bd8edab116fc81d216bfd18b473668b7739a4158e +sigsegv arch=linux-centos7-x86_64 \r\n[+]  nu3vh2f          ^zlib@1.2.11%gcc@7.2.1 cflags=\"-O2\" cxxflags=\"-O2\" fflags=\"-O2\" +optimize+pic+shared arch=linux-centos7-x86_64 \r\n[+]  t6jminf      ^parallel-netcdf@1.11.0%intel@18.0.3 cflags=\"-O3\" cxxflags=\"-O3\" fflags=\"-O3\" +cxx+fortran+pic arch=linux-centos7-x86_64 \r\n\r\n\r\n$ spack install -v ior@3.2.0%intel@18.0.3 +hdf5 +ncmpi ^hdf5/3bf4bbd\r\n...\r\n==> Executing phase: 'autoreconf'\r\n==> [2019-03-15-11:35:44.193623] './bootstrap'\r\n...\r\n==> Executing phase: 'configure'\r\n==> [2019-03-15-11:35:48.084921] '/bescratch/user/achiusol/spack/var/spack/stage/ior-3.2.0-jrd2lasvivzazps4kslphiywhsw47p7s/ior-3.2.0/configure' '--prefix=/bescratch/user/achiusol/spack/opt/spack/linux-centos7-x86_64/intel/18.0.3/ior/3.2.0-jrd2lasvivzazps4kslphiywhsw47p7s' '--with-hdf5' 'CFLAGS=-D H5_USE_16_API' '--with-ncmpi'\r\n\r\n...\r\n==> Executing phase: 'build'\r\n==> [2019-03-15-11:36:09.849379] 'make' '-j40'\r\nMaking all in src\r\nmake  all-recursive\r\nMaking all in .\r\n  CC       libaiori_a-ior.o\r\n  CC       libaiori_a-mdtest.o\r\n  CC       libaiori_a-utilities.o\r\n  CC       libaiori_a-parse_options.o\r\n  CC       libaiori_a-ior-output.o\r\n  CC       libaiori_a-option.o\r\n  CC       libaiori_a-aiori.o\r\n  CC       libaiori_a-aiori-DUMMY.o\r\n  CC       libaiori_a-aiori-MPIIO.o\r\n  CC       libaiori_a-aiori-HDF5.o\r\n  CC       libaiori_a-aiori-MMAP.o\r\n  CC       libaiori_a-aiori-NCMPI.o\r\n  CC       ior-ior-main.o\r\n  CC       libaiori_a-aiori-POSIX.o\r\n  CC       ior-aiori.o\r\n  CC       ior-aiori-DUMMY.o\r\n  CC       ior-aiori-HDF5.o\r\n  CC       ior-aiori-MPIIO.o\r\n  CC       ior-aiori-NCMPI.o\r\n  CC       ior-aiori-MMAP.o\r\n  CC       ior-aiori-POSIX.o\r\n  CC       mdtest-mdtest-main.o\r\n  CC       mdtest-aiori.o\r\n  CC       mdtest-aiori-DUMMY.o\r\n  CC       mdtest-aiori-HDF5.o\r\n  CC       mdtest-aiori-MPIIO.o\r\n  CC       mdtest-aiori-MMAP.o\r\n  CC       mdtest-aiori-NCMPI.o\r\n  CC       mdtest-aiori-POSIX.o\r\n  CC       test/lib.o\r\naiori-HDF5.c(24): warning #47: incompatible redefinition of macro \"H5_USE_16_API\"\r\n  #define H5_USE_16_API\r\n          ^\r\n\r\naiori-HDF5.c(24): warning #47: incompatible redefinition of macro \"H5_USE_16_API\"\r\n  #define H5_USE_16_API\r\n          ^\r\n\r\naiori-HDF5.c(24): warning #47: incompatible redefinition of macro \"H5_USE_16_API\"\r\n  #define H5_USE_16_API\r\n          ^\r\n\r\naiori-HDF5.c(232): error: struct \"<unnamed>\" has no field \"collective_md\"\r\n          if (param->collective_md) {\r\n                     ^\r\n\r\naiori-HDF5.c(232): error: struct \"<unnamed>\" has no field \"collective_md\"\r\n          if (param->collective_md) {\r\n                     ^\r\n\r\naiori-HDF5.c(232): error: struct \"<unnamed>\" has no field \"collective_md\"\r\n          if (param->collective_md) {\r\n                     ^\r\n\r\ncompilation aborted for aiori-HDF5.c (code 2)\r\ncompilation aborted for aiori-HDF5.c (code 2)\r\ncompilation aborted for aiori-HDF5.c (code 2)\r\nmake[3]: *** [libaiori_a-aiori-HDF5.o] Error 2\r\nmake[3]: *** Waiting for unfinished jobs....\r\nmake[3]: *** [ior-aiori-HDF5.o] Error 2\r\nmake[3]: *** [mdtest-aiori-HDF5.o] Error 2\r\nmake[2]: *** [all-recursive] Error 1\r\nmake[1]: *** [all] Error 2\r\nmake: *** [all-recursive] Error 1\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j40'\r\n\r\n9 errors found in build log:\r\n     181              ^\r\n     182    \r\n     183    aiori-HDF5.c(24): warning #47: incompatible redefinition of macro \"H5_USE_16_API\"\r\n     184      #define H5_USE_16_API\r\n     185              ^\r\n     186    \r\n  >> 187    aiori-HDF5.c(232): error: struct \"<unnamed>\" has no field \"collective_md\"\r\n     188              if (param->collective_md) {\r\n     189                         ^\r\n     190    \r\n  >> 191    aiori-HDF5.c(232): error: struct \"<unnamed>\" has no field \"collective_md\"\r\n     192              if (param->collective_md) {\r\n     193                         ^\r\n     194    \r\n  >> 195    aiori-HDF5.c(232): error: struct \"<unnamed>\" has no field \"collective_md\"\r\n     196              if (param->collective_md) {\r\n     197                         ^\r\n     198    \r\n     199    compilation aborted for aiori-HDF5.c (code 2)\r\n     200    compilation aborted for aiori-HDF5.c (code 2)\r\n     201    compilation aborted for aiori-HDF5.c (code 2)\r\n  >> 202    make[3]: *** [libaiori_a-aiori-HDF5.o] Error 2\r\n     203    make[3]: *** Waiting for unfinished jobs....\r\n  >> 204    make[3]: *** [ior-aiori-HDF5.o] Error 2\r\n  >> 205    make[3]: *** [mdtest-aiori-HDF5.o] Error 2\r\n  >> 206    make[2]: *** [all-recursive] Error 1\r\n  >> 207    make[1]: *** [all] Error 2\r\n  >> 208    make: *** [all-recursive] Error 1\r\n```\r\n\r\n### Platform and user environment\r\n\r\n```commandline\r\n$ uname -a\r\nLinux host1 3.10.0-933.el7.x86_64 #1 SMP Sat Aug 11 11:32:57 EDT 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:\tCentOS Linux release 7.6.1810 (Core) \r\n``` \r\n\r\n### Additional information\r\n\r\nI tried removing `config_args.append('CFLAGS=-D H5_USE_16_API')` from the ior package recipe, but crashed with the same error.\r\n\r\nVersion 3.0.1 compiled fine.\r\n\r\nShould I report this to hpc/ior? Am I the only one seeing this issue? Could it be related to my dependencies, i.e. intel?\r\nIn case someone else faces the same issue, should we set 3.0.1 to `preferred=True`?",
    "performed_via_github_app": null
}