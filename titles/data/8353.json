{
    "url": "https://api.github.com/repos/spack/spack/issues/8353",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8353/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8353/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8353/events",
    "html_url": "https://github.com/spack/spack/issues/8353",
    "id": 328692398,
    "node_id": "MDU6SXNzdWUzMjg2OTIzOTg=",
    "number": 8353,
    "title": "Emacs doesn't use Spack's terminfo files",
    "user": {
        "login": "hartzell",
        "id": 312978,
        "node_id": "MDQ6VXNlcjMxMjk3OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/312978?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hartzell",
        "html_url": "https://github.com/hartzell",
        "followers_url": "https://api.github.com/users/hartzell/followers",
        "following_url": "https://api.github.com/users/hartzell/following{/other_user}",
        "gists_url": "https://api.github.com/users/hartzell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hartzell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hartzell/subscriptions",
        "organizations_url": "https://api.github.com/users/hartzell/orgs",
        "repos_url": "https://api.github.com/users/hartzell/repos",
        "events_url": "https://api.github.com/users/hartzell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hartzell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908758,
            "node_id": "MDU6TGFiZWw3MzkwODc1OA==",
            "url": "https://api.github.com/repos/spack/spack/labels/question",
            "name": "question",
            "color": "cc317c",
            "default": true,
            "description": null
        },
        {
            "id": 729584669,
            "node_id": "MDU6TGFiZWw3Mjk1ODQ2Njk=",
            "url": "https://api.github.com/repos/spack/spack/labels/update-package",
            "name": "update-package",
            "color": "c68137",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2018-06-01T23:59:25Z",
    "updated_at": "2019-12-17T12:51:35Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "**TL;DR** -- If you have been building `emacs +tls`, the changes in #8302 *might* have changed where emacs looks for terminfo files.  If you want to go back to the old behavior, you can build `emacs ^ncurses+termlib`.\r\n\r\n---\r\n\r\nI'm playing around with Emacs configurations (cough -- rabbit hole -- cough) and discovered that emacs isn't using terminfo entries from Spack's ncurses package (e.g. `tmux-256color`).\r\n\r\nAs I dug into it a bit I noticed that my Spack-supplied `git` was behaving poorly (as is `bash`), at which point I decided that I should either stick with terminfo names that are in the system database or tuck a special entry in `~/.terminfo`.\r\n\r\nBut, in case someone else trips over this, I thought I'd write it up for posterity.\r\n\r\nIf I build `emacs ^ncurses+termlib` it *does* read those entries, which is confusing.  None of the options that are passed to configure when `+termlib` seem to have anything to do with where the terminfo entries is searched for.\r\n\r\nHere are the switches:\r\n\r\n```\r\n            opts.extend(('--with-termlib',\r\n                         '--enable-termcap',\r\n                         '--enable-getcap',\r\n                         '--enable-tcap-names'))\r\n```\r\n\r\nand here are the associated help messages from `configure --help`:\r\n\r\n```\r\n            # generate separate terminfo library\r\n            # compile in termcap fallback support\r\n            # fast termcap load, no xrefs to terminfo\r\n            # compile with user-definable terminal capabilities\r\n```\r\n\r\nApparently what's happening is if Spack doesn't build a separate terminfo library then emacs ends up linking against the system's `libtinfo.so`. \r\n\r\nWhen I build emacs with an `ncurses +termlib` I don't see any signs that emacs is using anything from ncurses specifically, but it does use its `libtinfo`:\r\n\r\n```\r\n[hartzell@ip-10-96-1-107 ncurses-6.1]$ ldd $(which emacs)\r\n\tlinux-vdso.so.1 =>  (0x00007fffe5c97000)\r\n\tlibrt.so.1 => /lib64/librt.so.1 (0x00007fa831040000)\r\n\tlibxml2.so.2 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/libxml2-2.9.8-hgfwbirg7su2pc67osk2fzrsilw22ybd/lib/libxml2.so.2 (0x00007fa830cd9000)\r\n\tlibtinfo.so.6 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/ncurses-6.1-rgdadtxyziks74sx7mzrpodj7ia6f36t/lib/libtinfo.so.6 (0x00007fa830a99000)\r\n\tlibselinux.so.1 => /lib64/libselinux.so.1 (0x00007fa830872000)\r\n\tlibgnutls.so.30 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/gnutls-3.5.13-ju3fyaastivwai6ixccqwelwd7bhxuii/lib/libgnutls.so.30 (0x00007fa8304e6000)\r\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fa8302ca000)\r\n\tlibanl.so.1 => /lib64/libanl.so.1 (0x00007fa8300c6000)\r\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fa82fdc4000)\r\n\tlibz.so.1 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/zlib-1.2.11-56rgaosb4ij2unhwfsnbiv7z3qjximce/lib/libz.so.1 (0x00007fa82fbac000)\r\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fa82f7e9000)\r\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007fa82f5e4000)\r\n\tliblzma.so.5 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/xz-5.2.4-xz3h7mccq4wkwdcl7twvmf2cpoawdwp7/lib/liblzma.so.5 (0x00007fa82f3be000)\r\n\tlibpcre.so.1 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/pcre-8.42-idvaazk4oqp6jj7sxfwq324jb7glms7m/lib/libpcre.so.1 (0x00007fa82f179000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x0000563d7ca1c000)\r\n\tlibnettle.so.6 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/nettle-3.3-gm37wrusxw523qx4pszjs3o56j5yqner/lib64/libnettle.so.6 (0x00007fa82ef43000)\r\n\tlibhogweed.so.4 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/nettle-3.3-gm37wrusxw523qx4pszjs3o56j5yqner/lib64/libhogweed.so.4 (0x00007fa82ed0e000)\r\n\tlibgmp.so.10 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/gmp-6.1.2-cd47nos5nivwx4zd5r37nxwy57e7qlb2/lib/libgmp.so.10 (0x00007fa82ea9a000)\r\n\tlibintl.so.8 => /home/hartzell/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/gettext-0.19.8.1-rb545khehtpmessjbd56yjqzt6cycgra/lib/libintl.so.8 (0x00007fa82e88e000)\r\n[hartzell@ip-10-96-1-107 ncurses-6.1]$\r\n```\r\n\r\nPerhaps the emacs'\r\n\r\n```\r\n  53     depends_on('ncurses')\r\n```\r\n\r\nis a bug and it should be `ncurses+termlib`?  Or perhaps it should not depend on it at all?\r\n\r\nDeleting the line and building emacs (without `tls`) doesn't build `ncurses` and the resulting emacs seems to work.  Building `emacs +tls` builds ncurses by way of gnutls by way of gettext, but emacs doesn't seem to use it or care.",
    "performed_via_github_app": null
}