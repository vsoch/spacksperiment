{
    "url": "https://api.github.com/repos/spack/spack/issues/22116",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22116/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22116/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22116/events",
    "html_url": "https://github.com/spack/spack/issues/22116",
    "id": 823290083,
    "node_id": "MDU6SXNzdWU4MjMyOTAwODM=",
    "number": 22116,
    "title": "If using external python, cannot install py-wheel via spack",
    "user": {
        "login": "BenjaminRodenberg",
        "id": 5740604,
        "node_id": "MDQ6VXNlcjU3NDA2MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5740604?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BenjaminRodenberg",
        "html_url": "https://github.com/BenjaminRodenberg",
        "followers_url": "https://api.github.com/users/BenjaminRodenberg/followers",
        "following_url": "https://api.github.com/users/BenjaminRodenberg/following{/other_user}",
        "gists_url": "https://api.github.com/users/BenjaminRodenberg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/BenjaminRodenberg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/BenjaminRodenberg/subscriptions",
        "organizations_url": "https://api.github.com/users/BenjaminRodenberg/orgs",
        "repos_url": "https://api.github.com/users/BenjaminRodenberg/repos",
        "events_url": "https://api.github.com/users/BenjaminRodenberg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/BenjaminRodenberg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2021-03-05T17:41:15Z",
    "updated_at": "2021-03-05T20:39:34Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I tried to install `py-wheel` via spack using the external python installation.\r\n\r\n### Steps to reproduce the issue\r\n\r\nThe following commands are run:\r\n\r\n```console\r\n$ source /spack/share/spack/setup-env.sh\r\n$ spack compiler find\r\n$ spack external find --not-buildable\r\n$ spack env create myenv\r\n$ spack -e myenv add py-wheel\r\n$ spack -e myenv install\r\n```\r\n\r\n### Error Message\r\n\r\n```\r\n$ spack -e myenv install\r\n==> Concretized py-wheel\r\n -   fjhuioq  py-wheel@0.35.1%gcc@9.3.0 arch=linux-ubuntu20.04-skylake\r\n -   74i5uip      ^py-setuptools@50.3.2%gcc@9.3.0 arch=linux-ubuntu20.04-skylake\r\n -   scbpvac          ^python@3.8.5%gcc@9.3.0+bz2+ctypes+dbm~debug+libxml2+lzma+nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87 arch=linux-ubuntu20.04-skylake\r\n\r\n==> Installing environment myenv\r\n[+] / (external python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c)\r\n==> Installing py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac\r\n==> No binary for py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/ed/ed0519d27a243843b05d82a5e9d01b0b083d9934eaa3d02779a23da18077bd3c.zip\r\n#=#=-  #       #                                                                                                                                                                                                                                               #=O=#     #        #                                                                                                                                                                                                                                           -#O=- #      #          #                             ######################################################################################################################################################################################################################################################### 100.0%\r\n==> No patches needed for py-setuptools\r\n==> py-setuptools: Executing phase: 'build'\r\n==> py-setuptools: Executing phase: 'install'\r\n==> py-setuptools: Successfully installed py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac\r\n  Fetch: 3.88s.  Build: 8.03s.  Total: 11.90s.\r\n[+] /spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac\r\n==> Installing py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\n==> No binary for py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2 found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/99/99a22d87add3f634ff917310a3d87e499f19e663413a52eb9232c447aa646c9f.tar.gz\r\n#=#=-  #       #                                                                                                                                                                                                                                               #=O=#     #        #                                                                                                                                                                                                                                           -#O=- #      #          #                             ######################################################################################################################################################################################################################################################### 100.0%\r\n==> No patches needed for py-wheel\r\n==> py-wheel: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/bin/python3.8' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nSee build log for details:\r\n  /tmp/root/spack-stage/spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2/spack-build-out.txt\r\n\r\n==> Updating view at /spack/var/spack/environments/myenv/.spack-env/view\r\n==> Warning: [/spack/var/spack/environments/myenv/.spack-env/view] Skipping external package: python@3.8.5%gcc@9.3.0+bz2+ctypes+dbm~debug+libxml2+lzma+nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87 arch=linux-ubuntu20.04-skylake/scbpvac\r\nroot@938a9ce25746:/# spack --debug --stacktrace -e myenv install\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-03-05-17:31:55.741243] Imported install from built-in commands\r\nlib/spack/spack/config.py:894 ==> [2021-03-05-17:31:55.763176] Reading config file /spack/var/spack/environments/myenv/spack.yaml\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-03-05-17:31:55.776761] Imported install from built-in commands\r\nlib/spack/spack/cmd/install.py:263 ==> [2021-03-05-17:31:55.984201] Installing environment myenv\r\nlib/spack/spack/environment.py:1425 ==> [2021-03-05-17:31:55.984854] Assessing installation status of environment packages\r\nlib/spack/spack/database.py:363 ==> [2021-03-05-17:31:55.986108] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:367 ==> [2021-03-05-17:31:55.986371] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/config.py:894 ==> [2021-03-05-17:31:55.988658] Reading config file /spack/etc/spack/defaults/repos.yaml\r\nlib/spack/spack/environment.py:1437 ==> [2021-03-05-17:31:56.458437] Processing 1 uninstalled specs\r\nlib/spack/spack/installer.py:1371 ==> [2021-03-05-17:31:56.466344] Initializing the build queue from the build requests\r\nlib/spack/spack/installer.py:989 ==> [2021-03-05-17:31:56.466647] Initializing the build queue for py-wheel\r\nlib/spack/spack/installer.py:2060 ==> [2021-03-05-17:31:56.467376] Processing dependencies for py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2: ('build', 'link', 'run')\r\nlib/spack/spack/installer.py:1798 ==> [2021-03-05-17:31:56.467804] Pkg id python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c has the following dependents:\r\nlib/spack/spack/installer.py:1801 ==> [2021-03-05-17:31:56.468019] - py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\nlib/spack/spack/installer.py:1801 ==> [2021-03-05-17:31:56.468208] - py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac\r\nlib/spack/spack/config.py:894 ==> [2021-03-05-17:31:56.469022] Reading config file /root/.spack/linux/compilers.yaml\r\nlib/spack/spack/installer.py:1798 ==> [2021-03-05-17:31:56.942720] Pkg id py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac has the following dependents:\r\nlib/spack/spack/installer.py:1801 ==> [2021-03-05-17:31:56.944247] - py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\nlib/spack/spack/database.py:463 ==> [2021-03-05-17:31:57.122523] Removing failure marking for py-wheel\r\nlib/spack/spack/installer.py:1798 ==> [2021-03-05-17:31:57.124856] Pkg id py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2 has the following dependents:\r\nlib/spack/spack/installer.py:1377 ==> [2021-03-05-17:31:57.130857] Ensure all dependencies know all dependents across specs\r\nlib/spack/spack/installer.py:322 ==> [2021-03-05-17:31:57.133523] python@3.8.5 : externally installed in /\r\nlib/spack/spack/installer.py:328 ==> [2021-03-05-17:31:57.134811] python@3.8.5 : already registered in DB\r\n[+] / (external python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c)\r\nlib/spack/spack/installer.py:1349 ==> [2021-03-05-17:31:57.144084] Flagging python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c as installed\r\nlib/spack/spack/installer.py:1356 ==> [2021-03-05-17:31:57.146251] Removing python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c from py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2's uninstalled dependencies.\r\nlib/spack/spack/installer.py:1905 ==> [2021-03-05-17:31:57.148464] py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2: Removed python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c from uninstalled deps list: {'py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac'}\r\nlib/spack/spack/installer.py:1356 ==> [2021-03-05-17:31:57.150220] Removing python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c from py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac's uninstalled dependencies.\r\nlib/spack/spack/installer.py:1905 ==> [2021-03-05-17:31:57.152204] py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac: Removed python-3.8.5-scbpvacvmluwk44b44luhrp66kkkdx5c from uninstalled deps list: set()\r\nlib/spack/spack/installer.py:935 ==> [2021-03-05-17:31:57.159605] Acquiring a write lock on py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac with timeout 1e-09\r\nlib/spack/spack/stage.py:313 ==> [2021-03-05-17:31:57.182885] Creating stage lock spack-stage-py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac\r\nlib/spack/spack/installer.py:1349 ==> [2021-03-05-17:31:57.312746] Flagging py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac as installed\r\nlib/spack/spack/installer.py:1356 ==> [2021-03-05-17:31:57.314327] Removing py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac from py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2's uninstalled dependencies.\r\nlib/spack/spack/installer.py:1905 ==> [2021-03-05-17:31:57.316302] py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2: Removed py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac from uninstalled deps list: set()\r\nlib/spack/spack/installer.py:951 ==> [2021-03-05-17:31:57.318989] Downgrading to a read lock on py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac with timeout 1e-09\r\n[+] /spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac\r\nlib/spack/spack/installer.py:935 ==> [2021-03-05-17:31:57.325107] Acquiring a write lock on py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2 with timeout 1e-09\r\nlib/spack/spack/stage.py:313 ==> [2021-03-05-17:31:57.344908] Creating stage lock spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\nlib/spack/spack/installer.py:1095 ==> [2021-03-05-17:31:57.372719] Installing py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\nlib/spack/spack/installer.py:393 ==> [2021-03-05-17:31:57.374713] Searching for binary cache of py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\nlib/spack/spack/config.py:894 ==> [2021-03-05-17:31:57.380725] Reading config file /spack/etc/spack/defaults/mirrors.yaml\r\nlib/spack/spack/binary_distribution.py:1350 ==> [2021-03-05-17:31:58.412427] Did not find linux-ubuntu20.04-skylake-gcc-9.3.0-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2.spec.yaml on https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/build_cache/linux-ubuntu20.04-skylake-gcc-9.3.0-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2.spec.yaml\r\n  Download failed: HTTP Error 404: Not Found\r\nlib/spack/spack/installer.py:281 ==> [2021-03-05-17:31:58.413097] No binary for py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2 found: installing from source\r\nlib/spack/spack/config.py:894 ==> [2021-03-05-17:31:58.425514] Reading config file /spack/etc/spack/defaults/packages.yaml\r\nlib/spack/spack/config.py:894 ==> [2021-03-05-17:31:58.681117] Reading config file /root/.spack/packages.yaml\r\nlib/spack/spack/compilers/__init__.py:741 ==> [2021-03-05-17:31:59.637878] [TOOLCHAIN] MATCH Gcc\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:31:59.841065] '/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:00.075023] '/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'CC'\"'\"'))'\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:00.233917] '/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'LDSHARED'\"'\"'))'\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:00.472883] '/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'CXX'\"'\"'))'\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:00.703090] '/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'LDCXXSHARED'\"'\"'))'\r\nlib/spack/spack/build_environment.py:748 ==> [2021-03-05-17:32:01.016607] A dependency has updated CPATH, this may lead pkg-config to assume that the package is part of the system includes and omit it when invoked with '--cflags'.\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:01.166036] '/usr/bin/g++' '-v' '/tmp/spack-implicit-link-infotob7_hdy/main.c' '-o' '/tmp/spack-implicit-link-infotob7_hdy/output'\r\nlib/spack/spack/compiler.py:105 ==> [2021-03-05-17:32:01.341741] parsing implicit link info\r\nlib/spack/spack/compiler.py:120 ==> [2021-03-05-17:32:01.344164] linker line:  /usr/lib/gcc/x86_64-linux-gnu/9/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/9/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper -plugin-opt=-fresolution=/tmp/ccopgULF.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --eh-frame-hdr -m elf_x86_64 --hash-style=gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie -z now -z relro -o /tmp/spack-implicit-link-infotob7_hdy/output /usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/9/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/9 -L/usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/9/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/9/../../.. /tmp/ccBsymrG.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/lib/gcc/x86_64-linux-gnu/9/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu/crtn.o\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.345275] linkdir: /usr/lib/gcc/x86_64-linux-gnu/9\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.346259] linkdir: /usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.348083] linkdir: /usr/lib/gcc/x86_64-linux-gnu/9/../../../../lib\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.354763] linkdir: /lib/x86_64-linux-gnu\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.359497] linkdir: /lib/../lib\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.361969] linkdir: /usr/lib/x86_64-linux-gnu\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.364567] linkdir: /usr/lib/../lib\r\nlib/spack/spack/compiler.py:136 ==> [2021-03-05-17:32:01.369321] linkdir: /usr/lib/gcc/x86_64-linux-gnu/9/../../..\r\nlib/spack/spack/compiler.py:144 ==> [2021-03-05-17:32:01.369905] found raw link dirs: /usr/lib/gcc/x86_64-linux-gnu/9, /usr/lib/gcc/x86_64-linux-gnu/9/../../../x86_64-linux-gnu, /usr/lib/gcc/x86_64-linux-gnu/9/../../../../lib, /lib/x86_64-linux-gnu, /lib/../lib, /usr/lib/x86_64-linux-gnu, /usr/lib/../lib, /usr/lib/gcc/x86_64-linux-gnu/9/../../..\r\nlib/spack/spack/compiler.py:154 ==> [2021-03-05-17:32:01.370479] found link dirs: /usr/lib/gcc/x86_64-linux-gnu/9, /usr/lib/x86_64-linux-gnu, /usr/lib, /lib/x86_64-linux-gnu, /lib\r\nlib/spack/spack/fetch_strategy.py:592 ==> [2021-03-05-17:32:01.376121] Using cached archive: /spack/var/spack/cache/_source-cache/archive/99/99a22d87add3f634ff917310a3d87e499f19e663413a52eb9232c447aa646c9f.tar.gz\r\nlib/spack/spack/fetch_strategy.py:449 ==> [2021-03-05-17:32:01.377546] Staging archive: /tmp/root/spack-stage/spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2/wheel-0.35.1.tar.gz\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:01.379510] '/usr/bin/tar' '-oxf' '/tmp/root/spack-stage/spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2/wheel-0.35.1.tar.gz'\r\nlib/spack/spack/stage.py:592 ==> [2021-03-05-17:32:01.399502] Created stage in /tmp/root/spack-stage/spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2\r\nlib/spack/spack/package.py:1407 ==> [2021-03-05-17:32:01.400843] No patches needed for py-wheel\r\nlib/spack/spack/installer.py:1656 ==> [2021-03-05-17:32:01.401559] py-wheel: Building py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2 [PythonPackage]\r\nlib/spack/spack/installer.py:1712 ==> [2021-03-05-17:32:01.410361] py-wheel: Executing phase: 'build'\r\nlib/spack/spack/error.py:55 ==> [2021-03-05-17:32:01.475291] Error: ProcessError: Command exited with status 1:\r\n    '/bin/python3.8' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nSee build log for details:\r\n  /tmp/root/spack-stage/spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2/spack-build-out.txt\r\n\r\nTraceback (most recent call last):\r\n  File \"/spack/lib/spack/spack/build_environment.py\", line 856, in _setup_pkg_and_run\r\n    return_value = function(pkg, kwargs)\r\n  File \"/spack/lib/spack/spack/installer.py\", line 1718, in build_process\r\n    phase(pkg.spec, pkg.prefix)\r\n  File \"/spack/lib/spack/spack/package.py\", line 110, in phase_wrapper\r\n    phase(spec, prefix)\r\n  File \"/spack/lib/spack/spack/build_systems/python.py\", line 171, in build\r\n    self.setup_py('build', *args)\r\n  File \"/spack/lib/spack/spack/build_systems/python.py\", line 160, in setup_py\r\n    self.python('-s', setup, '--no-user-cfg', *args, **kwargs)\r\n  File \"/spack/lib/spack/spack/build_systems/python.py\", line 154, in python\r\n    inspect.getmodule(self).python(*args, **kwargs)\r\n  File \"/spack/lib/spack/spack/util/executable.py\", line 217, in __call__\r\n    raise ProcessError('Command exited with status %d:' %\r\nspack.util.executable.ProcessError: Command exited with status 1:\r\n    '/bin/python3.8' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nlib/spack/spack/installer.py:1301 ==> [2021-03-05-17:32:01.557459] Flagging py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2 as failed: ProcessError: Command exited with status 1:\r\n    '/bin/python3.8' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nlib/spack/llnl/util/filesystem.py:685 ==> [2021-03-05-17:32:01.735440] TEMPORARY DIRECTORY CREATED [/spack/var/spack/environments/myenv/.spack-env/tmp24tct3gx]\r\nlib/spack/llnl/util/filesystem.py:688 ==> [2021-03-05-17:32:01.737586] DIRECTORY MOVED [src=/spack/var/spack/environments/myenv/.spack-env/view, dest=/spack/var/spack/environments/myenv/.spack-env/tmp24tct3gx]\r\nlib/spack/spack/environment.py:577 ==> [2021-03-05-17:32:01.738232] Updating view at /spack/var/spack/environments/myenv/.spack-env/view\r\nlib/spack/spack/filesystem_view.py:341 ==> [2021-03-05-17:32:01.788592] Warning: [/spack/var/spack/environments/myenv/.spack-env/view] Skipping external package: python@3.8.5%gcc@9.3.0+bz2+ctypes+dbm~debug+libxml2+lzma+nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87 arch=linux-ubuntu20.04-skylake/scbpvac\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:02.272706] 'file' '-b' '-h' '/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac/bin/easy_install-3.8'\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:02.300554] 'file' '-b' '-h' '/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-74i5uipoitwrxvvyn5kmzsqgzm6ml5ac/bin/easy_install'\r\nlib/spack/llnl/util/filesystem.py:710 ==> [2021-03-05-17:32:02.446074] TEMPORARY DIRECTORY DELETED [/spack/var/spack/environments/myenv/.spack-env/tmp24tct3gx]\r\nlib/spack/spack/main.py:765 ==> [2021-03-05-17:32:02.448852] ChildError: ProcessError: Command exited with status 1:\r\n    '/bin/python3.8' '-s' 'setup.py' '--no-user-cfg' 'build'\r\n```\r\n\r\nLog:\r\n\r\n```\r\n$ cat /tmp/root/spack-stage/spack-stage-py-wheel-0.35.1-fjhuioqezdwaehxgiuoa2bboyt7dmin2/spack-build-out.txt\r\nlib/spack/spack/installer.py:1712 ==> [2021-03-05-17:32:01.410361] py-wheel: Executing phase: 'build'\r\nlib/spack/spack/util/executable.py:182 ==> [2021-03-05-17:32:01.413513] '/bin/python3.8' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nTraceback (most recent call last):\r\n  File \"setup.py\", line 2, in <module>\r\n    from setuptools import setup\r\nModuleNotFoundError: No module named 'setuptools'\r\n```\r\n\r\n\r\n### Information on your system\r\n\r\n```\r\n$ spack debug report\r\n* **Spack:** 0.16.1-1615-4097a0c93f\r\n* **Python:** 3.8.5\r\n* **Platform:** linux-ubuntu20.04-skylake\r\n* **Concretizer:** original\r\n```\r\n\r\nI performed all experiments in docker. As a basis I use the following `my_Dockerfile`:\r\n```docker\r\n# Build stage with Spack pre-installed and ready to be used\r\nFROM ubuntu:20.04\r\n\r\nARG DEBIAN_FRONTEND=noninteractive\r\nSHELL [\"/bin/bash\", \"-c\"]\r\n# this is necessary to avoid timeouts during installation due to interactive installs\r\n\r\n# Installing necessary dependencies for preCICE, boost 1.71 from apt-get\r\nRUN apt-get -qq update && apt-get -qq install \\\r\n    build-essential \\\r\n    curl \\\r\n    unzip \\\r\n    git \\\r\n    python3-dev \\\r\n    wget && \\\r\n    rm -rf /var/lib/apt/lists/*\r\n\r\n# if we install python3-pip, wheel and setuptools are included and everything works.\r\n# RUN apt-get -qq update && apt-get -qq install \\\r\n#     python3-pip && \\\r\n#     rm -rf /var/lib/apt/lists/*\r\n\r\nRUN git clone https://github.com/spack/spack.git\r\n```\r\n\r\nI build and run this image via\r\n```console\r\n$ docker build -t spack_test -f my_Dockerfile .\r\n$ docker run -ti spack_test\r\n```\r\n\r\n### Additional information\r\n\r\nInstalling `py-wheel` via `spack` is not my ultimate goal, but I detected this problem, when I tried installing `py-cython` on the docker-system from above. Here, I ran into problems, if `py-wheels` was or too old missing. Related: https://github.com/spack/spack/pull/19558#discussion_r513258258\r\n\r\nSince it is easy to miss installing `wheel` and errors sometimes show up very late and are hard to track down I thought reporting this behavior might be useful.\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}