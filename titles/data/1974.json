{
    "url": "https://api.github.com/repos/spack/spack/issues/1974",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/1974/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/1974/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/1974/events",
    "html_url": "https://github.com/spack/spack/issues/1974",
    "id": 181822366,
    "node_id": "MDU6SXNzdWUxODE4MjIzNjY=",
    "number": 1974,
    "title": "flake8 tests: Don't overwrite files that haven't changed",
    "user": {
        "login": "citibeth",
        "id": 1924215,
        "node_id": "MDQ6VXNlcjE5MjQyMTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1924215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/citibeth",
        "html_url": "https://github.com/citibeth",
        "followers_url": "https://api.github.com/users/citibeth/followers",
        "following_url": "https://api.github.com/users/citibeth/following{/other_user}",
        "gists_url": "https://api.github.com/users/citibeth/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/citibeth/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/citibeth/subscriptions",
        "organizations_url": "https://api.github.com/users/citibeth/orgs",
        "repos_url": "https://api.github.com/users/citibeth/repos",
        "events_url": "https://api.github.com/users/citibeth/events{/privacy}",
        "received_events_url": "https://api.github.com/users/citibeth/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2016-10-08T12:02:43Z",
    "updated_at": "2016-10-10T14:14:30Z",
    "closed_at": "2016-10-10T14:14:29Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "@adamjstewart The one funny thing I've noticed with the flake8 tests is they overwrite the files you're working on every time you run.  Not sure why this is needed, but it is a bit annoying...\n\nBelow is code that can be used to overwrite files only if they are different.  Two things that could be improved with it:\n  *) Should be expanded to be a full Python context manager\n  *) It could write to an in-memory file with StringIO, rather than to a temporary file on disk.  Except for REALLY big files, that's probably a better approach these days.\n\n```\nimport tempfile\nimport filecmp\nimport shutil\n\n# ------------------------------------------------------\nclass WriteIfDifferent(object):\n    \"\"\"Allows user to write to a temporary file, then move it\n    to the destination only if it is different from the destination.\"\"\"\n    def __init__(self, ofname, **kwargs):\n        \"\"\"ofname: Name we ultimately want to write to.\"\"\"\n        self.ofname = ofname\n        self.file = tempfile.NamedTemporaryFile(delete=False, **kwargs)\n        self.tfname = self.file.name\n\n    def close(self):\n        self.file.close()\n        try:\n            if filecmp.cmp(self.tfname, self.ofname):\n                # Files are equal, we are done!\n                os.remove(self.tfname)\n                return\n        except: pass # Error means the files were NOT equal.\n\n        # Files are not equal, so copy the temporary file over.\n        shutil.copyfile(self.tfname, self.ofname)\n        os.remove(self.tfname)\n\n```\n",
    "performed_via_github_app": null
}