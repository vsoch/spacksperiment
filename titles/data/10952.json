{
    "url": "https://api.github.com/repos/spack/spack/issues/10952",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10952/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10952/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10952/events",
    "html_url": "https://github.com/spack/spack/pull/10952",
    "id": 423530180,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjYzMDg0Mjc2",
    "number": 10952,
    "title": "Add container sub-command to generate container spec files",
    "user": {
        "login": "samcmill",
        "id": 18687225,
        "node_id": "MDQ6VXNlcjE4Njg3MjI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/18687225?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/samcmill",
        "html_url": "https://github.com/samcmill",
        "followers_url": "https://api.github.com/users/samcmill/followers",
        "following_url": "https://api.github.com/users/samcmill/following{/other_user}",
        "gists_url": "https://api.github.com/users/samcmill/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/samcmill/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/samcmill/subscriptions",
        "organizations_url": "https://api.github.com/users/samcmill/orgs",
        "repos_url": "https://api.github.com/users/samcmill/repos",
        "events_url": "https://api.github.com/users/samcmill/events{/privacy}",
        "received_events_url": "https://api.github.com/users/samcmill/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446620495,
            "node_id": "MDU6TGFiZWw0NDY2MjA0OTU=",
            "url": "https://api.github.com/repos/spack/spack/labels/WIP",
            "name": "WIP",
            "color": "ededed",
            "default": false,
            "description": null
        },
        {
            "id": 719256466,
            "node_id": "MDU6TGFiZWw3MTkyNTY0NjY=",
            "url": "https://api.github.com/repos/spack/spack/labels/containers",
            "name": "containers",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 459174375,
            "node_id": "MDU6TGFiZWw0NTkxNzQzNzU=",
            "url": "https://api.github.com/repos/spack/spack/labels/revisit",
            "name": "revisit",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 17,
    "created_at": "2019-03-21T00:32:25Z",
    "updated_at": "2020-08-19T13:25:35Z",
    "closed_at": "2020-08-19T13:25:35Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/10952",
        "html_url": "https://github.com/spack/spack/pull/10952",
        "diff_url": "https://github.com/spack/spack/pull/10952.diff",
        "patch_url": "https://github.com/spack/spack/pull/10952.patch"
    },
    "body": "This PR adds a new subcommand, `container`, to generate container specification files.\r\n\r\nI am sure this PR is incomplete.  The objective is primarily to start a discussion about the usefulness of adding a container spec generation feature and the proposed implementation.\r\n\r\nIt uses HPC Container Maker (https://github.com/NVIDIA/hpc-container-maker) to generate either Dockerfiles or Singularity definition files based on the user selection.  HPCCM must be installed to use this capability (`pip install hpccm`).  \r\n\r\nExamples:\r\n```\r\n$ spack container --help\r\n$ spack container gromacs\r\n$ spack container --baseimage ubuntu:16.04 gromacs\r\n$ spack container --format singularity gromacs\r\n```\r\n\r\nThe container unwinds the DAG to build the dependencies in separate steps.  The reason for this is twofold.  \r\n\r\n1. The individual layers can be cached and re-used.  Consider building containers for both `gromacs@2019` and `gromacs@2018.2`.  Thanks to the container build cache, the second build will go much faster since only the final gromacs build step differs.\r\n\r\n2. If a layer fails (e.g., a download times out), then the build can be restarted from the last cached layer rather than having to restart from scratch, again saving considerable time.\r\n\r\nThis can be modified by the `--depth` option.  Set `--depth=0` to disable this capability.\r\n\r\nWhen generating Dockerfiles, multi-stage builds can be enabled by setting `--multi-stage`.  Currently this does not do much, but in the future if the runtime dependencies can be separated from the build dependencies, then this could be enhanced to produce significantly smaller container images.",
    "performed_via_github_app": null
}