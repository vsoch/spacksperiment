{
    "url": "https://api.github.com/repos/spack/spack/issues/12331",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12331/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12331/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12331/events",
    "html_url": "https://github.com/spack/spack/issues/12331",
    "id": 478609086,
    "node_id": "MDU6SXNzdWU0Nzg2MDkwODY=",
    "number": 12331,
    "title": "Spack reports multiple keys for gpg v2.2 even though only one was created",
    "user": {
        "login": "mamelara",
        "id": 7441417,
        "node_id": "MDQ6VXNlcjc0NDE0MTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7441417?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mamelara",
        "html_url": "https://github.com/mamelara",
        "followers_url": "https://api.github.com/users/mamelara/followers",
        "following_url": "https://api.github.com/users/mamelara/following{/other_user}",
        "gists_url": "https://api.github.com/users/mamelara/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mamelara/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mamelara/subscriptions",
        "organizations_url": "https://api.github.com/users/mamelara/orgs",
        "repos_url": "https://api.github.com/users/mamelara/repos",
        "events_url": "https://api.github.com/users/mamelara/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mamelara/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 966031931,
            "node_id": "MDU6TGFiZWw5NjYwMzE5MzE=",
            "url": "https://api.github.com/repos/spack/spack/labels/ecp",
            "name": "ecp",
            "color": "79d7ea",
            "default": false,
            "description": ""
        },
        {
            "id": 718816393,
            "node_id": "MDU6TGFiZWw3MTg4MTYzOTM=",
            "url": "https://api.github.com/repos/spack/spack/labels/good%20first%20issue",
            "name": "good first issue",
            "color": "3a7caf",
            "default": true,
            "description": null
        },
        {
            "id": 1491156024,
            "node_id": "MDU6TGFiZWwxNDkxMTU2MDI0",
            "url": "https://api.github.com/repos/spack/spack/labels/pipelines",
            "name": "pipelines",
            "color": "b22353",
            "default": false,
            "description": "Issues related to spack's pipeline features"
        },
        {
            "id": 446623896,
            "node_id": "MDU6TGFiZWw0NDY2MjM4OTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/platform-support",
            "name": "platform-support",
            "color": "bfdadc",
            "default": false,
            "description": null
        },
        {
            "id": 474580738,
            "node_id": "MDU6TGFiZWw0NzQ1ODA3Mzg=",
            "url": "https://api.github.com/repos/spack/spack/labels/versions",
            "name": "versions",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 480333036,
            "node_id": "MDU6TGFiZWw0ODAzMzMwMzY=",
            "url": "https://api.github.com/repos/spack/spack/labels/workaround",
            "name": "workaround",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "opadron",
        "id": 2837854,
        "node_id": "MDQ6VXNlcjI4Mzc4NTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2837854?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/opadron",
        "html_url": "https://github.com/opadron",
        "followers_url": "https://api.github.com/users/opadron/followers",
        "following_url": "https://api.github.com/users/opadron/following{/other_user}",
        "gists_url": "https://api.github.com/users/opadron/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/opadron/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/opadron/subscriptions",
        "organizations_url": "https://api.github.com/users/opadron/orgs",
        "repos_url": "https://api.github.com/users/opadron/repos",
        "events_url": "https://api.github.com/users/opadron/events{/privacy}",
        "received_events_url": "https://api.github.com/users/opadron/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "opadron",
            "id": 2837854,
            "node_id": "MDQ6VXNlcjI4Mzc4NTQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/2837854?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/opadron",
            "html_url": "https://github.com/opadron",
            "followers_url": "https://api.github.com/users/opadron/followers",
            "following_url": "https://api.github.com/users/opadron/following{/other_user}",
            "gists_url": "https://api.github.com/users/opadron/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/opadron/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/opadron/subscriptions",
            "organizations_url": "https://api.github.com/users/opadron/orgs",
            "repos_url": "https://api.github.com/users/opadron/repos",
            "events_url": "https://api.github.com/users/opadron/events{/privacy}",
            "received_events_url": "https://api.github.com/users/opadron/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-08-08T17:53:04Z",
    "updated_at": "2019-09-20T17:34:00Z",
    "closed_at": "2019-09-20T17:34:00Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "During the hackathon multiple people ran into an issue with gpg 2.2 because of the difference in output with `gpg --list-secret-keys --with-colons --fingerprint`. @opadron  was able to figure out that this was due to a difference in output from the different versions of gpg. \r\n\r\n\r\n### Steps to reproduce the issue\r\n\r\n```shell\r\n# use gpg v2.2.X\r\n$ gpg --list-secret-keys --with-colons --fingerprint\r\nsec:-:2048:1:XXXXXXXXXX:XXXXXXXX:::-:::escaESCA:::+:::23::0:\r\nfpr:::::::::XXXXXXXXXXXXXX:\r\ngrp:::::::::XXXXXXXXXXXXXX:\r\nuid:-::::XXXXXXXXX::XXXXXXXXX::Spack Build Pipeline (Demo Key) <key@spack.demo>::::::::::0:\r\nssb:-:2048:1:XXXXXXXXX::::::esa:::+:::23:\r\nfpr:::::::::XXXXXXXXXXX:\r\ngrp:::::::::XXXXXXXXXXX:\r\n\r\n```\r\n```shell\r\n# with gpg version 2.0.4\r\ngpg --list-secret-keys --with-colons --fingerprint\r\nsec::2048:1:XXXXXXXXXXX::::::::::\r\nfpr:::::::::XXXXXXXXXXXXXX:\r\nuid:::::::XXXXXXXXXXXXXXXX::Spack Build Pipeline (Demo Key) <key@spack.demo>:\r\nssb::2048:1:XXXXXXXXXXXXXXXX::::::::::\r\n```\r\n\r\nAs you can see in gpg version 2.2 both public and private keys are included in the output. I think the way spack currently handles this is by finding the first occurrence of `fpr` but since there are two `fpr`s in later versions Spack thinks there are multiple keys.\r\n\r\n### Error Message\r\n```console\r\n==> [2019-08-06-17:27:51.463007] creating binary cache file for package diffutils@3.7%gcc@8.2.0 arch=cray-cnl7-haswell \r\nTraceback (most recent call last):\r\n  File \"/global/project/projectdirs/swowner/JrAqyGHx/14/NERSC/spack-downstream-repo/lib/spack/spack/main.py\", line 697, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/global/project/projectdirs/swowner/JrAqyGHx/14/NERSC/spack-downstream-repo/lib/spack/spack/main.py\", line 447, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/global/project/projectdirs/swowner/JrAqyGHx/14/NERSC/spack-downstream-repo/lib/spack/spack/cmd/buildcache.py\", line 676, in buildcache\r\n    args.func(args)\r\n  File \"/global/project/projectdirs/swowner/JrAqyGHx/14/NERSC/spack-downstream-repo/lib/spack/spack/cmd/buildcache.py\", line 370, in createtarball\r\n    not args.no_rebuild_index)\r\n  File \"/global/project/projectdirs/swowner/JrAqyGHx/14/NERSC/spack-downstream-repo/lib/spack/spack/binary_distribution.py\", line 408, in build_tarball\r\n    sign_tarball(key, force, specfile_path)\r\n  File \"/global/project/projectdirs/swowner/JrAqyGHx/14/NERSC/spack-downstream-repo/lib/spack/spack/binary_distribution.py\", line 247, in sign_tarball\r\n    raise PickKeyException(str(keys))\r\nspack.binary_distribution.PickKeyException: Multi keys available for signing\r\n[u'XXXXXXXXXXXX', u'XXXXXXXXXXXX']\r\nUse spack buildcache create -k <key hash> to pick a key.\r\n...\r\n```\r\n\r\nOmar did a quick fix in `gpg.py` but we're not sure if this is the right way to approach this issue since we've not considered every case of output.\r\n\r\n",
    "performed_via_github_app": null
}