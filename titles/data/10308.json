{
    "url": "https://api.github.com/repos/spack/spack/issues/10308",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10308/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10308/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10308/events",
    "html_url": "https://github.com/spack/spack/issues/10308",
    "id": 398035607,
    "node_id": "MDU6SXNzdWUzOTgwMzU2MDc=",
    "number": 10308,
    "title": "Installation issue: hdf5%intel@18.0.5 ^intel-mpi@2018.4.274%intel@18.0.5 (error while loading shared libraries: libimf.so)",
    "user": {
        "login": "JiaweiZhuang",
        "id": 25473287,
        "node_id": "MDQ6VXNlcjI1NDczMjg3",
        "avatar_url": "https://avatars.githubusercontent.com/u/25473287?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JiaweiZhuang",
        "html_url": "https://github.com/JiaweiZhuang",
        "followers_url": "https://api.github.com/users/JiaweiZhuang/followers",
        "following_url": "https://api.github.com/users/JiaweiZhuang/following{/other_user}",
        "gists_url": "https://api.github.com/users/JiaweiZhuang/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/JiaweiZhuang/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/JiaweiZhuang/subscriptions",
        "organizations_url": "https://api.github.com/users/JiaweiZhuang/orgs",
        "repos_url": "https://api.github.com/users/JiaweiZhuang/repos",
        "events_url": "https://api.github.com/users/JiaweiZhuang/events{/privacy}",
        "received_events_url": "https://api.github.com/users/JiaweiZhuang/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2019-01-10T22:05:08Z",
    "updated_at": "2020-12-09T15:41:43Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Failed to build HDF5 with Intel MPI. (Can successfully build HDF5 without MPI or with OpenMPI, all using Intel compiler). \r\n\r\nThe error is \r\n```\r\n./H5make_libsettings: error while loading shared libraries: libimf.so: cannot open shared object file: No such file or directory\r\n```\r\n\r\n---\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install hdf5%intel@18.0.5 ^intel-mpi@2018.4.274%intel@18.0.5\r\n==> intel-mpi is already installed in /home/ubuntu/shared/spack/opt/spack/linux-ubuntu16.04-x86_64/intel-18.0.5/intel-mpi-2018.4.274-lxsyj2qtu3ikh36vy7wmksftpw2uozln\r\n==> zlib is already installed in /home/ubuntu/shared/spack/opt/spack/linux-ubuntu16.04-x86_64/intel-18.0.5/zlib-1.2.11-cvpzhrvce323vj2nqgpcqjnoq3vefxuw\r\n==> Installing hdf5\r\n==> Searching for binary cache of hdf5\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for hdf5 found: installing from source\r\n==> Using cached archive: /home/ubuntu/shared/spack/var/spack/cache/hdf5/hdf5-1.10.4.tar.gz\r\n==> Staging archive: /home/ubuntu/shared/spack/var/spack/stage/hdf5-1.10.4-usronacbwf6z5227t5wo3ic2xry2crmk/hdf5-1.10.4.tar.gz\r\n==> Created stage in /home/ubuntu/shared/spack/var/spack/stage/hdf5-1.10.4-usronacbwf6z5227t5wo3ic2xry2crmk\r\n==> No patches needed for hdf5\r\n==> Building hdf5 [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j8'\r\n\r\n4 errors found in build log:\r\n     1157      CCLD     H5detect\r\n     1158    LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH`echo  |                  \\\r\n     1159    \tsed -e 's/-L/:/g' -e 's/ //g'`\"                               \\\r\n     1160     ./H5make_libsettings > H5lib_settings.c  ||                               \\\r\n     1161        (test $HDF5_Make_Ignore && echo \"*** Error ignored\") ||          \\\r\n     1162        (rm -f H5lib_settings.c ; exit 1)\r\n  >> 1163    ./H5make_libsettings: error while loading shared libraries: libimf.so: cannot open shared object file: No such file or director\r\n             y\r\n     1164    Makefile:1886: recipe for target 'H5lib_settings.c' failed\r\n  >> 1165    make[2]: *** [H5lib_settings.c] Error 1\r\n     1166    make[2]: *** Waiting for unfinished jobs....\r\n     1167    make[2]: Leaving directory '/tmp/ubuntu/spack-stage/spack-stage-e7AFsP/hdf5-1.10.4/src'\r\n     1168    Makefile:1004: recipe for target 'all' failed\r\n  >> 1169    make[1]: *** [all] Error 2\r\n     1170    make[1]: Leaving directory '/tmp/ubuntu/spack-stage/spack-stage-e7AFsP/hdf5-1.10.4/src'\r\n     1171    Makefile:654: recipe for target 'all-recursive' failed\r\n  >> 1172    make: *** [all-recursive] Error 1\r\n```\r\n\r\n### Platform and user environment\r\n\r\n```commandline\r\n$ uname -a \r\nLinux ip-172-31-16-28 4.4.0-1072-aws #82-Ubuntu SMP Fri Nov 2 15:00:21 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:\tUbuntu 16.04.5 LTS\r\n``` \r\n\r\n### Additional information\r\n\r\nThe spec is:\r\n```\r\n$ spack spec  hdf5%intel@18.0.5 ^intel-mpi@2018.4.274%intel@18.0.5\r\nInput spec\r\n--------------------------------\r\nhdf5%intel@18.0.5\r\n    ^intel-mpi@2018.4.274%intel@18.0.5\r\n\r\nConcretized\r\n--------------------------------\r\nhdf5@1.10.4%intel@18.0.5~cxx~debug~fortran~hl+mpi+pic+shared~szip~threadsafe arch=linux-ubuntu16.04-x86_64\r\n    ^intel-mpi@2018.4.274%intel@18.0.5 arch=linux-ubuntu16.04-x86_64\r\n    ^zlib@1.2.11%intel@18.0.5+optimize+pic+shared arch=linux-ubuntu16.04-x86_64\r\n```\r\n\r\nThe error still occurs after the fix https://github.com/spack/spack/issues/8315#issuecomment-393160339 that adds intel libraries to`extra_rpaths`. Here's the compiler setup:\r\n\r\n```\r\n $ spack compiler info intel\r\nintel@18.0.5:\r\n\tpaths:\r\n\t\tcc = /home/ubuntu/shared/intel18/compilers_and_libraries_2018.5.274/linux/bin/intel64/icc\r\n\t\tcxx = /home/ubuntu/shared/intel18/compilers_and_libraries_2018.5.274/linux/bin/intel64/icpc\r\n\t\tf77 = /home/ubuntu/shared/intel18/compilers_and_libraries_2018.5.274/linux/bin/intel64/ifort\r\n\t\tfc = /home/ubuntu/shared/intel18/compilers_and_libraries_2018.5.274/linux/bin/intel64/ifort\r\n\tExtra rpaths:\r\n\t\t/home/ubuntu/shared/intel18/compilers_and_libraries_2018.5.274/linux/compiler/lib/intel64_lin\r\n\tmodules  = []\r\n\toperating system  = ubuntu16.04\r\n```\r\n\r\nWithout the `extra_rpaths` fix, all builds (without MPI, with OpenMPI, with Intel MPI) have the same `error while loading shared libraries: libimf.so` error. With the fix, HDF5 can be built successfully with no MPI or OpenMPI:\r\n\r\n```console\r\n# those work\r\n$ spack install hdf5~mpi %intel@18.0.5\r\n$ spack install hdf5 %intel@18.0.5  # with default OpenMPI\r\n```\r\n\r\nBut the build with intel MPI still has the same error.",
    "performed_via_github_app": null
}