{
    "url": "https://api.github.com/repos/spack/spack/issues/16730",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/16730/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/16730/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/16730/events",
    "html_url": "https://github.com/spack/spack/issues/16730",
    "id": 621233267,
    "node_id": "MDU6SXNzdWU2MjEyMzMyNjc=",
    "number": 16730,
    "title": "`lmod` integration unclear in module documentation",
    "user": {
        "login": "sjpb",
        "id": 33413598,
        "node_id": "MDQ6VXNlcjMzNDEzNTk4",
        "avatar_url": "https://avatars.githubusercontent.com/u/33413598?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sjpb",
        "html_url": "https://github.com/sjpb",
        "followers_url": "https://api.github.com/users/sjpb/followers",
        "following_url": "https://api.github.com/users/sjpb/following{/other_user}",
        "gists_url": "https://api.github.com/users/sjpb/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sjpb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sjpb/subscriptions",
        "organizations_url": "https://api.github.com/users/sjpb/orgs",
        "repos_url": "https://api.github.com/users/sjpb/repos",
        "events_url": "https://api.github.com/users/sjpb/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sjpb/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446625544,
            "node_id": "MDU6TGFiZWw0NDY2MjU1NDQ=",
            "url": "https://api.github.com/repos/spack/spack/labels/documentation",
            "name": "documentation",
            "color": "0d5977",
            "default": true,
            "description": ""
        },
        {
            "id": 512483297,
            "node_id": "MDU6TGFiZWw1MTI0ODMyOTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-low",
            "name": "impact-low",
            "color": "fef2c0",
            "default": false,
            "description": ""
        },
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 2,
    "created_at": "2020-05-19T19:35:27Z",
    "updated_at": "2020-05-27T08:36:20Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "Having recently installed spack on a system with `lmod` and built packages with it I was confused that `module avail` showed no modules. After asking for help on slack I discovered that `setup-env.sh` only sets `MODULEPATH` for `tcl`. I suggested on Slack that the module tutorial wasn't very clear about `lmod` use but having just gone back and reread the it `Hierarchical Module Files` section is actually fairly clear, but the details for lmod get a bit lost in a) the length of it and b) issues elsewhere.\r\n\r\nThings which are confusing:\r\n- [Using module files via Spack](https://spack.readthedocs.io/en/latest/module_file_support.html#using-module-files-via-spack) suggests to me that `lmod` should \"just work\" with no configuration:\r\n  > If you have installed a supported module system you should be able to run either `module avail` or `use -l spack` to see what module files have been installed.\r\n- [Shell support](https://spack.readthedocs.io/en/latest/module_file_support.html#id2) says:\r\n  > To enable additional Spack commands for loading and unloading module files, and to add the correct path to MODULEPATH, you need to source the appropriate setup file in the $SPACK_ROOT/share/spack directory.\r\n  \r\n  with no mention that actually this only applies to `tcl`.\r\n\r\nAdditionally the module tutorial:\r\n- [starts with](https://spack-tutorial.readthedocs.io/en/latest/tutorial_modules.html#build-a-module-tool) `lmod`\r\n- says in that section:\r\n  > Now we can re-source the setup file and Spack modules will be put in our module path\r\n- [shows](https://spack-tutorial.readthedocs.io/en/latest/tutorial_modules.html#non-hierarchical-module-files) `module avail` working without changes to `MODULEPATH` - admittedly this is for non-hierarchical modules, but it is using `lmod`.\r\n\r\n\r\nI also note (although its not strictly related) that the module tutorial [says](https://spack-tutorial.readthedocs.io/en/latest/tutorial_modules.html#add-a-new-compiler) that `spack load`\r\n> employed the module files generated automatically by Spack. \r\n\r\nwhich I understand is not true.\r\n\r\nIts hard to provide a clean paragraph change which fixes the above, but from a new user point-of-view I think the list of things needed to know to get `lmod` working as expected (i.e. hierarchically, because that's how lmod is generally used I believe):\r\n- `${SPACK_ROOT}/etc/spack/modules.yaml` needs to have `lmod:` or maybe `lmod::` in it.\r\n- You need to load the compiler(s) you want to use, then run  `spack compiler add`.\r\n- You must define at least one Core (i.e. os-defined) compiler in `modules.yaml`, to form the entry point for the heirarchy.\r\n- You need to run something like this to add Spack's modules into `lmod`:\r\n  \r\n      module use ${SPACK_ROOT}/share/spack/lmod/linux-centos7-x86_64/Core/\r\n\r\n- You need to rebuild Spack's modules using\r\n\r\n      spack module lmod refresh --delete-tree -y\r\n\r\n  (I think?)\r\n",
    "performed_via_github_app": null
}