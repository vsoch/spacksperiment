{
    "url": "https://api.github.com/repos/spack/spack/issues/12560",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12560/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12560/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12560/events",
    "html_url": "https://github.com/spack/spack/issues/12560",
    "id": 484736813,
    "node_id": "MDU6SXNzdWU0ODQ3MzY4MTM=",
    "number": 12560,
    "title": "Build error using spack mirrors to build py-chardet",
    "user": {
        "login": "CalvinDSeamons",
        "id": 35508425,
        "node_id": "MDQ6VXNlcjM1NTA4NDI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/35508425?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/CalvinDSeamons",
        "html_url": "https://github.com/CalvinDSeamons",
        "followers_url": "https://api.github.com/users/CalvinDSeamons/followers",
        "following_url": "https://api.github.com/users/CalvinDSeamons/following{/other_user}",
        "gists_url": "https://api.github.com/users/CalvinDSeamons/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/CalvinDSeamons/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/CalvinDSeamons/subscriptions",
        "organizations_url": "https://api.github.com/users/CalvinDSeamons/orgs",
        "repos_url": "https://api.github.com/users/CalvinDSeamons/repos",
        "events_url": "https://api.github.com/users/CalvinDSeamons/events{/privacy}",
        "received_events_url": "https://api.github.com/users/CalvinDSeamons/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-08-23T22:34:39Z",
    "updated_at": "2019-09-03T21:58:08Z",
    "closed_at": "2019-09-03T21:56:54Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\nThe first snippet of code is py-chardet installing with no issues from a mirror on a system with internet access. \r\n```console\r\n$ spack mirror create -D py-chardet\r\n$ spack mirror add $name *PATH*/$name\r\n$ spack install py-chardet\r\n==> diffutils is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/diffutils-3.7-ko7qdeieiylfx6v6v3u7jqptrv7lyvoj\r\n==> bzip2 is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/bzip2-1.0.8-hhbrbrhbf5tkbqcg57apuqeg2b7nhich\r\n==> libbsd is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libbsd-0.9.1-z3iyo2ibak3luzwebdwmoganb4x4orje\r\n==> expat is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/expat-2.2.5-cn2qjequsqaizlcxsvr74gq4rntgl5zn\r\n==> pkgconf is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/pkgconf-1.6.1-zyia6fm5vvznsxxla43wto6vezv3jciz\r\n==> ncurses is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/ncurses-6.1-rqw3cmcwvd76h4rjgtaxpvrqg47prwkg\r\n==> readline is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/readline-7.0-b4z2xcjalfc4z7tgktx7txhe2my3wlfd\r\n==> gdbm is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gdbm-1.18.1-dv2qksj2dheh7hzmu7iftqhxlkqrinwt\r\n==> libiconv is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libiconv-1.15-bli6oh4rawy6bwdqa7ylbp7wt5tkynyv\r\n==> xz is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/xz-5.2.4-agv5zlv7phi4ye3evlpv3t4ypgve4bpe\r\n==> zlib is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/zlib-1.2.11-64vg6e4evdrlqgx7iicwhu2hs7lv6gpz\r\n==> libxml2 is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libxml2-2.9.9-7mziu5hpmcz6mzurl4tnfvr3edkcacjl\r\n==> tar is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/tar-1.31-i3i4p3q35guhtu3qq5n2pr6f227xr7ha\r\n==> gettext is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gettext-0.19.8.1-osb2am7ooumpqy7dg3njcbzs6x4u4lfy\r\n==> libffi is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libffi-3.2.1-ksqyb2nne56f3f5z5cfsjwqyjfpnbejl\r\n==> perl is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.26.2-7tmxubxk4qnty7decxqsz5yu5v3p3lqq\r\n==> openssl is already installed in*PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/openssl-1.1.1c-4j6vfpkc34grsa5inqmqpxspw77dt6pv\r\n==> sqlite is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/sqlite-3.28.0-jymozgspl2bcxtorqvgcrkf2hbbdkr3s\r\n==> python is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/python-2.7.16-akox7z53z6whefovfhrnidla5g5iqvye\r\n==> py-setuptools is already installed in *PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-7aotd5zamac4vxrlr4l3tliwkqbd44j2\r\n==> Installing py-chardet\r\n==> Searching for binary cache of py-chardet\r\n==> Finding buildcaches in *PATH*/spack/py-chardet-mirror//build_cache\r\n==> No binary for py-chardet found: installing from source\r\n==> Fetching file:///*PATH*/spack/py-chardet-mirror/py-chardet/py-chardet-3.0.2.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /tmp/spack-stage/calvin/py-chardet-3.0.2-fj2yzc4aynffncjt4t7ykasoozx3n2jj/chardet-3.0.2.tar.gz\r\n==> Created stage in /tmp/spack-stage/calvin/py-chardet-3.0.2-fj2yzc4aynffncjt4t7ykasoozx3n2jj\r\n==> No patches needed for py-chardet\r\n==> Building py-chardet [PythonPackage]\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed py-chardet\r\n  Fetch: 0.02s.  Build: 2.11s.  Total: 2.13s.\r\n[+] /*PATH*/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/py-chardet-3.0.2-fj2yzc4aynffncjt4t7ykasoozx3n2jj\r\n\r\n```\r\nBelow is another system without access to the internet with the mirror from above copied over.  \r\n\r\n\r\n```console\r\n$ spack install py-chardet\r\n==> diffutils is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/diffutils-3.7-q6kg3el76v4ow4besjharxq7pmbk5e77\r\n==> bzip2 is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/bzip2-1.0.8-fslu4eku7nv64btwtycq45jf4iqebzq4\r\n==> libbsd is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/libbsd-0.9.1-li3rs5m2upxtnedr4ym5nujzc3cgiwmh\r\n==> expat is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/expat-2.2.5-7wtpegybe7jlv46j53pzyl7ivxe6v3zr\r\n==> pkgconf is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/pkgconf-1.6.1-painzorzjyprtyujfegxjkfbzl4jtdhn\r\n==> ncurses is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/ncurses-6.1-wkyck363aqihprfuuiipgdmzt6vjk6nk\r\n==> readline is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/readline-7.0-sfsamtunmnste5uxxmlvskfkjz7uhbcj\r\n==> gdbm is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/gdbm-1.18.1-verdgofikxsccbgxxozvdsrnewnc6jgh\r\n==> libiconv is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/libiconv-1.15-vlje6jumvfnor2wlmrq6cfilfi6zm7jt\r\n==> xz is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/xz-5.2.4-rh7gav63dk5xbjp2hq4rtp4wmuwk7slb\r\n==> zlib is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/zlib-1.2.11-vhzh5cfaki5lx5sjuth5iuojq5azdkbd\r\n==> libxml2 is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/libxml2-2.9.9-hionxpggi5cnp3jrsjh7s7fyial4hshv\r\n==> tar is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/tar-1.31-wiqmehfabuu63qb5puqfc6ext3sywhrl\r\n==> gettext is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/gettext-0.19.8.1-h7pjtji5nclu5vibcwpuvj5kerwx6mbk\r\n==> libffi is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/libffi-3.2.1-4s3dshkk5mra3bp2vdxqfasds2sxmzrp\r\n==> perl is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/perl-5.26.2-wa43pmynkm6qb5j7yi7mxo45jmrmi5iz\r\n==> openssl is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/openssl-1.1.1c-otnl3ibgdbsdxtkuqlcnmt2a76tsu3a4\r\n==> sqlite is already installed in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/sqlite-3.28.0-vina3q22pu3ipnjuswwwtwkjalwph34e\r\n==> Installing python\r\n==> Searching for binary cache of python\r\n==> Finding buildcaches on ./spack-mirror-2019-08-22/\r\n==> Warning: Spack will not check SSL certificates. You need to update your Python to enable certificate verification.\r\n==> Finding buildcaches in *PATH*/py-chardet-mirror//build_cache\r\n==> No binary for python found: installing from source\r\n==> Fetching file://*PATH*/py-chardet-mirror/python/python-2.7.16.tgz\r\n######################################################################## 100.0%\r\n==> Staging archive: *PATH*/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/Python-2.7.16.tgz\r\n==> Created stage in *PATH*/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa\r\n==> Ran patch() for python\r\n==> Building python [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/python2-config\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/pydoc\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/idle\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/2to3\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/smtpd.py\r\n==> Successfully installed python\r\n  Fetch: 0.32s.  Build: 1m 46.89s.  Total: 1m 47.21s.\r\n[+] *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa\r\n==> Installing py-setuptools\r\n==> Searching for binary cache of py-setuptools\r\n==> Finding buildcaches on ./spack-mirror-2019-08-22/\r\n==> Warning: Spack will not check SSL certificates. You need to update your Python to enable certificate verification.\r\n==> Finding buildcaches in *PATH*/py-chardet-mirror//build_cache\r\n==> No binary for py-setuptools found: installing from source\r\n==> Fetching file://*PATH*/py-chardet-mirror/py-setuptools/py-setuptools-41.0.1.zip\r\n######################################################################## 100.0%\r\n==> Staging archive: *PATH*/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/setuptools-41.0.1.zip\r\n==> Created stage in *PATH*/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx\r\n==> No patches needed for py-setuptools\r\n==> Building py-setuptools [PythonPackage]\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/bin/easy_install\r\n==> Warning: Patched overlong shebang in *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/bin/easy_install-2.7\r\n==> Successfully installed py-setuptools\r\n  Fetch: 0.03s.  Build: 2.70s.  Total: 2.73s.\r\n[+] *PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx\r\n==> Installing py-chardet\r\n==> Searching for binary cache of py-chardet\r\n==> Finding buildcaches on ./spack-mirror-2019-08-22/\r\n==> Warning: Spack will not check SSL certificates. You need to update your Python to enable certificate verification.\r\n==> Finding buildcaches in *PATH*/py-chardet-mirror//build_cache\r\n==> No binary for py-chardet found: installing from source\r\n==> Using cached archive: *PATH*/spack/var/spack/cache/py-chardet/py-chardet-3.0.2.tar.gz\r\n==> Staging archive: *PATH*/py-chardet-3.0.2-2aeirjvr3ekqu4xdi753ishosfdzxo3b/chardet-3.0.2.tar.gz\r\n==> Created stage in *PATH*/py-chardet-3.0.2-2aeirjvr3ekqu4xdi753ishosfdzxo3b\r\n==> No patches needed for py-chardet\r\n==> Building py-chardet [PythonPackage]\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/python2.7' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nSee build log for details:\r\n  *PATH*/py-chardet-3.0.2-2aeirjvr3ekqu4xdi753ishosfdzxo3b/spack-build-out.txt\r\n\r\n```\r\nHere are the contents of the `spack-build-out.txt`\r\n```console\r\n==> Executing phase: 'build'\r\n==> [2019-08-23-15:56:02.753350] '*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/python-2.7.16-amwgjf5cxfwuyk5x5x4jge5gn56vkhfa/bin/python2.7' '-s' 'setup.py' '--no-user-cfg' 'build'\r\nDownload error on https://pypi.org/simple/pytest-runner/: [Errno 97] Address family not supported by protocol -- Some packages may not be found!\r\nCouldn't find index page for 'pytest-runner' (maybe misspelled?)\r\nDownload error on https://pypi.org/simple/: [Errno 97] Address family not supported by protocol -- Some packages may not be found!\r\nNo local packages or working download links found for pytest-runner\r\nTraceback (most recent call last):\r\n  File \"setup.py\", line 52, in <module>\r\n    ['chardetect = chardet.cli.chardetect:main']})\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/setuptools/__init__.py\", line 144, in setup\r\n    _install_setup_requires(attrs)\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/setuptools/__init__.py\", line 139, in _install_setup_requires\r\n    dist.fetch_build_eggs(dist.setup_requires)\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/setuptools/dist.py\", line 717, in fetch_build_eggs\r\n    replace_conflicting=True,\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 782, in resolve\r\n    replace_conflicting=replace_conflicting\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 1065, in best_match\r\n    return self.obtain(req, installer)\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 1077, in obtain\r\n    return installer(requirement)\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/setuptools/dist.py\", line 784, in fetch_build_egg\r\n    return cmd.easy_install(req)\r\n  File \"*PATH*/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/py-setuptools-41.0.1-oczl4htyiutqfuhwmi2bqv4zmoytujkx/lib/python2.7/site-packages/setuptools/command/easy_install.py\", line 673, in easy_install\r\n    raise DistutilsError(msg)\r\ndistutils.errors.DistutilsError: Could not find suitable distribution for Requirement.parse('pytest-runner')\r\n```\r\n\r\n### Platform and user environment\r\nlinux-rhel7-x86_64\r\n\r\n### Additional information\r\nIt would appear despite the mirror, py-chardet is still trying to reach out to the internet. \r\nDifference between the two machines centos7(worked) -> rhel7(failed)\r\n",
    "performed_via_github_app": null
}