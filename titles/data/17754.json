{
    "url": "https://api.github.com/repos/spack/spack/issues/17754",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/17754/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/17754/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/17754/events",
    "html_url": "https://github.com/spack/spack/pull/17754",
    "id": 667426616,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NDU4MDk1MDc1",
    "number": 17754,
    "title": "Detecting changed files: don't use version range for detached commit",
    "user": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2020-07-28T22:39:04Z",
    "updated_at": "2020-07-29T18:23:36Z",
    "closed_at": "2020-07-29T18:23:36Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/17754",
        "html_url": "https://github.com/spack/spack/pull/17754",
        "diff_url": "https://github.com/spack/spack/pull/17754.diff",
        "patch_url": "https://github.com/spack/spack/pull/17754.patch"
    },
    "body": "(EDIT: this is better resolved by https://github.com/spack/spack/pull/17732/files although it summarizes the issue, so I've added a close tag to that PR and this will be automatically closed when that is merged)\r\n\r\nSee also: https://github.com/spack/spack/pull/17738\r\n\r\nFrom https://git-scm.com/docs/git-diff\r\n\r\n> `git diff [<options>] <commit>...<commit> [--] [<path>\u2026\u200b]`\r\n> `This form is to view the changes on the branch containing and up to the second <commit>, starting at a common ancestor of both <commit>. \"git diff A...B\" is equivalent to \"git diff $(git merge-base A B) B\". You can omit any one of <commit>, which has the same effect as using HEAD instead.`\r\n\r\n`spack.cmd.flake8.changed_files` runs \r\n\r\n`'/usr/local/bin/git' 'diff' '--name-only' '--diff-filter=ACMR' 'develop...'`\r\n\r\nWhich (from the linked documentation) will involve calling `git merge-base develop...HEAD`\r\n\r\nHowever, the commands which set up the git repository result in a detached head with no discernable merge-base, e.g. from  https://github.com/spack/spack/pull/17733/checks?check_run_id=920605207:\r\n\r\n```\r\ngit init test1\r\ngit remote add origin https://github.com/spack/spack\r\ngit -c protocol.version=2 fetch --no-tags --prune --progress --no-recurse-submodules --depth=1 origin +893837c02773b007384c0de343baa43223cda865:refs/remotes/pull/17733/merge\r\ngit checkout --progress --force refs/remotes/pull/17733/merge\r\n```\r\n\r\nFor some reason, Git versions before 2.28.0 on Mac OS (and including that on Ubuntu) tolerate the fact that `git merge-base develop...HEAD` returns nothing. However, 2.28.0 on Mac OS rejects `git diff develop...HEAD` with:\r\n\r\n`fatal: HEAD...develop: no merge base`\r\n\r\nTo resolve this, the PR uses the `git diff` format which compares two arbitrary commits, for example: `git diff develop`\r\n",
    "performed_via_github_app": null
}