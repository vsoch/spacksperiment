{
    "url": "https://api.github.com/repos/spack/spack/issues/13065",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13065/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13065/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13065/events",
    "html_url": "https://github.com/spack/spack/issues/13065",
    "id": 503565472,
    "node_id": "MDU6SXNzdWU1MDM1NjU0NzI=",
    "number": 13065,
    "title": "tests: revisit `mock_stage`, `nomockstage`, and `tmp_build_stage_dir`",
    "user": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 512483297,
            "node_id": "MDU6TGFiZWw1MTI0ODMyOTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-low",
            "name": "impact-low",
            "color": "fef2c0",
            "default": false,
            "description": ""
        },
        {
            "id": 1371552534,
            "node_id": "MDU6TGFiZWwxMzcxNTUyNTM0",
            "url": "https://api.github.com/repos/spack/spack/labels/stage",
            "name": "stage",
            "color": "b50fc1",
            "default": false,
            "description": ""
        },
        {
            "id": 456341797,
            "node_id": "MDU6TGFiZWw0NTYzNDE3OTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/tests",
            "name": "tests",
            "color": "b60205",
            "default": false,
            "description": "General test capability(ies)"
        },
        {
            "id": 480333036,
            "node_id": "MDU6TGFiZWw0ODAzMzMwMzY=",
            "url": "https://api.github.com/repos/spack/spack/labels/workaround",
            "name": "workaround",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tldahlgren",
            "id": 35777542,
            "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tldahlgren",
            "html_url": "https://github.com/tldahlgren",
            "followers_url": "https://api.github.com/users/tldahlgren/followers",
            "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
            "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
            "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
            "repos_url": "https://api.github.com/users/tldahlgren/repos",
            "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 0,
    "created_at": "2019-10-07T16:40:06Z",
    "updated_at": "2019-10-10T18:13:36Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Revisit `autouse` of `mock_stage` and `check_for_leftover_stage_files` per Peter's (scheibelp) feedback on #12857 .  Also revisit `tmp_build_stage_dir` fixture (per https://github.com/spack/spack/pull/12857#discussion_r333244995).\r\n\r\n-----------------------\r\n> So I would think it would be better to either revisit having it autouse (which should be mirrored in the use of the check_for_leftover_stage_files fixture) OR make more use of the nomockstage mark to avoid the unnecessary overhead.\r\n\r\nI prefer the former and agree that if it comes to this it ought to be dealt with in a later PR. However, I'm curious about:\r\n\r\n> Given mock_stage is (now at) the function level and autouse, this file system activity is performed whether the test case needs it or not.\r\n\r\nI was wondering if there might be a way to make the tests work regardless of whether this runs. The goal of this is to ensure that for the purposes of testing that the stages are created in a test-managed directory. I'm wondering if introducing an additional root path component would reconcile the concerns of the tests: e.g. right now the stage path read from `config.yaml` is relative to `/` but we could add a module-level variable to `Stage` that adjusts this root to be a temporary directory.\r\n\r\nDoes that seem reasonable? It could also be moved to another refactor PR but I prefer it to the approach of removing `autouse` or using `nomockstage`. I think it could be beneficial even in the case of removing the `autouse` but IMO it would also make it so `autouse` was only a performance problem.\r\n\r\n_Originally posted by @scheibelp in https://github.com/spack/spack/pull/12857_",
    "performed_via_github_app": null
}