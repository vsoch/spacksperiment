{
    "url": "https://api.github.com/repos/spack/spack/issues/25177",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/25177/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/25177/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/25177/events",
    "html_url": "https://github.com/spack/spack/issues/25177",
    "id": 957882927,
    "node_id": "MDU6SXNzdWU5NTc4ODI5Mjc=",
    "number": 25177,
    "title": "Installation issue: charmpp ",
    "user": {
        "login": "pelahi",
        "id": 12030027,
        "node_id": "MDQ6VXNlcjEyMDMwMDI3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12030027?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pelahi",
        "html_url": "https://github.com/pelahi",
        "followers_url": "https://api.github.com/users/pelahi/followers",
        "following_url": "https://api.github.com/users/pelahi/following{/other_user}",
        "gists_url": "https://api.github.com/users/pelahi/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pelahi/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pelahi/subscriptions",
        "organizations_url": "https://api.github.com/users/pelahi/orgs",
        "repos_url": "https://api.github.com/users/pelahi/repos",
        "events_url": "https://api.github.com/users/pelahi/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pelahi/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2021-08-02T08:12:02Z",
    "updated_at": "2021-08-02T08:12:02Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\n\nThe issue is how charmpp defines compiler names and how inflexible it is. The spack recipe will need an update to deal with this issue. To highlight it, I have tried building charmpp with three different GNU compiler versions. \r\n\r\nHere are the compiler versions and the spec produced. \r\n```console\r\n$ gcc-10 --version # gcc 10 is only available as gcc-10\r\ngcc-10 (Ubuntu 10.3.0-1ubuntu1~20.04) 10.3.0\r\nCopyright (C) 2020 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n$ gfortran-10 --version # gfortran is similarly available through gfortran-10 \r\nGNU Fortran (Ubuntu 10.3.0-1ubuntu1~20.04) 10.3.0\r\nCopyright (C) 2020 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n$ spack spec charmpp %gcc@10.3.0\r\nInput spec\r\n--------------------------------\r\ncharmpp%gcc@10.3.0\r\n\r\nConcretized\r\n--------------------------------\r\ncharmpp@6.10.2%gcc@10.3.0~cuda~omp~papi+production~pthreads+shared+smp~syncft~tcp~tracing backend=netlrts build-target=LIBS pmi=none arch=linux-ubuntu20.04-x86_64\r\n\r\n$ # gcc 9 is available \r\n$ gcc --version # gcc 9 is only available as gcc\r\ngcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0\r\nCopyright (C) 2019 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n$ gfortran --version # gfortran is similarly available through gfortran\r\nGNU Fortran (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0\r\nCopyright (C) 2019 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n$ spack spec charmpp %gcc@9.3.0\r\nInput spec\r\n--------------------------------\r\ncharmpp%gcc@9.3.0\r\n\r\nConcretized\r\n--------------------------------\r\ncharmpp@6.10.2%gcc@9.3.0~cuda~omp~papi+production~pthreads+shared+smp~syncft~tcp~tracing backend=netlrts build-target=LIBS pmi=none arch=linux-ubuntu20.04-x86_64\r\n\r\n$ # gcc 8 also available via gcc-8 executable\r\n$ spack spec charmpp %gcc@8.4.0\r\nInput spec\r\n--------------------------------\r\ncharmpp%gcc@8.4.0\r\n\r\nConcretized\r\n--------------------------------\r\ncharmpp@6.10.2%gcc@8.4.0~cuda~omp~papi+production~pthreads+shared+smp~syncft~tcp~tracing backend=netlrts build-target=LIBS pmi=none arch=linux-ubuntu20.04-x86_64 \r\n```\r\n\r\nThe resulting builds follow: \r\n```console\r\n$ spack install charmpp %gcc@10.3.0\r\n==> Installing charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm\r\n==> No binary for charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm found: installing from source\r\n==> Using cached archive: /home/ubuntu/spack/var/spack/cache/_source-cache/archive/7a/7abb4cace8aebdfbb8006eac03eb766897c009cfb919da0d0a33f74c3b4e6deb.tar.gz\r\n==> charmpp: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    './build' 'LIBS' 'netlrts-linux-x86_64' 'gcc-10' 'gfortran-10' '-j16' '--destination=/home/ubuntu/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-10.3.0/charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm' 'smp' '--build-shared' '--with-production'\r\nSee build log for details:\r\n  /tmp/ubuntu/spack-stage/spack-stage-charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm/spack-build-out.txt\r\n$ cat /tmp/ubuntu/spack-stage/spack-stage-charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm/spack-build-out.txt\r\n==> charmpp: Executing phase: 'install'\r\n==> [2021-08-02-07:53:06.986784] './build' 'LIBS' 'netlrts-linux-x86_64' 'gcc-10' 'gfortran-10' '-j16' '--destination=/home/ubuntu/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-10.3.0/charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm' 'smp' '--build-shared' '--with-production'\r\nError> option: gfortran-10 is not supported in this version!\r\nSupported compilers: clang craycc gcc icc iccstatic msvc pgcc xlc xlc64\r\nSupported options: bigemulator bigsim clustermatic common cuda flang gfortran ifort local nolb omp ooc papi pedantic perftools persistent pgf90 pxshm smp syncft sysvshm tcp tsan\r\n\r\n$ install charmpp %gcc@9.3.0\r\n==> Installing charmpp-6.10.2-dvxkjegc3ze3sakfbtfsfo457musu5ej\r\n==> No binary for charmpp-6.10.2-dvxkjegc3ze3sakfbtfsfo457musu5ej found: installing from source\r\n==> Using cached archive: /home/ubuntu/spack/var/spack/cache/_source-cache/archive/7a/7abb4cace8aebdfbb8006eac03eb766897c009cfb919da0d0a33f74c3b4e6deb.tar.gz\r\n==> charmpp: Executing phase: 'install'\r\n[+] /home/ubuntu/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/charmpp-6.10.2-dvxkjegc3ze3sakfbtfsfo457musu5ej\r\n\r\n$ install charmpp %gcc@8.4.0 # similar issue to gcc@10.3.0\r\n```\r\n\r\nThere are similar issues on a cray system where the compilers are called `cc` rather than `craycc`. The charmpp build script does not recognise this compiler and then fails.\r\n```console \r\n$ spack install charmpp pmi=slurmpmi2 backend=mpi %gcc@7.2.0\"\r\n[+] None (external slurm-20.02.5-1-afmopinmgbephlmiq6yu5wlq75jegdxz)\r\n==> Installing charmpp-6.10.2-xu3qxov4aqezqho5hkwqezjefljqncf4\r\n==> No binary for charmpp-6.10.2-xu3qxov4aqezqho5hkwqezjefljqncf4 found: installing from source\r\n==> Using cached archive: /group/pawsey0001/pelahi/spack-tests/spack-all/var/spack/cache/_source-cache/archive/7a/7abb4cace8aebdfbb8006eac03eb766897c009cfb919da0d0a33f74c3b4e6deb.tar.gz\r\n==> No patches needed for charmpp\r\n==> charmpp: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    './build' 'LIBS' 'mpi-linux-x86_64' 'cc' 'ftn' '-j16' '--destination=/group/pawsey0001/pelahi/spack-tests/spack-all/opt/spack/cray-cnl6-haswell/gcc-7.2.0/charmpp-6.10.2-xu3qxov4aqezqho5hkwqezjefljqncf4' 'slurmpmi2' '--incdir=/opt/cray/pe/mpt/7.7.0/gni/mpich-gnu/5.1/include' '--libdir=/opt/cray/pe/mpt/7.7.0/gni/mpich-gnu/5.1/lib' 'smp' '--build-shared' '--with-production'\r\n \r\n$ # log file contains\r\n$ more ${log}\r\n==> charmpp: Executing phase: 'install'\r\n==> [2021-07-30-15:50:48.796202] './build' 'LIBS' 'mpi-linux-x86_64' 'cc' 'ftn' '-j16' '--destination=/group/pawsey0001/pelahi/spack-tests/spack-all/opt/spack/cray-cnl6-haswell/gcc-7.2.0/charmpp-6.10.2-xu3qxov4aqezqho5hkwqezjefljqncf4' 'slurmpmi2' '--incdir=/opt/cray/pe/mpt/7.7.0/gni/mpich-gnu/5.1/include' '--libdir=/opt/cray/pe/mpt/7.7.0/gni/mpich-gnu/5.1/lib' 'smp' '--build-shared' '--with-production'\r\nError> option: cc is not supported in this version!\r\nSupported compilers: clang craycc gcc icc iccstatic mpicxx msvc pathscale pgcc xlc xlc64\r\nSupported options: bigemulator bigsim common cuda flang gfortran gm gm2 ifort lam mic mpt nolb omp ooc papi pedantic perftools persistent pgf90 pthreads scyld smp syncft tsan\r\n ```\r\n\n\n### Information on your system\n\n* **Spack:** 0.16.2-1-c699e907fc\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-x86_64\n\n### Additional information\n\nThere are no maintainers\r\n```console\r\n$ spack maintainers charmpp \r\n```\r\n\r\nOn Linux\r\n=======\r\n\r\nThe configuration is\r\n```console\r\n$ more ~/.spack/linux/compilers.yaml\r\n```\r\n```yaml\r\ncompilers:\r\n- compiler:\r\n    spec: clang@11.0.0\r\n    paths:\r\n      cc: /usr/bin/clang-11\r\n      cxx: /usr/bin/clang++-11\r\n      f77: null\r\n      fc: null\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: gcc@10.3.0\r\n    paths:\r\n      cc: /usr/bin/gcc-10\r\n      cxx: /usr/bin/g++-10\r\n      f77: /usr/bin/gfortran-10\r\n      fc: /usr/bin/gfortran-10\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: gcc@9.3.0\r\n    paths:\r\n      cc: /usr/bin/gcc\r\n      cxx: /usr/bin/g++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: gcc@8.4.0\r\n    paths:\r\n      cc: /usr/bin/gcc-8\r\n      cxx: /usr/bin/g++-8\r\n      f77: /usr/bin/gfortran-8\r\n      fc: /usr/bin/gfortran-8\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n```\r\n\r\nThe log files are already provided. `spack-build-env.txt` for `gcc-10` build\r\n```bash\r\nC=/home/ubuntu/spack/lib/spack/env/gcc/gcc; export CC\r\nCMAKE_PREFIX_PATH=''; export CMAKE_PREFIX_PATH\r\nCXX=/home/ubuntu/spack/lib/spack/env/gcc/g++; export CXX\r\nDBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus; export DBUS_SESSION_BUS_ADDRESS\r\nDISPLAY=localhost:11.0; export DISPLAY\r\nF77=/home/ubuntu/spack/lib/spack/env/gcc/gfortran; export F77\r\nFC=/home/ubuntu/spack/lib/spack/env/gcc/gfortran; export FC\r\nHOME=/home/ubuntu; export HOME\r\nLANG=C.UTF-8; export LANG\r\nLC_ALL=C; export LC_ALL\r\nLC_TERMINAL=iTerm2; export LC_TERMINAL\r\nLC_TERMINAL_VERSION=3.4.8; export LC_TERMINAL_VERSION\r\nLESSCLOSE='/usr/bin/lesspipe %s %s'; export LESSCLOSE\r\nLESSOPEN='| /usr/bin/lesspipe %s'; export LESSOPEN\r\nLOGNAME=ubuntu; export LOGNAME\r\nLS_COLORS='rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:'; export LS_COLORS\r\nMOTD_SHOWN=pam; export MOTD_SHOWN\r\n#OLDPWD=/home/ubuntu; export OLDPWD\r\nPATH=/home/ubuntu/spack/lib/spack/env/gcc:/home/ubuntu/spack/lib/spack/env/case-insensitive:/home/ubuntu/spack/lib/spack/env:/home/ubuntu/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin; export PATH\r\n#PWD=/home/ubuntu/spack; export PWD\r\nSHELL=/bin/bash; export SHELL\r\nSHLVL=2; export SHLVL\r\nSPACK_CC=/usr/bin/gcc-10; export SPACK_CC\r\nSPACK_CC_RPATH_ARG=-Wl,-rpath,; export SPACK_CC_RPATH_ARG\r\nSPACK_COMPILER_SPEC=gcc@10.3.0; export SPACK_COMPILER_SPEC\r\nSPACK_CXX=/usr/bin/g++-10; export SPACK_CXX\r\nSPACK_CXX_RPATH_ARG=-Wl,-rpath,; export SPACK_CXX_RPATH_ARG\r\nSPACK_DEBUG_LOG_DIR=/home/ubuntu/spack; export SPACK_DEBUG_LOG_DIR\r\nSPACK_DEBUG_LOG_ID=charmpp-bg33dxw; export SPACK_DEBUG_LOG_ID\r\nSPACK_DTAGS_TO_ADD=--disable-new-dtags; export SPACK_DTAGS_TO_ADD\r\nSPACK_DTAGS_TO_STRIP=--enable-new-dtags; export SPACK_DTAGS_TO_STRIP\r\nSPACK_ENV_PATH=/home/ubuntu/spack/lib/spack/env:/home/ubuntu/spack/lib/spack/env/case-insensitive:/home/ubuntu/spack/lib/spack/env/gcc; export SPACK_ENV_PATH\r\nSPACK_F77=/usr/bin/gfortran-10; export SPACK_F77\r\nSPACK_F77_RPATH_ARG=-Wl,-rpath,; export SPACK_F77_RPATH_ARG\r\nSPACK_FC=/usr/bin/gfortran-10; export SPACK_FC\r\nSPACK_FC_RPATH_ARG=-Wl,-rpath,; export SPACK_FC_RPATH_ARG\r\nSPACK_INCLUDE_DIRS=''; export SPACK_INCLUDE_DIRS\r\nSPACK_LD_LIBRARY_PATH=''; export SPACK_LD_LIBRARY_PATH\r\nSPACK_LINKER_ARG=-Wl,; export SPACK_LINKER_ARG\r\nSPACK_LINK_DIRS=''; export SPACK_LINK_DIRS\r\nSPACK_NEW_LD_LIBRARY_PATH=''; export SPACK_NEW_LD_LIBRARY_PATH\r\nSPACK_RPATH_DIRS=/home/ubuntu/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-10.3.0/charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm/lib:/home/ubuntu/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-10.3.0/charmpp-6.10.2-bg33dxwo6svnuwgesckdmkcq4vvi7fnm/lib64; export SPACK_RPATH_DIRS\r\nSPACK_SHORT_SPEC='charmpp@6.10.2%gcc@10.3.0~cuda~omp~papi+production~pthreads+shared+smp~syncft~tcp~tracing backend=netlrts build-target=LIBS pmi=none arch=linux-ubuntu20.04-x86_64/bg33dxw'; export SPACK_SHORT_SPEC\r\nSPACK_SYSTEM_DIRS=/bin:/usr/bin:/usr/local/bin:/bin64:/usr/bin64:/usr/local/bin64:/include:/usr/include:/usr/local/include:/lib:/usr/lib:/usr/local/lib:/lib64:/usr/lib64:/usr/local/lib64:/:/usr:/usr/local; export SPACK_SYSTEM_DIRS\r\nSPACK_TARGET_ARGS='-march=x86-64 -mtune=generic'; export SPACK_TARGET_ARGS\r\nSSH_CLIENT='130.116.194.91 52033 22'; export SSH_CLIENT\r\nSSH_CONNECTION='130.116.194.91 52033 146.118.68.15 22'; export SSH_CONNECTION\r\nSSH_TTY=/dev/pts/1; export SSH_TTY\r\nTERM=xterm-256color; export TERM\r\nUSER=ubuntu; export USER\r\nXDG_DATA_DIRS=/usr/local/share:/usr/share:/var/lib/snapd/desktop; export XDG_DATA_DIRS\r\nXDG_RUNTIME_DIR=/run/user/1000; export XDG_RUNTIME_DIR\r\nXDG_SESSION_CLASS=user; export XDG_SESSION_CLASS\r\nXDG_SESSION_ID=554; export XDG_SESSION_ID\r\nXDG_SESSION_TYPE=tty; export XDG_SESSION_TYPE\r\n_=/usr/bin/python3; export _\r\n```\r\n\r\nOn Cray\r\n======\r\n\r\n* **Spack:** 0.16.2-3696-6104c31556\r\n* **Python:** 3.6.3\r\n* **Platform:** cray-sles12-haswell\r\n* **Concretizer:** clingo\r\nThe error on the Cray is the same and does not depend on the environment. The issue is `SPACK_CC=/dir/to/compiler/cc`.  \r\n\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "performed_via_github_app": null
}