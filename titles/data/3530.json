{
    "url": "https://api.github.com/repos/spack/spack/issues/3530",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/3530/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/3530/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/3530/events",
    "html_url": "https://github.com/spack/spack/pull/3530",
    "id": 216539702,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTEyMzE1OTcw",
    "number": 3530,
    "title": "Override partial installs by default",
    "user": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2017-03-23T19:07:25Z",
    "updated_at": "2017-04-20T04:59:19Z",
    "closed_at": "2017-04-20T04:59:19Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/3530",
        "html_url": "https://github.com/spack/spack/pull/3530",
        "diff_url": "https://github.com/spack/spack/pull/3530.diff",
        "patch_url": "https://github.com/spack/spack/pull/3530.patch"
    },
    "body": "Fixes https://github.com/LLNL/spack/issues/2634\r\n\r\n@tgamblin we originally talked about not automatically removing the prefix if --keep-prefix is set. While working on this I also noticed that it is possible that a partially complete installation may also have left stage files and in some cases re-initiating the install will fail because of that (gmp is an example as the 'configure' step cannot be performed twice without an intervening make clean). ~~My thought there was to also remove the stage files by default unless the user has specified --keep-stage. Perhaps adding a different option would be better.~~\r\n\r\n(EDIT 3/27) --keep-prefix now indicates that the install prefix and staging directory should be kept if present. If --keep-prefix is not set, then both of these are removed.\r\n\r\n- [x] Test removal of stage by default\r\n- [x] Add test to ensure that the prefix is not deleted on a new install attempt if --keep-prefix is set\r\n\r\nDepending on how spack is terminated in the middle of building a package it may leave a partially installed package in the install prefix. Originally Spack treated the package as being installed if the prefix was present, in which case the user would have to manually remove the installation prefix before restarting an install. This adds a more-thorough check to ensure that a package is actually installed. If the installation prefix is present but Spack determines that the install did not complete, it removes the installation prefix and starts a new install. ~~If the user has enabled --keep-prefix, then Spack reverts to its old behavior.~~\r\n\r\nEDIT 3/27: If the user has enabled --keep-prefix, then Spack will keep its stage directory if present (as it did before); in this case Spack will also keep the installation prefix and re-execute the installation commands unless there is an issue with the metadata (e.g. the spec.yaml file), in which case it will reset the installation prefix.",
    "performed_via_github_app": null
}