{
    "url": "https://api.github.com/repos/spack/spack/issues/8673",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8673/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8673/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8673/events",
    "html_url": "https://github.com/spack/spack/issues/8673",
    "id": 340011096,
    "node_id": "MDU6SXNzdWUzNDAwMTEwOTY=",
    "number": 8673,
    "title": "Spack finds the wrong compilers when container OS differs from host OS",
    "user": {
        "login": "reidpr",
        "id": 1682574,
        "node_id": "MDQ6VXNlcjE2ODI1NzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1682574?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/reidpr",
        "html_url": "https://github.com/reidpr",
        "followers_url": "https://api.github.com/users/reidpr/followers",
        "following_url": "https://api.github.com/users/reidpr/following{/other_user}",
        "gists_url": "https://api.github.com/users/reidpr/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/reidpr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/reidpr/subscriptions",
        "organizations_url": "https://api.github.com/users/reidpr/orgs",
        "repos_url": "https://api.github.com/users/reidpr/repos",
        "events_url": "https://api.github.com/users/reidpr/events{/privacy}",
        "received_events_url": "https://api.github.com/users/reidpr/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446615135,
            "node_id": "MDU6TGFiZWw0NDY2MTUxMzU=",
            "url": "https://api.github.com/repos/spack/spack/labels/configuration",
            "name": "configuration",
            "color": "bfd4f2",
            "default": false,
            "description": null
        },
        {
            "id": 719256466,
            "node_id": "MDU6TGFiZWw3MTkyNTY0NjY=",
            "url": "https://api.github.com/repos/spack/spack/labels/containers",
            "name": "containers",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 832208203,
            "node_id": "MDU6TGFiZWw4MzIyMDgyMDM=",
            "url": "https://api.github.com/repos/spack/spack/labels/docker",
            "name": "docker",
            "color": "77b9d6",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2018-07-10T21:19:42Z",
    "updated_at": "2020-11-19T08:36:01Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I've installed Spack into a Debian Stretch container. When running Spack on a Debian Stretch host, it seems to work fine. On a Red Hat host, however, it finds the Red Hat compilers instead, and basic commands fail (I tried `spack spec`).\r\n\r\nThis is demonstrated with Charliecloud but I suspect it would happen with other container runtimes as well.\r\n\r\n### Expected Result\r\n\r\nThe following is from a Debian Stretch host (same as the container). I expect it to also happen on the Red Hat host.\r\n\r\n```\r\n$ ch-run /var/tmp/images/spack -- fgrep PRETTY_NAME /etc/os-release\r\nPRETTY_NAME=\"Debian GNU/Linux 9 (stretch)\"\r\n$ ch-run /var/tmp/images/spack -- /spack/bin/spack compilers\r\n==> Available compilers\r\n-- gcc debian9-x86_64 -------------------------------------------\r\ngcc@6.3.0\r\n$ bin/ch-run /var/tmp/images/spack -- /spack/bin/spack spec netcdf\r\nInput spec\r\n--------------------------------\r\nnetcdf\r\n\r\nConcretized\r\n--------------------------------\r\nnetcdf@4.6.1%gcc@6.3.0~dap~hdf4 maxdims=1024 maxvars=8192 +mpi~parallel-netcdf+shared arch=linux-debian9-x86_64\r\n    ^hdf5@1.10.2%gcc@6.3.0~cxx~debug~fortran+hl+mpi+pic+shared~szip~threadsafe arch=linux-debian9-x86_64\r\n        ^openmpi@3.1.0%gcc@6.3.0~cuda fabrics= ~java~memchecker~pmi schedulers= ~sqlite3~thread_multiple+vt arch=linux-debian9-x86_64\r\n            ^hwloc@1.11.9%gcc@6.3.0~cairo~cuda+libxml2+pci+shared arch=linux-debian9-x86_64\r\n                ^libpciaccess@0.13.5%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                    ^libtool@2.4.6%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                        ^m4@1.4.18%gcc@6.3.0 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,c0a408fbffb7255fcc75e26bd8edab116fc81d216bfd18b473668b7739a4158e +sigsegv arch=linux-debian9-x86_64\r\n                            ^libsigsegv@2.11%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                    ^pkgconf@1.4.2%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                    ^util-macros@1.19.1%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                ^libxml2@2.9.8%gcc@6.3.0~python arch=linux-debian9-x86_64\r\n                    ^xz@5.2.4%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                    ^zlib@1.2.11%gcc@6.3.0+optimize+pic+shared arch=linux-debian9-x86_64\r\n                ^numactl@2.0.11%gcc@6.3.0 patches=592f30f7f5f757dfc239ad0ffd39a9a048487ad803c26b419e0f96b8cda08c1a arch=linux-debian9-x86_64\r\n                    ^autoconf@2.69%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                        ^perl@5.26.2%gcc@6.3.0+cpanm patches=0eac10ed90aeb0459ad8851f88081d439a4e41978e586ec743069e8b059370ac +shared+threads arch=linux-debian9-x86_64\r\n                            ^gdbm@1.14.1%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                                ^readline@7.0%gcc@6.3.0 arch=linux-debian9-x86_64\r\n                                    ^ncurses@6.1%gcc@6.3.0~symlinks~termlib arch=linux-debian9-x86_64\r\n                    ^automake@1.16.1%gcc@6.3.0 arch=linux-debian9-x86_64\r\n```\r\n\r\n### Actual Result\r\n\r\nOn a RHEL 7.4 (TOSS 3.2-5) host, I get the following. This is the same container image as above.\r\n\r\nGCC 6.4.0 comes from a module and GCC 4.8.5 comes with the OS.\r\n\r\n```\r\n$ ch-run /var/tmp/ch-images/spack -- fgrep PRETTY_NAME /etc/os-release\r\nPRETTY_NAME=\"Debian GNU/Linux 9 (stretch)\"\r\n$ ch-run /var/tmp/ch-images/spack -- /spack/bin/spack compilers\r\n==> Available compilers\r\n-- gcc rhel7-x86_64 ---------------------------------------------\r\ngcc@6.4.0  gcc@4.8.5\r\n$ ch-run /var/tmp/ch-images/spack -- /spack/bin/spack spec netcdf\r\nInput spec\r\n--------------------------------\r\nnetcdf\r\n\r\nConcretized\r\n--------------------------------\r\n==> Error: No compilers found for operating system debian9 and target x86_64.\r\nIf previous installations have succeeded, the operating system may have been updated.\r\nCompilers are defined for the following operating systems and targets:\r\n\trhel7-x86_64\r\nRun 'spack compiler find' to add compilers.\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. Install Charliecloud.\r\n2. Build the Spack example image using the [test suite](https://hpc.github.io/charliecloud/test.html) in full scope. This may require a Debian 9 host as-is, but commenting out a few lines in the Dockerfile may make it work on a Red Hat build box.\r\n3. Unpack the image tarball with `ch-tar2dir`.\r\n4. Run the commands above.\r\n\r\nI can provide the image tarball `spack.tar.gz` out of band as well.\r\n\r\n### Information on your system\r\n\r\n* Charliecloud commit `e3b39eb` to avoid a Charliecloud bug.\r\n* Spack v0.11.2.\r\n* Installation [Dockerfile](https://github.com/hpc/charliecloud/blob/e3b39eba936883eeb5baf679ba3db1cd0c16045a/examples/other/spack/Dockerfile)",
    "performed_via_github_app": null
}