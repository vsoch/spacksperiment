{
    "url": "https://api.github.com/repos/spack/spack/issues/9829",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9829/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9829/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9829/events",
    "html_url": "https://github.com/spack/spack/issues/9829",
    "id": 380026589,
    "node_id": "MDU6SXNzdWUzODAwMjY1ODk=",
    "number": 9829,
    "title": "Installation issue : mpich, complains about F90 being set",
    "user": {
        "login": "s-sajid-ali",
        "id": 30510036,
        "node_id": "MDQ6VXNlcjMwNTEwMDM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/30510036?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/s-sajid-ali",
        "html_url": "https://github.com/s-sajid-ali",
        "followers_url": "https://api.github.com/users/s-sajid-ali/followers",
        "following_url": "https://api.github.com/users/s-sajid-ali/following{/other_user}",
        "gists_url": "https://api.github.com/users/s-sajid-ali/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/s-sajid-ali/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/s-sajid-ali/subscriptions",
        "organizations_url": "https://api.github.com/users/s-sajid-ali/orgs",
        "repos_url": "https://api.github.com/users/s-sajid-ali/repos",
        "events_url": "https://api.github.com/users/s-sajid-ali/events{/privacy}",
        "received_events_url": "https://api.github.com/users/s-sajid-ali/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 809934104,
            "node_id": "MDU6TGFiZWw4MDk5MzQxMDQ=",
            "url": "https://api.github.com/repos/spack/spack/labels/regression",
            "name": "regression",
            "color": "e2c071",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-11-13T02:07:29Z",
    "updated_at": "2019-03-06T01:11:41Z",
    "closed_at": "2019-03-06T01:11:41Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\n```\r\n$ spack install mpich%gcc@7.3.0\r\n....\r\n==> Installing mpich\r\n==> Searching for binary cache of mpich\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for mpich found: installing from source\r\n==> Using cached archive: /home/sajid/packages/spack/var/spack/cache/mpich/mpich-3.2.1.tar.gz\r\n==> Staging archive: /home/sajid/packages/spack/var/spack/stage/mpich-3.2.1-nxdzgyvdfa3aztkjv37k3syg7yvresgo/mpich-3.2.1.tar.gz\r\n==> Created stage in /home/sajid/packages/spack/var/spack/stage/mpich-3.2.1-nxdzgyvdfa3aztkjv37k3syg7yvresgo\r\n==> No patches needed for mpich\r\n==> Building mpich [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/home/sajid/packages/spack/var/spack/stage/mpich-3.2.1-nxdzgyvdfa3aztkjv37k3syg7yvresgo/mpich-3.2.1/configure' '--prefix=/home/sajid/packages/spack/opt/spack/linux-centos7-x86_64/gcc-7.3.0/mpich-3.2.1-nxdzgyvdfa3aztkjv37k3syg7yvresgo' '--enable-shared' '--with-pm=hydra' '--with-pmi=yes' '--enable-romio' '--without-ibverbs' '--with-device=ch3:nemesis:tcp'\r\n\r\n1 error found in build log:\r\n     419    checking for type of weak symbol alias support... pragma weak\r\n     420    checking whether __attribute__ ((weak)) allowed... yes\r\n     421    checking whether __attribute__ ((weak_import)) allowed... yes\r\n     422    checking whether __attribute__((weak,alias(...))) allowed... yes\r\n     423    checking for multiple weak symbol support... yes\r\n     424    checking for shared library (esp. rpath) characteristics of CC... done (results in src/env/cc_shlib.conf)\r\n  >> 425    configure: error: F90 and F90FLAGS are replaced by FC and FCFLAGS respectively in this configure, please unset F90/F90FLAGS and set FC/FCFLAGS instead and rerun\r\n            configure again.\r\n\r\nSee build log for details:\r\n  /home/sajid/packages/spack/var/spack/stage/mpich-3.2.1-nxdzgyvdfa3aztkjv37k3syg7yvresgo/mpich-3.2.1/spack-build.out\r\n```\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```\r\n$ uname -a \r\nLinux xrmlite.phys.northwestern.edu 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:    CentOS Linux release 7.5.1804 (Core)\r\n``` \r\n\r\n- `packages.yaml`\r\nhas this line `mpi: [intel-mpi,mpich]`\r\n- `compilers.yaml` \r\nentry for gcc@7.3.0 is below \r\n```\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags:\r\n     cflags: -march=haswell\r\n     cxxflags: -march=haswell\r\n    modules: []\r\n    operating_system: centos7\r\n    paths:\r\n      cc: /home/sajid/packages/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.3.0-xyzezhjmbiebkjfoakso464rhfshlkyq/bin/gcc\r\n      cxx: /home/sajid/packages/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.3.0-xyzezhjmbiebkjfoakso464rhfshlkyq/bin/g++\r\n      f77: /home/sajid/packages/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.3.0-xyzezhjmbiebkjfoakso464rhfshlkyq/bin/gfortran\r\n      fc: /home/sajid/packages/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.3.0-xyzezhjmbiebkjfoakso464rhfshlkyq/bin/gfortran\r\n    spec: gcc@7.3.0\r\n    target: x86_64\r\n```\r\n\r\n\r\n\r\n\r\n### Additional information\r\n\r\n```\r\n[sajid@xrmlite ~]$ spack spec --install-status mpich%gcc@7.3.0\r\nInput spec\r\n--------------------------------\r\n -   mpich%gcc@7.3.0\r\n\r\nConcretized\r\n--------------------------------\r\n -   mpich@3.2.1%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  device=ch3 +hydra netmod=tcp +pmi+romio~verbs arch=linux-centos7-x86_64\r\n[+]      ^findutils@4.6.0%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  patches=84b916c0bf8c51b7e7b28417692f0ad3e7030d1f3c248ba77c42ede5c1c5d11e,bd9e4e5cc280f9753ae14956c4e4aa17fe7a210f55dd6c84aa60b12d106d47a2 arch=linux-centos7-x86_64\r\n[+]          ^autoconf@2.69%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]              ^m4@1.4.18%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,c0a408fbffb7255fcc75e26bd8edab116fc81d216bfd18b473668b7739a4158e,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 +sigsegv arch=linux-centos7-x86_64\r\n[+]                  ^libsigsegv@2.11%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]              ^perl@5.26.2%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\" +cpanm patches=0eac10ed90aeb0459ad8851f88081d439a4e41978e586ec743069e8b059370ac +shared+threads arch=linux-centos7-x86_64\r\n[+]                  ^gdbm@1.14.1%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]                      ^readline@7.0%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]                          ^ncurses@6.1%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\" ~symlinks~termlib arch=linux-centos7-x86_64\r\n[+]                              ^pkgconf@1.4.2%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]          ^automake@1.16.1%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]          ^libtool@2.4.6%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n[+]          ^texinfo@6.5%gcc@7.3.0 cflags=\"-march=haswell\" cxxflags=\"-march=haswell\"  arch=linux-centos7-x86_64\r\n\r\n```\r\n\r\n```\r\n[sajid@xrmlite ~]$ spack log-parse --show=errors,warnings   /home/sajid/packages/spack/var/spack/stage/mpich-3.2.1-nxdzgyvdfa3aztkjv37k3syg7yvresgo/mpich-3.2.1/spack-build.out\r\n1 errors\r\n0 warnings\r\n     422    checking whether __attribute__((weak,alias(...))) allowed... yes\r\n     423    checking for multiple weak symbol support... yes\r\n     424    checking for shared library (esp. rpath) characteristics of CC... done (results in src/env/cc_shlib.conf)\r\n  >> 425    configure: error: F90 and F90FLAGS are replaced by FC and FCFLAGS respectively in this configure, please unset F90/F90FLAGS and set FC/FCFLAGS instead and rerun\r\n            configure again.\r\n```\r\nSame error when building with `-j 1`\r\n\r\nLooks like the compiler wrapper is setting `F90` as shown below : \r\n```\r\n\r\n[sajid@xrmlite ~]$ echo $F90\r\n/home/sajid/packages/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.3.0-xyzezhjmbiebkjfoakso464rhfshlkyq/bin/gfortran\r\n[sajid@xrmlite ~]$ echo $F90FLAGS\r\n\r\n[sajid@xrmlite ~]$\r\n```\r\n\r\nCan post the complete logs if needed. \r\n\r\nI remember @adamjstewart [pointing out](https://github.com/spack/spack/pull/8903#issuecomment-410875839) that `F90` isn't explicitly set by spack. [This PR](https://github.com/spack/spack/pull/9107) changed things and was supposed to fix [the exact issue](https://github.com/spack/spack/issues/9084) I encountered. I'm on develop at the latest commit and yet this happens. \r\n",
    "performed_via_github_app": null
}