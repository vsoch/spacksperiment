{
    "url": "https://api.github.com/repos/spack/spack/issues/12722",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12722/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12722/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12722/events",
    "html_url": "https://github.com/spack/spack/issues/12722",
    "id": 490000062,
    "node_id": "MDU6SXNzdWU0OTAwMDAwNjI=",
    "number": 12722,
    "title": "MPI wrapper compiler ",
    "user": {
        "login": "SheraLee",
        "id": 33297023,
        "node_id": "MDQ6VXNlcjMzMjk3MDIz",
        "avatar_url": "https://avatars.githubusercontent.com/u/33297023?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SheraLee",
        "html_url": "https://github.com/SheraLee",
        "followers_url": "https://api.github.com/users/SheraLee/followers",
        "following_url": "https://api.github.com/users/SheraLee/following{/other_user}",
        "gists_url": "https://api.github.com/users/SheraLee/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SheraLee/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SheraLee/subscriptions",
        "organizations_url": "https://api.github.com/users/SheraLee/orgs",
        "repos_url": "https://api.github.com/users/SheraLee/repos",
        "events_url": "https://api.github.com/users/SheraLee/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SheraLee/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2019-09-05T21:01:26Z",
    "updated_at": "2019-10-08T20:21:07Z",
    "closed_at": "2019-10-08T20:21:07Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I am trying to create a spack package for p3dfft.3 [https://github.com/sdsc/p3dfft.3]. \r\nI start with trying on SDSC Comet with default Intel Compilers. \r\n\r\nThe package depends on FFTW and MPI, in this particular platform, we use mvapich2. \r\n\r\n\r\n\r\n**My  python script:** \r\n`class P3dfft3(Package):\r\n    homepage = \"https://www.p3dfft.net\"\r\n    url      = \"https://github.com/sdsc/p3dfft.3/archive/master.tar.gz\"\r\n\r\n    version('0.0.0', '458b788512fe1bc7009282201f476d7c')\r\n\r\n       git = \"https://github.com/sdsc/p3dfft.3\"\r\n\r\n    version('develop', branch = 'master')\r\n    version('0.0.0', '734afcef3f2baf1a25b24963c66e13e9')\r\n\r\n    variant('fftw', default = False ,\r\n            description='Builds with FFTW library')\r\n    variant('essl', default=False,\r\n            description='Builds with ESSL library')\r\n    variant('openmp', default=False,\r\n            description=\"Enable OpenMP support.\")\r\n\r\n    depends_on('mpi')\r\n    depends_on('fftw',when = '+fftw')\r\n    depends_on('essl',when = '+essl')\r\n\r\n\r\n    def setup_environment(self, spack_env, run_env):\r\n        spec = self.spec\r\n\r\n        spack_env.set('CC', spec['mpi'].mpicc)\r\n        spack_env.set('FC', spec['mpi'].mpifc)\r\n        spack_env.set('CXX', spec['mpi'].mpicxx)\r\n\r\n    def install(self, spec, prefix):\r\n        config_args = ['--prefix={0}'.format(prefix)]\r\n\r\n        if '+fftw' in spec:\r\n            config_args.append('--enable-fftw')\r\n            config_args.append ('--with-fftw-lib= %s' % spec['fftw'].prefix.lib)\r\n            config_args.append ('--with-fftw-inc= %s' % spec['fftw'].prefix.include)\r\n\r\n        if '+essl' in spec:\r\n            config_args.append('--enable-essl')\r\n            config_args.append ('--with-fftw-lib= %s' % spec['essl'].prefix.lib)\r\n            config_args.append ('--with-fftw-inc= %s' % spec['essl'].prefix.include)\r\n\r\n        configure( *config_args)\r\n\r\n        make()\r\n        make('install')\r\n\r\n**My compiler.yaml:** : I did not modify it. It is auto created\r\n\r\n```\r\ncompilers:\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: centos6\r\n    paths:\r\n      cc: /usr/bin/gcc\r\n      cxx: /usr/bin/g++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    spec: gcc@4.4.7\r\n    target: x86_64\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: centos6\r\n    paths:\r\n      cc: /opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/icc\r\n      cxx: /opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/icpc\r\n      f77: /opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/ifort\r\n      fc: /opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/ifort\r\n    spec: intel@14.0.2\r\n    target: x86_64\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: centos6\r\n    paths:\r\n      cc: /opt/gnu/gcc/bin/gcc\r\n      cxx: /opt/gnu/gcc/bin/g++\r\n      f77: /opt/gnu/gcc/bin/gfortran\r\n      fc: /opt/gnu/gcc/bin/gfortran\r\n    spec: gcc@4.9.2\r\n    target: x86_64\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: centos6\r\n    paths:\r\n      cc: /opt/pgi/linux86-64/17.5/bin/pgcc\r\n      cxx: /opt/pgi/linux86-64/17.5/bin/pgc++\r\n      f77: /opt/pgi/linux86-64/17.5/bin/pgfortran\r\n      fc: /opt/pgi/linux86-64/17.5/bin/pgf95\r\n    spec: pgi@17.5\r\n    target: x86_64\r\n\r\n```\r\n**My package.yaml:**\r\n```\r\n packages:\r\n    fftw:\r\n        modules:\r\n             fftw@3.3.4: fftw/3.3.4\r\n        buildable: False\r\n\r\n    mvapich2: \r\n        modules:\r\n              mvapich2@2.1: mvapich2_ib/2.1\r\n        buildable: False\r\n\r\n```\r\n**spack-build-env.txt**\r\n```\r\nANT_HOME=/opt/rocks; export ANT_HOME\r\nfunction module() {  eval `/usr/bin/modulecmd bash $*`\r\n}; export -f module\r\nfunction spack() {  if [ -n \"${ZSH_VERSION:-}\" ]; then\r\n emulate -L sh;\r\n fi;\r\n _sp_flags=\"\";\r\n while [ ! -z ${1+x} ] && [ \"${1#-}\" != \"${1}\" ]; do\r\n _sp_flags=\"$_sp_flags $1\";\r\n shift;\r\n done;\r\n if [ -n \"$_sp_flags\" ] && [ \"${_sp_flags#*h}\" != \"${_sp_flags}\" ] || [ \"${_sp_flags#*V}\" != \"${_sp_flags}\" ]; then\r\n command spack $_sp_flags \"$@\";\r\n return;\r\n fi;\r\n _sp_subcommand=\"\";\r\n if [ ! -z ${1+x} ]; then\r\n _sp_subcommand=\"$1\";\r\n shift;\r\n fi;\r\n case $_sp_subcommand in \r\n \"cd\")\r\n _sp_arg=\"\";\r\n if [ -n \"$1\" ]; then\r\n _sp_arg=\"$1\";\r\n shift;\r\n fi;\r\n if [ \"$_sp_arg\" = \"-h\" ] || [ \"$_sp_arg\" = \"--help\" ]; then\r\n command spack cd -h;\r\n else\r\n LOC=\"$(spack location $_sp_arg \"$@\")\";\r\n if [ -d \"$LOC\" ]; then\r\n cd \"$LOC\";\r\n else\r\n return 1;\r\n fi;\r\n fi;\r\n return\r\n ;;\r\n \"env\")\r\n _sp_arg=\"\";\r\n if [ -n \"$1\" ]; then\r\n _sp_arg=\"$1\";\r\n shift;\r\n fi;\r\n if [ \"$_sp_arg\" = \"-h\" ] || [ \"$_sp_arg\" = \"--help\" ]; then\r\n command spack env -h;\r\n else\r\n case $_sp_arg in \r\n activate)\r\n _a=\"$@\";\r\n if [ -z ${1+x} ] || [ \"${_a#*--sh}\" != \"$_a\" ] || [ \"${_a#*--csh}\" != \"$_a\" ] || [ \"${_a#*-h}\" != \"$_a\" ]; then\r\n command spack env activate \"$@\";\r\n else\r\n eval $(command spack $_sp_flags env activate --sh \"$@\");\r\n fi\r\n ;;\r\n deactivate)\r\n _a=\"$@\";\r\n if [ \"${_a#*--sh}\" != \"$_a\" ] || [ \"${_a#*--csh}\" != \"$_a\" ]; then\r\n command spack env deactivate \"$@\";\r\n else\r\n if [ -n \"$*\" ]; then\r\n command spack env deactivate -h;\r\n else\r\n eval $(command spack $_sp_flags env deactivate --sh);\r\n fi;\r\n fi\r\n ;;\r\n *)\r\n command spack env $_sp_arg \"$@\"\r\n ;;\r\n esac;\r\n fi;\r\n return\r\n ;;\r\n \"use\" | \"unuse\" | \"load\" | \"unload\")\r\n _sp_subcommand_args=\"\";\r\n _sp_module_args=\"\";\r\n while [ \"${1#-}\" != \"${1}\" ]; do\r\n if [ \"$1\" = \"-h\" ] || [ \"$1\" = \"--help\" ]; then\r\n command spack $_sp_flags $_sp_subcommand $_sp_subcommand_args \"$@\";\r\n return;\r\n else\r\n if [ \"$1\" = \"-r\" ] || [ \"$1\" = \"--dependencies\" ]; then\r\n _sp_subcommand_args=\"$_sp_subcommand_args $1\";\r\n else\r\n _sp_module_args=\"$_sp_module_args $1\";\r\n fi;\r\n fi;\r\n shift;\r\n done;\r\n case $_sp_subcommand in \r\n \"use\")\r\n if _sp_full_spec=$(command spack $_sp_flags module dotkit find $_sp_subcommand_args \"$@\"); then\r\n use $_sp_module_args $_sp_full_spec;\r\n else\r\n $(exit 1);\r\n fi\r\n ;;\r\n \"unuse\")\r\n if _sp_full_spec=$(command spack $_sp_flags module dotkit find $_sp_subcommand_args \"$@\"); then\r\n unuse $_sp_module_args $_sp_full_spec;\r\n else\r\n $(exit 1);\r\n fi\r\n ;;\r\n \"load\")\r\n if _sp_full_spec=$(command spack $_sp_flags module tcl find $_sp_subcommand_args \"$@\"); then\r\n module load $_sp_module_args $_sp_full_spec;\r\n else\r\n $(exit 1);\r\n fi\r\n ;;\r\n \"unload\")\r\n if _sp_full_spec=$(command spack $_sp_flags module tcl find $_sp_subcommand_args \"$@\"); then\r\n module unload $_sp_module_args $_sp_full_spec;\r\n else\r\n $(exit 1);\r\n fi\r\n ;;\r\n esac\r\n ;;\r\n *)\r\n command spack $_sp_flags $_sp_subcommand \"$@\"\r\n ;;\r\n esac\r\n}; export -f spack\r\nCC=/opt/mvapich2/intel/ib/bin/mpicc; export CC\r\nCMAKE_PREFIX_PATH=/opt/fftw/3.3.4/intel/mvapich2_ib:/opt/mvapich2/intel/ib; export CMAKE_PREFIX_PATH\r\nCVS_RSH=ssh; export CVS_RSH\r\nCXX=/opt/mvapich2/intel/ib/bin/mpicxx; export CXX\r\nDK_NODE=/home/shera/spack/spack/share/spack/dotkit/linux-centos6-x86_64; export DK_NODE\r\nF77=/home/shera/spack/spack/lib/spack/env/intel/ifort; export F77\r\nFC=/opt/mvapich2/intel/ib/bin/mpif90; export FC\r\nFFTWHOME=/opt/fftw/3.3.4/intel/mvapich2_ib; export FFTWHOME\r\nFPATH=/opt/intel/composer_xe_2013_sp1.2.144/mkl/include; export FPATH\r\nGDBSERVER_MIC=/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/target/mic/bin/gdbserver; export GDBSERVER_MIC\r\nGDB_CROSS=/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64_mic/bin/gdb-mic; export GDB_CROSS\r\nGNUTOOLSHOME=/opt/gnu; export GNUTOOLSHOME\r\nG_BROKEN_FILENAMES=1; export G_BROKEN_FILENAMES\r\nHISTCONTROL=ignoredups; export HISTCONTROL\r\nHISTSIZE=1000; export HISTSIZE\r\nHOME=/home/shera; export HOME\r\nHOSTNAME=comet-ln2.sdsc.edu; export HOSTNAME\r\nINCLUDE=/opt/intel/composer_xe_2013_sp1.2.144/mkl/include; export INCLUDE\r\nINFOPATH=/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64/share/info/:/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64_mic/share/info/; export INFOPATH\r\nINTELHOME=/opt/intel/composer_xe_2013_sp1.2.144; export INTELHOME\r\nINTEL_LICENSE_FILE=/opt/intel/composer_xe_2013_sp1.2.144/licenses:/opt/intel/licenses:/root/intel/licenses; export INTEL_LICENSE_FILE\r\nINTEL_PYTHONHOME=/opt/intel/composer_xe_2013_sp1.2.144/debugger/python/intel64/; export INTEL_PYTHONHOME\r\nIPPROOT=/opt/intel/composer_xe_2013_sp1.2.144/ipp; export IPPROOT\r\nJAVA_HOME=/usr/java/latest; export JAVA_HOME\r\nKRB5CCNAME=FILE:/tmp/krb5cc_524149_Rai27h; export KRB5CCNAME\r\nLANG=en_US.UTF-8; export LANG\r\nLC_ALL=C; export LC_ALL\r\nLD_LIBRARY_PATH=/opt/mvapich2/intel/ib/lib:/opt/fftw/3.3.4/intel/mvapich2_ib/lib; export LD_LIBRARY_PATH\r\nLESSOPEN='||/usr/bin/lesspipe.sh %s'; export LESSOPEN\r\nLIBPATH=/opt/fftw/3.3.4/intel/mvapich2_ib/lib; export LIBPATH\r\nLM_LICENSE_FILE=/opt/flexlm/license/license.dat; export LM_LICENSE_FILE\r\nLOADEDMODULES=intel/2013_sp1.2.144:mvapich2_ib/2.1:gnutools/2.69:fftw/3.3.4; export LOADEDMODULES\r\nLOGNAME=shera; export LOGNAME\r\nLS_COLORS='rs=0:di=38;5;27:ln=38;5;51:mh=44;38;5;15:pi=40;38;5;11:so=38;5;13:do=38;5;5:bd=48;5;232;38;5;11:cd=48;5;232;38;5;3:or=48;5;232;38;5;9:mi=05;48;5;232;38;5;15:su=48;5;196;38;5;15:sg=48;5;11;38;5;16:ca=48;5;196;38;5;226:tw=48;5;10;38;5;16:ow=48;5;10;38;5;21:st=48;5;21;38;5;15:ex=38;5;34:*.tar=38;5;9:*.tgz=38;5;9:*.arj=38;5;9:*.taz=38;5;9:*.lzh=38;5;9:*.lzma=38;5;9:*.tlz=38;5;9:*.txz=38;5;9:*.zip=38;5;9:*.z=38;5;9:*.Z=38;5;9:*.dz=38;5;9:*.gz=38;5;9:*.lz=38;5;9:*.xz=38;5;9:*.bz2=38;5;9:*.tbz=38;5;9:*.tbz2=38;5;9:*.bz=38;5;9:*.tz=38;5;9:*.deb=38;5;9:*.rpm=38;5;9:*.jar=38;5;9:*.rar=38;5;9:*.ace=38;5;9:*.zoo=38;5;9:*.cpio=38;5;9:*.7z=38;5;9:*.rz=38;5;9:*.jpg=38;5;13:*.jpeg=38;5;13:*.gif=38;5;13:*.bmp=38;5;13:*.pbm=38;5;13:*.pgm=38;5;13:*.ppm=38;5;13:*.tga=38;5;13:*.xbm=38;5;13:*.xpm=38;5;13:*.tif=38;5;13:*.tiff=38;5;13:*.png=38;5;13:*.svg=38;5;13:*.svgz=38;5;13:*.mng=38;5;13:*.pcx=38;5;13:*.mov=38;5;13:*.mpg=38;5;13:*.mpeg=38;5;13:*.m2v=38;5;13:*.mkv=38;5;13:*.ogm=38;5;13:*.mp4=38;5;13:*.m4v=38;5;13:*.mp4v=38;5;13:*.vob=38;5;13:*.qt=38;5;13:*.nuv=38;5;13:*.wmv=38;5;13:*.asf=38;5;13:*.rm=38;5;13:*.rmvb=38;5;13:*.flc=38;5;13:*.avi=38;5;13:*.fli=38;5;13:*.flv=38;5;13:*.gl=38;5;13:*.dl=38;5;13:*.xcf=38;5;13:*.xwd=38;5;13:*.yuv=38;5;13:*.cgm=38;5;13:*.emf=38;5;13:*.axv=38;5;13:*.anx=38;5;13:*.ogv=38;5;13:*.ogx=38;5;13:*.aac=38;5;45:*.au=38;5;45:*.flac=38;5;45:*.mid=38;5;45:*.midi=38;5;45:*.mka=38;5;45:*.mp3=38;5;45:*.mpc=38;5;45:*.ogg=38;5;45:*.ra=38;5;45:*.wav=38;5;45:*.axa=38;5;45:*.oga=38;5;45:*.spx=38;5;45:*.xspf=38;5;45:'; export LS_COLORS\r\nMAIL=/var/spool/mail/shera; export MAIL\r\nMANPATH=/opt/intel/composer_xe_2013_sp1.2.144/man/en_US:/opt/intel/composer_xe_2013_sp1.2.144/man/en_US:/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64/share/man/:/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64_mic/share/man/:/usr/share/man; export MANPATH\r\nMIC_LD_LIBRARY_PATH=/opt/intel/composer_xe_2013_sp1.2.144/compiler/lib/mic:/opt/intel/composer_xe_2013_sp1.2.144/mpirt/lib/mic:/opt/intel/composer_xe_2013_sp1.2.144/compiler/lib/mic:/opt/intel/composer_xe_2013_sp1.2.144/mkl/lib/mic:/opt/intel/composer_xe_2013_sp1.2.144/tbb/lib/mic; export MIC_LD_LIBRARY_PATH\r\nMIC_LIBRARY_PATH=/opt/intel/composer_xe_2013_sp1.2.144/compiler/lib/mic:/opt/intel/composer_xe_2013_sp1.2.144/mpirt/lib/mic:/opt/intel/composer_xe_2013_sp1.2.144/tbb/lib/mic; export MIC_LIBRARY_PATH\r\nMKLROOT=/opt/intel/composer_xe_2013_sp1.2.144/mkl; export MKLROOT\r\nMKL_ROOT=/opt/intel/composer_xe_2013_sp1.2.144/mkl; export MKL_ROOT\r\nMODULEPATH=/home/shera/spack/spack/share/spack/modules/linux-centos6-x86_64:/opt/modulefiles/mpi/.intel:/opt/modulefiles/applications/.intel:/opt/modulefiles/mpi:/opt/modulefiles/compilers:/opt/modulefiles/applications:/usr/share/Modules/modulefiles:/etc/modulefiles; export MODULEPATH\r\nMODULESHOME=/usr/share/Modules; export MODULESHOME\r\nMPICC=/opt/mvapich2/intel/ib/bin/mpicc; export MPICC\r\nMPICH_CC=/home/shera/spack/spack/lib/spack/env/intel/icc; export MPICH_CC\r\nMPICH_CXX=/home/shera/spack/spack/lib/spack/env/intel/icpc; export MPICH_CXX\r\nMPICH_F77=/home/shera/spack/spack/lib/spack/env/intel/ifort; export MPICH_F77\r\nMPICH_F90=/home/shera/spack/spack/lib/spack/env/intel/ifort; export MPICH_F90\r\nMPICH_FC=/home/shera/spack/spack/lib/spack/env/intel/ifort; export MPICH_FC\r\nMPICXX=/opt/mvapich2/intel/ib/bin/mpicxx; export MPICXX\r\nMPIF77=/opt/mvapich2/intel/ib/bin/mpif77; export MPIF77\r\nMPIF90=/opt/mvapich2/intel/ib/bin/mpif90; export MPIF90\r\nMPIHOME=/opt/mvapich2/intel/ib; export MPIHOME\r\nMPM_LAUNCHER=/opt/intel/composer_xe_2013_sp1.2.144/debugger/mpm/bin/start_mpm.sh; export MPM_LAUNCHER\r\nMV2_ALLTOALL_TUNING=2; export MV2_ALLTOALL_TUNING\r\nNLSPATH=/opt/intel/composer_xe_2013_sp1.2.144/compiler/lib/intel64/locale/%l_%t/%N:/opt/intel/composer_xe_2013_sp1.2.144/ipp/lib/intel64/locale/%l_%t/%N:/opt/intel/composer_xe_2013_sp1.2.144/mkl/lib/intel64/locale/%l_%t/%N:/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64_mic/share/locale/%l_%t/%N:/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64/share/locale/%l_%t/%N; export NLSPATH\r\nPATH=/home/shera/spack/spack/lib/spack/env/intel:/home/shera/spack/spack/lib/spack/env/case-insensitive:/home/shera/spack/spack/lib/spack/env:/opt/mvapich2/intel/ib/bin:/opt/fftw/3.3.4/intel/mvapich2_ib/bin:/opt/mvapich2/intel/ib/bin:/opt/fftw/3.3.4/intel/mvapich2_ib/bin:/opt/fftw/3.3.4/intel/mvapich2_ib/bin:/home/shera/spack/spack/bin:/opt/gnu/gcc/bin:/opt/gnu/bin:/opt/mvapich2/intel/ib/bin:/opt/intel/composer_xe_2013_sp1.2.144/bin/intel64:/opt/intel/composer_xe_2013_sp1.2.144/mpirt/bin/intel64:/opt/intel/composer_xe_2013_sp1.2.144/debugger/gdb/intel64_mic/bin:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/opt/sdsc/bin:/opt/sdsc/sbin:/opt/ibutils/bin:/usr/java/latest/bin:/opt/pdsh/bin:/opt/rocks/bin:/opt/rocks/sbin:/home/shera/bin; export PATH\r\nPDSHROOT=/opt/pdsh; export PDSHROOT\r\nPKG_CONFIG_PATH=/opt/mvapich2/intel/ib/lib/pkgconfig:/opt/fftw/3.3.4/intel/mvapich2_ib/lib/pkgconfig; export PKG_CONFIG_PATH\r\n#PWD=/home/shera; export PWD\r\nPYTHONPATH=/opt/sdsc/lib; export PYTHONPATH\r\nQTDIR=/usr/lib64/qt-3.3; export QTDIR\r\nQTINC=/usr/lib64/qt-3.3/include; export QTINC\r\nQTLIB=/usr/lib64/qt-3.3/lib; export QTLIB\r\nROCKSROOT=/opt/rocks/share/devel; export ROCKSROOT\r\nROCKS_ROOT=/opt/rocks; export ROCKS_ROOT\r\nROLLSROOT=/opt/rocks/share/devel/src/roll; export ROLLSROOT\r\nSDSCDEVEL=/opt/sdsc/devel; export SDSCDEVEL\r\nSDSCHOME=/opt/sdsc; export SDSCHOME\r\nSHELL=/bin/bash; export SHELL\r\nSHLVL=3; export SHLVL\r\nSPACK_CC=/opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/icc; export SPACK_CC\r\nSPACK_CC_RPATH_ARG=-Wl,-rpath,; export SPACK_CC_RPATH_ARG\r\nSPACK_COMPILER_SPEC=intel@14.0.2; export SPACK_COMPILER_SPEC\r\nSPACK_CXX=/opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/icpc; export SPACK_CXX\r\nSPACK_CXX_RPATH_ARG=-Wl,-rpath,; export SPACK_CXX_RPATH_ARG\r\nSPACK_DEBUG_LOG_DIR=/home/shera; export SPACK_DEBUG_LOG_DIR\r\nSPACK_DEBUG_LOG_ID=p3dfft-3-v6h2bqu; export SPACK_DEBUG_LOG_ID\r\nSPACK_ENV_PATH=/home/shera/spack/spack/lib/spack/env:/home/shera/spack/spack/lib/spack/env/case-insensitive:/home/shera/spack/spack/lib/spack/env/intel; export SPACK_ENV_PATH\r\nSPACK_F77=/opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/ifort; export SPACK_F77\r\nSPACK_F77_RPATH_ARG=-Wl,-rpath,; export SPACK_F77_RPATH_ARG\r\nSPACK_FC=/opt/intel/composer_xe_2013_sp1.2.144/bin/intel64/ifort; export SPACK_FC\r\nSPACK_FC_RPATH_ARG=-Wl,-rpath,; export SPACK_FC_RPATH_ARG\r\nSPACK_INCLUDE_DIRS=/opt/fftw/3.3.4/intel/mvapich2_ib/include:/opt/mvapich2/intel/ib/include; export SPACK_INCLUDE_DIRS\r\nSPACK_LINK_DIRS=/opt/fftw/3.3.4/intel/mvapich2_ib/lib:/opt/mvapich2/intel/ib/lib; export SPACK_LINK_DIRS\r\nSPACK_ROOT=/home/shera/spack/spack; export SPACK_ROOT\r\nSPACK_RPATH_DIRS=/home/shera/spack/spack/opt/spack/linux-centos6-x86_64/intel-14.0.2/p3dfft-3-0.0.0-v6h2bqutm7rmpcjnp272grcmhrtms3hr/lib:/home/shera/spack/spack/opt/spack/linux-centos6-x86_64/intel-14.0.2/p3dfft-3-0.0.0-v6h2bqutm7rmpcjnp272grcmhrtms3hr/lib64:/opt/fftw/3.3.4/intel/mvapich2_ib/lib:/opt/mvapich2/intel/ib/lib; export SPACK_RPATH_DIRS\r\nSPACK_SHORT_SPEC='p3dfft-3@0.0.0%intel@14.0.2~essl+fftw~openmp arch=linux-centos6-x86_64/v6h2bqu'; export SPACK_SHORT_SPEC\r\nSPACK_SYSTEM_DIRS=/bin:/usr/bin:/usr/local/bin:/bin64:/usr/bin64:/usr/local/bin64:/include:/usr/include:/usr/local/include:/lib:/usr/lib:/usr/local/lib:/lib64:/usr/lib64:/usr/local/lib64:/:/usr:/usr/local; export SPACK_SYSTEM_DIRS\r\nSSH_CLIENT='37.120.132.126 58108 22'; export SSH_CLIENT\r\nSSH_CONNECTION='37.120.132.126 58108 198.202.113.253 22'; export SSH_CONNECTION\r\nSSH_TTY=/dev/pts/120; export SSH_TTY\r\nTBBROOT=/opt/intel/composer_xe_2013_sp1.2.144/tbb; export TBBROOT\r\nTERM=xterm-256color; export TERM\r\nUSER=shera; export USER\r\n_=/usr/bin/python; export _\r\n_LMFILES_=/opt/modulefiles/compilers/intel/2013_sp1.2.144:/opt/modulefiles/mpi/.intel/mvapich2_ib/2.1:/opt/modulefiles/applications/gnutools/2.69:/opt/modulefiles/applications/.intel/fftw/3.3.4; export _LMFILES_\r\n```\r\n\r\n**Steps to reproduce the issue**\r\nWhen call spack install, I encounter this error: \r\n```\r\n[shera@comet-ln2 ~]$ spack  install p3dfft-3%intel +fftw\r\n==> fftw@3.3.4 : has external module in fftw/3.3.4\r\n==> fftw@3.3.4 : is actually installed in /opt/fftw/3.3.4/intel/mvapich2_ib\r\n==> fftw@3.3.4 : already registered in DB\r\n==> mvapich2@2.1 : has external module in mvapich2_ib/2.1\r\n==> mvapich2@2.1 : is actually installed in /opt/mvapich2/intel/ib\r\n==> mvapich2@2.1 : already registered in DB\r\n==> Installing p3dfft-3\r\n==> Searching for binary cache of p3dfft-3\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for p3dfft-3 found: installing from source\r\n==> Warning: Suspicious requests to set or unset 'CC' found\r\n==> Warning: \t    \tenv.set('CC', os.path.join(link_dir, compiler.link_paths['cc'])) at /home/shera/spack/spack/lib/spack/spack/build_environment.py:185\r\n==> Warning: \t--->\tspack_env.set('FC', spec['mpi'].mpifc) at /home/shera/spack/spack/var/spack/repos/tutorial/packages/p3dfft-3/package.py:54\r\n==> Warning: Suspicious requests to set or unset 'CXX' found\r\n==> Warning: \t    \tenv.set('CXX', os.path.join(link_dir, compiler.link_paths['cxx'])) at /home/shera/spack/spack/lib/spack/spack/build_environment.py:188\r\n==> Warning: \t--->\t at /home/shera/spack/spack/var/spack/repos/tutorial/packages/p3dfft-3/package.py:56\r\n==> Warning: Suspicious requests to set or unset 'FC' found\r\n==> Warning: \t    \tenv.set('FC', os.path.join(link_dir, compiler.link_paths['fc'])) at /home/shera/spack/spack/lib/spack/spack/build_environment.py:194\r\n==> Warning: \t--->\tspack_env.set('CXX', spec['mpi'].mpicxx) at /home/shera/spack/spack/var/spack/repos/tutorial/packages/p3dfft-3/package.py:55\r\n==> Using cached archive: /home/shera/spack/spack/var/spack/cache/p3dfft-3/p3dfft-3-0.0.0.tar.gz\r\n==> Staging archive: /home/shera/spack/spack/var/spack/stage/p3dfft-3-0.0.0-v6h2bqutm7rmpcjnp272grcmhrtms3hr/master.tar.gz\r\n==> Created stage in /home/shera/spack/spack/var/spack/stage/p3dfft-3-0.0.0-v6h2bqutm7rmpcjnp272grcmhrtms3hr\r\n==> No patches needed for p3dfft-3\r\n==> Building p3dfft-3 [Package]\r\n==> Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 77:\r\n    './configure' '--prefix=/home/shera/spack/spack/opt/spack/linux-centos6-x86_64/intel-14.0.2/p3dfft-3-0.0.0-v6h2bqutm7rmpcjnp272grcmhrtms3hr' '--enable-fftw' '--with-fftw-lib= /opt/fftw/3.3.4/intel/mvapich2_ib/lib' '--with-fftw-inc= /opt/fftw/3.3.4/intel/mvapich2_ib/include'\r\n\r\n2 errors found in build log:\r\n     18    checking whether to use ESSL library... no\r\n     19    checking whether to use MKL library... no\r\n     20    checking fftw lib location...  /opt/fftw/3.3.4/intel/mvapich2_ib/lib\r\n     21    checking fftw inc location...  /opt/fftw/3.3.4/intel/mvapich2_ib/inc\r\n           lude\r\n     22    checking for gcc... /opt/mvapich2/intel/ib/bin/mpicc\r\n     23    checking whether the C compiler works... no\r\n  >> 24    configure: error: in `/tmp/shera/spack-stage/spack-stage-HmWLVU/spac\r\n           k-src':\r\n  >> 25    configure: error: C compiler cannot create executables\r\n     26    See `config.log' for more details\r\n\r\nSee build log for details:\r\n  /home/shera/spack/spack/var/spack/stage/p3dfft-3-0.0.0-v6h2bqutm7rmpcjnp272grcmhrtms3hr/spack-build-out.txt\r\n```\r\n\r\nHowever, I can build the package successfuly in the spack debug environment, after call\r\n`'./configure --prefix=/home/shera/installed --enable-intel --enable-fftw CC=mpicc CXX=mpicxx FC=mpif90'.\r\n`\r\nMy best guess is that the error is caused by CC=mpicc CXX=mpicxx FC=mpif90, because if I removed these 3 arguments, I will not get the C compiler cannot create executables error, but spack will not find mpicc(./configure --prefix=/home/shera/installed --enable-intel --enable-fftw  works when not using spack, CC and CXX has been automatically set correctly).\r\n\r\nI am pretty new to HPC and spack, so there is could be some silly mistakes. Hope I can get some helps. Thank you!\r\n\r\n\r\n",
    "performed_via_github_app": null
}