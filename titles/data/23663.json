{
    "url": "https://api.github.com/repos/spack/spack/issues/23663",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/23663/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/23663/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/23663/events",
    "html_url": "https://github.com/spack/spack/issues/23663",
    "id": 892675512,
    "node_id": "MDU6SXNzdWU4OTI2NzU1MTI=",
    "number": 23663,
    "title": "AttributeError: 'CommentedSeq' object has no attribute 'get'",
    "user": {
        "login": "sethrj",
        "id": 741229,
        "node_id": "MDQ6VXNlcjc0MTIyOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sethrj",
        "html_url": "https://github.com/sethrj",
        "followers_url": "https://api.github.com/users/sethrj/followers",
        "following_url": "https://api.github.com/users/sethrj/following{/other_user}",
        "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions",
        "organizations_url": "https://api.github.com/users/sethrj/orgs",
        "repos_url": "https://api.github.com/users/sethrj/repos",
        "events_url": "https://api.github.com/users/sethrj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sethrj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483406,
            "node_id": "MDU6TGFiZWw1MTI0ODM0MDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-high",
            "name": "impact-high",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2021-05-16T13:49:36Z",
    "updated_at": "2021-05-28T21:12:06Z",
    "closed_at": "2021-05-28T21:12:06Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I'm trying to install a new package after pulling spack to a recent version; and the install seems to be failing due to an error while building modulefiles deep in the spack config settings.\r\n\r\n### Error Message\r\n\r\n```console\r\n$ spack -vd install fortrilinos ^trilinos/fi45zpy\r\n# snip\r\n==> [2021-05-16-09:23:02.993000] Installing /var/folders/gy/mrg1ffts2h945qj9k29s1l1dvvmbqb/T/s3j/spack-stage/spack-stage-fortrilinos-2.0.0-xdulgmsdgorsfvtvr73vubopurrs2hn5/spack-src/example/test-installation to /rnsdhpc/code/spack/opt/spack/apple-clang/fortrilinos/xdulgms/.spack/test/example/test-installation\r\n==> [2021-05-16-09:23:03.317370] Error: AttributeError: 'CommentedSeq' object has no attribute 'get'\r\n\r\n/rnsdhpc/code/spack/lib/spack/spack/build_environment.py:930, in _setup_pkg_and_run:\r\n        927        tb_string = traceback.format_exc()\r\n        928\r\n        929        # build up some context from the offending package so we can\r\n  >>    930        # show that, too.\r\n        931        package_context = get_package_context(tb)\r\n        932\r\n        933        logfile = None\r\n\r\nSee build log for details:\r\n  /var/folders/gy/mrg1ffts2h945qj9k29s1l1dvvmbqb/T/s3j/spack-stage/spack-stage-fortrilinos-2.0.0-xdulgmsdgorsfvtvr73vubopurrs2hn5/spack-build-out.txt\r\n\r\nTraceback (most recent call last):\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/build_environment.py\", line 914, in _setup_pkg_and_run\r\n    return_value = function(pkg, kwargs)\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/installer.py\", line 1792, in build_process\r\n    spack.hooks.post_install(pkg.spec)\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/hooks/__init__.py\", line 75, in __call__\r\n    hook(*args, **kwargs)\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/hooks/module_file_generation.py\", line 38, in post_install\r\n    _for_each_enabled(spec, 'write')\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/hooks/module_file_generation.py\", line 15, in _for_each_enabled\r\n    enabled = spack.config.get('modules:%s:enable' % name)\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/config.py\", line 899, in get\r\n    return config.get(path, default, scope)\r\n  File \"/rnsdhpc/code/spack/lib/spack/spack/config.py\", line 652, in get\r\n    value = value.get(key, default)\r\nAttributeError: 'CommentedSeq' object has no attribute 'get'\r\n==> [2021-05-16-09:23:03.317914] Flagging fortrilinos-2.0.0-xdulgmsdgorsfvtvr73vubopurrs2hn5 as failed: AttributeError: 'CommentedSeq' object has no attribute 'get'\r\n==> [2021-05-16-09:23:03.333998] ChildError: AttributeError: 'CommentedSeq' object has no attribute 'get'\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.1-2661-2202ce27fa\r\n* **Python:** 3.8.5\r\n* **Platform:** darwin-bigsur-skylake\r\n* **Concretizer:** clingo\r\n\r\n### Additional information\r\n\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n\r\nThe modules config looks a little funky, apparently \r\n```console\r\n$ spack config get modules\r\nmodules:\r\n  default:\r\n    lmod:\r\n      core_compilers:\r\n      - apple-clang@12.0.5\r\n      - gcc@10.2.0\r\n      hierarchy:\r\n      - mpi\r\n    prefix_inspections:\r\n      lib:\r\n      - DYLD_FALLBACK_LIBRARY_PATH\r\n      lib64:\r\n      - DYLD_FALLBACK_LIBRARY_PATH\r\n    roots:\r\n      tcl: $spack/share/spack/modules\r\n      lmod: $spack/share/spack/lmod\r\n    enable:\r\n    - tcl\r\n\r\n    # Default configurations if lmod is enabled\r\n  'enable:':\r\n  - lmod\r\n  prefix_inspections:\r\n    bin:\r\n    - PATH\r\n    man:\r\n    - MANPATH\r\n    share/man:\r\n    - MANPATH\r\n    share/aclocal:\r\n    - ACLOCAL_PATH\r\n    'include:': []\r\n    lib:\r\n    - LIBRARY_PATH\r\n    lib64:\r\n    - LIBRARY_PATH\r\n    lib/pkgconfig:\r\n    - PKG_CONFIG_PATH\r\n    lib64/pkgconfig:\r\n    - PKG_CONFIG_PATH\r\n    share/pkgconfig:\r\n    - PKG_CONFIG_PATH\r\n    ? ''\r\n    : - CMAKE_PREFIX_PATH\r\n\r\n  # These are configurations for the module set named \"default\"\r\n  lmod:\r\n    core_compilers:\r\n    - apple-clang@12.0.0\r\n    hash_length: 4\r\n    'hierarchy:': []\r\n    ^python:\r\n      autoload: direct\r\n    all:\r\n      suffixes:\r\n        ^python@2: py2\r\n        +cuda: cuda\r\n        +debug: debug\r\n        +mpi: mpi\r\n        +multithreaded: mt\r\n        +openmp: mt\r\n        +threads: mt\r\n        ~shared: static\r\n        cxxstd=98: c++98\r\n        cxxstd=14: c++14\r\n        cxxstd=17: c++17\r\n      environment:\r\n        set:\r\n          ${PACKAGE}_ROOT: ${PREFIX}\r\n```",
    "performed_via_github_app": null
}