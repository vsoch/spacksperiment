{
    "url": "https://api.github.com/repos/spack/spack/issues/18001",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/18001/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/18001/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/18001/events",
    "html_url": "https://github.com/spack/spack/issues/18001",
    "id": 677279092,
    "node_id": "MDU6SXNzdWU2NzcyNzkwOTI=",
    "number": 18001,
    "title": "Clang/Cuda compatibility on power9",
    "user": {
        "login": "JulienLoiseau",
        "id": 12030272,
        "node_id": "MDQ6VXNlcjEyMDMwMjcy",
        "avatar_url": "https://avatars.githubusercontent.com/u/12030272?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/JulienLoiseau",
        "html_url": "https://github.com/JulienLoiseau",
        "followers_url": "https://api.github.com/users/JulienLoiseau/followers",
        "following_url": "https://api.github.com/users/JulienLoiseau/following{/other_user}",
        "gists_url": "https://api.github.com/users/JulienLoiseau/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/JulienLoiseau/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/JulienLoiseau/subscriptions",
        "organizations_url": "https://api.github.com/users/JulienLoiseau/orgs",
        "repos_url": "https://api.github.com/users/JulienLoiseau/repos",
        "events_url": "https://api.github.com/users/JulienLoiseau/events{/privacy}",
        "received_events_url": "https://api.github.com/users/JulienLoiseau/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 618601843,
            "node_id": "MDU6TGFiZWw2MTg2MDE4NDM=",
            "url": "https://api.github.com/repos/spack/spack/labels/cuda",
            "name": "cuda",
            "color": "85b737",
            "default": false,
            "description": ""
        },
        {
            "id": 883727171,
            "node_id": "MDU6TGFiZWw4ODM3MjcxNzE=",
            "url": "https://api.github.com/repos/spack/spack/labels/power",
            "name": "power",
            "color": "8a8edb",
            "default": false,
            "description": ""
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "adamjstewart",
            "id": 12021217,
            "node_id": "MDQ6VXNlcjEyMDIxMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/adamjstewart",
            "html_url": "https://github.com/adamjstewart",
            "followers_url": "https://api.github.com/users/adamjstewart/followers",
            "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
            "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
            "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
            "repos_url": "https://api.github.com/users/adamjstewart/repos",
            "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
            "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 16,
    "created_at": "2020-08-12T00:08:41Z",
    "updated_at": "2020-09-29T02:51:34Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I am working on Power9 architecture. \r\nThe module already existing are: \r\ncuda 9.2 \r\ncuda 10.2 \r\ncuda 11.0 \r\n\r\nI have multiple versions of clang available: \r\nclang 8.0.1 \r\nclang 8.0.0\r\nclang 7.0.0\r\nI also installed llvm 10.0.0 and master (11.0.0?) using spack. \r\n\r\nI want to install Kokkos using a combination of clang/cuda but I encounter problems of compatibility even if as listed (https://gist.github.com/ax3l/9489132#clang--x-cuda) there should not be any problem for these version. \r\nI took Kokkos as a simple example here but all the other code that depend on Cuda give me the same problem with Clang/Cuda. \r\n\r\n### Steps to reproduce the issue and errors: \r\n\r\n#### Clang 10 : only clang 10 + cuda 11 is working properly \r\n\r\nClang 10/Cuda 9.2\r\n```console\r\nspack install kokkos +cuda cuda_arch=72 %clang@10.0.0 ^cuda@9.2\r\n```\r\nError: \r\n```console\r\n==> Warning: the attribute \"modules\" in the \"packages\" section of the configuration has been deprecated [entry=CommentedMap([('cuda@9.2', 'cuda/9.2'), ('cuda@10.2', 'cuda/10.2'), ('cuda@11.0', 'cuda/11.0')])]\r\n==> Error: Conflicts in concretized spec \"kokkos@3.1.01%clang@10.0.0~aggressive_vectorization~compiler_warnings+cuda~cuda_lambda~cuda_ldg_intrinsic~cuda_relocatable_device_code~cuda_uvm~debug~debug_bounds_check~debug_dualview_modify_check~deprecated_code~examples~explicit_instantiation~hip~hpx~hpx_async_dispatch~hwloc~memkind~numactl~openmp~pic+profiling~profiling_load_print~pthread~qthread+serial+shared~tests~wrapper amd_gpu_arch=none build_type=RelWithDebInfo cuda_arch=72 std=11 arch=linux-rhel7-power9le/ie32y66\"\r\nList of matching conflicts for spec:\r\n\r\n    kokkos@3.1.01%clang@10.0.0~aggressive_vectorization~compiler_warnings+cuda~cuda_lambda~cuda_ldg_intrinsic~cuda_relocatable_device_code~cuda_uvm~debug~debug_bounds_check~debug_dualview_modify_check~deprecated_code~examples~explicit_instantiation~hip~hpx~hpx_async_dispatch~hwloc~memkind~numactl~openmp~pic+profiling~profiling_load_print~pthread~qthread+serial+shared~tests~wrapper amd_gpu_arch=none build_type=RelWithDebInfo cuda_arch=72 std=11 arch=linux-rhel7-power9le\r\n        ^cmake@3.18.1%clang@10.0.0~doc+ncurses+openssl+ownlibs~qt arch=linux-rhel7-power9le\r\n            ^ncurses@6.2%clang@10.0.0~symlinks+termlib arch=linux-rhel7-power9le\r\n                ^pkgconf@1.7.3%clang@10.0.0 arch=linux-rhel7-power9le\r\n            ^openssl@1.1.1g%clang@10.0.0+systemcerts arch=linux-rhel7-power9le\r\n                ^perl@5.30.3%clang@10.0.0+cpanm+shared+threads arch=linux-rhel7-power9le\r\n                    ^berkeley-db@18.1.40%clang@10.0.0 arch=linux-rhel7-power9le\r\n                    ^gdbm@1.18.1%clang@10.0.0 arch=linux-rhel7-power9le\r\n                        ^readline@8.0%clang@10.0.0 arch=linux-rhel7-power9le\r\n                ^zlib@1.2.11%clang@10.0.0+optimize+pic+shared arch=linux-rhel7-power9le\r\n        ^cuda@9.2%clang@10.0.0 arch=linux-rhel7-power9le\r\n\r\n1. \"%clang@6:\" conflicts with \"kokkos+cuda ^cuda@:9.2 arch=linux-None-ppc64le:\"\r\n2. \"%clang@7.1:\" conflicts with \"kokkos+cuda ^cuda@:10.1.105 arch=linux-None-ppc64le:\"\r\n3. \"%clang@8.1:\" conflicts with \"kokkos+cuda ^cuda@:10.2.89 arch=linux-None-ppc64le:\"\r\n```\r\n\r\nClang 10/Cuda 10.2\r\n```console\r\nspack install kokkos +cuda cuda_arch=72 %clang@10.0.0 ^cuda@10.2\r\n```\r\nError: \r\n```console\r\n==> Warning: the attribute \"modules\" in the \"packages\" section of the configuration has been deprecated [entry=CommentedMap([('cuda@9.2', 'cuda/9.2'), ('cuda@10.2', 'cuda/10.2'), ('cuda@11.0', 'cuda/11.0')])]\r\n==> Error: Conflicts in concretized spec \"kokkos@3.1.01%clang@10.0.0~aggressive_vectorization~compiler_warnings+cuda~cuda_lambda~cuda_ldg_intrinsic~cuda_relocatable_device_code~cuda_uvm~debug~debug_bounds_check~debug_dualview_modify_check~deprecated_code~examples~explicit_instantiation~hip~hpx~hpx_async_dispatch~hwloc~memkind~numactl~openmp~pic+profiling~profiling_load_print~pthread~qthread+serial+shared~tests~wrapper amd_gpu_arch=none build_type=RelWithDebInfo cuda_arch=72 std=11 arch=linux-rhel7-power9le/7mbl2ho\"\r\nList of matching conflicts for spec:\r\n\r\n    kokkos@3.1.01%clang@10.0.0~aggressive_vectorization~compiler_warnings+cuda~cuda_lambda~cuda_ldg_intrinsic~cuda_relocatable_device_code~cuda_uvm~debug~debug_bounds_check~debug_dualview_modify_check~deprecated_code~examples~explicit_instantiation~hip~hpx~hpx_async_dispatch~hwloc~memkind~numactl~openmp~pic+profiling~profiling_load_print~pthread~qthread+serial+shared~tests~wrapper amd_gpu_arch=none build_type=RelWithDebInfo cuda_arch=72 std=11 arch=linux-rhel7-power9le\r\n        ^cmake@3.18.1%clang@10.0.0~doc+ncurses+openssl+ownlibs~qt arch=linux-rhel7-power9le\r\n            ^ncurses@6.2%clang@10.0.0~symlinks+termlib arch=linux-rhel7-power9le\r\n                ^pkgconf@1.7.3%clang@10.0.0 arch=linux-rhel7-power9le\r\n            ^openssl@1.1.1g%clang@10.0.0+systemcerts arch=linux-rhel7-power9le\r\n                ^perl@5.30.3%clang@10.0.0+cpanm+shared+threads arch=linux-rhel7-power9le\r\n                    ^berkeley-db@18.1.40%clang@10.0.0 arch=linux-rhel7-power9le\r\n                    ^gdbm@1.18.1%clang@10.0.0 arch=linux-rhel7-power9le\r\n                        ^readline@8.0%clang@10.0.0 arch=linux-rhel7-power9le\r\n                ^zlib@1.2.11%clang@10.0.0+optimize+pic+shared arch=linux-rhel7-power9le\r\n        ^cuda@10.2%clang@10.0.0 arch=linux-rhel7-power9le\r\n\r\n1. \"%clang@8.1:\" conflicts with \"kokkos+cuda ^cuda@:10.2.89 arch=linux-None-ppc64le:\"\r\n```\r\n\r\nClang 10/Cuda 11\r\n\r\n```console\r\n spack install kokkos +cuda cuda_arch=72 %clang@10.0.0 ^cuda@11.0\r\n```\r\n\r\nThis is the only working combination.\r\n\r\nI have the same kind of error using other version of clang like clang 8.0.0 or clang 7.0.0 even if these versions should be compatible regarding to: https://gist.github.com/ax3l/9489132#clang--x-cuda\r\n\r\n### Information on your system\r\n\r\ndebug report: \r\n```\r\n* **Spack:** 0.15.3-489-2f0fd44\r\n* **Python:** 3.7.8\r\n* **Platform:** linux-rhel7-power9le: \r\n```\r\npackages.yaml: \r\n```\r\npackages:\r\n  cuda: \r\n    modules:\r\n      cuda@9.2: cuda/9.2 \r\n      cuda@10.2: cuda/10.2\r\n      cuda@11.0: cuda/11.0\r\n```\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n",
    "performed_via_github_app": null
}