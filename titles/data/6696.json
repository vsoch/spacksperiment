{
    "url": "https://api.github.com/repos/spack/spack/issues/6696",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/6696/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/6696/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/6696/events",
    "html_url": "https://github.com/spack/spack/issues/6696",
    "id": 282499012,
    "node_id": "MDU6SXNzdWUyODI0OTkwMTI=",
    "number": 6696,
    "title": "Spack Fails to Build Packages on Stampede2",
    "user": {
        "login": "nilsdeppe",
        "id": 13531030,
        "node_id": "MDQ6VXNlcjEzNTMxMDMw",
        "avatar_url": "https://avatars.githubusercontent.com/u/13531030?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/nilsdeppe",
        "html_url": "https://github.com/nilsdeppe",
        "followers_url": "https://api.github.com/users/nilsdeppe/followers",
        "following_url": "https://api.github.com/users/nilsdeppe/following{/other_user}",
        "gists_url": "https://api.github.com/users/nilsdeppe/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/nilsdeppe/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/nilsdeppe/subscriptions",
        "organizations_url": "https://api.github.com/users/nilsdeppe/orgs",
        "repos_url": "https://api.github.com/users/nilsdeppe/repos",
        "events_url": "https://api.github.com/users/nilsdeppe/events{/privacy}",
        "received_events_url": "https://api.github.com/users/nilsdeppe/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2017-12-15T17:40:43Z",
    "updated_at": "2019-05-30T03:46:39Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Summary\r\n\r\nI have tried building the packages jemalloc, yaml-cpp, and LIBXSMM on Stampede2 and all fail in the same manner. I'll focus on jemalloc since this is the package we investigated most thoroughly.\r\n\r\n### Expected Result\r\n\r\n`spack install jemalloc%gcc@7.1.0` successfully install jemalloc.\r\n\r\n### Actual Result\r\n\r\nSpack fails during the configure step.\r\n\r\n### Steps to reproduce the issue\r\n\r\nRunning `spack install jemalloc%gcc@7.1.0` results in:\r\n\r\n```\r\n==> Installing jemalloc\r\n==> Using cached archive: /home1/04264/tg835637/spack/var/spack/cache/jemalloc/jemalloc-4.5.0.tar.bz2\r\n==> Staging archive: /home1/04264/tg835637/spack/var/spack/stage/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/jemalloc-4.5.0.tar.bz2\r\n==> Created stage in /home1/04264/tg835637/spack/var/spack/stage/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr\r\n==> No patches needed for jemalloc\r\n==> Building jemalloc [Package]\r\n==> Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 77:\r\n    './configure' '--prefix=/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr'\r\n\r\n2 errors found in build log:\r\n     [ ... ]\r\n  >> 6     configure: error: in `/tmp/tg835637/spack-stage/spack-stage-4RKgmL/jemalloc-4.5.0':\r\n  >> 7     configure: error: C compiler cannot create executables\r\n     8     See `config.log' for more details\r\n\r\nSee build log for details:\r\n  /home1/04264/tg835637/spack/var/spack/stage/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/jemalloc-4.5.0/spack-build.out\r\n```\r\n\r\nThe contents of `/home1/04264/tg835637/spack/var/spack/stage/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/jemalloc-4.5.0/spack-build.out` are:\r\n\r\n```\r\n==> Executing phase: 'install'\r\n==> './configure' '--prefix=/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr'\r\nchecking for xsltproc... /bin/xsltproc\r\nchecking for gcc... /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc\r\nchecking whether the C compiler works... no\r\nconfigure: error: in `/tmp/tg835637/spack-stage/spack-stage-_Q2nyD/jemalloc-4.5.0':\r\nconfigure: error: C compiler cannot create executables\r\nSee `config.log' for more details\r\n```\r\n\r\nand the contents of `config.log` are:\r\n\r\n```\r\nThis file contains any messages produced by compilers while\r\nrunning configure, to aid debugging if configure makes a mistake.\r\n\r\nIt was created by configure, which was\r\ngenerated by GNU Autoconf 2.69.  Invocation command line was\r\n\r\n  $ ./configure --prefix=/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr\r\n\r\n## --------- ##\r\n## Platform. ##\r\n## --------- ##\r\n\r\nhostname = login4.stampede2.tacc.utexas.edu\r\nuname -m = x86_64\r\nuname -r = 3.10.0-693.5.2.el7.x86_64\r\nuname -s = Linux\r\nuname -v = #1 SMP Fri Oct 20 20:32:50 UTC 2017\r\n\r\n/usr/bin/uname -p = x86_64\r\n/bin/uname -X     = unknown\r\n\r\n/bin/arch              = x86_64\r\n/usr/bin/arch -k       = unknown\r\n/usr/convex/getsysinfo = unknown\r\n/usr/bin/hostinfo      = unknown\r\n/bin/machine           = unknown\r\n/usr/bin/oslevel       = unknown\r\n/bin/universe          = unknown\r\n\r\nPATH: /home1/04264/tg835637/spack/lib/spack/env\r\nPATH: /home1/04264/tg835637/spack/lib/spack/env/case-insensitive\r\nPATH: /home1/04264/tg835637/spack/lib/spack/env/gcc\r\nPATH: /opt/apps/xalt/1.7.7/bin\r\nPATH: /opt/apps/gcc7_1/python/2.7.13/bin\r\nPATH: /opt/apps/gcc7_1/impi/17.0.3/bin\r\nPATH: /opt/intel/compilers_and_libraries_2017.4.196/linux/mpi/intel64/bin\r\nPATH: /opt/apps/gcc/7.1.0/bin\r\nPATH: /home1/04264/tg835637/spack/bin\r\nPATH: /opt/apps/autotools/1.1/bin\r\nPATH: /opt/apps/git/2.9.0/bin\r\nPATH: /usr/lib64/qt-3.3/bin\r\nPATH: /usr/local/bin\r\nPATH: /bin\r\nPATH: /usr/bin\r\nPATH: .\r\n\r\n\r\n## ----------- ##\r\n## Core tests. ##\r\n## ----------- ##\r\n\r\nconfigure:2607: checking for xsltproc\r\nconfigure:2625: found /bin/xsltproc\r\nconfigure:2638: result: /bin/xsltproc\r\nconfigure:2719: checking for gcc\r\nconfigure:2746: result: /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc\r\nconfigure:2975: checking for C compiler version\r\nconfigure:2984: /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc --version >&5\r\ngcc (GCC) 7.1.0\r\nCopyright (C) 2017 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\nconfigure:2995: $? = 0\r\nconfigure:2984: /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc -v >&5\r\nUsing built-in specs.\r\nCOLLECT_GCC=/opt/apps/gcc/7.1.0/bin/gcc\r\nCOLLECT_LTO_WRAPPER=/opt/apps/gcc/7.1.0/libexec/gcc/x86_64-pc-linux-gnu/7.1.0/lto-wrapper\r\nTarget: x86_64-pc-linux-gnu\r\nConfigured with: /admin/build/rpms/BUILD/gcc-7.1.0/configure --enable-libssp --enable-gold=yes --enable-ld=default --enable-plugins --enable-lt\r\no --with-tune=generic --enable-languages=c,c++,fortran --disable-multilib --prefix=/opt/apps/gcc/7.1.0 --with-gmp=/opt/apps/gcc/7.1.0 --with-ml\r\ngmp=/opt/apps/gcc/7.1.0 --with-mpfr=/opt/apps/gcc/7.1.0 --with-mpc=/opt/apps/gcc/7.1.0 --with-isl=/opt/apps/gcc/7.1.0\r\nThread model: posix\r\ngcc version 7.1.0 (GCC) \r\nconfigure:2995: $? = 0\r\nconfigure:2984: /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc -V >&5\r\ngcc: error: unrecognized command line option '-V'\r\ngcc: fatal error: no input files\r\ncompilation terminated.\r\nconfigure:2995: $? = 1\r\nconfigure:2984: /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc -qversion >&5\r\ngcc: error: unrecognized command line option '-qversion'; did you mean '--version'?\r\nconfigure:2995: $? = 1\r\nconfigure:3015: checking whether the C compiler works\r\nconfigure:3037: /home1/04264/tg835637/spack/lib/spack/env/gcc/gcc    conftest.c  >&5\r\n/opt/apps/gcc/7.1.0/libexec/gcc/x86_64-pc-linux-gnu/7.1.0/cc1: error while loading shared libraries: libisl.so.15: cannot open shared object file: No such file or directory\r\nconfigure:3041: $? = 1\r\nconfigure:3079: result: no\r\nconfigure: failed program was:\r\n| /* confdefs.h */\r\n| #define PACKAGE_NAME \"\"\r\n| #define PACKAGE_TARNAME \"\"\r\n| #define PACKAGE_VERSION \"\"\r\n| #define PACKAGE_STRING \"\"\r\n| #define PACKAGE_BUGREPORT \"\"\r\n| #define PACKAGE_URL \"\"\r\n| /* end confdefs.h.  */\r\n| \r\n| int\r\n| main ()\r\n| {\r\n| \r\n|   ;\r\n|   return 0;\r\n| }\r\nconfigure:3084: error: in `/tmp/tg835637/spack-stage/spack-stage-_Q2nyD/jemalloc-4.5.0':\r\nconfigure:3086: error: C compiler cannot create executables\r\nSee `config.log' for more details\r\n\r\n## ---------------- ##\r\n## Cache variables. ##\r\n## ---------------- ##\r\n\r\nac_cv_env_CC_set=set\r\nac_cv_env_CC_value=/home1/04264/tg835637/spack/lib/spack/env/gcc/gcc\r\nac_cv_env_CFLAGS_set=\r\nac_cv_env_CFLAGS_value=\r\nac_cv_env_CPPFLAGS_set=\r\nac_cv_env_CPPFLAGS_value=\r\nac_cv_env_CPP_set=\r\nac_cv_env_CPP_value=\r\nac_cv_env_LDFLAGS_set=\r\nac_cv_env_LDFLAGS_value=\r\nac_cv_env_LIBS_set=\r\nac_cv_env_LIBS_value=\r\nac_cv_env_build_alias_set=\r\nac_cv_env_build_alias_value=\r\nac_cv_env_host_alias_set=\r\nac_cv_env_host_alias_value=\r\nac_cv_env_target_alias_set=\r\nac_cv_env_target_alias_value=\r\nac_cv_path_XSLTPROC=/bin/xsltproc\r\nac_cv_prog_ac_ct_CC=/home1/04264/tg835637/spack/lib/spack/env/gcc/gcc\r\n\r\n## ----------------- ##\r\n## Output variables. ##\r\n## ----------------- ##\r\n\r\nAR=''\r\nARFLAGS=''\r\nAROUT=''\r\nAUTOCONF=''\r\nBINDIR='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/bin'\r\nCC='/home1/04264/tg835637/spack/lib/spack/env/gcc/gcc'\r\nCC_MM=''\r\nCFLAGS=''\r\nCONFIG='--prefix=/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr CC=/home1\r\n/04264/tg835637/spack/lib/spack/env/gcc/gcc'\r\nCONFIGURE_CFLAGS=''\r\nCPP=''\r\nCPPFLAGS=''\r\nCTARGET=''\r\nDATADIR='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/share'\r\nDEFS=''\r\nDSO_LDFLAGS=''\r\nECHO_C=''\r\nECHO_N='-n'\r\nECHO_T=''\r\nEGREP=''\r\nEXEEXT=''\r\nEXTRA_CFLAGS=''\r\nEXTRA_LDFLAGS=''\r\nGREP=''\r\nINCLUDEDIR='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/include'\r\nINSTALL_DATA=''\r\nINSTALL_PROGRAM=''\r\nINSTALL_SCRIPT=''\r\nJEMALLOC_CPREFIX=''\r\nLD=''\r\nLDFLAGS=''\r\nLDTARGET=''\r\nLD_PRELOAD_VAR=''\r\nLIBDIR='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/lib'\r\nLIBOBJS=''\r\nLIBS=''\r\nLM=''\r\nLTLIBOBJS=''\r\nMANDIR='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/share/man'\r\nMKLIB=''\r\nOBJEXT=''\r\nPACKAGE_BUGREPORT=''\r\nPACKAGE_NAME=''\r\nPACKAGE_STRING=''\r\nPACKAGE_TARNAME=''\r\nPACKAGE_URL=''\r\nPACKAGE_VERSION=''\r\nPATH_SEPARATOR=':'\r\nPIC_CFLAGS=''\r\nPREFIX='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr'\r\nRANLIB=''\r\nRPATH=''\r\nRPATH_EXTRA=''\r\nSHELL='/bin/sh'\r\nSOREV=''\r\nSPECIFIED_CFLAGS=''\r\nTEST_LD_MODE=''\r\nXSLROOT=''\r\nXSLTPROC='/bin/xsltproc'\r\na=''\r\nabi=''\r\nabs_objroot='/tmp/tg835637/spack-stage/spack-stage-_Q2nyD/jemalloc-4.5.0/'\r\nabs_srcroot='/tmp/tg835637/spack-stage/spack-stage-_Q2nyD/jemalloc-4.5.0/'\r\nac_ct_CC='/home1/04264/tg835637/spack/lib/spack/env/gcc/gcc'\r\nbindir='${exec_prefix}/bin'\r\nbuild=''\r\nbuild_alias=''\r\nbuild_cpu=''\r\nbuild_os=''\r\nbuild_vendor=''\r\ncfghdrs_in=''\r\ncfghdrs_out=''\r\ncfgoutputs_in=''\r\ncfgoutputs_out=''\r\ndatadir='${datarootdir}'\r\ndatarootdir='${prefix}/share'\r\ndocdir='${datarootdir}/doc/${PACKAGE}'\r\ndvidir='${docdir}'\r\nenable_autogen=''\r\nenable_cache_oblivious=''\r\nenable_code_coverage=''\r\nenable_debug=''\r\nenable_fill=''\r\nenable_lazy_lock=''\r\nenable_munmap=''\r\nenable_prof=''\r\nenable_stats=''\r\nenable_tcache=''\r\nenable_thp=''\r\nenable_tls=''\r\nenable_utrace=''\r\nenable_valgrind=''\r\nenable_xmalloc=''\r\nenable_zone_allocator=''\r\nexe=''\r\nexec_prefix='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr'\r\nhost=''\r\nhost_alias=''\r\nhost_cpu=''\r\nhost_os=''\r\nhost_vendor=''\r\nhtmldir='${docdir}'\r\nimportlib=''\r\nincludedir='${prefix}/include'\r\ninfodir='${datarootdir}/info'\r\ninstall_suffix=''\r\nje_=''\r\njemalloc_version=''\r\njemalloc_version_bugfix=''\r\njemalloc_version_gid=''\r\njemalloc_version_major=''\r\njemalloc_version_minor=''\r\njemalloc_version_nrev=''\r\nlibdir='${exec_prefix}/lib'\r\nlibexecdir='${exec_prefix}/libexec'\r\nlibprefix=''\r\nlink_whole_archive=''\r\nlocaledir='${datarootdir}/locale'\r\nlocalstatedir='${prefix}/var'\r\nmandir='${datarootdir}/man'\r\no=''\r\nobjroot=''\r\noldincludedir='/usr/include'\r\npdfdir='${docdir}'\r\nprefix='/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr'\r\nprivate_namespace=''\r\nprogram_transform_name='s,x,x,'\r\npsdir='${docdir}'\r\nrev='2'\r\nrunstatedir='${localstatedir}/run'\r\nsbindir='${exec_prefix}/sbin'\r\nsharedstatedir='${prefix}/com'\r\nso=''\r\nsrcroot=''\r\nsysconfdir='${prefix}/etc'\r\ntarget_alias=''\r\n\r\n## ----------- ##\r\n## confdefs.h. ##\r\n## ----------- ##\r\n\r\n/* confdefs.h */\r\n#define PACKAGE_NAME \"\"\r\n#define PACKAGE_TARNAME \"\"\r\n#define PACKAGE_VERSION \"\"\r\n#define PACKAGE_STRING \"\"\r\n#define PACKAGE_BUGREPORT \"\"\r\n#define PACKAGE_URL \"\"\r\n\r\nconfigure: exit 77\r\n```\r\n\r\nInterestingly, if I manually run `./configure --prefix=/home1/04264/tg835637/spack/opt/spack/linux-centos7-x86_64/gcc-7.1.0/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr` in `/home1/04264/tg835637/spack/var/spack/stage/jemalloc-4.5.0-jdofbiqat6d2b7bheyelgag4cezkj7tr/jemalloc-4.5.0/` everything is fine. I can run `make` and `make install`  without any issues. We've tried tracing through Spack to see what could be happening but are not familiar enough with Spack to find a solution.\r\n\r\n### Information on your system\r\n\r\n1. Stampede2 login node (seems to be the same on them all, as expected)\r\n2. The module env is:\r\n```\r\nCurrently Loaded Modules:\r\n  1) git/2.9.0   2) autotools/1.1   3) xalt/1.7.7\r\n  4) TACC       5) gcc/7.1.0        6) impi/17.0.3\r\n  7) python/2.7.13\r\n```",
    "performed_via_github_app": null
}