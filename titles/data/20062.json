{
    "url": "https://api.github.com/repos/spack/spack/issues/20062",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/20062/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/20062/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/20062/events",
    "html_url": "https://github.com/spack/spack/issues/20062",
    "id": 749305622,
    "node_id": "MDU6SXNzdWU3NDkzMDU2MjI=",
    "number": 20062,
    "title": "Installation issue: phist",
    "user": {
        "login": "scottwittenburg",
        "id": 6527504,
        "node_id": "MDQ6VXNlcjY1Mjc1MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6527504?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scottwittenburg",
        "html_url": "https://github.com/scottwittenburg",
        "followers_url": "https://api.github.com/users/scottwittenburg/followers",
        "following_url": "https://api.github.com/users/scottwittenburg/following{/other_user}",
        "gists_url": "https://api.github.com/users/scottwittenburg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scottwittenburg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scottwittenburg/subscriptions",
        "organizations_url": "https://api.github.com/users/scottwittenburg/orgs",
        "repos_url": "https://api.github.com/users/scottwittenburg/repos",
        "events_url": "https://api.github.com/users/scottwittenburg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scottwittenburg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2020-11-24T03:18:33Z",
    "updated_at": "2020-11-24T15:07:35Z",
    "closed_at": "2020-11-24T15:07:35Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "It seems `phist` may need `sbang` patching for its build process, as it uses a python script configured by cmake (`fortran_bindings/cfwrapper.py.in`) where the python interpreter generated into the shebang lives in the spack install tree, which may be quite deep, depending on the installation root and any padding.  A recent `phist` build failed with the following error:\r\n\r\n```\r\n[ 23%] Generating phist_kernels.F90, phist_jada.F90, phist_tools.F90, phist_tools_s.F90, phist_tools_d.F90, phist_tools_c.F90, phist_tools_z.F90, phist_kernels_s.F90, phist_kernels_d.F90, phist_kernels_c.F90, phist_kernels_z.F90, phist_core_s.F90, phist_core_d.F90, phist_core_c.F90, phist_core_z.F90, phist_krylov_s.F90, phist_krylov_d.F90, phist_krylov_c.F90, phist_krylov_z.F90, phist_jada_s.F90, phist_jada_d.F90, phist_jada_c.F90, phist_jada_z.F90, phist_precon_s.F90, phist_precon_d.F90, phist_precon_c.F90, phist_precon_z.F90\r\ncd /tmp/root/spack-stage/spack-stage-phist-1.9.3-qw6xyhd7kcq25y5a6pcsgozkrvdu3rwp/spack-build-qw6xyhd/fortran_bindings && ./cfwrapper.py\r\n./cfwrapper.py: 39: ./cfwrapper.py:  Generates the *.F files from the C header files of phist.\r\n    Command line:         python3 cfwrapper.py\r\n    : not found\r\n./cfwrapper.py: 41: ./cfwrapper.py: import: not found\r\n./cfwrapper.py: 42: ./cfwrapper.py: import: not found\r\n./cfwrapper.py: 43: ./cfwrapper.py: import: not found\r\n./cfwrapper.py: 44: ./cfwrapper.py: import: not found\r\n./cfwrapper.py: 45: ./cfwrapper.py: import: not found\r\n./cfwrapper.py: 46: ./cfwrapper.py: import: not found\r\n./cfwrapper.py: 47: ./cfwrapper.py: from: not found\r\n./cfwrapper.py: 49: ./cfwrapper.py: from: not found\r\n./cfwrapper.py: 51: ./cfwrapper.py: Syntax error: \"(\" unexpected\r\nfortran_bindings/CMakeFiles/phist_fort.dir/build.make:109: recipe for target 'fortran_bindings/phist_kernels.F90' failed\r\nmake[2]: *** [fortran_bindings/phist_kernels.F90] Error 2\r\nmake[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-phist-1.9.3-qw6xyhd7kcq25y5a6pcsgozkrvdu3rwp/spack-build-qw6xyhd'\r\nCMakeFiles/Makefile2:3055: recipe for target 'fortran_bindings/CMakeFiles/phist_fort.dir/all' failed\r\nmake[1]: *** [fortran_bindings/CMakeFiles/phist_fort.dir/all] Error 2\r\nmake[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-phist-1.9.3-qw6xyhd7kcq25y5a6pcsgozkrvdu3rwp/spack-build-qw6xyhd'\r\nMakefile:184: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n```\r\n\r\nInvestigation showed that the shebang line generated into the `cfwrapper.py` file was longer than the max acceptable 127 characters, and when I simply added the `sbang` line before it, the problem went away.\r\n\r\n### Information on your system\r\n\r\nThis occurred in a gitlab CI automated build of the `phist` package.  The attached spec.yaml file indicates the version, compiler, architecture, OS, etc, but to summarize, it was:\r\n\r\n```\r\nphist@1.9.3%gcc@7.5.0 arch=linux-ubuntu18.04-x86_64\r\n```\r\n\r\nThis is happening with spack `develop` as of today ([c468d6bed2](https://github.com/spack/spack/commit/c468d6bed2f862e4221c0bd500f600bc29ab6092)).\r\n\r\n### Additional information\r\n\r\nBelow is the spack build log:\r\n\r\n[spack-build-out.txt](https://github.com/spack/spack/files/5587183/spack-build-out.txt)\r\n\r\nFind attached below the spack environment:\r\n\r\n[spack.yaml.txt](https://github.com/spack/spack/files/5587190/spack.yaml.txt)\r\n\r\nThis is the concrete phist spec serialized as yaml:\r\n\r\n[phist.yaml.txt](https://github.com/spack/spack/files/5587191/phist.yaml.txt)\r\n",
    "performed_via_github_app": null
}