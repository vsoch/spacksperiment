{
    "url": "https://api.github.com/repos/spack/spack/issues/12481",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12481/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12481/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12481/events",
    "html_url": "https://github.com/spack/spack/issues/12481",
    "id": 482758524,
    "node_id": "MDU6SXNzdWU0ODI3NTg1MjQ=",
    "number": 12481,
    "title": "Installation issue: root+x build does not find fontconfig headers",
    "user": {
        "login": "HadrienG2",
        "id": 1305080,
        "node_id": "MDQ6VXNlcjEzMDUwODA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1305080?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HadrienG2",
        "html_url": "https://github.com/HadrienG2",
        "followers_url": "https://api.github.com/users/HadrienG2/followers",
        "following_url": "https://api.github.com/users/HadrienG2/following{/other_user}",
        "gists_url": "https://api.github.com/users/HadrienG2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/HadrienG2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/HadrienG2/subscriptions",
        "organizations_url": "https://api.github.com/users/HadrienG2/orgs",
        "repos_url": "https://api.github.com/users/HadrienG2/repos",
        "events_url": "https://api.github.com/users/HadrienG2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/HadrienG2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 1281134171,
            "node_id": "MDU6TGFiZWwxMjgxMTM0MTcx",
            "url": "https://api.github.com/repos/spack/spack/labels/hep",
            "name": "hep",
            "color": "bfdadc",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2019-08-20T09:49:14Z",
    "updated_at": "2020-01-23T17:42:26Z",
    "closed_at": "2020-01-23T17:42:26Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "# Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install root@6.16.00 cxxstd=17 -davix -examples +gdml -minuit +opengl +root7 -rootfit +sqlite +ssl +tbb +threads -tiff -tmva -unuran +vdt +x -xml ^ mesa -llvm\r\n...\r\n==> Installing root\r\n==> Searching for binary cache of root\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for root found: installing from source\r\n==> Fetching https://root.cern/download/root_v6.16.00.source.tar.gz\r\n######################################################################################################################################################################################################################################################### 100.0%\r\n==> Staging archive: /opt/spack/var/spack/stage/root-6.16.00-yutbhaeokr5zahqs2rfbzokzwpcfl7nt/root_v6.16.00.source.tar.gz\r\n==> Created stage in /opt/spack/var/spack/stage/root-6.16.00-yutbhaeokr5zahqs2rfbzokzwpcfl7nt\r\n==> Applied patch /opt/spack/var/spack/repos/builtin/packages/root/format-stringbuf-size.patch\r\n==> Applied patch /opt/spack/var/spack/repos/builtin/packages/root/find-mysql.patch\r\n==> Applied patch /opt/spack/var/spack/repos/builtin/packages/root/root7-webgui.patch\r\n==> Building root [CMakePackage]\r\n==> Executing phase: 'cmake'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n\r\n3 errors found in build log:\r\n     18142    make[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-Czff34/spack-build'\r\n     18143    make -f graf2d/gpad/CMakeFiles/Gpad.dir/build.make graf2d/gpad/CMakeFiles/Gpad.dir/build\r\n     18144    make[2]: Entering directory '/tmp/root/spack-stage/spack-stage-Czff34/spack-build'\r\n     18145    [ 90%] Building CXX object graf2d/gpad/CMakeFiles/Gpad.dir/G__Gpad.cxx.o\r\n     18146    cd /tmp/root/spack-stage/spack-stage-Czff34/spack-build/graf2d/gpad && /opt/spack/lib/spack/env/gcc/g++   -I/tmp/root/spack-stage/spack-stage-Czff34/spack-build/include  -Wno-implicit-fallthrough -Wno-noexcept-type -pipe -m64  -Wshadow -Wall -W -Woverloaded-virtual -fsigned-char -pthread -std=c++1z -O\r\n              3 -g -DNDEBUG -fPIC   -o CMakeFiles/Gpad.dir/G__Gpad.cxx.o -c /tmp/root/spack-stage/spack-stage-Czff34/spack-build/graf2d/gpad/G__Gpad.cxx\r\n     18147    In file included from /opt/spack/var/spack/stage/root-6.16.00-yutbhaeokr5zahqs2rfbzokzwpcfl7nt/spack-src/graf2d/x11ttf/src/TGX11TTF.cxx:48:\r\n  >> 18148    /opt/spack/opt/spack/linux-opensuse_tumbleweed20190814-x86_64/gcc-9.1.1/libxft-2.3.2-tqnhi32egmnt6ynjcmlgnqmdeylvljac/include/X11/Xft/Xft.h:41:10: fatal error: fontconfig/fontconfig.h: No such file or directory\r\n     18149       41 | #include <fontconfig/fontconfig.h>\r\n     18150          |          ^~~~~~~~~~~~~~~~~~~~~~~~~\r\n     18151    compilation terminated.\r\n  >> 18152    make[2]: *** [graf2d/x11ttf/CMakeFiles/GX11TTF.dir/build.make:95: graf2d/x11ttf/CMakeFiles/GX11TTF.dir/src/TGX11TTF.cxx.o] Error 1\r\n     18153    make[2]: *** Waiting for unfinished jobs....\r\n     18154    [ 90%] Building CXX object graf2d/postscript/CMakeFiles/Postscript.dir/src/TSVG.cxx.o\r\n     18155    cd /tmp/root/spack-stage/spack-stage-Czff34/spack-build/graf2d/postscript && /opt/spack/lib/spack/env/gcc/g++   -I/tmp/root/spack-stage/spack-stage-Czff34/spack-build/include -isystem /opt/spack/opt/spack/linux-opensuse_tumbleweed20190814-x86_64/gcc-9.1.1/zlib-1.2.11-x2tjr22sb22d5ojjyd5veya2np3f6nu4/i\r\n              nclude  -Wno-implicit-fallthrough -Wno-noexcept-type -pipe -m64  -Wshadow -Wall -W -Woverloaded-virtual -fsigned-char -pthread -std=c++1z -O3 -g -DNDEBUG -fPIC   -o CMakeFiles/Postscript.dir/src/TSVG.cxx.o -c /opt/spack/var/spack/stage/root-6.16.00-yutbhaeokr5zahqs2rfbzokzwpcfl7nt/spack-src/graf2d/pos\r\n              tscript/src/TSVG.cxx\r\n     18156    [ 90%] Linking CXX shared library ../../lib/libROOTFitPanelv7.so\r\n     18157    cd /tmp/root/spack-stage/spack-stage-Czff34/spack-build/gui/fitpanelv7 && /opt/spack/opt/spack/linux-opensuse_tumbleweed20190814-x86_64/gcc-9.1.1/cmake-3.15.1-s4mgjta5wolsfn6ujx47565gobmsfqyf/bin/cmake -E cmake_link_script CMakeFiles/ROOTFitPanelv7.dir/link.txt --verbose=1\r\n     18158    /opt/spack/lib/spack/env/gcc/g++ -fPIC  -Wno-implicit-fallthrough -Wno-noexcept-type -pipe -m64  -Wshadow -Wall -W -Woverloaded-virtual -fsigned-char -pthread -std=c++1z -O3 -g -DNDEBUG  -Wl,--no-undefined -Wl,--hash-style=\"both\" -shared -Wl,-soname,libROOTFitPanelv7.so.6.16 -o ../../lib/libROOTFitPan\r\n              elv7.so.6.16.00 CMakeFiles/ROOTFitPanelv7.dir/G__ROOTFitPanelv7.cxx.o CMakeFiles/ROOTFitPanelv7.dir/src/RFitPanel.cxx.o  -L/opt/spack/opt/spack/linux-opensuse_tumbleweed20190814-x86_64/gcc-9.1.1/intel-tbb-2019.4-fvjrjtlq7pahgkb2ncyioxpm4q34rst4/lib -Wl,-rpath,/tmp/root/spack-stage/spack-stage-Czff34/s\r\n              pack-build/lib:/opt/spack/opt/spack/linux-opensuse_tumbleweed20190814-x86_64/gcc-9.1.1/intel-tbb-2019.4-fvjrjtlq7pahgkb2ncyioxpm4q34rst4/lib::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: ../../lib/libROOTWebDisplay.so.6.16.00 ../../lib/libROOTGpadv7.so.6.16.00 ../../lib/libROOTHistD\r\n              raw.so.6.16.00 ../../lib/libRHTTP.so.6.16.00 ../../lib/libROOTGraphicsPrimitives.so.6.16.00 ../../lib/libHist.so.6.16.00 ../../lib/libRIO.so.6.16.00 ../../lib/libMatrix.so.6.16.00 ../../lib/libMathCore.so.6.16.00 ../../lib/libImt.so.6.16.00 ../../lib/libThread.so.6.16.00 ../../lib/libCore.so.6.16.00 -\r\n              ltbb -lpthread\r\n\r\n     ...\r\n\r\n     18175    In file included from /tmp/root/spack-stage/spack-stage-Czff34/spack-build/include/TSliderBox.h:16,\r\n     18176                     from /tmp/root/spack-stage/spack-stage-Czff34/spack-build/graf2d/gpad/G__Gpad.cxx:56:\r\n     18177    /tmp/root/spack-stage/spack-stage-Czff34/spack-build/include/TWbox.h:30:4: note: because 'TWbox' has user-provided 'TWbox::TWbox(const TWbox&)'\r\n     18178       30 |    TWbox(const TWbox &wbox);\r\n     18179          |    ^~~~~\r\n     18180    make[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-Czff34/spack-build'\r\n  >> 18181    make[1]: *** [CMakeFiles/Makefile2:21274: graf2d/x11ttf/CMakeFiles/GX11TTF.dir/all] Error 2\r\n     18182    make[1]: *** Waiting for unfinished jobs....\r\n     18183    [ 90%] Building CXX object graf2d/gpad/CMakeFiles/Gpad.dir/src/TAttCanvas.cxx.o\r\n     18184    cd /tmp/root/spack-stage/spack-stage-Czff34/spack-build/gui/fitpanelv7 && /opt/spack/opt/spack/linux-opensuse_tumbleweed20190814-x86_64/gcc-9.1.1/cmake-3.15.1-s4mgjta5wolsfn6ujx47565gobmsfqyf/bin/cmake -E cmake_symlink_library ../../lib/libROOTFitPanelv7.so.6.16.00 ../../lib/libROOTFitPanelv7.so.6.16 \r\n              ../../lib/libROOTFitPanelv7.so\r\n     18185    cd /tmp/root/spack-stage/spack-stage-Czff34/spack-build/graf2d/gpad && /opt/spack/lib/spack/env/gcc/g++   -I/tmp/root/spack-stage/spack-stage-Czff34/spack-build/include  -Wno-implicit-fallthrough -Wno-noexcept-type -pipe -m64  -Wshadow -Wall -W -Woverloaded-virtual -fsigned-char -pthread -std=c++1z -O\r\n              3 -g -DNDEBUG -fPIC   -o CMakeFiles/Gpad.dir/src/TAttCanvas.cxx.o -c /opt/spack/var/spack/stage/root-6.16.00-yutbhaeokr5zahqs2rfbzokzwpcfl7nt/spack-src/graf2d/gpad/src/TAttCanvas.cxx\r\n     18186    [ 90%] Building CXX object graf2d/gpad/CMakeFiles/Gpad.dir/src/TButton.cxx.o\r\n     18187    cd /tmp/root/spack-stage/spack-stage-Czff34/spack-build/graf2d/gpad && /opt/spack/lib/spack/env/gcc/g++   -I/tmp/root/spack-stage/spack-stage-Czff34/spack-build/include  -Wno-implicit-fallthrough -Wno-noexcept-type -pipe -m64  -Wshadow -Wall -W -Woverloaded-virtual -fsigned-char -pthread -std=c++1z -O\r\n              3 -g -DNDEBUG -fPIC   -o CMakeFiles/Gpad.dir/src/TButton.cxx.o -c /opt/spack/var/spack/stage/root-6.16.00-yutbhaeokr5zahqs2rfbzokzwpcfl7nt/spack-src/graf2d/gpad/src/TButton.cxx\r\n```\r\n\r\nAs you can see, ROOT uses a libXft header which includes a fontconfig header. Even though `fontconfig` and `libxft` are correctly made part of `root`'s spec and installed before ROOT is built, the fontconfig header is not found during the ROOT build, which suggests an include path problem.\r\n\r\nOther libxft-based applications, such as `xclock`, `xlogo` and `xdm`, build correctly, showcasing the ROOT-specific nature of the problem.\r\n\r\nOne way in which the ROOT package is suspiciously special is that it [disables Spack's built-in include path management](https://github.com/spack/spack/pull/11129) because it [used to interact badly with that of ROOT's CMake-based build system a few months ago](https://github.com/spack/spack/issues/10850), as a result of a header name clash between ROOT and python.\r\n\r\nThe assumption at the time was that spack's include path management should be redundant and unnecessary in CMake-based projects. However, that assumption may be incorrect when a CMake-based project uses an autotools-based library, as transitive dependencies may not be taken care of properly. I suspect that this is the problem here.\r\n\r\nAnd indeed, for the particular root spec above, restoring spack's normal include path behavior by commenting out the line that clears `SPACK_INCLUDE_DIRS` in ROOT's package.py brings the build back without bringing back bug #10850. So it may be the case that this \"temporary workaround\" isn't necessary anymore and should be dropped. Any opinions, @gartung?\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```commandline\r\n$ uname -a \r\nLinux f10384140714 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64 x86_64 x86_64 GNU/Linux\r\n$ cat /etc/os-release \r\nNAME=\"openSUSE Tumbleweed\"\r\n# VERSION=\"20190814\"\r\nID=\"opensuse-tumbleweed\"\r\nID_LIKE=\"opensuse suse\"\r\nVERSION_ID=\"20190814\"\r\nPRETTY_NAME=\"openSUSE Tumbleweed\"\r\nANSI_COLOR=\"0;32\"\r\nCPE_NAME=\"cpe:/o:opensuse:tumbleweed:20190814\"\r\nBUG_REPORT_URL=\"https://bugs.opensuse.org\"\r\nHOME_URL=\"https://www.opensuse.org/\"\r\nLOGO=\"distributor-logo\"\r\n``` ",
    "performed_via_github_app": null
}