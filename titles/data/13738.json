{
    "url": "https://api.github.com/repos/spack/spack/issues/13738",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13738/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13738/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13738/events",
    "html_url": "https://github.com/spack/spack/issues/13738",
    "id": 523037864,
    "node_id": "MDU6SXNzdWU1MjMwMzc4NjQ=",
    "number": 13738,
    "title": "Installation issue: py-setuptools",
    "user": {
        "login": "LDAmorim",
        "id": 15057096,
        "node_id": "MDQ6VXNlcjE1MDU3MDk2",
        "avatar_url": "https://avatars.githubusercontent.com/u/15057096?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/LDAmorim",
        "html_url": "https://github.com/LDAmorim",
        "followers_url": "https://api.github.com/users/LDAmorim/followers",
        "following_url": "https://api.github.com/users/LDAmorim/following{/other_user}",
        "gists_url": "https://api.github.com/users/LDAmorim/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/LDAmorim/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/LDAmorim/subscriptions",
        "organizations_url": "https://api.github.com/users/LDAmorim/orgs",
        "repos_url": "https://api.github.com/users/LDAmorim/repos",
        "events_url": "https://api.github.com/users/LDAmorim/events{/privacy}",
        "received_events_url": "https://api.github.com/users/LDAmorim/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 455855856,
            "node_id": "MDU6TGFiZWw0NTU4NTU4NTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/external-packages",
            "name": "external-packages",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 446619758,
            "node_id": "MDU6TGFiZWw0NDY2MTk3NTg=",
            "url": "https://api.github.com/repos/spack/spack/labels/python",
            "name": "python",
            "color": "c2e0c6",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2019-11-14T18:45:22Z",
    "updated_at": "2020-04-21T16:39:38Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Hi,\r\nI didn't find any of the `spack` repo \"permission\" open or closed issues that seemed related to the one I am getting. But I am new to using and understanding spack, so sorry in advance if this is a duplicate (or easy-fix which I am not familiar with).\r\n\r\n-----------------------------------------------------------------------------------------\r\n*Summary version of the issue*\r\nPermission denied error using MacOS built-in python to install packages with spack\r\n\r\nUsing my built-in python in MacOS raises permissions issues (see error message below) that I think could be fixed by setting a user directory instead of system one to install.\r\nBut I don't know how to do that.\r\nDo you have any suggestions?\r\n```console\r\n==> [2019-12-02-13:57:50.686524] Installing py-setuptools\r\n==> [2019-12-02-13:57:50.686559] Searching for binary cache of py-setuptools\r\n==> [2019-12-02-13:57:50.686714] Warning: No Spack mirrors are currently configured\r\n==> [2019-12-02-13:57:50.687290] No binary for py-setuptools found: installing from source\r\n==> [2019-12-02-13:57:50.687374] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> [2019-12-02-13:57:50.687552] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> [2019-12-02-13:57:50.698058] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> [2019-12-02-13:57:51.240050] [TOOLCHAIN] MATCH Clang\r\n==> [2019-12-02-13:57:51.240570] [TOOLCHAIN] MATCH Gcc\r\n==> [2019-12-02-13:57:51.240898] [TOOLCHAINS] {'Gcc', 'Clang'}\r\n==> [2019-12-02-13:57:51.241306] Warning: microarchitecture specific optimizations are not supported yet on mixed compiler toolchains [check clang@11.0.0-apple for further details]\r\n==> [2019-12-02-13:57:51.245121] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> [2019-12-02-13:57:51.245867] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> [2019-12-02-13:57:51.258519] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> [2019-12-02-13:57:51.263593] '/usr/bin/clang' '-v' '/var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/spack-implicit-link-infos5a21kac/main.c' '-o' '/var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/spack-implicit-link-infos5a21kac/output'\r\n==> [2019-12-02-13:57:51.326761] parsing implicit link info\r\n==> [2019-12-02-13:57:51.327512] linker line:  \"/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld\" -demangle -lto_library /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/libLTO.dylib -no_deduplicate -dynamic -arch x86_64 -macosx_version_min 10.15.0 -syslibroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk -o /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/spack-implicit-link-infos5a21kac/output /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/main-c472f8.o -lSystem /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/11.0.0/lib/darwin/libclang_rt.osx.a\r\n==> [2019-12-02-13:57:51.328095] found raw link dirs: \r\n==> [2019-12-02-13:57:51.328621] found link dirs: \r\n==> [2019-12-02-13:57:51.358458] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> [2019-12-02-13:57:51.359026] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> [2019-12-02-13:57:51.370593] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> [2019-12-02-13:57:51.371008] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> [2019-12-02-13:57:51.371457] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> [2019-12-02-13:57:51.381614] READ LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> [2019-12-02-13:57:51.382647] '/usr/bin/python3' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\n==> [2019-12-02-13:57:51.437466] '/usr/bin/python3' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\n==> [2019-12-02-13:57:51.486830] A dependency has updated CPATH, this may lead pkg-config to assume that the package is part of the system includes and omit it when invoked with '--cflags'.\r\n==> [2019-12-02-13:57:51.508185] Fetching https://pypi.io/packages/source/s/setuptools/setuptools-41.4.0.zip\r\n==> [2019-12-02-13:57:51.509087] '/usr/bin/curl' '-C' '-' '-o' '/var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/spack-stage-py-setuptools-41.4.0-wf3sirq5x4t7tabwlhjsdpf6go4ipfuo/setuptools-41.4.0.zip.part' '-f' '-D' '-' '-L' 'https://pypi.io/packages/source/s/setuptools/setuptools-41.4.0.zip' '-#'\r\n##################################################################################################################################################################################################### 100.0%##################################################################################################################################################################################################### 100.0%##################################################################################################################################################################################################### 100.0%\r\n==> [2019-12-02-13:57:52.418228] Staging archive: /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/spack-stage-py-setuptools-41.4.0-wf3sirq5x4t7tabwlhjsdpf6go4ipfuo/setuptools-41.4.0.zip\r\n==> [2019-12-02-13:57:52.419447] '/usr/bin/unzip' '-q' '/var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/spack-stage-py-setuptools-41.4.0-wf3sirq5x4t7tabwlhjsdpf6go4ipfuo/setuptools-41.4.0.zip'\r\n==> [2019-12-02-13:57:52.476651] Created stage in /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/spack-stage-py-setuptools-41.4.0-wf3sirq5x4t7tabwlhjsdpf6go4ipfuo\r\n==> [2019-12-02-13:57:52.477470] No patches needed for py-setuptools\r\n==> [2019-12-02-13:57:52.477854] Building py-setuptools [PythonPackage]\r\n==> [2019-12-02-13:57:52.478463] WRITE LOCK: /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/.lock[3210409316178349029:1] [Acquiring]\r\n==> [2019-12-02-13:57:52.479164] WRITE LOCK: /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/.lock[3210409316178349029:1] [Acquired]\r\n==> [2019-12-02-13:57:52.479654] WRITE LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/prefix_lock[6393864775253595132:1] [Acquiring]\r\n==> [2019-12-02-13:57:52.480102] WRITE LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/prefix_lock[6393864775253595132:1] [Acquired]\r\n==> [2019-12-02-13:57:52.483910] Executing phase: 'build'\r\n==> [2019-12-02-13:57:52.969034] Executing phase: 'install'\r\n==> [2019-12-02-13:57:53.369047] WRITE LOCK: /Users/LDianaAmorim/Documents/opt/spack/opt/spack/.spack-db/prefix_lock[6393864775253595132:1] [Released]\r\n==> [2019-12-02-13:57:53.369800] WRITE LOCK: /var/folders/5p/x7ftfty12yndrs3p6ntlk1jc0000gp/T/LDianaAmorim/spack-stage/.lock[3210409316178349029:1] [Released]\r\n==> [2019-12-02-13:57:53.380643] Error: ProcessError: Command exited with status 1:\r\n    '/usr/bin/python3' '-s' 'setup.py' '--no-user-cfg' 'install' '--prefix=/Users/LDianaAmorim/Documents/opt/spack/opt/spack/darwin-catalina-x86_64/clang-11.0.0-apple/py-setuptools-41.4.0-wf3sirq5x4t7tabwlhjsdpf6go4ipfuo' '--single-version-externally-managed' '--root=/'\r\n\r\n1 error found in build log:\r\n     110    ==> [2019-12-02-13:57:52.969968] '/usr/bin/python3' '-s' 'setup.py' '--no-user-cfg' 'install' '--prefix=/Users/LDianaAmorim/Documents/opt/spack/opt/spack/darwin-catalina-x86_64/clang-11.0.0-a\r\n            pple/py-setuptools-41.4.0-wf3sirq5x4t7tabwlhjsdpf6go4ipfuo' '--single-version-externally-managed' '--root=/'\r\n     111    running install\r\n     112    running build\r\n     113    running build_py\r\n     114    running install_lib\r\n     115    copying build/lib/easy_install.py -> /Library/Python/3.7/site-packages\r\n  >> 116    error: could not create '/Library/Python/3.7/site-packages/easy_install.py': Permission denied\r\n```\r\n\r\n-----------------------------------------------------------------------------------------\r\n*Detailed version of the issue*\r\nI upgraded to macOS Catalina that comes with built-in python3 that I wish to use.\r\nMy pip is correlated with python3 since I did `pip3 install --upgrade pip`.\r\nWhen I try to install things via `pip install`, I need to use the option `--user` (as described in  https://github.com/googlesamples/assistant-sdk-python/issues/236, which I think is a better option than doing `sudo` and installing packages as a root).\r\n\r\nAlthough that work-around allows me to install things through `pip` I wish to install some packages (such as mpi4py) that require openmpi/mpich (that require gcc) that I much prefer to (and am able to) install with spack.\r\n\r\nTo use my built-in python, I (inspired by https://github.com/spack/spack/issues/7353) created the file `Documents/opt/spack/etc/spack/packages.yaml` with:\r\n```vi\r\npackages:\r\n    python:\r\n        paths:\r\n            python@3.7.3: /usr\r\n```\r\n\r\nI have also used (and added to my ~/.zprofile):\r\n```bash\r\nexport PYTHONPATH=/Users/LDianaAmorim/Library/Python/3.7/lib/python/site-packages:$PYTHONPATH\r\n```\r\n\r\nWhen I tried to install the python module through spack via \r\n```console\r\n$ spack -d install py-mpi4py ^python@3.7.3 ^openmpi@3.1.4 %gcc@9.2.0\r\n```\r\nI got the error message shown in the summary version of this issue.\r\n\r\nDo you know what I am doing wrong with this installation?\r\nIs there a way for me to specify where `easy_install.py` will be installed and accessed by spack?\r\nOr something equivalent to pip's `--user` option?\r\nDo you recommend that I try to install these packages differently?\r\n\r\nThank you in advance for your help with this,\r\nDiana\r\n\r\n-----------------------------------------------------------------------------------------\r\n\r\n### Platform and user environment\r\n\r\n```commandline\r\n% sw_vers\r\nProductName:\tMac OS X\r\nProductVersion:\t10.15.1\r\nBuildVersion:\t19B88\r\n``` \r\n\r\n### Additional information\r\n\r\n- clang 11.0.0\r\n- spack 0.13.0\r\n- gcc@9.2.0%clang@11.0.0-apple\r\n- openmpi@3.1.4%clang@11.0.0-apple (installed with %gcc)\r\n- python 3.7.3\r\n- python 2.7.16\r\n- ipython 7.9.0\r\n- pip 19.3.1\r\n\r\nI didn't find any `spack-cc-py-mpi4py` files, but I have the `-out` and `-env` that I attach here.\r\n\r\n[spack-build-env.txt](https://github.com/spack/spack/files/3848095/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/3848096/spack-build-out.txt)\r\n\r\n",
    "performed_via_github_app": null
}