{
    "url": "https://api.github.com/repos/spack/spack/issues/14334",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/14334/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/14334/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/14334/events",
    "html_url": "https://github.com/spack/spack/issues/14334",
    "id": 544255884,
    "node_id": "MDU6SXNzdWU1NDQyNTU4ODQ=",
    "number": 14334,
    "title": "inconsistent module behavior in spack environments",
    "user": {
        "login": "glennpj",
        "id": 16138574,
        "node_id": "MDQ6VXNlcjE2MTM4NTc0",
        "avatar_url": "https://avatars.githubusercontent.com/u/16138574?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glennpj",
        "html_url": "https://github.com/glennpj",
        "followers_url": "https://api.github.com/users/glennpj/followers",
        "following_url": "https://api.github.com/users/glennpj/following{/other_user}",
        "gists_url": "https://api.github.com/users/glennpj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/glennpj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/glennpj/subscriptions",
        "organizations_url": "https://api.github.com/users/glennpj/orgs",
        "repos_url": "https://api.github.com/users/glennpj/repos",
        "events_url": "https://api.github.com/users/glennpj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/glennpj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 537065486,
            "node_id": "MDU6TGFiZWw1MzcwNjU0ODY=",
            "url": "https://api.github.com/repos/spack/spack/labels/environments",
            "name": "environments",
            "color": "d4c5f9",
            "default": false,
            "description": null
        },
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-12-31T19:29:47Z",
    "updated_at": "2020-09-08T22:16:19Z",
    "closed_at": "2020-09-08T22:16:19Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "When installing packages into a spack environment, module files are created for all packages, including build only dependencies. However, since build only dependencies are not registered in the environment, the module files for the build only dependencies can not be regenerated with\r\n`spack module refresh tcl`\r\n \r\n This means that those modules could be lost with no way to recover them, ie., with the\r\n`--delete-tree`\r\noption, which is sometimes needed for cleanup. This is an issue if the module files for the dependencies had already been deployed in a stack and then disappear. I currently run \r\n`spack module refresh tcl --delete-tree` prior to updating the Lmod cache to avoid the problem, but it is an easy thing to forget.\r\n \r\nInternally consistent behavior could be achieved by either of the following two mechanisms:\r\n\r\n1. Allow all modules to be rebuilt in an environment\r\n1. Do not create module files for build only dependencies at all\r\n\r\nThe second option is probably the most sensible one as the first option would likely require registration of the dependencies in the environment. Either one avoids the risk of deploying modules, getting them in an Lmod cache, and then having them potentially disappear with no quick way to recover.",
    "performed_via_github_app": null
}