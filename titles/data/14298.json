{
    "url": "https://api.github.com/repos/spack/spack/issues/14298",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/14298/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/14298/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/14298/events",
    "html_url": "https://github.com/spack/spack/issues/14298",
    "id": 542787670,
    "node_id": "MDU6SXNzdWU1NDI3ODc2NzA=",
    "number": 14298,
    "title": "give mixed llvm and gfortran special microarchitecture treatment on x86_64",
    "user": {
        "login": "svenevs",
        "id": 5871461,
        "node_id": "MDQ6VXNlcjU4NzE0NjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5871461?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/svenevs",
        "html_url": "https://github.com/svenevs",
        "followers_url": "https://api.github.com/users/svenevs/followers",
        "following_url": "https://api.github.com/users/svenevs/following{/other_user}",
        "gists_url": "https://api.github.com/users/svenevs/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/svenevs/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/svenevs/subscriptions",
        "organizations_url": "https://api.github.com/users/svenevs/orgs",
        "repos_url": "https://api.github.com/users/svenevs/repos",
        "events_url": "https://api.github.com/users/svenevs/events{/privacy}",
        "received_events_url": "https://api.github.com/users/svenevs/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 654034395,
            "node_id": "MDU6TGFiZWw2NTQwMzQzOTU=",
            "url": "https://api.github.com/repos/spack/spack/labels/clang",
            "name": "clang",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 446615268,
            "node_id": "MDU6TGFiZWw0NDY2MTUyNjg=",
            "url": "https://api.github.com/repos/spack/spack/labels/compilers",
            "name": "compilers",
            "color": "f9d0c4",
            "default": false,
            "description": null
        },
        {
            "id": 73908756,
            "node_id": "MDU6TGFiZWw3MzkwODc1Ng==",
            "url": "https://api.github.com/repos/spack/spack/labels/feature",
            "name": "feature",
            "color": "84b6eb",
            "default": false,
            "description": null
        },
        {
            "id": 1574436554,
            "node_id": "MDU6TGFiZWwxNTc0NDM2NTU0",
            "url": "https://api.github.com/repos/spack/spack/labels/microarchitectures",
            "name": "microarchitectures",
            "color": "011970",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 0,
    "created_at": "2019-12-27T08:01:23Z",
    "updated_at": "2019-12-27T08:06:07Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "> `==> Warning: microarchitecture specific optimizations are not supported yet on mixed compiler toolchains [check clang@3.9.1 for further details]`\r\n\r\nIn tracking down how to circumvent this warning, I believe the order of events was\r\n\r\n- #13250 use `-march -mcpu` when `%clang`, which was deemed incompatible.\r\n- #13913 for x86_64, switch to `-march -mtune`\r\n\r\nResult: as far as I can tell, for linux x86_64, the flags for tuning gcc and clang will be the same, and can \"safely mix these compilers.\"\r\n\r\n### Rationale\r\n\r\n1. Tuned better than not tuned :D\r\n2. `clang` and `gfortran` mixing is pretty common as far as I can tell.\r\n3. Adopting `flang` is not really a valid option at this point.  I can't figure out how to get the version of LLVM I need (exactly 8.0.0, because CUDA) and also get `flang`.\r\n\r\n### Description\r\n\r\nRight now to test things out I just added some conditions to short out since I'm on x86_64 using clang and gfortran (aka this isn't robust):\r\n\r\nhttps://github.com/spack/spack/blob/08898a2ad7c4579ff9b0c08c4e97cde11c0d4601/lib/spack/spack/architecture.py#L199-L204\r\n\r\n```diff\r\n- if spack.compilers.is_mixed_toolchain(compiler): \r\n+ if spack.compilers.is_mixed_toolchain(compiler) and 'clang' not in compiler.cc_names:\r\n```\r\n\r\n1. Life seems OK so far, are there any specific known \"good\" packages to test to verify the fortran compiler is working right?\r\n\r\n2. What exactly, if anything, are we going to support?  Examples:\r\n    - Only support this mix on x86_64 (my vote: yes)?\r\n    - Only support on linux (impartial, questionable if apple compiler will be trouble)?\r\n\r\n3. Should I rely on the flags remaining the same, or deliberately mix things?  At the end of that method:\r\n\r\n    https://github.com/spack/spack/blob/08898a2ad7c4579ff9b0c08c4e97cde11c0d4601/lib/spack/spack/architecture.py#L224-L226\r\n\r\n    If there is a way for me to know \"for cc / cxx\" vs \"for fc\" then we could mix things.  Do we want to introduce a hack to allow a probably common toolchain to be optimized, or is there future intent on \"properly\" supporting mixed toolchains?\r\n\r\nI don't know what the best choice is, happy to PR with direction or close the issue if introducing a hack that relies on this isn't desired (reasonable...).\r\n\r\n",
    "performed_via_github_app": null
}