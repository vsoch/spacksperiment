{
    "url": "https://api.github.com/repos/spack/spack/issues/608",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/608/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/608/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/608/events",
    "html_url": "https://github.com/spack/spack/issues/608",
    "id": 142753422,
    "node_id": "MDU6SXNzdWUxNDI3NTM0MjI=",
    "number": 608,
    "title": "Spack-built SciPy calls Spack compiler wrapper",
    "user": {
        "login": "adamjstewart",
        "id": 12021217,
        "node_id": "MDQ6VXNlcjEyMDIxMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjstewart",
        "html_url": "https://github.com/adamjstewart",
        "followers_url": "https://api.github.com/users/adamjstewart/followers",
        "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
        "repos_url": "https://api.github.com/users/adamjstewart/repos",
        "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 23,
    "created_at": "2016-03-22T19:27:32Z",
    "updated_at": "2016-03-23T17:39:52Z",
    "closed_at": "2016-03-23T07:46:24Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Oh the joys of running Spack in production...\n\nI just had a user report that he was having major problems running Spack-built Python. I took a look at his error message and found that it was trying to call the Spack compiler wrapper instead of the system gcc.\n\nThis problem can be recreated by installing python and py-scipy with a spack-built gcc.\n\nCreate a file containing:\n\n``` python\n#!/usr/bin/env python\n\nfrom scipy import weave\n\nsource = \"\"\"\nint main(void) {\n    return 0;\n}\n\"\"\"\n\nweave.inline(source, compiler='gcc')\n```\n\nWhen run from Spack-built Python, this program produces the error message:\n\n```\nSpack compiler must be run from spack!  Input SPACK_PREFIX was missing!\nSpack compiler must be run from spack!  Input SPACK_PREFIX was missing!\nTraceback (most recent call last):\n  File \"./test.py\", line 11, in <module>\n    weave.inline(source, compiler='gcc')\n  File \"/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/scipy/weave/inline_tools.py\", line 366, in inline\n    **kw)\n  File \"/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/scipy/weave/inline_tools.py\", line 496, in compile_function\n    verbose=verbose, **kw)\n  File \"/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/scipy/weave/ext_tools.py\", line 373, in compile\n    verbose=verbose, **kw)\n  File \"/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/scipy/weave/build_tools.py\", line 279, in build_extension\n    setup(name=module_name, ext_modules=[ext],verbose=verb)\n  File \"/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/numpy/distutils/core.py\", line 169, in setup\n    return old_setup(**new_attr)\n  File \"/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/distutils/core.py\", line 166, in setup\n    raise SystemExit, \"error: \" + str(msg)\nscipy.weave.build_tools.CompileError: error: Command \"/blues/gpfs/home/software/spack/lib/spack/env/gcc/g++ -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/scipy/weave -I/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/scipy/weave/scxx -I/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/lib/python2.7/site-packages/numpy/core/include -I/soft/spack/opt/spack/linux-x86_64/gcc-5.3.0/python-2.7.11-mbvirl2oruaqyp7kpdzz7lfxl6ciggif/include/python2.7 -c /home/ajstewart/.cache/scipy/python27_compiled/sc_ee5a589152be75eefeb2b60fb2235ec52.cpp -o /tmp/scipy-ajstewart-svKPMx/python27_intermediate/compiler_8dcbb390c5f7d775e8e51e82751bb966/home/ajstewart/.cache/scipy/python27_compiled/sc_ee5a589152be75eefeb2b60fb2235ec52.o\" failed with exit status 1\n```\n\nYou'll notice that the last line is directly calling `lib/spack/env/gcc/g++`, causing the message `Spack compiler must be run from spack!  Input SPACK_PREFIX was missing!`. Note that gcc-5.3.0 and lib/spack/env/gcc are not in my PATH. The only thing built by Spack in my path is Python.\n\nI'm currently trying to reinstall gcc, python, and py-scipy from scratch to see if this problem has been resolved since I first installed these packages. Can someone else try to recreate this in the meantime?\n",
    "performed_via_github_app": null
}