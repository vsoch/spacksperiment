{
    "url": "https://api.github.com/repos/spack/spack/issues/2309",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2309/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2309/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2309/events",
    "html_url": "https://github.com/spack/spack/issues/2309",
    "id": 188756878,
    "node_id": "MDU6SXNzdWUxODg3NTY4Nzg=",
    "number": 2309,
    "title": "fetching from list_url no longer works when installing",
    "user": {
        "login": "glennpj",
        "id": 16138574,
        "node_id": "MDQ6VXNlcjE2MTM4NTc0",
        "avatar_url": "https://avatars.githubusercontent.com/u/16138574?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glennpj",
        "html_url": "https://github.com/glennpj",
        "followers_url": "https://api.github.com/users/glennpj/followers",
        "following_url": "https://api.github.com/users/glennpj/following{/other_user}",
        "gists_url": "https://api.github.com/users/glennpj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/glennpj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/glennpj/subscriptions",
        "organizations_url": "https://api.github.com/users/glennpj/orgs",
        "repos_url": "https://api.github.com/users/glennpj/repos",
        "events_url": "https://api.github.com/users/glennpj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/glennpj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446643530,
            "node_id": "MDU6TGFiZWw0NDY2NDM1MzA=",
            "url": "https://api.github.com/repos/spack/spack/labels/fetching",
            "name": "fetching",
            "color": "fbca04",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 11,
    "created_at": "2016-11-11T13:09:36Z",
    "updated_at": "2017-01-28T03:57:42Z",
    "closed_at": "2017-01-28T03:57:42Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Recent updates have broken the ability to fetch from list_url when installing. This seems to point to PR #2263 and #1822. Since the r- packages depend on list_url to fetch versions other than the latest in CRAN this has likely broken some of the spack r- packages. Here is an example with pango, which has a URL scheme that used to work with list_url.\r\n\r\n```\r\nclass Pango(Package):                                                                                               \r\n 29     \"\"\"Pango is a library for laying out and rendering of text, with                                                \r\n 30        an emphasis on internationalization. It can be used anywhere                                                 \r\n 31        that text layout is needed, though most of the work on Pango so                                              \r\n 32        far has been done in the context of the GTK+ widget toolkit.\"\"\"                                              \r\n 33     homepage = \"http://www.pango.org\"                                                                               \r\n 34     url      = \"http://ftp.gnome.org/pub/gnome/sources/pango/1.36/pango-1.36.8.tar.xz\"                              \r\n 35     list_url = \"http://ftp.gnome.org/pub/gnome/sources/pango/\"                                                      \r\n 36     list_depth = 2                                                                                                  \r\n 37                                                                                                                     \r\n 38     version('1.36.8', '217a9a753006275215fa9fa127760ece')                                                           \r\n 39     version('1.40.1', '6fc88c6529890d6c8e03074d57a3eceb')\r\n```\r\n\r\n```\r\nspack versions pango\r\n==> Safe versions (already checksummed):\r\n  1.40.1  1.36.8\r\n==> Remote versions (not yet checksummed):\r\n  1.40.3  1.38.1  1.37.3  1.36.7  1.36.3  1.35.3  1.34.0  1.32.6  1.32.2  1.31.1  1.29.5\r\n  1.40.2  1.38.0  1.37.2  1.36.6  1.36.2  1.35.2  1.33.9  1.32.5  1.32.1  1.31.0  1.29.4\r\n  1.40.0  1.37.5  1.37.1  1.36.5  1.36.1  1.35.0  1.33.8  1.32.4  1.32.0  1.30.1  1.29.3\r\n  1.39.0  1.37.4  1.37.0  1.36.4  1.36.0  1.34.1  1.33.7  1.32.3  1.31.2  1.30.0  1.29.1\r\n```\r\n```\r\nspack stage pango\r\n==> Fetching http://ftp.gnome.org/pub/gnome/sources/pango/1.36/pango-1.40.1.tar.xz\r\n\r\ncurl: (22) The requested URL returned error: 404 Not Found\r\n==> Fetching from http://ftp.gnome.org/pub/gnome/sources/pango/1.36/pango-1.40.1.tar.xz failed.\r\n==> Error: All fetchers failed for pango-1.40.1-aejizzb5ofh63jl5qvygyy6ovvcostw4\r\n```\r\nThat used to work by going to list_url. Backing out PR #2263 gets fetching to work again to the stage but produces an error and does not put the tarball in the cache. That leads to the install failing.\r\n```\r\nspack stage pango\r\n==> Fetching http://ftp.gnome.org/pub/gnome/sources/pango/1.36/pango-1.40.1.tar.xz\r\n\r\ncurl: (22) The requested URL returned error: 404 Not Found\r\n==> Fetching from http://ftp.gnome.org/pub/gnome/sources/pango/1.36/pango-1.40.1.tar.xz failed.\r\n==> Fetching http://ftp.gnome.org/pub/gnome/sources/pango/1.40/pango-1.40.1.tar.xz\r\n######################################################################## 100.0%\r\n==> Error: Attempt to check URLFetchStrategy with no digest.\r\n```\r\nHowever, a second attempt at the install will then put the previously downloaded tarball into the cache and then the installation will proceed.\r\n\r\n@tgamblin Can you take a look at this? ",
    "performed_via_github_app": null
}