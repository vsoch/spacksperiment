{
    "url": "https://api.github.com/repos/spack/spack/issues/7384",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7384/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7384/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7384/events",
    "html_url": "https://github.com/spack/spack/issues/7384",
    "id": 301952418,
    "node_id": "MDU6SXNzdWUzMDE5NTI0MTg=",
    "number": 7384,
    "title": "\"spack install silo ^hdf5~mpi~shared\" fails due to missing -ldl flag",
    "user": {
        "login": "pozulp",
        "id": 2090931,
        "node_id": "MDQ6VXNlcjIwOTA5MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2090931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pozulp",
        "html_url": "https://github.com/pozulp",
        "followers_url": "https://api.github.com/users/pozulp/followers",
        "following_url": "https://api.github.com/users/pozulp/following{/other_user}",
        "gists_url": "https://api.github.com/users/pozulp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pozulp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pozulp/subscriptions",
        "organizations_url": "https://api.github.com/users/pozulp/orgs",
        "repos_url": "https://api.github.com/users/pozulp/repos",
        "events_url": "https://api.github.com/users/pozulp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pozulp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2018-03-03T01:09:29Z",
    "updated_at": "2018-03-05T12:28:37Z",
    "closed_at": "2018-03-05T12:28:37Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "According to [a response on the hdf5 mailing list](https://lists.hdfgroup.org/pipermail/hdf-forum_lists.hdfgroup.org/2013-October/007240.html), hdf5 >= 1.8.11 requires libdl. Attempting\r\n\r\n```console\r\n$ spack install silo ^hdf5~mpi~shared\r\n``` \r\n(~mpi added to reduce build time and is not required to reproduce, but ~shared _is_ required to reproduce) causes silo to fail during configure with undefined reference to 'dlsym', 'dlopen', etc. during a conftest where it looks for H5open in the supplied libhdf5.a.\r\n\r\n### Expected Result\r\nSuccessful silo install\r\n### Actual Result\r\n\r\n```console\r\n$ git clone https://github.com/spack/spack.git\r\n$ ./spack/bin/spack install silo ^hdf5~mpi~shared\r\n==> Installing zlib\r\n==> Using cached archive: /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/cache/zlib/zlib-1.2.11.tar.gz\r\n==> Staging archive: /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/stage/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur/zlib-1.2.11.tar.gz\r\n==> Created stage in /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/stage/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur\r\n==> No patches needed for zlib\r\n==> Building zlib [Package]\r\n==> Executing phase: 'install'\r\n==> Successfully installed zlib\r\n  Fetch: 0.09s.  Build: 16.54s.  Total: 16.64s.\r\n[+] /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur\r\n==> Installing hdf5\r\n==> Fetching https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.1/src/hdf5-1.10.1.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/stage/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/hdf5-1.10.1.tar.gz\r\n==> Created stage in /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/stage/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn\r\n==> No patches needed for hdf5\r\n==> Building hdf5 [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed hdf5\r\n  Fetch: 14.94s.  Build: 2m 22.22s.  Total: 2m 37.16s.\r\n[+] /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn\r\n==> Installing silo\r\n==> Fetching https://wci.llnl.gov/content/assets/docs/simulation/computer-codes/silo/silo-4.10.2/silo-4.10.2.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/stage/silo-4.10.2-nctk3nlpkb3hxkxdnrbdspsgllqtr3ie/silo-4.10.2.tar.gz\r\n==> Created stage in /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/var/spack/stage/silo-4.10.2-nctk3nlpkb3hxkxdnrbdspsgllqtr3ie\r\n==> Applied patch remove-mpiposix.patch\r\n==> Building silo [Package]\r\n==> Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    './configure' '--prefix=/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/silo-4.10.2-nctk3nlpkb3hxkxdnrbdspsgllqtr3ie' '--with-hdf5=/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/include,/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/lib' '--with-zlib=/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur/include,/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur/lib' '--enable-install-lite-headers' '--enable-fortran' '--disable-silex' '--enable-shared' 'CFLAGS=-fPIC' 'CXXFLAGS=-fPIC' 'FCFLAGS=-fPIC'\r\n\r\n1 error found in build log:\r\n     191    checking for H5open... no\r\n     192    configure: checking if lack of zlib caused tests for hdf5 to fail...\r\n     193    checking hdf5.h usability... yes\r\n     194    checking hdf5.h presence... yes\r\n     195    checking for hdf5.h... yes\r\n     196    checking for H5open in -lhdf5... no\r\n  >> 197    configure: error:\r\n     198    You have made an explicit request for hdf5 with the --with-hdf option\r\n     199    and ./configure is unable to find hdf5 and its supporting libs, if any.\r\n     200    Please see INSTALL_FAQ for possible causes.\r\n```\r\n\r\nHere is the failed conftest, copied from config.log\r\n```console\r\nconfigure:28869: checking for H5open\r\nconfigure:28933: /usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/lib/spack/env/gcc/gcc -o conftest -fPIC -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -Wdeclaration-after-statement -I/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/include  -I/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur/include -L/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/lib  -L/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/zlib-1.2.11-3r4cfkmx3wwfqeof4bc244yduu2mz4ur/lib conftest.c -lhdf5 -lz  -lz -lm >&5\r\n/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/lib/libhdf5.a(H5PL.o): In function `H5PL_term_package':\r\nH5PL.c:(.text+0xb2): undefined reference to `dlclose'\r\n/usr/workspace/wsrzc/pozulp1/sp/reprospack/spack/opt/spack/linux-rhel7-x86_64/gcc-4.9.3/hdf5-1.10.1-pa7j66e6mfu6qfkgfrus7zuppvirktnn/lib/libhdf5.a(H5PL.o): In function `H5PL_load':\r\nH5PL.c:(.text+0x5b2): undefined reference to `dlsym'\r\nH5PL.c:(.text+0x797): undefined reference to `dlopen'\r\nH5PL.c:(.text+0x7b2): undefined reference to `dlsym'\r\nH5PL.c:(.text+0x7e9): undefined reference to `dlclose'\r\nH5PL.c:(.text+0x8f1): undefined reference to `dlerror'\r\nH5PL.c:(.text+0xb73): undefined reference to `dlclose'\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ git clone https://github.com/spack/spack.git\r\n$ ./spack/bin/spack install silo ^hdf5~mpi~shared\r\n```\r\n\r\n### Information on your system\r\nLLNL toss3 system **rzgenie**, empty ~/.spack directory",
    "performed_via_github_app": null
}