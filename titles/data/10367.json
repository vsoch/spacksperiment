{
    "url": "https://api.github.com/repos/spack/spack/issues/10367",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10367/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10367/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10367/events",
    "html_url": "https://github.com/spack/spack/issues/10367",
    "id": 399884494,
    "node_id": "MDU6SXNzdWUzOTk4ODQ0OTQ=",
    "number": 10367,
    "title": "Lua load all dependencies",
    "user": {
        "login": "mforde84",
        "id": 20908622,
        "node_id": "MDQ6VXNlcjIwOTA4NjIy",
        "avatar_url": "https://avatars.githubusercontent.com/u/20908622?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mforde84",
        "html_url": "https://github.com/mforde84",
        "followers_url": "https://api.github.com/users/mforde84/followers",
        "following_url": "https://api.github.com/users/mforde84/following{/other_user}",
        "gists_url": "https://api.github.com/users/mforde84/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mforde84/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mforde84/subscriptions",
        "organizations_url": "https://api.github.com/users/mforde84/orgs",
        "repos_url": "https://api.github.com/users/mforde84/repos",
        "events_url": "https://api.github.com/users/mforde84/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mforde84/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908756,
            "node_id": "MDU6TGFiZWw3MzkwODc1Ng==",
            "url": "https://api.github.com/repos/spack/spack/labels/feature",
            "name": "feature",
            "color": "84b6eb",
            "default": false,
            "description": null
        },
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 9,
    "created_at": "2019-01-16T16:15:28Z",
    "updated_at": "2019-01-17T19:44:17Z",
    "closed_at": "2019-01-17T19:44:17Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I have some previous experience manually generating lua files for a lmod library. Generally speaking, we would explicitly load any shared libraries and headers used for compilation upon a package load. It appears that the module files spack generates doesn't do this, so it's possible to load a package dependent on one version of say ncurses and then load a separate version of ncurses to the headers and library paths.  Eg.,\r\n\r\n```\r\n[root@gosset:~]# module list\r\n\r\nCurrently Loaded Modules:\r\n  1) gcc/7.4.0   2) samtools/1.9\r\n\r\n\r\n\r\n[root@gosset:~]# ldd `which samtools`\r\n        linux-vdso.so.1 =>  (0x00007ffdb8aac000)\r\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00002acdb2858000)\r\n        libz.so.1 => /mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-7.4.0/zlib-1.2.11-25pskdmfdd52x3ewomarucg3eu6mswte/lib/libz.so.1 (0x00002acdb2a74000)\r\n        libm.so.6 => /lib64/libm.so.6 (0x00002acdb2c8c000)\r\n        libbz2.so.1.0 => /mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-7.4.0/bzip2-1.0.6-y4qayy3nlojfq3ctw6wbfeorrq7xdk26/lib/libbz2.so.1.0 (0x00002acdb2f8e000)\r\n        liblzma.so.5 => /mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-7.4.0/xz-5.2.4-vewnijktsjco3mbf2ycv6irlvlur46uq/lib/liblzma.so.5 (0x00002acdb319e000)\r\n        libcurl.so.4 => /lib64/libcurl.so.4 (0x00002acdb33c5000)\r\n        libcrypto.so.10 => /lib64/libcrypto.so.10 (0x00002acdb362e000)\r\n        libncursesw.so.6 => /mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-7.4.0/ncurses-6.1-svwt4yh6tdtt7qtfuefht5d2bpll3f2p/lib/libncursesw.so.6 (0x00002acdb3a8f000)\r\n        libc.so.6 => /lib64/libc.so.6 (0x00002acdb3d0a000)\r\n        /lib64/ld-linux-x86-64.so.2 (0x000055bb83fc7000)\r\n        libidn.so.11 => /lib64/libidn.so.11 (0x00002acdb40d7000)\r\n        libssh2.so.1 => /lib64/libssh2.so.1 (0x00002acdb430a000)\r\n        libssl3.so => /lib64/libssl3.so (0x00002acdb4535000)\r\n        libsmime3.so => /lib64/libsmime3.so (0x00002acdb4781000)\r\n        libnss3.so => /lib64/libnss3.so (0x00002acdb49a8000)\r\n        libnssutil3.so => /lib64/libnssutil3.so (0x00002acdb4cd3000)\r\n        libplds4.so => /lib64/libplds4.so (0x00002acdb4f00000)\r\n        libplc4.so => /lib64/libplc4.so (0x00002acdb5104000)\r\n        libnspr4.so => /lib64/libnspr4.so (0x00002acdb530a000)\r\n        libdl.so.2 => /lib64/libdl.so.2 (0x00002acdb5548000)\r\n        libgssapi_krb5.so.2 => /lib64/libgssapi_krb5.so.2 (0x00002acdb574c000)\r\n        libkrb5.so.3 => /lib64/libkrb5.so.3 (0x00002acdb599a000)\r\n        libk5crypto.so.3 => /lib64/libk5crypto.so.3 (0x00002acdb5c82000)\r\n        libcom_err.so.2 => /lib64/libcom_err.so.2 (0x00002acdb5eb5000)\r\n        liblber-2.4.so.2 => /lib64/liblber-2.4.so.2 (0x00002acdb60ba000)\r\n        libldap-2.4.so.2 => /lib64/libldap-2.4.so.2 (0x00002acdb62c9000)\r\n        libssl.so.10 => /lib64/libssl.so.10 (0x00002acdb651e000)\r\n        librt.so.1 => /lib64/librt.so.1 (0x00002acdb6790000)\r\n        libkrb5support.so.0 => /lib64/libkrb5support.so.0 (0x00002acdb6999000)\r\n        libkeyutils.so.1 => /lib64/libkeyutils.so.1 (0x00002acdb6ba7000)\r\n        libresolv.so.2 => /lib64/libresolv.so.2 (0x00002acdb6dab000)\r\n        libsasl2.so.3 => /lib64/libsasl2.so.3 (0x00002acdb6fc5000)\r\n        libselinux.so.1 => /lib64/libselinux.so.1 (0x00002acdb71e2000)\r\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00002acdb740a000)\r\n        libpcre.so.1 => /lib64/libpcre.so.1 (0x00002acdb7641000)\r\n        libfreebl3.so => /lib64/libfreebl3.so (0x00002acdb78a3000)\r\n[root@gosset:~]# module load ncurses/6.0\r\n[root@gosset:~]# module list\r\n\r\nCurrently Loaded Modules:\r\n  1) gcc/7.4.0   2) samtools/1.9   3) ncurses/6.0\r\n\r\n\r\n\r\n[root@gosset:~]# echo $LD_LIBRARY_PATH\r\n/mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-7.4.0/ncurses-6.0-lxirmoeyz63ywzsiodd6zzzh6uoi2g4f/lib:/mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-7.4.0/samtools-1.9-m547dlsaia3x3co62zqhgnqqln2w5aj7/lib:/mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.4.0-bved7bzpjss3w3d3qe4mur5qc25nfll6/lib64:/mnt/beegfs/spackroot/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-7.4.0-bved7bzpjss3w3d3qe4mur5qc25nfll6/lib:/usr/lib/oracle/12.2/client64/lib::\r\n```\r\n\r\nIn this example samtools/1.9 was compiled with ncurses/6.1 as confirmed by the library linking. However I can load a different version of ncurses/6.0 and it won't link against samtools, but will show up in my lib path. Do I have to worry about this type of behavior? I presume this is the bit about package concretization?\r\n\r\nIs there a way for lua files to explicitly load all dependencies? Or is this truly unnecessary to ensure appropriate linking with libraries used for compilation?\r\n\r\nM",
    "performed_via_github_app": null
}