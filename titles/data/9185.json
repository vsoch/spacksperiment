{
    "url": "https://api.github.com/repos/spack/spack/issues/9185",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9185/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9185/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9185/events",
    "html_url": "https://github.com/spack/spack/issues/9185",
    "id": 357799107,
    "node_id": "MDU6SXNzdWUzNTc3OTkxMDc=",
    "number": 9185,
    "title": "packages.yaml / spack ignores external OpenCL, only provides pocl",
    "user": {
        "login": "tdd11235813",
        "id": 16594217,
        "node_id": "MDQ6VXNlcjE2NTk0MjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/16594217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tdd11235813",
        "html_url": "https://github.com/tdd11235813",
        "followers_url": "https://api.github.com/users/tdd11235813/followers",
        "following_url": "https://api.github.com/users/tdd11235813/following{/other_user}",
        "gists_url": "https://api.github.com/users/tdd11235813/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tdd11235813/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tdd11235813/subscriptions",
        "organizations_url": "https://api.github.com/users/tdd11235813/orgs",
        "repos_url": "https://api.github.com/users/tdd11235813/repos",
        "events_url": "https://api.github.com/users/tdd11235813/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tdd11235813/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 2165627345,
            "node_id": "MDU6TGFiZWwyMTY1NjI3MzQ1",
            "url": "https://api.github.com/repos/spack/spack/labels/opencl",
            "name": "opencl",
            "color": "720cb2",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2018-09-06T19:45:30Z",
    "updated_at": "2020-06-27T20:39:39Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I am new to spack :tada: and look for a build customization to use system's OpenCL instead of installing pocl.\r\nMy current configuration provides a package called `amd-opencl`, that concretises the virtual package `opencl` by pointing to system's installation of OpenCL (coming via ROCm). \r\nHowever, spack does not apply my configuration (spack parsed the packages.yaml though), but only shows `pocl`. \r\nSo what are the missing steps?\r\n\r\n```\r\n$ spack providers opencl\r\n    pocl\r\n```\r\n#### packages.yaml\r\n\r\n```yaml\r\n# /etc/spack/defaults/packages.yaml \r\npackages:\r\n  amd-opencl:\r\n    paths:\r\n      amd-opencl@2.0 arch=linux-ubuntu16.04-x86_64: /opt/rocm/opencl\r\n    buildable: False\r\n  all:\r\n    compiler: [gcc, intel, pgi, clang, xl, nag]\r\n    providers:\r\n<..snip..>\r\n      opencl: [amd-opencl]\r\n# or alternatively: /root/.spack/packages.yaml\r\npackages:\r\n  amd-opencl:\r\n    paths:\r\n      amd-opencl: /opt/rocm/opencl # with/without version/arch tried\r\n    buildable: False\r\n  all:\r\n    providers:\r\n      opencl: [amd-opencl]\r\n```\r\nI also have tried `spack clean -a`, `spack reindex` and also deleted the `.spack/cache`.\r\nspack reads the `packages.yaml` (when there is an error inside, spack stops install).\r\n```\r\n$ spack --version\r\n0.11.2\r\n\r\n$ ls /opt/rocm/opencl/*\r\n/opt/rocm/opencl/bin:\r\nx86_64\r\n\r\n/opt/rocm/opencl/include:\r\nCL  opencl-c.h\r\n\r\n/opt/rocm/opencl/lib:\r\nx86_64\r\n```\r\n\r\n#### spack compilers and mirrors\r\n\r\n<details>\r\n\r\n```\r\n$ less .spack/linux/compilers.yaml\r\ncompilers:\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: ubuntu16.04\r\n    paths:\r\n      cc: /usr/bin/gcc-5\r\n      cxx: /usr/bin/g++-5\r\n      f77: null\r\n      fc: null\r\n    spec: gcc@5.4.0\r\n    target: x86_64\r\n\r\n$ less .spack/linux/mirrors.yaml\r\nmirrors:\r\n  manual: file://~/.spack/manual_mirror\r\n  local_filesystem: file:///root/.spack/manual_mirror/\r\n```\r\n\r\n</details>\r\n\r\n#### spack find\r\n\r\n<details>\r\n\r\n```\r\n-- linux-ubuntu16.04-x86_64 / gcc@5.4.0 -------------------------\r\nbinutils@2.28\r\nbison@3.0.4\r\nboost@1.65.1\r\nbzip2@1.0.6\r\ncmake@3.9.4\r\nflex@2.6.4\r\ngettext@0.19.8.1\r\nhelp2man@1.47.4\r\nhwloc@1.11.8\r\nlibedit@3.1-20170329\r\nlibelf@0.8.13\r\nlibpciaccess@0.13.5\r\nlibsigsegv@2.11\r\nlibtool@2.4.6\r\nlibxml2@2.9.4\r\nllvm@4.0.1\r\nm4@1.4.18\r\nncurses@6.0\r\nopenssl@1.0.2k\r\npcre@8.40\r\npkg-config@0.29.2\r\npy-appdirs@1.4.3\r\npy-lit@0.5.0\r\npy-packaging@16.8\r\npy-pyparsing@2.2.0\r\npy-setuptools@35.0.2\r\npy-six@1.10.0\r\npython@2.7.14\r\nreadline@7.0\r\nsqlite@3.20.0\r\nswig@3.0.12\r\ntar@1.29\r\ntcl@8.6.6\r\nutil-macros@1.19.1\r\nxz@5.2.3\r\nzlib@1.2.11\r\n```\r\n\r\n</details>\r\n\r\n#### OpenCL version:\r\n```\r\n$ /opt/rocm/opencl/bin/x86_64/clinfo | grep -i Version\r\n  Platform Version:                              OpenCL 2.1 AMD-APP.internal (2574.0)\r\n  Device OpenCL C version:                       OpenCL C 2.0 \r\n  Driver version:                                2574.0 (HSA1.1,LC)\r\n  Version:                                       OpenCL 1.2\r\n```\r\n\r\nEdit: relates to #7460",
    "performed_via_github_app": null
}