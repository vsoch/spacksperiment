{
    "url": "https://api.github.com/repos/spack/spack/issues/11982",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/11982/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/11982/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/11982/events",
    "html_url": "https://github.com/spack/spack/issues/11982",
    "id": 466726629,
    "node_id": "MDU6SXNzdWU0NjY3MjY2Mjk=",
    "number": 11982,
    "title": "Build error: singularity-legacy (2.6.1) with Spack-provided libarchive",
    "user": {
        "login": "steffen-AEI",
        "id": 30238236,
        "node_id": "MDQ6VXNlcjMwMjM4MjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/30238236?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/steffen-AEI",
        "html_url": "https://github.com/steffen-AEI",
        "followers_url": "https://api.github.com/users/steffen-AEI/followers",
        "following_url": "https://api.github.com/users/steffen-AEI/following{/other_user}",
        "gists_url": "https://api.github.com/users/steffen-AEI/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/steffen-AEI/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/steffen-AEI/subscriptions",
        "organizations_url": "https://api.github.com/users/steffen-AEI/orgs",
        "repos_url": "https://api.github.com/users/steffen-AEI/repos",
        "events_url": "https://api.github.com/users/steffen-AEI/events{/privacy}",
        "received_events_url": "https://api.github.com/users/steffen-AEI/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 10,
    "created_at": "2019-07-11T07:57:18Z",
    "updated_at": "2019-08-02T11:37:04Z",
    "closed_at": "2019-08-02T11:37:03Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "`singularity-legacy` fails to build in configure phase although libarchive is available (and unchanged for long), has no variants, and was added as a dependency.\r\nSystem is CentOS 7, Spack uses GCC 7.3.0, package file has been merged with latest git.\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n[stefgru@login01 ~]$ . /home/SPACK/share/spack/setup-env.sh\r\n[stefgru@login01 ~]$ module purge\r\n[stefgru@login01 ~]$ cd /home/SPACK/var/spack/repos/builtin/packages/singularity-legacy/\r\n[stefgru@login01 singularity-legacy]$ cat package.py\r\n```\r\n```python\r\n##############################################################################\r\n# Copyright (c) 2013-2018, Lawrence Livermore National Security, LLC.\r\n# Produced at the Lawrence Livermore National Laboratory.\r\n#\r\n# This file is part of Spack.\r\n# Created by Todd Gamblin, tgamblin@llnl.gov, All rights reserved.\r\n# LLNL-CODE-647188\r\n#\r\n# For details, see https://github.com/spack/spack\r\n# Please also see the NOTICE and LICENSE files for our notice and the LGPL.\r\n#\r\n# This program is free software; you can redistribute it and/or modify\r\n# it under the terms of the GNU Lesser General Public License (as\r\n# published by the Free Software Foundation) version 2.1, February 1999.\r\n#\r\n# This program is distributed in the hope that it will be useful, but\r\n# WITHOUT ANY WARRANTY; without even the IMPLIED WARRANTY OF\r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the terms and\r\n# conditions of the GNU Lesser General Public License for more details.\r\n#\r\n# You should have received a copy of the GNU Lesser General Public\r\n# License along with this program; if not, write to the Free Software\r\n# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA\r\n##############################################################################\r\nfrom spack import *\r\n\r\n\r\nclass SingularityLegacy(AutotoolsPackage):\r\n    \"\"\"Singularity is a container platform focused on supporting 'Mobility of\r\n       Compute'. The software changed the installation method from AutoTools\r\n       to GoLang, so we have two separate package names to support that. The\r\n       legacy package is pre-version 3.0.0\r\n    \"\"\"\r\n\r\n    homepage = \"https://www.sylabs.io/singularity/\"\r\n    url      = \"https://github.com/sylabs/singularity/releases/download/2.5.2/singularity-2.5.2.tar.gz\"\r\n\r\n    # Versions before 2.5.2 suffer from a serious security problem.\r\n    # https://nvd.nist.gov/vuln/detail/CVE-2018-12021\r\n    version('2.6-release', branch='vault/2.6-release')\r\n    version('2.6.1', sha256='f38d46a225e8368eb4693137806d2dc96e925a50bdf7f6983662848831041df2')\r\n    version('2.6.0', sha256='7c425211a099f6fa6f74037e6e17be58fb5923b0bd11aea745e48ef83c488b49')\r\n    version('2.5.2', '2edc1a8ac9a4d7d26fba6244f1c5fd95')\r\n    version('2.4.5', '9afa903ee019448104b4f40be77a46e7')\r\n    version('2.4', 'd357ce68ef2f8149edd84155731531465dbe74148c37719f87f168fc39384377')\r\n    version('2.3.1', '292ff7fe3db09c854b8accf42f763f62')\r\n    version('develop', git='https://github.com/singularityware/singularity.git', branch='master')\r\n\r\n    depends_on('m4',       type='build')\r\n    depends_on('autoconf', type='build')\r\n    depends_on('automake', type='build')\r\n    depends_on('libtool',  type='build')\r\n    depends_on('libarchive', type='build')\r\n\r\n    # When installing as root, the copy has to run before chmod runs\r\n    def install(self, spec, prefix):\r\n        make('install', parallel=False)\r\n```\r\n```console\r\n[stefgru@login01 singularity-legacy]$ spack find libarchive\r\n==> 1 installed packages.\r\n-- linux-centos7-x86_64 / gcc@7.3.0 -----------------------------\r\nlibarchive@3.3.2\r\n[stefgru@login01 singularity-legacy]$ spack load libarchive\r\n[stefgru@login01 singularity-legacy]$ module list -t\r\nCurrently Loaded Modulefiles:\r\nlibarchive-3.3.2-gcc-7.3.0-akvokuw\r\n[stefgru@login01 singularity-legacy]$ spack install singularity-legacy\r\n==> libsigsegv is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/libsigsegv-2.11-nwbx3xloeloijlyclcpkhaffbhcv4ac2\r\n==> m4 is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/m4-1.4.18-dprnz44bxbatsc7dxhd56dabn2m6owzr\r\n==> pkgconf is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/pkgconf-1.4.2-7idfhupnmb7v6afl6p2g35riyeosjlnc\r\n==> ncurses is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/ncurses-6.1-3tmz3apsfbu5ugilyfs4kao77mmymirf\r\n==> readline is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/readline-7.0-tjd5dul25fk2ercddtz4ved5s5bzums3\r\n==> gdbm is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/gdbm-1.14.1-jh53h4hajb4rciqe5hklfus2e6spbihv\r\n==> perl is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/perl-5.26.2-6it6cpil74uhmou5nalbakcklzlyvwhm\r\n==> autoconf is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/autoconf-2.69-ubkflpm3gicbsthnlnm6jp2ro4lqq7pf\r\n==> automake is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/automake-1.16.1-xenqwrb6sbcatumbvqzhn7cyg6kbdmtt\r\n==> bzip2 is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/bzip2-1.0.6-hzpdm3hwavettperm3hufzmpnyzdu2bh\r\n==> libbsd is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/libbsd-0.8.6-kaird42iy3ehyoswazkhlqwcc3gbwev2\r\n==> expat is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/expat-2.2.5-6eteuvfqtavxsspduqzwvoa7f6qi2ojc\r\n==> xz is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/xz-5.2.4-jw7ekw4wtqrma5ho6vlhal4fzliygckx\r\n==> zlib is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/zlib-1.2.11-zknfwanbwk6tnyaplsykwghx7cvnz4cr\r\n==> libxml2 is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/libxml2-2.9.8-7bqs2w6crcgpgl7fqvjgd2vpg54zufsj\r\n==> lz4 is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/lz4-1.8.1.2-wosywqqapswqy47tu45oxcsnaodesk4v\r\n==> lzma is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/lzma-4.32.7-2vuhiqljrh7ko5b77yo7kk5unk6x5yzu\r\n==> lzo is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/lzo-2.09-74jpbr5oj3hvunavi2srfqcwgbdvjq43\r\n==> libtool is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/libtool-2.4.6-z7osdpc5jrpjdoyrr5gkmo345sknbijn\r\n==> gmp is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/gmp-6.1.2-rvionwwgpegozyro6aelwbqgnapsertb\r\n==> nettle is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/nettle-3.3-oxxyo6frtazjrnh2ay2brzkfg5kfxphz\r\n==> openssl is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/openssl-1.0.2o-sh6zpq5ncaq6s3wfn5afxckiywfqthtg\r\n==> libarchive is already installed in /home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/libarchive-3.3.2-akvokuww4umnfycmqn4kft4royb6h2kz\r\n==> Installing singularity-legacy\r\n==> Using cached archive: /home/SPACK/var/spack/cache/singularity-legacy/singularity-legacy-2.6.1.tar.gz\r\n==> Staging archive: /home/SPACK/var/spack/stage/singularity-legacy-2.6.1-3rc24q3yzfwpphktu6zes4olg7e4wct7/singularity-2.6.1.tar.gz\r\n==> Created stage in /home/SPACK/var/spack/stage/singularity-legacy-2.6.1-3rc24q3yzfwpphktu6zes4olg7e4wct7\r\n==> No patches needed for singularity-legacy\r\n==> Building singularity-legacy [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/home/SPACK/var/spack/stage/singularity-legacy-2.6.1-3rc24q3yzfwpphktu6zes4olg7e4wct7/singularity-2.6.1/configure' '--prefix=/home/SPACK/opt/spack/linux-centos7-x86_64/gcc-7.3.0/singularity-legacy-2.6.1-3rc24q3yzfwpphktu6zes4olg7e4wct7'\r\n\r\n1 error found in build log:\r\n     130    checking if suid should be enabled... yes\r\n     131    checking for git version... -dist\r\n     132    checking archive.h usability... yes\r\n     133    checking archive.h presence... yes\r\n     134    checking for archive.h... yes\r\n     135    checking for library containing archive_read_new... no\r\n  >> 136    configure: error: unable to find libarchive, need package libarchive-devel (libarchive-de on Debian/Ubuntu)\r\n\r\nSee build log for details:\r\n  /home/SPACK/var/spack/stage/singularity-legacy-2.6.1-3rc24q3yzfwpphktu6zes4olg7e4wct7/singularity-2.6.1/spack-build.out\r\n```\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```console\r\n[stefgru@login01 singularity-legacy]$ uname -a\r\nLinux login01.cluster 3.10.0-514.26.2.el7.x86_64 #1 SMP Tue Jul 4 15:04:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n[stefgru@login01 singularity-legacy]$ cat /etc/os-release \r\nNAME=\"CentOS Linux\"\r\nVERSION=\"7 (Core)\"\r\nID=\"centos\"\r\nID_LIKE=\"rhel fedora\"\r\nVERSION_ID=\"7\"\r\nPRETTY_NAME=\"CentOS Linux 7 (Core)\"\r\nANSI_COLOR=\"0;31\"\r\nCPE_NAME=\"cpe:/o:centos:centos:7\"\r\nHOME_URL=\"https://www.centos.org/\"\r\nBUG_REPORT_URL=\"https://bugs.centos.org/\"\r\n\r\nCENTOS_MANTISBT_PROJECT=\"CentOS-7\"\r\nCENTOS_MANTISBT_PROJECT_VERSION=\"7\"\r\nREDHAT_SUPPORT_PRODUCT=\"centos\"\r\nREDHAT_SUPPORT_PRODUCT_VERSION=\"7\"\r\n```\r\n\r\n\r\n### Additional information\r\n\r\n(none yet)\r\n",
    "performed_via_github_app": null
}