{
    "url": "https://api.github.com/repos/spack/spack/issues/2189",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2189/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2189/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2189/events",
    "html_url": "https://github.com/spack/spack/pull/2189",
    "id": 186273155,
    "node_id": "MDExOlB1bGxSZXF1ZXN0OTE2MDE3OTk=",
    "number": 2189,
    "title": "Use JSON for the database instead of YAML.",
    "user": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 460427403,
            "node_id": "MDU6TGFiZWw0NjA0Mjc0MDM=",
            "url": "https://api.github.com/repos/spack/spack/labels/performance",
            "name": "performance",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 446780477,
            "node_id": "MDU6TGFiZWw0NDY3ODA0Nzc=",
            "url": "https://api.github.com/repos/spack/spack/labels/pkg-database",
            "name": "pkg-database",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 26,
    "created_at": "2016-10-31T12:35:31Z",
    "updated_at": "2017-05-01T00:53:30Z",
    "closed_at": "2016-12-05T18:03:58Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/2189",
        "html_url": "https://github.com/spack/spack/pull/2189",
        "diff_url": "https://github.com/spack/spack/pull/2189.diff",
        "patch_url": "https://github.com/spack/spack/pull/2189.patch"
    },
    "body": "Fixes #2027.\r\n\r\nOk, so #2010 was a nice speed boost but it doesn't work for everyone and only takes advantage of C YAML if you've got it installed.  Also, it seems to cause issues on BG/Q (see @pramodk's #2027).  So for reliability it seems like we *don't* really want to fall back on CYAML.  \r\n\r\nHowever, YAML is just a more human-readable JSON, and JSON is built into Python.  They have the same object model (we even already use `jsonschema` to validate YAML config files).\r\n\r\nSo I tried it out and compared JSON and YAML speeds for reading the Spack DB (the is the main bottleneck for `spack find`).  Here is what I got:\r\n\r\n- JSON is much faster than YAML \r\n  - **~180x** faster than Python YAML (on my mac)\r\n  - **~25x** faster than C YAML on my mac.\r\n- Don't need human readability for the package database.\r\n- JSON requires no major changes to the code -- same object model as YAML.\r\n\r\nSo it seems like using JSON for the database and other index files is the way to go.  JSON is built into Python, unlike C YAML, so doesn't add a dependency, and it's faster than the C libyaml.\r\n\r\nIf you wan to try this out, [here is a gist](https://gist.github.com/tgamblin/93ba38c3dbe099e7c979e71d75b49f11) -- set `test_file` to the path to `opt/spack/.spack-db/index.yaml` (or wherever your install root is now that #2152 is in) and it'll print out the speedup of reading your install database with JSON and YAML using `timeit`. I didn't compare with pickle, but [people say JSON is faster than that](https://konstantin.blog/2010/pickle-vs-json-which-is-faster/), too.\r\n\r\nYou can also just try this PR out by merging it, then typing `spack reindex`, and it'll build you a `json` database.  `spack find` should run faster after that.  As written the PR will read an old `index.yaml` if it is present, but it will not write it again (once an index.json database is written it won't go back to YAML).\r\n\r\n@pramodk @adamjstewart @alalazo @davydden @eschnett @lee218llnl: let me know how this does with your installations if you get a chance.  I'd be curious to now how fast `spack find` is with and without it.\r\n\r\nComments welcome.",
    "performed_via_github_app": null
}