{
    "url": "https://api.github.com/repos/spack/spack/issues/17469",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/17469/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/17469/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/17469/events",
    "html_url": "https://github.com/spack/spack/issues/17469",
    "id": 655075032,
    "node_id": "MDU6SXNzdWU2NTUwNzUwMzI=",
    "number": 17469,
    "title": "buildcache for foreign architecture no longer readable",
    "user": {
        "login": "frankwillmore",
        "id": 508437,
        "node_id": "MDQ6VXNlcjUwODQzNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/508437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/frankwillmore",
        "html_url": "https://github.com/frankwillmore",
        "followers_url": "https://api.github.com/users/frankwillmore/followers",
        "following_url": "https://api.github.com/users/frankwillmore/following{/other_user}",
        "gists_url": "https://api.github.com/users/frankwillmore/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/frankwillmore/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/frankwillmore/subscriptions",
        "organizations_url": "https://api.github.com/users/frankwillmore/orgs",
        "repos_url": "https://api.github.com/users/frankwillmore/repos",
        "events_url": "https://api.github.com/users/frankwillmore/events{/privacy}",
        "received_events_url": "https://api.github.com/users/frankwillmore/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 759411369,
            "node_id": "MDU6TGFiZWw3NTk0MTEzNjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/buildcache",
            "name": "buildcache",
            "color": "bf354c",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2020-07-10T22:52:05Z",
    "updated_at": "2020-08-01T15:36:13Z",
    "closed_at": "2020-08-01T15:36:13Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\nI generated a buildcache with cnl7 (alcf iota), copied the mirror to a cnl6 system (alcf theta) and tried to list packages.\r\nWhen building the cache with spack v0.14.2, I was able to view the packages, but not install. When building with v0.15.0, I am neither able to view nor install. \r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n\u718a\u4fca\u5091@thetalogin1:~/spack$ git checkout v0.14.2\r\nHEAD is now at 7a68a4d85... update CHANGELOG.md for 0.14.2\r\n\u718a\u4fca\u5091@thetalogin1:~/spack$ spack buildcache list -al arch=cray-cnl7-mic_knl \r\n==> Finding buildcaches in /home/willmore/mirror/build_cache\r\n==> Finding buildcaches in /tmp/mirror/build_cache\r\n==> Finding buildcaches in /tmp/build_cache\r\n==> Finding buildcaches in /home/willmore/spack-mirror/build_cache\r\n-- cray-cnl7-mic_knl / gcc@7.3.0 --------------------------------\r\njscdp26 hdf5@1.10.6  ek675oc zlib@1.2.11\r\n\r\n-- cray-cnl7-mic_knl / gcc@9.2.0 --------------------------------\r\nbl5unjg hdf5@1.8.16  zjoxq7c kokkos@3.1.01   zmjwtet zlib@1.2.11\r\n4b3p7v2 hdf5@1.10.6  4itl6jz numactl@2.0.12\r\n\u718a\u4fca\u5091@thetalogin1:~/spack$ git checkout v0.15.0\r\nPrevious HEAD position was 7a68a4d85... update CHANGELOG.md for 0.14.2\r\nHEAD is now at d4bf70d98... changelog for v0.15.0\r\n\u718a\u4fca\u5091@thetalogin1:~/spack$ spack buildcache list -al arch=cray-cnl7-mic_knl \r\n==> Finding buildcaches at file:///home/willmore/mirror/build_cache\r\n==> Error: Can't recreate arch for spec cray-cnl7-mic_knl on current arch cray-cnl6-haswell; spec architecture is too different\r\n```\r\n\r\ntgamblin:\r\nit\u2019s complaining about the OS difference so I believe it should work fine after the upgrade but that\u2019s not great \u2014 you want it to list and show what\u2019s there regardless of the host OS right? \r\n\r\nwillmore:\r\nyes. It looks like the -o option [for buildcache install] came with v0.15.0 so I upgraded, but I could at least list the packages with the v0.14.2.\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n\u718a\u4fca\u5091@thetalogin1:~/spack$ spack debug report\r\n* **Spack:** 0.15.0\r\n* **Python:** 3.4.6\r\n* **Platform:** cray-sles12-haswell\r\n\r\n(This is not the correct target architecture,which should reflectr mic_knl instead of haswell; this also changed since v0.14.2 and reported in issue #16707) \r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Debug output\r\n```\r\n\u718a\u4fca\u5091@thetalogin1:~/spack$ spack -d buildcache list -al arch=cray-cnl7-mic_knl \r\n==> [2020-07-10-22:47:52.140418, 32101] '/bin/bash' '--norc' '--noprofile' '-lc' 'echo $CRAY_CPU_TARGET'\r\n==> [2020-07-10-22:47:52.145034, 32101] default to front-end architecture\r\n==> [2020-07-10-22:47:52.187344, 32101] Imported buildcache from built-in commands\r\n==> [2020-07-10-22:47:52.190937, 32101] Imported buildcache from built-in commands\r\n==> [2020-07-10-22:47:52.191575, 32101] Reading config file /home/willmore/.spack/cray/mirrors.yaml\r\n==> [2020-07-10-22:47:52.195722, 32101] Finding buildcaches at file:///home/willmore/mirror/build_cache\r\n==> [2020-07-10-22:47:52.196035, 32101] Reading config file /gpfs/mira-home/willmore/spack/etc/spack/defaults/config.yaml\r\n==> [2020-07-10-22:47:52.219533, 32101] DATABASE LOCK TIMEOUT: 3s\r\n==> [2020-07-10-22:47:52.219589, 32101] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2020-07-10-22:47:52.290808, 32101] '/bin/bash' '--norc' '--noprofile' '-lc' 'echo $CRAY_CPU_TARGET'\r\n==> [2020-07-10-22:47:52.294602, 32101] default to front-end architecture\r\nTraceback (most recent call last):\r\n  File \"/home/willmore/spack/bin/spack\", line 64, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/gpfs/mira-home/willmore/spack/lib/spack/spack/main.py\", line 761, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/gpfs/mira-home/willmore/spack/lib/spack/spack/main.py\", line 489, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/gpfs/mira-home/willmore/spack/lib/spack/spack/cmd/buildcache.py\", line 756, in buildcache\r\n    args.func(args)\r\n  File \"/gpfs/mira-home/willmore/spack/lib/spack/spack/cmd/buildcache.py\", line 491, in listspecs\r\n    specs = bindist.get_specs(args.allarch)\r\n  File \"/gpfs/mira-home/willmore/spack/lib/spack/spack/binary_distribution.py\", line 888, in get_specs\r\n    spec_arch = architecture.arch_for_spec(indexed_spec.architecture)\r\n  File \"/gpfs/mira-home/willmore/spack/lib/spack/spack/architecture.py\", line 476, in arch_for_spec\r\n    \"spec architecture is too different\" % (arch_spec, sys_type()))\r\nValueError: Can't recreate arch for spec cray-cnl7-mic_knl on current arch cray-cnl6-haswell; spec architecture is too different\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}