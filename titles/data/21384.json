{
    "url": "https://api.github.com/repos/spack/spack/issues/21384",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/21384/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/21384/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/21384/events",
    "html_url": "https://github.com/spack/spack/issues/21384",
    "id": 796534651,
    "node_id": "MDU6SXNzdWU3OTY1MzQ2NTE=",
    "number": 21384,
    "title": "All self-test cases fail to be executed on the OpenEuler system:collectd@5.11.0",
    "user": {
        "login": "Tom-python0121",
        "id": 77763324,
        "node_id": "MDQ6VXNlcjc3NzYzMzI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/77763324?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Tom-python0121",
        "html_url": "https://github.com/Tom-python0121",
        "followers_url": "https://api.github.com/users/Tom-python0121/followers",
        "following_url": "https://api.github.com/users/Tom-python0121/following{/other_user}",
        "gists_url": "https://api.github.com/users/Tom-python0121/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Tom-python0121/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Tom-python0121/subscriptions",
        "organizations_url": "https://api.github.com/users/Tom-python0121/orgs",
        "repos_url": "https://api.github.com/users/Tom-python0121/repos",
        "events_url": "https://api.github.com/users/Tom-python0121/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Tom-python0121/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2021-01-29T02:57:38Z",
    "updated_at": "2021-02-02T11:37:49Z",
    "closed_at": "2021-02-02T11:37:49Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\nI am having trouble about all self-test cases fail to be executed on the OpenEuler system:collectd@5.11.0.\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n[root@openEuler spack-src]$ spack install --keep-stage collectd@5.11.0\r\n[root@openEuler spack-src]$ spack cd collectd@5.11.0\r\n[root@openEuler spack-src]$ spack load collectd@5.11.0\r\n[root@openEuler spack-src]$ bash -c \"source ../spack-build-env.txt; make check\"\r\nmake[2]: 'libplugin_mock.la' is up to date.\r\nmake[2]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake  check-TESTS\r\nmake[2]: Entering directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake[3]: Entering directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nFAIL: test_common\r\nFAIL: test_format_graphite\r\nFAIL: test_meta_data\r\nFAIL: test_utils_avltree\r\nFAIL: test_utils_cmds\r\nFAIL: test_utils_heap\r\nFAIL: test_utils_latency\r\nFAIL: test_utils_message_parser\r\nFAIL: test_utils_mount\r\nFAIL: test_utils_subst\r\nFAIL: test_utils_time\r\nFAIL: test_utils_vl_lookup\r\nFAIL: test_libcollectd_network_parse\r\nFAIL: test_utils_config_cores\r\nFAIL: test_plugin_logparser\r\nFAIL: test_plugin_network\r\nFAIL: test_plugin_pcie_errors\r\n============================================================================\r\nTestsuite summary for collectd 5.11.0.git\r\n============================================================================\r\n# TOTAL: 19\r\n# PASS:  0\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  19\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\nSee ./test-suite.log\r\n============================================================================\r\nmake[3]: *** [Makefile:9834: test-suite.log] Error 1\r\nmake[3]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake[2]: *** [Makefile:9942: check-TESTS] Error 2\r\nmake[2]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake[1]: *** [Makefile:10343: check-am] Error 2\r\nmake[1]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\n[root@openEuler spack-src]$ cat test-suite.log\r\n`===========================================\r\n   collectd 5.11.0.git: ./test-suite.log\r\n===========================================\r\n\r\n# TOTAL: 19\r\n# PASS:  0\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  19\r\n# XPASS: 0\r\n# ERROR: 0\r\n\r\n.. contents:: :depth: 2\r\n\r\nFAIL: test_common\r\n=================\r\n\r\n\r\nvalgrind:  Fatal error at startup: a function redirection\r\nvalgrind:  which is mandatory for this platform-tool combination\r\nvalgrind:  cannot be set up.  Details of the redirection are:\r\nvalgrind:\r\nvalgrind:  A must-be-redirected function\r\nvalgrind:  whose name matches the pattern:      strlen\r\nvalgrind:  in an object with soname matching:   ld-linux-aarch64.so.1\r\nvalgrind:  was not found whilst processing\r\nvalgrind:  symbols from the object with soname: ld-linux-aarch64.so.1\r\nvalgrind:\r\nvalgrind:  Possible fixes: (1, short term): install glibc's debuginfo\r\nvalgrind:  package on this machine.  (2, longer term): ask the packagers\r\nvalgrind:  for your Linux distribution to please in future ship a non-\r\nvalgrind:  stripped ld.so (or whatever the dynamic linker .so is called)\r\nvalgrind:  that exports the above-named function using the standard\r\nvalgrind:  calling conventions for this platform.  The package you need\r\nvalgrind:  to install for fix (1) is called\r\nvalgrind:\r\nvalgrind:    On Debian, Ubuntu:                 libc6-dbg\r\nvalgrind:    On SuSE, openSuSE, Fedora, RHEL:   glibc-debuginfo\r\nvalgrind:\r\nvalgrind:  Note that if you are debugging a 32 bit process on a\r\nvalgrind:  64 bit system, you will need a corresponding 32 bit debuginfo\r\nvalgrind:  package (e.g. libc6-dbg:i386).\r\nvalgrind:\r\nvalgrind:  Cannot continue -- exiting now.  Sorry.\r\n\r\nFAIL test_common (exit status: 1)\r\n\u2026\u2026\r\n[root@openEuler spack-src]# valgrind ls -l\r\n==1010428== Memcheck, a memory error detector\r\n==1010428== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==1010428== Using Valgrind-3.16.1 and LibVEX; rerun with -h for copyright info\r\n==1010428== Command: ls -l\r\n==1010428==\r\n\r\nvalgrind:  Fatal error at startup: a function redirection\r\nvalgrind:  which is mandatory for this platform-tool combination\r\nvalgrind:  cannot be set up.  Details of the redirection are:\r\nvalgrind:\r\nvalgrind:  A must-be-redirected function\r\nvalgrind:  whose name matches the pattern:      strlen\r\nvalgrind:  in an object with soname matching:   ld-linux-aarch64.so.1\r\nvalgrind:  was not found whilst processing\r\nvalgrind:  symbols from the object with soname: ld-linux-aarch64.so.1\r\nvalgrind:\r\nvalgrind:  Possible fixes: (1, short term): install glibc's debuginfo\r\nvalgrind:  package on this machine.  (2, longer term): ask the packagers\r\nvalgrind:  for your Linux distribution to please in future ship a non-\r\nvalgrind:  stripped ld.so (or whatever the dynamic linker .so is called)\r\nvalgrind:  that exports the above-named function using the standard\r\nvalgrind:  calling conventions for this platform.  The package you need\r\nvalgrind:  to install for fix (1) is called\r\nvalgrind:\r\nvalgrind:    On Debian, Ubuntu:                 libc6-dbg\r\nvalgrind:    On SuSE, openSuSE, Fedora, RHEL:   glibc-debuginfo\r\nvalgrind:\r\nvalgrind:  Note that if you are debugging a 32 bit process on a\r\nvalgrind:  64 bit system, you will need a corresponding 32 bit debuginfo\r\nvalgrind:  package (e.g. libc6-dbg:i386).\r\nvalgrind:\r\nvalgrind:  Cannot continue -- exiting now.  Sorry.\r\n[root@openEuler spack-src]# yum install glibc-debuginfo\r\nLast metadata expiration check: 1:57:52 ago on Fri 29 Jan 2021 08:23:17 AM CST.\r\nDependencies resolved.\r\n============================================================================================================================================================================================================\r\n Package                                            Architecture                              Version                                          Repository                                              Size\r\n============================================================================================================================================================================================================\r\nInstalling:\r\n glibc-debugutils                                   aarch64                                   2.28-36.oe1                                      openEuler-everything                                   7.9 M\r\n\r\nTransaction Summary\r\n============================================================================================================================================================================================================\r\nInstall  1 Package\r\n\r\nTotal download size: 7.9 M\r\nInstalled size: 58 M\r\nIs this ok [y/N]: y\r\nDownloading Packages:\r\nglibc-debugutils-2.28-36.oe1.aarch64.rpm                                                                                                                                    1.2 MB/s | 7.9 MB     00:06\r\n------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nTotal                                                                                                                                                                       1.2 MB/s | 7.9 MB     00:06\r\nRunning transaction check\r\nTransaction check succeeded.\r\nRunning transaction test\r\nTransaction test succeeded.\r\nRunning transaction\r\n  Preparing        :                                                                                                                                                                                    1/1\r\n  Installing       : glibc-debugutils-2.28-36.oe1.aarch64                                                                                                                                               1/1\r\n  Running scriptlet: glibc-debugutils-2.28-36.oe1.aarch64                                                                                                                                               1/1\r\n  Verifying        : glibc-debugutils-2.28-36.oe1.aarch64                                                                                                                                               1/1\r\n\r\nInstalled:\r\n  glibc-debugutils-2.28-36.oe1.aarch64\r\n\r\nComplete!\r\n[root@openEuler spack-src]# valgrind ls -l\r\n==1011796== Memcheck, a memory error detector\r\n==1011796== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==1011796== Using Valgrind-3.16.1 and LibVEX; rerun with -h for copyright info\r\n==1011796== Command: ls -l\r\n==1011796==\r\n\r\nvalgrind:  Fatal error at startup: a function redirection\r\nvalgrind:  which is mandatory for this platform-tool combination\r\nvalgrind:  cannot be set up.  Details of the redirection are:\r\nvalgrind:\r\nvalgrind:  A must-be-redirected function\r\nvalgrind:  whose name matches the pattern:      strlen\r\nvalgrind:  in an object with soname matching:   ld-linux-aarch64.so.1\r\nvalgrind:  was not found whilst processing\r\nvalgrind:  symbols from the object with soname: ld-linux-aarch64.so.1\r\nvalgrind:\r\nvalgrind:  Possible fixes: (1, short term): install glibc's debuginfo\r\nvalgrind:  package on this machine.  (2, longer term): ask the packagers\r\nvalgrind:  for your Linux distribution to please in future ship a non-\r\nvalgrind:  stripped ld.so (or whatever the dynamic linker .so is called)\r\nvalgrind:  that exports the above-named function using the standard\r\nvalgrind:  calling conventions for this platform.  The package you need\r\nvalgrind:  to install for fix (1) is called\r\nvalgrind:\r\nvalgrind:    On Debian, Ubuntu:                 libc6-dbg\r\nvalgrind:    On SuSE, openSuSE, Fedora, RHEL:   glibc-debuginfo\r\nvalgrind:\r\nvalgrind:  Note that if you are debugging a 32 bit process on a\r\nvalgrind:  64 bit system, you will need a corresponding 32 bit debuginfo\r\nvalgrind:  package (e.g. libc6-dbg:i386).\r\nvalgrind:\r\nvalgrind:  Cannot continue -- exiting now.  Sorry.\r\n\r\n[root@openEuler spack-src]# spack install --keep-stage valgrind@3.15.0\r\n\u2026\u2026\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n\r\n2 errors found in build log:\r\n     848    ranlib libreplacemalloc_toolpreload-arm64-linux.a\r\n     849    mv -f m_ume/.deps/libcoregrind_arm64_linux_a-macho.Tpo m_ume/.deps/libcoregrind_arm64_linux_a-macho.Po\r\n     850    /home/spack/lib/spack/env/gcc/gcc -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wcast-align -Wcast-qual -Wwrite-strings -Wempty-body -\r\n            Wformat -Wformat-signedness -Wformat-security -Wignored-qualifiers -Wmissing-parameter-type -Wlogical-op -Wimplicit-fallthrough=2 -Wold-style-declaration -finline-functions -fno-stack-protect\r\n            or -fsanitize=undefined -fno-sanitize=alignment -fno-strict-aliasing -fno-builtin     -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wc\r\n            ast-align -Wcast-qual -Wwrite-strings -Wempty-body -Wformat -Wformat-signedness -Wformat-security -Wignored-qualifiers -Wmissing-parameter-type -Wlogical-op -Wimplicit-fallthrough=2 -Wold-sty\r\n            le-declaration -finline-functions -fno-stack-protector -fsanitize=undefined -fno-sanitize=alignment -fno-strict-aliasing -fno-builtin  -static-libubsan     -o valgrind valgrind-launcher-linux\r\n            .o valgrind-m_debuglog.o\r\n     851    /home/spack/lib/spack/env/gcc/gcc -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wcast-align -Wcast-qual -Wwrite-strings -Wempty-body -\r\n            Wformat -Wformat-signedness -Wformat-security -Wignored-qualifiers -Wmissing-parameter-type -Wlogical-op -Wimplicit-fallthrough=2 -Wold-style-declaration -finline-functions -fno-stack-protect\r\n            or -fsanitize=undefined -fno-sanitize=alignment -fno-strict-aliasing -fno-builtin     -O2 -g -Wall -Wmissing-prototypes -Wshadow -Wpointer-arith -Wstrict-prototypes -Wmissing-declarations -Wc\r\n            ast-align -Wcast-qual -Wwrite-strings -Wempty-body -Wformat -Wformat-signedness -Wformat-security -Wignored-qualifiers -Wmissing-parameter-type -Wlogical-op -Wimplicit-fallthrough=2 -Wold-sty\r\n            le-declaration -finline-functions -fno-stack-protector -fsanitize=undefined -fno-sanitize=alignment -fno-strict-aliasing -fno-builtin  -static-libubsan   -o vgdb vgdb-vgdb.o  vgdb-vgdb-invoke\r\n            r-ptrace.o   -lpthread\r\n     852    /usr/bin/ld:/ usrcannot/ binfind/ ld-:lubsan\r\n     853    cannot find -lubsan\r\n  >> 854    collect2: error: ld returned 1 exit status\r\n  >> 855    collect2: error: ld returned 1 exit status\r\n     856    make[3]: *** [Makefile:2818: valgrind] Error 1\r\n     857    make[3]: *** Waiting for unfinished jobs....\r\n     858    make[3]: *** [Makefile:2822: vgdb] Error 1\r\n     859    mv -f m_syswrap/.deps/libcoregrind_arm64_linux_a-syswrap-arm64-linux.Tpo m_syswrap/.deps/libcoregrind_arm64_linux_a-syswrap-arm64-linux.Po\r\n     860    mv -f m_ume/.deps/libcoregrind_arm64_linux_a-script.Tpo m_ume/.deps/libcoregrind_arm64_linux_a-script.Po\r\n     861    mv -f m_ume/.deps/libcoregrind_arm64_linux_a-main.Tpo m_ume/.deps/libcoregrind_arm64_linux_a-main.Po\r\n\r\nSee build log for details:\r\n  /home/stage/root/spack-stage-valgrind-3.15.0-jesuhkzymt5p344mipwwnjbslr2ozo45/spack-build-out.txt\r\n[root@openEuler spack-src]# spack install --keep-stage valgrind@3.14.0\r\n==> Error: FetchError: All fetchers failed\r\n\r\n/home/spack/lib/spack/spack/package.py:1331, in do_fetch:\r\n       1328                                 self.spec.format('{name}{@version}'), ck_msg)\r\n       1329\r\n       1330        self.stage.create()\r\n  >>   1331        err_msg = None if not self.manual_download else self.download_instr\r\n\r\n[root@openEuler spack-src]# vim Makefile\r\n-  LOG_COMPILER = env VALGRIND=\"/usr/local/bin/valgrind\" $(abs_srcdir)/testwrapper.sh\r\n+ #LOG_COMPILER = env VALGRIND=\"/usr/local/bin/valgrind\" $(abs_srcdir)/testwrapper.sh\r\n[root@openEuler spack-src]# make check\r\nmake  check-TESTS\r\nmake[2]: Entering directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake[3]: Entering directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nPASS: test_common\r\nPASS: test_format_graphite\r\nPASS: test_meta_data\r\nPASS: test_utils_avltree\r\nPASS: test_utils_cmds\r\nPASS: test_utils_heap\r\nPASS: test_utils_latency\r\nPASS: test_utils_message_parser\r\nPASS: test_utils_mount\r\nPASS: test_utils_subst\r\nPASS: test_utils_time\r\nPASS: test_utils_vl_lookup\r\nPASS: test_libcollectd_network_parse\r\nPASS: test_utils_config_cores\r\nPASS: test_plugin_logparser\r\nPASS: test_plugin_network\r\nPASS: test_plugin_pcie_errors\r\n============================================================================\r\nTestsuite summary for collectd 5.11.0.git\r\n============================================================================\r\n# TOTAL: 19\r\n# PASS:  19\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  0\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\nmake[3]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake[2]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\nmake[1]: Leaving directory '/home/stage/root/spack-stage-collectd-5.11.0-bbrxz6bk3mut4ugpbzv4zpvef6u4gtr6/spack-src'\r\n```\r\nTherfore,The impact of **valgrind** on the **make test** is as follows on the **openEuler** system,all **collected** self-test cases fail.Although glibc-debuginfo is successfully installed, the version of **glibc-debugutils** is not the expected one. However, the **glibc-debuginfo** version does not take effect on **valgrind**. In addition, the **spack install** valgrind has a bug and the installation fails, although it already exists, comment out **LOG_COMPILER = env VALGRIND=\"/usr/bin/valgrind\" $(abs_srcdir)/testwrapper.sh** in Makefile and deduct the impact of **valgrind** on make tests,and it pass.Can you help me to see if my method is feasible?\r\n\r\n### Information on your system\r\n```console\r\n[root@openEuler spack-src]# spack debug report\r\n* **Spack:** 0.16.0-77-98460b6f4\r\n* **Python:** 3.7.4\r\n* **Platform:** linux-openeuler20-aarch64\r\n* **Concretizer:** original\r\n```\r\n<!-- Please include the output of `spack debug report` -->\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [ ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ ] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}