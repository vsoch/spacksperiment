{
    "url": "https://api.github.com/repos/spack/spack/issues/19041",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/19041/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/19041/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/19041/events",
    "html_url": "https://github.com/spack/spack/issues/19041",
    "id": 710825445,
    "node_id": "MDU6SXNzdWU3MTA4MjU0NDU=",
    "number": 19041,
    "title": "Installation issue: openblas@0.3.10 on MacOSX",
    "user": {
        "login": "healther",
        "id": 4048699,
        "node_id": "MDQ6VXNlcjQwNDg2OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4048699?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/healther",
        "html_url": "https://github.com/healther",
        "followers_url": "https://api.github.com/users/healther/followers",
        "following_url": "https://api.github.com/users/healther/following{/other_user}",
        "gists_url": "https://api.github.com/users/healther/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/healther/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/healther/subscriptions",
        "organizations_url": "https://api.github.com/users/healther/orgs",
        "repos_url": "https://api.github.com/users/healther/repos",
        "events_url": "https://api.github.com/users/healther/events{/privacy}",
        "received_events_url": "https://api.github.com/users/healther/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 654034395,
            "node_id": "MDU6TGFiZWw2NTQwMzQzOTU=",
            "url": "https://api.github.com/repos/spack/spack/labels/clang",
            "name": "clang",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 9,
    "created_at": "2020-09-29T07:03:59Z",
    "updated_at": "2020-10-02T20:57:47Z",
    "closed_at": "2020-10-02T20:57:47Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "After having handed in my thesis (and therefore can risk screwing up my environment again) I tried to upgrade to the up-to-date spack/develop branch. Turns out this breaks building `openblas`. I'm not sure why, there are at least 3 option that I'm aware of:\r\n1) The latest Xcode update (to `apple-clang@12.0.0`) is unable to build `openblas` (previously it was `clang@11.0.0-apple`, i.e. my software is older than the clang-rename)\r\n2) Neither the old, nor the new `gfortran` binary is working with the new system clang (I tried my old one from a `gcc@9.3.0%clang@11.0.0-apple` as well as a new one from `gcc@10.3.0%apple-clang@12.0.0`)\r\n3) Something broke in the `openblas/package.py` during the update\r\n\r\nI'm using the same environment as before with a couple of not-in-upstream-spack-packages but non of those can interfere (mostly python packages far above blas). Unfortunately I cannot easily recover the old base commit, but the current one is `04771ad9f8` from just now.\r\n\r\nCurrently I'm trying to set `{blas,lapack}: [libvecfort]` as suggested in #7803 and it seems to work (at least `py-numpy` successfully installed). I'm attaching the build log and environment in the hope that someone can point out where I'm just being stupid and that this build normally works... Googling the error message didn't turn up any information, since this (see below) is \"just\" an `Implicit declaration of function 'cggsvp_' is invalid in C99` it may be fine to just patch out the `-Werror` flag and be done with it but I (at least currently) don't want to fiddle with the build and hope for the `libvecfort` thing to work.\r\n\r\nPinging a couple of people that work on MacOSX for their comments @adamjstewart @davydden ? \r\n\r\n```\r\n% spack debug report\r\n* **Spack:** 0.15.4-1203-1240db659a\r\n* **Python:** 3.7.4\r\n* **Platform:** darwin-catalina-skylake\r\n```\r\n\r\n[spack-build-out.txt](https://github.com/spack/spack/files/5296990/spack-build-out.txt)\r\n[spack-build-env.txt](https://github.com/spack/spack/files/5296994/spack-build-env.txt)\r\n\r\n```\r\nhealther@MacBook-Air-2 spack % spack install\r\n==> Installing environment generalenv\r\n==> Installing openblas\r\n==> No binary for openblas found: installing from source\r\n==> Warning: microarchitecture specific optimizations are not supported yet on mixed compiler toolchains [check apple-clang@12.0.0 for further details]\r\n==> Using cached archive: /Users/healther/Documents/git.nosync/spack/var/spack/cache/_source-cache/archive/04/0484d275f87e9b8641ff2eecaa9df2830cbe276ac79ad80494822721de6e1693.tar.gz\r\n==> openblas: Executing phase: 'edit'\r\n==> openblas: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j4' 'CC=/Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang' 'FC=/Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/gfortran' 'MAKE_NB_JOBS=0' 'ARCH=x86_64' 'DYNAMIC_ARCH=1' 'USE_OPENMP=0' 'USE_THREAD=0' 'libs' 'netlib' 'shared'\r\n\r\n9 errors found in build log:\r\n     19707    /Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang -O2 -DMAX_STACK_ALLOC=2048 -DEXPRECISION -Wall -m64 -DF_INTERFACE_GFORT -fPIC -DDYNAMIC_ARCH -DNO_WARMUP -DMAX_CPU_NUMBER=4 -DMAX_PARALLEL_NUMBER=1 -DVERSION=\"0.3.10\" -UASMNAME -UASMFNAME \r\n              -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME=_ -DASMFNAME=__ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -DHAVE_LAPACK_CONFIG_H -I../include -c -o lapacke_zupmtr_work.o lapacke_zupmtr_work.c\r\n     19708    /Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang -O2 -DMAX_STACK_ALLOC=2048 -DEXPRECISION -Wall -m64 -DF_INTERFACE_GFORT -fPIC -DDYNAMIC_ARCH -DNO_WARMUP -DMAX_CPU_NUMBER=4 -DMAX_PARALLEL_NUMBER=1 -DVERSION=\"0.3.10\" -UASMNAME -UASMFNAME \r\n              -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME=_ -DASMFNAME=__ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -DHAVE_LAPACK_CONFIG_H -I../include -c -o lapacke_cggsvp.o lapacke_cggsvp.c\r\n     19709    /Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang -O2 -DMAX_STACK_ALLOC=2048 -DEXPRECISION -Wall -m64 -DF_INTERFACE_GFORT -fPIC -DDYNAMIC_ARCH -DNO_WARMUP -DMAX_CPU_NUMBER=4 -DMAX_PARALLEL_NUMBER=1 -DVERSION=\"0.3.10\" -UASMNAME -UASMFNAME \r\n              -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME=_ -DASMFNAME=__ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -DHAVE_LAPACK_CONFIG_H -I../include -c -o lapacke_cggsvp_work.o lapacke_cggsvp_work.c\r\n     19710    /Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang -O2 -DMAX_STACK_ALLOC=2048 -DEXPRECISION -Wall -m64 -DF_INTERFACE_GFORT -fPIC -DDYNAMIC_ARCH -DNO_WARMUP -DMAX_CPU_NUMBER=4 -DMAX_PARALLEL_NUMBER=1 -DVERSION=\"0.3.10\" -UASMNAME -UASMFNAME \r\n              -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME=_ -DASMFNAME=__ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -DHAVE_LAPACK_CONFIG_H -I../include -c -o lapacke_dggsvp.o lapacke_dggsvp.c\r\n     19711    /Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang -O2 -DMAX_STACK_ALLOC=2048 -DEXPRECISION -Wall -m64 -DF_INTERFACE_GFORT -fPIC -DDYNAMIC_ARCH -DNO_WARMUP -DMAX_CPU_NUMBER=4 -DMAX_PARALLEL_NUMBER=1 -DVERSION=\"0.3.10\" -UASMNAME -UASMFNAME \r\n              -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME=_ -DASMFNAME=__ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -DHAVE_LAPACK_CONFIG_H -I../include -c -o lapacke_dggsvp_work.o lapacke_dggsvp_work.c\r\n     19712    /Users/healther/Documents/git.nosync/spack/lib/spack/env/clang/clang -O2 -DMAX_STACK_ALLOC=2048 -DEXPRECISION -Wall -m64 -DF_INTERFACE_GFORT -fPIC -DDYNAMIC_ARCH -DNO_WARMUP -DMAX_CPU_NUMBER=4 -DMAX_PARALLEL_NUMBER=1 -DVERSION=\"0.3.10\" -UASMNAME -UASMFNAME \r\n              -UNAME -UCNAME -UCHAR_NAME -UCHAR_CNAME -DASMNAME=_ -DASMFNAME=__ -DNAME=_ -DCNAME= -DCHAR_NAME=\"_\" -DCHAR_CNAME=\"\" -DNO_AFFINITY -I. -DHAVE_LAPACK_CONFIG_H -I../include -c -o lapacke_sggsvp.o lapacke_sggsvp.c\r\n  >> 19713    lapacke_cggsvp_work.c:52:9: error: implicit declaration of function 'cggsvp_' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\r\n     19714            LAPACK_cggsvp( &jobu, &jobv, &jobq, &m, &p, &n, a, &lda, b, &ldb, &tola,\r\n     19715            ^\r\n     19716    ../include/lapack.h:3771:23: note: expanded from macro 'LAPACK_cggsvp'\r\n     19717    #define LAPACK_cggsvp LAPACK_GLOBAL(cggsvp,CGGSVP)\r\n     19718                          ^\r\n     19719    ../include/lapacke_mangling.h:12:39: note: expanded from macro 'LAPACK_GLOBAL'\r\n\r\n     ...\r\n\r\n     19741    ../include/lapacke_mangling.h:12:39: note: expanded from macro 'LAPACK_GLOBAL'\r\n     19742    #define LAPACK_GLOBAL(lcname,UCNAME)  lcname##_\r\n     19743                                          ^\r\n     19744    <scratch space>:94:1: note: expanded from here\r\n     19745    cggsvp3_\r\n     19746    ^\r\n  >> 19747    lapacke_cggsvp_work.c:139:9: error: implicit declaration of function 'cggsvp_' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\r\n     19748            LAPACK_cggsvp( &jobu, &jobv, &jobq, &m, &p, &n, a_t, &lda_t, b_t,\r\n     19749            ^\r\n     19750    ../include/lapack.h:3771:23: note: expanded from macro 'LAPACK_cggsvp'\r\n     19751    #define LAPACK_cggsvp LAPACK_GLOBAL(cggsvp,CGGSVP)\r\n     19752                          ^\r\n     19753    ../include/lapacke_mangling.h:12:39: note: expanded from macro 'LAPACK_GLOBAL'\r\n     19754    #define LAPACK_GLOBAL(lcname,UCNAME)  lcname##_\r\n     19755                                          ^\r\n     19756    <scratch space>:229:1: note: expanded from here\r\n     19757    cggsvp_\r\n     19758    ^\r\n     19759    2 errors generated.\r\n  >> 19760    make[3]: *** [lapacke_cggsvp_work.o] Error 1\r\n     19761    make[3]: *** Waiting for unfinished jobs....\r\n  >> 19762    lapacke_dggsvp_work.c:48:9: error: implicit declaration of function 'dggsvp_' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\r\n     19763            LAPACK_dggsvp( &jobu, &jobv, &jobq, &m, &p, &n, a, &lda, b, &ldb, &tola,\r\n     19764            ^\r\n     19765    ../include/lapack.h:3763:23: note: expanded from macro 'LAPACK_dggsvp'\r\n     19766    #define LAPACK_dggsvp LAPACK_GLOBAL(dggsvp,DGGSVP)\r\n     19767                          ^\r\n     19768    ../include/lapacke_mangling.h:12:39: note: expanded from macro 'LAPACK_GLOBAL'\r\n\r\n     ...\r\n\r\n     19790    ../include/lapacke_mangling.h:12:39: note: expanded from macro 'LAPACK_GLOBAL'\r\n     19791    #define LAPACK_GLOBAL(lcname,UCNAME)  lcname##_\r\n     19792                                          ^\r\n     19793    <scratch space>:95:1: note: expanded from here\r\n     19794    dggsvp3_\r\n     19795    ^\r\n  >> 19796    lapacke_dggsvp_work.c:127:9: error: implicit declaration of function 'dggsvp_' is invalid in C99 [-Werror,-Wimplicit-function-declaration]\r\n     19797            LAPACK_dggsvp( &jobu, &jobv, &jobq, &m, &p, &n, a_t, &lda_t, b_t,\r\n     19798            ^\r\n     19799    ../include/lapack.h:3763:23: note: expanded from macro 'LAPACK_dggsvp'\r\n     19800    #define LAPACK_dggsvp LAPACK_GLOBAL(dggsvp,DGGSVP)\r\n     19801                          ^\r\n     19802    ../include/lapacke_mangling.h:12:39: note: expanded from macro 'LAPACK_GLOBAL'\r\n     19803    #define LAPACK_GLOBAL(lcname,UCNAME)  lcname##_\r\n     19804                                          ^\r\n     19805    <scratch space>:229:1: note: expanded from here\r\n     19806    dggsvp_\r\n     19807    ^\r\n     19808    2 errors generated.\r\n  >> 19809    make[3]: *** [lapacke_dggsvp_work.o] Error 1\r\n  >> 19810    make[2]: *** [lapacke] Error 2\r\n  >> 19811    make[1]: *** [lapackelib] Error 2\r\n  >> 19812    make: *** [netlib] Error 2\r\n\r\nSee build log for details:\r\n  /var/folders/1q/jxx1cgcx3l13d153s6_c1zc00000gn/T/healther/spack-stage/spack-stage-openblas-0.3.10-gkmqerz6bgkp6uw5jdkmeiiadxlwyyhw/spack-build-out.txt\r\n```\r\n\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install openblas\r\n...\r\n```\r\n\r\n### Information on your system\r\n\r\n```\r\nspack:\r\n  # add package specs to the `specs` list\r\n  specs: [py-notebook ^python@3.7.4, py-numpy, py-scipy, nest~mpi~optimize~openmp,\r\n    py-matplotlib, py-ipython, py-line-profiler, py-memory-profiler, boost, yaml-cpp,\r\n    ccache, py-pudb, htop, py-virtualenv, py-sympy, py-scikit-optimize, py-scikit-learn,\r\n    py-scikit-image, py-requests, py-flake8, py-black, py-pandas, py-numba, py-tornado,\r\n    py-ics, py-xlrd, py-git-review, py-seaborn, openssh, py-pynn, py-sbs]\r\n  view: true\r\n  config: {}\r\n  mirrors: {}\r\n  modules:\r\n    enable: []\r\n  packages: {}\r\n  repos: []\r\n  upstreams: {}\r\n  definitions: []\r\n  concretization: together\r\n  compilers:\r\n  - compiler:\r\n      spec: apple-clang@12.0.0\r\n      paths:\r\n        cc: /usr/bin/clang\r\n        cxx: /usr/bin/clang++\r\n        f77: /Users/healther/Documents/git.nosync/spack/opt/spack/darwin-catalina-x86_64/apple-clang-12.0.0/gcc-10.2.0-j73olo3b5grspw4skyyfkynhtnagj3hd/bin/gfortran\r\n        fc: /Users/healther/Documents/git.nosync/spack/opt/spack/darwin-catalina-x86_64/apple-clang-12.0.0/gcc-10.2.0-j73olo3b5grspw4skyyfkynhtnagj3hd/bin/gfortran\r\n      flags: {}\r\n      operating_system: catalina\r\n      target: x86_64\r\n      modules: []\r\n      environment: {unset: []}\r\n      extra_rpaths: []\r\n```\r\n\r\n### Additional information\r\n",
    "performed_via_github_app": null
}