{
    "url": "https://api.github.com/repos/spack/spack/issues/13051",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13051/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13051/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13051/events",
    "html_url": "https://github.com/spack/spack/issues/13051",
    "id": 502741656,
    "node_id": "MDU6SXNzdWU1MDI3NDE2NTY=",
    "number": 13051,
    "title": "Installation issue: petsc4py",
    "user": {
        "login": "shuds13",
        "id": 16457059,
        "node_id": "MDQ6VXNlcjE2NDU3MDU5",
        "avatar_url": "https://avatars.githubusercontent.com/u/16457059?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shuds13",
        "html_url": "https://github.com/shuds13",
        "followers_url": "https://api.github.com/users/shuds13/followers",
        "following_url": "https://api.github.com/users/shuds13/following{/other_user}",
        "gists_url": "https://api.github.com/users/shuds13/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/shuds13/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/shuds13/subscriptions",
        "organizations_url": "https://api.github.com/users/shuds13/orgs",
        "repos_url": "https://api.github.com/users/shuds13/repos",
        "events_url": "https://api.github.com/users/shuds13/events{/privacy}",
        "received_events_url": "https://api.github.com/users/shuds13/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2019-10-04T16:54:05Z",
    "updated_at": "2019-10-22T19:43:06Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "petsc4py cannot find numpy on Theta (Cray XC40).\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n\r\nI am building on the Theta MOM nodes with:\r\n\r\n$ aprun -cc none -n 1 python $SPACKDIR/bin/spack  install -j 8 py-petsc4py\r\n\r\nOther packages have been built (see additional information). Also see packages.yaml.\r\n\r\nError message:\r\n==> hdf5@1.8.16 : has external module in cray-hdf5-parallel/1.8.16\r\n==> hdf5@1.8.16 : is actually installed in /opt/cray/pe/hdf5-parallel/1.8.16/INTEL/15.0\r\n==> hdf5@1.8.16 : already registered in DB\r\n==> intel-mkl@18.0.0.128 : externally installed in /opt/intel\r\n==> intel-mkl@18.0.0.128 : already registered in DB\r\n==> mpich@7.7.3 : has external module in cray-mpich/7.7.3\r\n==> mpich@7.7.3 : is actually installed in /opt/cray/pe/mpt/7.7.3/gni/mpich-intel/16.0\r\n==> mpich@7.7.3 : already registered in DB\r\n==> hypre is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/hypre-2.16.0-7lassjtlqx5yb2xo5mdcfaky3ow6wipy\r\n==> cmake@3.14.5 : has external module in cmake/3.14.5\r\n==> cmake@3.14.5 : is actually installed in /soft/buildtools/cmake/3.14.5\r\n==> cmake@3.14.5 : already registered in DB\r\n==> metis is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/metis-5.1.0-w55hn3as2v2tgxpjgzd6bjvi5oiybavj\r\n==> parmetis is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/parmetis-4.0.3-q3yum2iwdf4nokrrpf7khisamjsfpprr\r\n==> python@3.6 : has external module in intelpython36/2019.3.075\r\n==> python@3.6 : is actually installed in /soft/interpreters/python/3.6/intel/2019.3.075\r\n==> python@3.6 : already registered in DB\r\n==> superlu-dist is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/superlu-dist-6.1.1-ir2n4d65jrmngluqip76erndhdlunarb\r\n==> zlib is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/zlib-1.2.11-s7bdjvahlkb3xxahosfntgntfz2lx5pd\r\n==> petsc is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/petsc-3.11.3-hvhj6mlbaqhw34ly2hai7pttkgdtq3o3\r\n==> py-mpi4py@3.0.2 : has external module in datascience/intelpython36/mpi4py-3.0.2\r\n==> py-mpi4py@3.0.2 : is actually installed in None\r\n==> py-mpi4py@3.0.2 : already registered in DB\r\n==> py-setuptools is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/py-setuptools-41.0.1-gdjyjx2kjxj6s44s2n36kdxxwd2itk7z\r\n==> py-numpy is already installed in <USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/py-numpy-1.16.4-yj7ttmckx7qmn3cjbmhogew5btckyeny\r\n==> Installing py-petsc4py\r\n==> Searching for binary cache of py-petsc4py\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for py-petsc4py found: installing from source\r\n==> Using cached archive: <USER_HOME_DIR>/spackdev/var/spack/cache/py-petsc4py/py-petsc4py-3.11.0.tar.gz\r\n==> Staging archive: <USER_HOME_DIR>/spackdev/var/spack/stage/py-petsc4py-3.11.0-i5276ua3nfjfah4evgxcfd3ijku5conj/3.11.0.tar.gz\r\n==> Created stage in <USER_HOME_DIR>/spackdev/var/spack/stage/py-petsc4py-3.11.0-i5276ua3nfjfah4evgxcfd3ijku5conj\r\n==> No patches needed for py-petsc4py\r\n==> Building py-petsc4py [PythonPackage]\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/soft/interpreters/python/3.6/intel/2019.3.075/bin/python3.6' '-s' 'setup.py' '--no-user-cfg' 'build'\r\n\r\n2 errors found in build log:\r\n     39    creating build/temp.linux-x86_64-3.6\r\n     40    creating build/temp.linux-x86_64-3.6/src\r\n     41    cc -pthread -fPIC -fPIC -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wformat -Wformat-security -D_FORTIFY_SOURCE=2 -fstack-protector -O3 -fpic -fPIC -Wformat -Wformat-security -D_FORTIFY_SOURCE=2 -fstack-protector -O3 -fpic -fPIC -DPETSC_DIR=<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/petsc-3.11.3-hvhj6mlbaqhw34ly2hai7pttkgdtq3o3 -I<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/zlib-1.2.11-s7bdjvahlkb3xxahosfntgntfz2lx5pd/include -I<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/metis-5.1.0-w55hn3as2v2tgxpjgzd6bjvi5oiybavj/include -I<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/parmetis-4.0.3-q3yum2iwdf4nokrrpf7khisamjsfpprr/include -I/opt/cray/pe/hdf5-parallel/1.8.16/INTEL/15.0/include -I<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/superlu-dist-6.1.1-ir2n4d65jrmngluqip76erndhdlunarb/include -I<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/hypre-2.16.0-7lassjtlqx5yb2xo5mdcfaky3ow6wipy/include -I<USER_HOME_DIR>/spackdev/opt/spack/cray-cnl6-mic_knl/intel-18.0.0.128/petsc-3.11.3-hvhj6mlbaqhw34ly2hai7pttkgdtq3o3/include -Isrc/include -I/soft/interpreters/python/3.6/intel/2019.3.075/include/python3.6m -c src/PETSc.c -o build/temp.linux-x86_64-3.6/src/PETSc.o\r\n     42    icc: command line warning #10006: ignoring unknown option '-Wno-unused-result'\r\n     43    In file included from src/petsc4py.PETSc.c(615),\r\n     44                     from src/PETSc.c(4):\r\n  >> 45    src/include/petsc4py/numpy.h(11): catastrophic error: cannot open source file \"numpy/arrayobject.h\"\r\n     46      #include \"numpy/arrayobject.h\"\r\n     47                                    ^\r\n     48    \r\n     49    compilation aborted for src/PETSc.c (code 4)\r\n     50    /soft/interpreters/python/3.6/intel/2019.3.075/lib/python3.6/site-packages/Cython/Compiler/Main.py:367: FutureWarning: Cython directive 'language_level' not set, using 2 for now (Py2). This will change in a later release! File: include/petsc4py/PETSc.pxd\r\n     51      tree = Parsing.p_module(s, pxd, full_module_name)\r\n     52    /soft/interpreters/python/3.6/intel/2019.3.075/lib/python3.6/site-packages/Cython/Compiler/Main.py:367: FutureWarning: Cython directive 'language_level' not set, using 2 for now (Py2). This will change in a later release! File: <USER_HOME_DIR>/spack-temp/stage/spack-stage/spack-stage-XT8eIZ/spack-src/src/libpetsc4py/libpetsc4py.pyx\r\n     53      tree = Parsing.p_module(s, pxd, full_module_name)\r\n  >> 54    error: command 'cc' failed with exit status 4\r\n\r\nSee build log for details:\r\n  <USER_HOME_DIR>/spackdev/var/spack/stage/py-petsc4py-3.11.0-i5276ua3nfjfah4evgxcfd3ijku5conj/spack-build-out.txt\r\n\r\nApplication 16690094 exit codes: 1\r\nApplication 16690094 resources: utime ~248s, stime ~47s, Rss ~209956, inblocks ~47762, outblocks ~0\r\n\r\nMy aim is to build py-ilbensemble with all optional dependencies, but the issue occurs when building py-petsc4py. \r\n\r\n```\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```commandline\r\n$ uname -a\r\nLinux thetamom3 4.4.103-6.38_4.0.153-cray_ari_s #1 SMP Thu Nov 1 16:05:01 UTC 2018 (6ef8fef) x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n$ lsb_release -d\r\nDescription:\tSUSE Linux Enterprise Server 12 SP3\r\n``` \r\n[config.yaml.txt](https://github.com/spack/spack/files/3691338/config.yaml.txt)\r\n[packages.yaml.txt](https://github.com/spack/spack/files/3691339/packages.yaml.txt)\r\n\r\n### Additional information\r\n\r\n```console\r\n$ spack spec --install-status py-petsc4py\r\nInput spec\r\n--------------------------------\r\n -   py-petsc4py\r\n\r\nConcretized\r\n--------------------------------\r\n -   py-petsc4py@3.11.0%intel@18.0.0.128 arch=cray-cnl6-mic_knl\r\n[+]      ^petsc@3.11.3%intel@18.0.0.128~X clanguage=C ~complex~debug+double~fftw+hdf5+hypre~int64~knl+metis+mpi~mumps+shared~suite-sparse+superlu-dist~trilinos arch=cray-cnl6-mic_knl\r\n[+]          ^hdf5@1.8.16%intel@18.0.0.128~cxx~debug+fortran+hl+mpi+pic+shared~szip~threadsafe arch=cray-cnl6-mic_knl\r\n[+]          ^hypre@2.16.0%intel@18.0.0.128~debug~int64~internal-superlu+mpi+shared~superlu-dist arch=cray-cnl6-mic_knl\r\n[+]              ^intel-mkl@18.0.0.128%intel@18.0.0.128~ilp64+shared threads=none arch=cray-cnl6-mic_knl\r\n[+]              ^mpich@7.7.3%intel@18.0.0.128 device=ch3 +hydra netmod=tcp +pci pmi=pmi +romio~slurm~verbs+wrapperrpath arch=cray-cnl6-mic_knl\r\n[+]          ^metis@5.1.0%intel@18.0.0.128 build_type=Release ~gdb~int64 patches=4991da938c1d3a1d3dea78e49bbebecba00273f98df2a656e38b83d55b281da1 ~real64+shared arch=cray-cnl6-mic_knl\r\n[+]              ^cmake@3.14.5%intel@18.0.0.128~doc+ncurses+openssl+ownlibs~qt arch=cray-cnl6-mic_knl\r\n[+]          ^parmetis@4.0.3%intel@18.0.0.128 build_type=RelWithDebInfo ~gdb patches=4f892531eb0a807eb1b82e683a416d3e35154a455274cf9b162fb02054d11a5b,50ed2081bc939269689789942067c58b3e522c269269a430d5d34c00edbc5870,704b84f7c7444d4372cb59cca6e1209df4ef3b033bc4ee3cf50f369bce972a9d +shared arch=cray-cnl6-mic_knl\r\n[+]          ^python@3.6%intel@18.0.0.128+bz2+ctypes+dbm+lzma~nis~optimizations patches=ebdca648c9c1d25f586d7e2a495b62e6d91973b55264a13d89eda1beff72ef56 +pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4~uuid+zlib arch=cray-cnl6-mic_knl\r\n[+]          ^superlu-dist@6.1.1%intel@18.0.0.128 build_type=RelWithDebInfo ~int64+shared arch=cray-cnl6-mic_knl\r\n[+]          ^zlib@1.2.11%intel@18.0.0.128+optimize+pic+shared arch=cray-cnl6-mic_knl\r\n[+]      ^py-mpi4py@3.0.2%intel@18.0.0.128 arch=cray-cnl6-mic_knl\r\n[+]      ^py-numpy@1.16.4%intel@18.0.0.128+blas+lapack arch=cray-cnl6-mic_knl\r\n[+]          ^py-setuptools@41.0.1%intel@18.0.0.128 arch=cray-cnl6-mic_knl\r\n``` \r\n\r\nI have also tried to do this in a speck environment and activating using the --with-view option.\r\n",
    "performed_via_github_app": null
}