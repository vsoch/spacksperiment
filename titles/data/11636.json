{
    "url": "https://api.github.com/repos/spack/spack/issues/11636",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/11636/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/11636/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/11636/events",
    "html_url": "https://github.com/spack/spack/issues/11636",
    "id": 452641895,
    "node_id": "MDU6SXNzdWU0NTI2NDE4OTU=",
    "number": 11636,
    "title": "Spack install no-checksum not working correctly with spack environments",
    "user": {
        "login": "prckent",
        "id": 13683814,
        "node_id": "MDQ6VXNlcjEzNjgzODE0",
        "avatar_url": "https://avatars.githubusercontent.com/u/13683814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/prckent",
        "html_url": "https://github.com/prckent",
        "followers_url": "https://api.github.com/users/prckent/followers",
        "following_url": "https://api.github.com/users/prckent/following{/other_user}",
        "gists_url": "https://api.github.com/users/prckent/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/prckent/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/prckent/subscriptions",
        "organizations_url": "https://api.github.com/users/prckent/orgs",
        "repos_url": "https://api.github.com/users/prckent/repos",
        "events_url": "https://api.github.com/users/prckent/events{/privacy}",
        "received_events_url": "https://api.github.com/users/prckent/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 9,
    "created_at": "2019-06-05T18:06:14Z",
    "updated_at": "2021-05-13T22:53:18Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I am having trouble using the --no-checksum setting with install and spack environments.\r\nUse case involves setting up multiple compilers and libraries using the spack environments capability to simplify development and testing of another program and avoid the maintenance headache of a brittle version specific script. The --no-checksum setting does not appear to work with e.g. libxml2 on the install line when it is invoked in the second created environment. A workaround would be very helpful.\r\n\r\n### Steps to reproduce the issue\r\n\r\nSimplified script:\r\n\r\n```\r\nrm -r -f $HOME/apps/spack\r\nrm -f $HOME/.spack/linux/compilers.yaml\r\ncd $HOME/apps\r\ngit clone https://github.com/spack/spack.git\r\ncd spack/bin\r\n./spack bootstrap\r\n\r\nmodule() { eval `/usr/bin/modulecmd bash $*`; }\r\n\r\nexport SPACK_ROOT=$HOME/apps/spack\r\n. $SPACK_ROOT/share/spack/setup-env.sh\r\n\r\necho --- Spack list\r\nspack find\r\necho --- Modules list\r\nmodule list\r\necho --- End listings\r\n\r\ngcc_vnew=8.3.0\r\ngcc_vold=5.5.0\r\nlibxml2_vnew=2.9.9\r\nlibxml2_vold=2.9.1\r\n\r\necho --- START env `date`\r\nspack env create gccnewbuild\r\nspack env activate gccnewbuild\r\nspack install gcc@${gcc_vnew}\r\nspack load gcc@${gcc_vnew}\r\nspack compiler add\r\nspack add libxml2@${libxml2_vnew}%gcc@${gcc_vnew}\r\n# Intended usage would have many more adds here\r\n\r\nspack install --no-checksum #because some packages such as libxml2 don't have checksums\r\nspack env deactivate\r\necho --- FINISH env `date`\r\n\r\necho --- START env `date`\r\nspack env create gccoldbuild\r\nspack env activate gccoldbuild\r\nspack install gcc@${gcc_vold}\r\nspack load gcc@${gcc_vold}\r\nspack compiler add\r\nspack add libxml2@${libxml2_vold}%gcc@${gcc_vold}\r\n# Intended usage would have many more adds here\r\n\r\nspack install --no-checksum\r\nspack env deactivate\r\necho --- FINISH env `date`\r\n```\r\n\r\n### Error Message\r\n\r\nThe error occurs on the second install of libxml2. The first installation of libxml2 appears to be successful.\r\n\r\n```\r\n==> Successfully installed zlib\r\n  Fetch: 0.00s.  Build: 1.43s.  Total: 1.44s.\r\n[+] /home/pk7/apps/spack/opt/spack/linux-rhel7-x86_64/gcc-5.5.0/zlib-1.2.11-56rgaosb4ij2unhwfsnbiv7z3qjximce\r\n==> Warning: No Spack mirrors are currently configured\r\n==> Installing libxml2\r\n==> Searching for binary cache of libxml2\r\n==> No binary for libxml2 found: installing from source\r\n==> Warning: There is no checksum on file to fetch libxml2@2.9.1 safely.\r\n==> Error: FetchError: Will not fetch libxml2@2.9.1\r\n    Add a checksum or use --no-checksum to skip this check.\r\n\r\n/home/pk7/apps/spack/lib/spack/spack/package.py:996, in do_fetch:\r\n        993                    tty.msg(\"Fetching with no checksum.\", ck_msg)\r\n        994\r\n        995            if not ignore_checksum:\r\n  >>    996                raise FetchError(\"Will not fetch %s\" %\r\n        997                                 self.spec.format('{name}{@version}'), ck_msg)\r\n        998\r\n        999        self.stage.create()\r\n\r\n```\r\n\r\n### Information on your system\r\n\r\nSystem is a RHEL 7.6 box. spack is today's head version.\r\n\r\n",
    "performed_via_github_app": null
}