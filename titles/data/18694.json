{
    "url": "https://api.github.com/repos/spack/spack/issues/18694",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/18694/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/18694/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/18694/events",
    "html_url": "https://github.com/spack/spack/issues/18694",
    "id": 702873295,
    "node_id": "MDU6SXNzdWU3MDI4NzMyOTU=",
    "number": 18694,
    "title": "binary relocation: libtool control files: hardcoded paths to libstdc++.la are ploblematic",
    "user": {
        "login": "eugeneswalker",
        "id": 38933153,
        "node_id": "MDQ6VXNlcjM4OTMzMTUz",
        "avatar_url": "https://avatars.githubusercontent.com/u/38933153?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eugeneswalker",
        "html_url": "https://github.com/eugeneswalker",
        "followers_url": "https://api.github.com/users/eugeneswalker/followers",
        "following_url": "https://api.github.com/users/eugeneswalker/following{/other_user}",
        "gists_url": "https://api.github.com/users/eugeneswalker/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/eugeneswalker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/eugeneswalker/subscriptions",
        "organizations_url": "https://api.github.com/users/eugeneswalker/orgs",
        "repos_url": "https://api.github.com/users/eugeneswalker/repos",
        "events_url": "https://api.github.com/users/eugeneswalker/events{/privacy}",
        "received_events_url": "https://api.github.com/users/eugeneswalker/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 880675484,
            "node_id": "MDU6TGFiZWw4ODA2NzU0ODQ=",
            "url": "https://api.github.com/repos/spack/spack/labels/binary-packages",
            "name": "binary-packages",
            "color": "fc5fb3",
            "default": false,
            "description": ""
        },
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 759411369,
            "node_id": "MDU6TGFiZWw3NTk0MTEzNjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/buildcache",
            "name": "buildcache",
            "color": "bf354c",
            "default": false,
            "description": null
        },
        {
            "id": 1474769306,
            "node_id": "MDU6TGFiZWwxNDc0NzY5MzA2",
            "url": "https://api.github.com/repos/spack/spack/labels/e4s",
            "name": "e4s",
            "color": "5224ad",
            "default": false,
            "description": ""
        },
        {
            "id": 966031931,
            "node_id": "MDU6TGFiZWw5NjYwMzE5MzE=",
            "url": "https://api.github.com/repos/spack/spack/labels/ecp",
            "name": "ecp",
            "color": "79d7ea",
            "default": false,
            "description": ""
        },
        {
            "id": 512483390,
            "node_id": "MDU6TGFiZWw1MTI0ODMzOTA=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-medium",
            "name": "impact-medium",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 5,
    "created_at": "2020-09-16T15:42:12Z",
    "updated_at": "2020-10-13T16:15:49Z",
    "closed_at": "2020-10-13T16:15:49Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Libtool control files can contain hardcoded paths to `libstdc++.la`. This can break builds when packages that contain these hardcoded paths get cached in a build cache, and are then subsequently installed into a target environment where `libstdc++.la` is not in the same location. \r\n\r\nFor instance, if I build the dependencies of `hpctoolkit` in an environment where `libstdc++.la` is at\r\n```\r\n/spack-build/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-8.1.0-glpr3bujg7j5hxvesdbis4cjqzwlncth/lib/../lib64/libstdc++.la\r\n``` \r\n\r\nThen the following files end up with this path hardcoded:\r\n```\r\n/spack-build/opt/spack/linux-centos7-x86_64/gcc-8.1.0/berkeley-db-18.1.40-uasyknrjfdzy2xfoswjqn36w7yzovyts/lib/libdb_cxx-18.1.la\r\n/spack-build/opt/spack/linux-centos7-x86_64/gcc-8.1.0/berkeley-db-18.1.40-uasyknrjfdzy2xfoswjqn36w7yzovyts/lib/libdb_stl-18.1.la\r\n/spack-build/opt/spack/linux-centos7-x86_64/gcc-8.1.0/gettext-0.21-md2v74tvbcqvsu56jmlre3p6mnms5tzm/lib/libasprintf.la\r\n/spack-build/opt/spack/linux-centos7-x86_64/gcc-8.1.0/mpich-3.2.1-y2wrnnftiawtynzg4qzugcfqktatnh64/lib/libmpicxx.la\r\n/spack-build/opt/spack/linux-centos7-x86_64/gcc-8.1.0/xerces-c-3.2.2-ba55khya5d3b6526s2lpzxadl24figaq/lib/libxerces-c.la\r\n```\r\n\r\nIf I then cache all the dependencies of `hpctoolkit`, and subsequently install those dependencies into an environment where `gcc@8.1.0` is installed to `/packages/gcc/8.1`,  this is what happens when you try to build `hpctoolkit`:\r\n\r\n```\r\n==> Installing hpctoolkit\r\n==> hpctoolkit: Executing phase: 'autoreconf'\r\n==> hpctoolkit: Executing phase: 'configure'\r\n==> hpctoolkit: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n\r\n5 errors found in build log:\r\n...\r\n     1250    /bin/sh ../../../libtool  --tag=CXX   --mode=link /spack-test/lib/spack/env/gcc/g++ -g -O3 -Wall  -faligned-new -I/tmp/eugeneswalker/sp\r\n             ack-stage/spack-stage-hpctoolkit-2020.08.03-h7pd5znfeg25vx5d7pijtvkrmqqnljrr/spack-src/src -I/tmp/eugeneswalker/spack-stage/spack-stage-hpctoolki\r\n             t-2020.08.03-h7pd5znfeg25vx5d7pijtvkrmqqnljrr/spack-src/src -I/spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/binutils-2.33.1\r\n             -qmxhsmfvocs5u4qfad3prpixgjtjocgo/include -I/spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/xerces-c-3.2.2-ba55khya5d3b6526s2\r\n             lpzxadl24figaq/include  -g -O3 -Wall  -faligned-new -L/spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/xerces-c-3.2.2-ba55khya\r\n             5d3b6526s2lpzxadl24figaq/lib -L/spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/xz-5.2.5-fqzrczlylvl333jhjlasdsc5n2ydugxo/lib\r\n             -llzma  -o hpcprof-bin hpcprof_bin-main.o hpcprof_bin-Args.o ../../../src/lib/analysis/libHPCanalysis.la ../../../src/lib/banal/libHPCbanal_\r\n             simple.la ../../../src/lib/profxml/libHPCprofxml.la ../../../src/lib/prof/libHPCprof.la ../../../src/lib/binutils/libHPCbinutils.la ../../..\r\n             /src/lib/prof-lean/libHPCprof-lean.la ../../../src/lib/isa/libHPCisa.la -L/spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/int\r\n             el-xed-2019.03.01-ivkiqjbbhifszwlm3ncetcnztjqr5gjy/lib -lxed ../../../src/lib/xml/libHPCxml.la ../../../src/lib/support/libHPCsupport.la ../\r\n             ../../src/lib/support-lean/libHPCsupport-lean.la -L/spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/elfutils-0.180-s4ib3ctvhay\r\n             jk7l3r2diozomettjzdwj/lib -ldw -lelf /spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/xz-5.2.5-fqzrczlylvl333jhjlasdsc5n2ydugx\r\n             o/lib/liblzma.a -lxerces-c -lxerces-c /spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/binutils-2.33.1-qmxhsmfvocs5u4qfad3prpi\r\n             xgjtjocgo/lib/libbfd.a /spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/binutils-2.33.1-qmxhsmfvocs5u4qfad3prpixgjtjocgo/lib64\r\n             /libiberty.a -ldl /spack-test/opt/spack/linux-centos7-x86_64/gcc-8.1.0/zlib-1.2.11-sh7mgsynw6uq2lkaqsv4ty5zerjfu7ww/lib/libz.a -lm\r\n  >> 1251    libtool:   error: cannot find the library '/spack-test/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-8.1.0-glpr3bujg7j5hxvesdbis4cj\r\n             qzwlncth/lib/../lib64/libstdc++.la' or unhandled argument '/spack-test/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-8.1.0-glpr3buj\r\n             g7j5hxvesdbis4cjqzwlncth/lib/../lib64/libstdc++.la'\r\n  >> 1252    make[3]: *** [hpcprof-bin] Error 1\r\n     1253    make[3]: Leaving directory `/tmp/eugeneswalker/spack-stage/spack-stage-hpctoolkit-2020.08.03-h7pd5znfeg25vx5d7pijtvkrmqqnljrr/spack-src/src/tool/\r\n             hpcprof'\r\n  >> 1254    make[2]: *** [all-recursive] Error 1\r\n     1255    make[2]: Leaving directory `/tmp/eugeneswalker/spack-stage/spack-stage-hpctoolkit-2020.08.03-h7pd5znfeg25vx5d7pijtvkrmqqnljrr/spack-src/src/tool'\r\n  >> 1256    make[1]: *** [all-recursive] Error 1\r\n     1257    make[1]: Leaving directory `/tmp/eugeneswalker/spack-stage/spack-stage-hpctoolkit-2020.08.03-h7pd5znfeg25vx5d7pijtvkrmqqnljrr/spack-src/src'\r\n  >> 1258    make: *** [all-recursive] Error 1\r\n...\r\n```\r\n\r\nNotice in the error output that although the Spack `install_tree` was re-written, where the original install tree of `/spack-build/opt/spack` was replaced with `/spack-test/opt/spack`, you still have these paths:\r\n\r\n```\r\n  >> 1251    libtool:   error: cannot find the library '/spack-test/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-8.1.0-glpr3bujg7j5hxvesdbis4cj\r\n             qzwlncth/lib/../lib64/libstdc++.la' or unhandled argument '/spack-test/opt/spack/linux-centos7-x86_64/gcc-4.8.5/gcc-8.1.0-glpr3buj\r\n             g7j5hxvesdbis4cjqzwlncth/lib/../lib64/libstdc++.la'\r\n```\r\n\r\n@gartung @alalazo @tgamblin @becker33 @scottwittenburg ",
    "performed_via_github_app": null
}