{
    "url": "https://api.github.com/repos/spack/spack/issues/7150",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7150/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7150/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7150/events",
    "html_url": "https://github.com/spack/spack/issues/7150",
    "id": 293267377,
    "node_id": "MDU6SXNzdWUyOTMyNjczNzc=",
    "number": 7150,
    "title": "gdal: Bad Install Name for Shared Library",
    "user": {
        "login": "citibeth",
        "id": 1924215,
        "node_id": "MDQ6VXNlcjE5MjQyMTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1924215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/citibeth",
        "html_url": "https://github.com/citibeth",
        "followers_url": "https://api.github.com/users/citibeth/followers",
        "following_url": "https://api.github.com/users/citibeth/following{/other_user}",
        "gists_url": "https://api.github.com/users/citibeth/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/citibeth/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/citibeth/subscriptions",
        "organizations_url": "https://api.github.com/users/citibeth/orgs",
        "repos_url": "https://api.github.com/users/citibeth/repos",
        "events_url": "https://api.github.com/users/citibeth/events{/privacy}",
        "received_events_url": "https://api.github.com/users/citibeth/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2018-01-31T18:39:26Z",
    "updated_at": "2018-02-01T02:51:05Z",
    "closed_at": "2018-02-01T02:51:05Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "\r\n[build.out.txt](https://github.com/spack/spack/files/1682861/build.out.txt)\r\nI did `spack install gdal` on macOS High Sierra and the latest Spack.  It worked, and installed `libgdal.dylib`.  However, this library will not load with `dlopen()` (or any other way), because it has ITSELF as a dependency, but in the stage --- which has since been deleted.\r\n\r\n```\r\n$ cd `spack location -i gdal`/lib\r\n$ otool -L libgdal.dylib\r\nlibgdal.dylib:\r\n\t/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/libgdal.dylib (compatibility version 0.0.0, current version 0.0.0)\r\n\t/Users/citibeth/spack/melissa/opt/spack/darwin-highsierra-x86_64/clang-9.0.0-apple/sqlite-3.21.0-2vkzp2on66wjjfmwg3xsg3rqgofq7x7d/lib/libsqlite3.0.dylib (compatibility version 9.0.0, current version 9.6.0)\r\n\t/usr/lib/libexpat.1.dylib (compatibility version 7.0.0, current version 8.0.0)\r\n    ...\r\n```\r\n\r\nMy workaround for now is to hack `gdal/package.py` to install static.  Does anyone have any insight on this problem?  Is it specific to GDAL, or common for all of macOS?\r\n\r\nI've included the link line from `spack-build.out` below; and also attached the entire build log.  After it links, it does some other stuff to the library, maybe that's causing the problem.\r\n\r\n```\r\n/Users/citibeth/spack/melissa/lib/spack/env/clang/clang++\r\n-dynamiclib\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/frmts/o/*.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/gcore/*.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/port/*.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/alg/*.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/commonutils.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdalinfo_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdal_translate_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdalwarp_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/ogr2ogr_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdaldem_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/nearblack_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdal_grid_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdal_rasterize_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/apps/gdalbuildvrt_lib.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/ogr/ogrsf_frmts/o/*.o\r\n./ogr/ogrgeometryfactory.o\r\n./ogr/ogrpoint.o\r\n./ogr/ogrcurve.o\r\n./ogr/ogrlinestring.o\r\n./ogr/ogrlinearring.o\r\n./ogr/ogrpolygon.o\r\n./ogr/ogrutils.o\r\n./ogr/ogrgeometry.o\r\n./ogr/ogrgeometrycollection.o\r\n./ogr/ogrmultipolygon.o\r\n./ogr/ogrsurface.o\r\n./ogr/ogrmultipoint.o\r\n./ogr/ogrmultilinestring.o\r\n./ogr/ogrcircularstring.o\r\n./ogr/ogrcompoundcurve.o\r\n./ogr/ogrcurvepolygon.o\r\n./ogr/ogrcurvecollection.o\r\n./ogr/ogrmulticurve.o\r\n./ogr/ogrmultisurface.o\r\n./ogr/ogr_api.o\r\n./ogr/ogrfeature.o\r\n./ogr/ogrfeaturedefn.o\r\n./ogr/ogrfeaturequery.o\r\n./ogr/ogrfeaturestyle.o\r\n./ogr/ogrfielddefn.o\r\n./ogr/ogrspatialreference.o\r\n./ogr/ogr_srsnode.o\r\n./ogr/ogr_srs_proj4.o\r\n./ogr/ogr_fromepsg.o\r\n./ogr/ogrct.o\r\n./ogr/ogr_opt.o\r\n./ogr/ogr_srs_esri.o\r\n./ogr/ogr_srs_pci.o\r\n./ogr/ogr_srs_usgs.o\r\n./ogr/ogr_srs_dict.o\r\n./ogr/ogr_srs_panorama.o\r\n./ogr/ogr_srs_ozi.o\r\n./ogr/ogr_srs_erm.o\r\n./ogr/swq.o\r\n./ogr/swq_expr_node.o\r\n./ogr/swq_parser.o\r\n./ogr/swq_select.o\r\n./ogr/swq_op_registrar.o\r\n./ogr/swq_op_general.o\r\n./ogr/ogr_srs_validate.o\r\n./ogr/ogr_srs_xml.o\r\n./ogr/ograssemblepolygon.o\r\n./ogr/ogr2gmlgeometry.o\r\n./ogr/gml2ogrgeometry.o\r\n./ogr/ogr_expat.o\r\n./ogr/ogrpgeogeometry.o\r\n./ogr/ogrgeomediageometry.o\r\n./ogr/ogr_geocoding.o\r\n./ogr/osr_cs_wkt.o\r\n./ogr/osr_cs_wkt_parser.o\r\n./ogr/ogrgeomfielddefn.o\r\n./ogr/ograpispy.o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/libgdal.a\r\n-lsqlite3\r\n-lexpat\r\n-ljpeg\r\n-ltiff\r\n-lpng\r\n-llzma\r\n-lz\r\n-lpthread\r\n-ldl\r\n-lpcre\r\n-lcurl\r\n-liconv\r\n-L/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/lib\r\n-lxml2\r\n-lz\r\n-lpthread\r\n-licucore\r\n-lm\r\n-o\r\n/private/var/folders/gd/t1br2vk136z0zj9d9cx8t4kc0000gp/T/citibeth/spack-stage/spack-stage-d1jL_y/gdal-2.1.2/libgdal.dylib\r\n```\r\n",
    "performed_via_github_app": null
}