{
    "url": "https://api.github.com/repos/spack/spack/issues/3484",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/3484/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/3484/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/3484/events",
    "html_url": "https://github.com/spack/spack/issues/3484",
    "id": 215114999,
    "node_id": "MDU6SXNzdWUyMTUxMTQ5OTk=",
    "number": 3484,
    "title": "`spack activate py-virtualenv` fails to activate `py-setuptools`",
    "user": {
        "login": "hartzell",
        "id": 312978,
        "node_id": "MDQ6VXNlcjMxMjk3OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/312978?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hartzell",
        "html_url": "https://github.com/hartzell",
        "followers_url": "https://api.github.com/users/hartzell/followers",
        "following_url": "https://api.github.com/users/hartzell/following{/other_user}",
        "gists_url": "https://api.github.com/users/hartzell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hartzell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hartzell/subscriptions",
        "organizations_url": "https://api.github.com/users/hartzell/orgs",
        "repos_url": "https://api.github.com/users/hartzell/repos",
        "events_url": "https://api.github.com/users/hartzell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hartzell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-03-17T20:33:32Z",
    "updated_at": "2017-03-19T16:57:36Z",
    "closed_at": "2017-03-17T21:25:49Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I've starting installing and activating py-virtualenv as part of a standard shared toolset.  Here's the bit of the script that drives the installation.\r\n\r\n```\r\nspack install python            # default from packages.yaml\r\nspack install py-virtualenv\r\nspack activate py-virtualenv\r\n\r\nspack install python@3.6.0\r\nspack install py-virtualenv ^python@3.6.0\r\nspack activate py-virtualenv ^python@3.6.0\r\n```\r\n\r\nI was suprised to discover that activating `py-virtualenv` did not activate the apparently-required `py-setuptools` (happens with python2 and python3).  \r\n\r\nE.g.  Here's the python3 version: \r\n- adding the installed python directory to PATH;\r\n- python3 works; and\r\n- virtualenv is on PATH; but\r\n- it blows up; until\r\n- I activate `py-setuptools ^python@3.6.0`.\r\n\r\n```\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ export PATH=`pwd`/opt/spack/linux-centos7-x86_64/gcc-5.4.0/python-3.6.0-m5uhlrl7k4ac7gi2agj7xiw6wmquxpq3/bin:$PATH\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ which python\r\n/usr/bin/python\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ which python3\r\n/isilon/Analysis/scratch/hartzelg/spack-cime-rpbuchop002-working-dir/workspace/daily-build/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/python-3.6.0-m5uhlrl7k4ac7gi2agj7xiw6wmquxpq3/bin/python3\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ python3\r\nPython 3.6.0 (default, Mar 17 2017, 11:35:47)\r\n[GCC 5.4.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>>\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ which virtualenv\r\n/isilon/Analysis/scratch/hartzelg/spack-cime-rpbuchop002-working-dir/workspace/daily-build/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/python-3.6.0-m5uhlrl7k4ac7gi2agj7xiw6wmquxpq3/bin/virtualenv\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ virtualenv\r\nTraceback (most recent call last):\r\n  File \"/isilon/Analysis/scratch/hartzelg/spack-cime-rpbuchop002-working-dir/workspace/daily-build/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/python-3.6.0-m5uhlrl7k4ac7gi2agj7xiw6wmquxpq3/bin/virtualenv\", line 7, in <module>\r\n    from pkg_resources import load_entry_point\r\nModuleNotFoundError: No module named 'pkg_resources'\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ spack activate py-setuptools ^python@3.6.0\r\n==> Activated extension py-appdirs@1.4.0%gcc@5.4.0 arch=linux-centos7-x86_64 /eajpjfn for python@3.6.0~tk~ucs4%gcc@5.4.0\r\n==> Activated extension py-pyparsing@2.1.10%gcc@5.4.0 arch=linux-centos7-x86_64 /jzlgzex for python@3.6.0~tk~ucs4%gcc@5.4.0\r\n==> Activated extension py-six@1.10.0%gcc@5.4.0 arch=linux-centos7-x86_64 /em5tra4 for python@3.6.0~tk~ucs4%gcc@5.4.0\r\n==> Activated extension py-packaging@16.8%gcc@5.4.0 arch=linux-centos7-x86_64 /wporjj5 for python@3.6.0~tk~ucs4%gcc@5.4.0\r\n==> Activated extension py-setuptools@34.2.0%gcc@5.4.0 arch=linux-centos7-x86_64 /ys7rdd6 for python@3.6.0~tk~ucs4%gcc@5.4.0\r\nhartzelg@rpbuchop002:spack (llnl/develop)$ virtualenv\r\nYou must provide a DEST_DIR\r\nUsage: virtualenv [OPTIONS] DEST_DIR\r\n\r\n[...]\r\n```\r\n\r\n`py-virtualenv` seems to depend on `py-setuptools`....\r\n\r\n```python\r\nclass PyVirtualenv(PythonPackage):\r\n  [...]\r\n    depends_on('py-setuptools') # not just build-time, requires pkg_resources\r\n```\r\n\r\nI have a feeling that I've been around this before.\r\n\r\nIs this a bug?  Am I missing something obvious (share a previous Issue and shame my search skills... :1st_place_medal: )?\r\n\r\nThanks!",
    "performed_via_github_app": null
}