{
    "url": "https://api.github.com/repos/spack/spack/issues/14458",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/14458/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/14458/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/14458/events",
    "html_url": "https://github.com/spack/spack/issues/14458",
    "id": 548007717,
    "node_id": "MDU6SXNzdWU1NDgwMDc3MTc=",
    "number": 14458,
    "title": "INCLUDE error ",
    "user": {
        "login": "SheraLee",
        "id": 33297023,
        "node_id": "MDQ6VXNlcjMzMjk3MDIz",
        "avatar_url": "https://avatars.githubusercontent.com/u/33297023?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SheraLee",
        "html_url": "https://github.com/SheraLee",
        "followers_url": "https://api.github.com/users/SheraLee/followers",
        "following_url": "https://api.github.com/users/SheraLee/following{/other_user}",
        "gists_url": "https://api.github.com/users/SheraLee/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SheraLee/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SheraLee/subscriptions",
        "organizations_url": "https://api.github.com/users/SheraLee/orgs",
        "repos_url": "https://api.github.com/users/SheraLee/repos",
        "events_url": "https://api.github.com/users/SheraLee/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SheraLee/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 13,
    "created_at": "2020-01-10T10:48:55Z",
    "updated_at": "2020-01-17T20:34:19Z",
    "closed_at": "2020-01-17T19:44:28Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I am trying to create a spack package for our program P3DFFT. The program depends on MPI and FFTW3, and I use external modules to build with.  I got the  ```Error in opening the compiled module file.``` when I try to install it but I can build it in debug mood. I am not sure how should I update my INCLUDE paths. \r\nI also tried to use install --dirty, but it would give me:`Error: OSError: [Errno 2] No such file or directory:'/opt/intel/2018.1.163/compilers_and_libraries_2018.1.163/linux/ipp/lib/intel64'`when building the environment. \r\n\r\nAny help would be appreciated!\r\n\r\n```\r\n79 errors found in build log:\r\n     81     /opt/mvapich2/intel/ib/bin/mpif90 -DHAVE_CONFIG_H -I. -I.. -I/opt/f\r\n            ftw/3.3.8/intel/mvapich2_ib/include   -DINTEL -DMEASURE -DFFTW -g -\r\n            c -o fft_spec.o fft_spec.F90\r\n     82     /opt/mvapich2/intel/ib/bin/mpif90 -DHAVE_CONFIG_H -I. -I.. -I/opt/f\r\n            ftw/3.3.8/intel/mvapich2_ib/include   -DINTEL -DMEASURE -DFFTW -g -\r\n            c -o module.o module.F90\r\n     83     /opt/mvapich2/intel/ib/bin/mpif90 -DHAVE_CONFIG_H -I. -I.. -I/opt/f\r\n            ftw/3.3.8/intel/mvapich2_ib/include   -DINTEL -DMEASURE -DFFTW -g -\r\n            c -o fft_init.o fft_init.F90\r\n     84     /opt/mvapich2/intel/ib/bin/mpif90 -DHAVE_CONFIG_H -I. -I.. -I/opt/f\r\n            ftw/3.3.8/intel/mvapich2_ib/include   -DINTEL -DMEASURE -DFFTW -g -\r\n            c -o fft_exec.o fft_exec.F90\r\n     85     /opt/mvapich2/intel/ib/bin/mpif90 -DHAVE_CONFIG_H -I. -I.. -I/opt/f\r\n            ftw/3.3.8/intel/mvapich2_ib/include   -DINTEL -DMEASURE -DFFTW -g -\r\n            c -o wrap.o wrap.F90\r\n     86     make[2]: [all-local] Error 1 (ignored)\r\n  >> 87     wrap.F90(84): error #7002: Error in opening the compiled module fil\r\n            e.  Check INCLUDE paths.   [P3DFFT]\r\n     88           use p3dfft\r\n     89     ----------^\r\n  >> 90     fft_exec.F90(88): error #7002: Error in opening the compiled module\r\n             file.  Check INCLUDE paths.   [P3DFFT]\r\n     91           use p3dfft\r\n     92     ----------^\r\n  >> 93     wrap.F90(87): error #6683: A kind type parameter must be a compile-\r\n            time constant.   [P3DFFT_TYPE]\r\n     94           real(p3dfft_type), TARGET :: IN(dim_in,nv)\r\n     95     -----------^\r\n  >> 96     fft_exec.F90(93): error #6683: A kind type parameter must be a comp\r\n            ile-time constant.   [P3DFFT_TYPE]\r\n     97           complex(p3dfft_type) In(xsize_in,ny,0:zsize_in-1),Out(xsize_o\r\n            ut,ny,0:zsize_out-1)\r\n     98     --------------^\r\n  >> 99     wrap.F90(88): error #6683: A kind type parameter must be a compile-\r\n            time constant.   [P3DFFT_TYPE]\r\n     100          complex(p3dfft_type), TARGET :: OUT(dim_out,nv)\r\n     101    --------------^\r\n  >> 102    fft_init.F90(90): error #7002: Error in opening the compiled module\r\n             file.  Check INCLUDE paths.   [P3DFFT]\r\n     103          use p3dfft\r\n     104    ----------^\r\n  >> 105    fft_init.F90(95): error #6683: A kind type parameter must be a comp\r\n            ile-time constant.   [P3DFFT_TYPE]\r\n     106          complex(p3dfft_type) X(N*m),Y(N*m)\r\n     107    --------------^\r\n  >> 108    wrap.F90(102): error #7002: Error in opening the compiled module fi\r\n            le.  Check INCLUDE paths.   [P3DFFT]\r\n     109          use p3dfft\r\n     110    ----------^\r\n  >> 111    fft_exec.F90(105): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     112          use p3dfft\r\n  >> 113    wrap.F90(105): error #6683: A kind type parameter must be a compile\r\n            -time constant.   [P3DFFT_TYPE]\r\n     114    ----------^\r\n     115          real(p3dfft_type), TARGET :: OUT(dim_out,nv)\r\n     116    -----------^\r\n  >> 117    fft_exec.F90(110): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     118          complex(p3dfft_type) In(xsize_in,ny,0:zsize_in-1),Out(xsize_o\r\n            ut,ny,0:zsize_out-1)\r\n     119    --------------^\r\n  >> 120    wrap.F90(106): error #6683: A kind type parameter must be a compile\r\n            -time constant.   [P3DFFT_TYPE]\r\n     121          complex(p3dfft_type), TARGET :: IN(dim_in,nv)\r\n     122    --------------^\r\n  >> 123    fft_init.F90(113): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     124          use p3dfft\r\n     125    ----------^\r\n  >> 126    wrap.F90(120): error #7002: Error in opening the compiled module fi\r\n            le.  Check INCLUDE paths.   [P3DFFT]\r\n     127          use p3dfft\r\n     128    ----------^\r\n  >> 129    wrap.F90(122): error #6683: A kind type parameter must be a compile\r\n            -time constant.   [P3DFFT_TYPE]\r\n     130          real(p3dfft_type), TARGET :: IN(1,1,*)\r\n     131    -----------^\r\n  >> 132    wrap.F90(123): error #6683: A kind type parameter must be a compile\r\n            -time constant.   [P3DFFT_TYPE]\r\n     133          complex(p3dfft_type), TARGET :: OUT(1,1,*)\r\n     134    --------------^\r\n  >> 135    fft_init.F90(118): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     136          complex(p3dfft_type) X(N*m),Y(N*m)\r\n     137    --------------^\r\n  >> 138    fft_exec.F90(124): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     139          use p3dfft\r\n     140    ----------^\r\n  >> 141    fft_exec.F90(129): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     142          complex(p3dfft_type) X(N*stride_x1+m*stride_x2),Y(N*stride_y1\r\n            +m*stride_y2)\r\n     143    --------------^\r\n  >> 144    fft_init.F90(136): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     145          use p3dfft\r\n     146    ----------^\r\n  >> 147    wrap.F90(137): error #7002: Error in opening the compiled module fi\r\n            le.  Check INCLUDE paths.   [P3DFFT]\r\n     148          use p3dfft\r\n     149    ----------^\r\n  >> 150    wrap.F90(139): error #6683: A kind type parameter must be a compile\r\n            -time constant.   [P3DFFT_TYPE]\r\n     151          real(p3dfft_type), TARGET :: OUT(1,1,*)\r\n     152    -----------^\r\n  >> 153    wrap.F90(140): error #6683: A kind type parameter must be a compile\r\n            -time constant.   [P3DFFT_TYPE]\r\n     154          complex(p3dfft_type), TARGET :: IN(1,1,*)\r\n     155    --------------^\r\n  >> 156    fft_init.F90(141): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     157          complex(p3dfft_type) X(N*m),Y(N*m)\r\n     158    --------------^\r\n  >> 159    fft_exec.F90(172): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     160          use p3dfft\r\n     161    ----------^\r\n  >> 162    fft_exec.F90(177): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     163          complex(p3dfft_type) X(N*stride_x1+m*stride_x2),Y(N*stride_y1\r\n            +m*stride_y2)\r\n     164    --------------^\r\n  >> 165    fft_init.F90(161): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     166          use p3dfft\r\n     167    ----------^\r\n  >> 168    fft_init.F90(167): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     169          complex(p3dfft_type) X(N*m),Y(N*m)\r\n     170    --------------^\r\n  >> 171    fft_exec.F90(208): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     172          use p3dfft\r\n     173    ----------^\r\n  >> 174    fft_exec.F90(213): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     175          complex(p3dfft_type) X(N*stride_x1+m*stride_x2),Y(N*stride_y1\r\n            +m*stride_y2)\r\n     176    --------------^\r\n  >> 177    fft_init.F90(190): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     178          use p3dfft\r\n     179    ----------^\r\n  >> 180    fft_init.F90(195): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     181          complex(p3dfft_type) X((N/2+1)*m)\r\n     182    --------------^\r\n  >> 183    fft_init.F90(196): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     184          real(p3dfft_type) Y(N*m)\r\n     185    -----------^\r\n  >> 186    fft_exec.F90(254): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n     187          use p3dfft\r\n     188    ----------^\r\n  >> 189    fft_exec.F90(260): error #6683: A kind type parameter must be a com\r\n            pile-time constant.   [P3DFFT_TYPE]\r\n     190          complex(p3dfft_type) X(N*stride_x1+m*stride_x2),Y(N*stride_y1\r\n            +m*stride_y2)\r\n     191    --------------^\r\n  >> 192    fft_init.F90(214): error #7002: Error in opening the compiled modul\r\n            e file.  Check INCLUDE paths.   [P3DFFT]\r\n```\r\n\r\n**Package.py**\r\n```python\r\nfrom spack import *\r\n\r\n\r\nclass P3dfft3(Package):\r\n    \"\"\"put a proper description of this  package here later.\"\"\"\r\n\r\n    homepage = \"https://www.p3dfft.net\"\r\n    url      = \"https://github.com/sdsc/p3dfft.3/archive/master.tar.gz\"\r\n    git = \"https://github.com/sdsc/p3dfft.3\"\r\n\r\n    version('develop', branch = 'master')\r\n    version('0.0.0', '3c62c2bdf4aa91c3f1ab122efc1b3799')\r\n\r\n    variant('fftw', default = True,\r\n            description='Builds with FFTW library')\r\n    variant('essl', default=False,\r\n            description='Builds with ESSL library')\r\n    variant('mpi', default = True,\r\n            description=\"Enable MPI support.\")\r\n    variant('openmp', default=False,\r\n            description=\"Enable OpenMP support.\")\r\n    variant('measure', default=False,\r\n            description=\"Define if you want to use the measure fftw planner flag\")\r\n    variant('estimate', default=False,\r\n            description=\"Define if you want to use the estimate fftw planner flag\")\r\n    variant('patient', default=False,\r\n            description=\"[Define if you want to use the patient fftw planner flag]\")\r\n\r\n    depends_on('mpi',when = '+mpi')\r\n    depends_on('fftw',when = '+fftw')\r\n    depends_on('essl',when = '+essl')\r\n    depends_on('openmp',when = '+openmp')\r\n\r\n\r\n    def setup_environment(self, spack_env, run_env):\r\n        spec = self.spec\r\n\r\n        spack_env.set('CC', spec['mpi'].mpicc)\r\n        spack_env.set('FC', spec['mpi'].mpifc)\r\n        spack_env.set('CXX', spec['mpi'].mpicxx)\r\n\r\n\t\r\n\r\n    def install(self, spec, prefix):\r\n        config_args = ['--prefix={0}'.format(prefix)]\r\n\r\n        if '+fftw' in spec:\r\n            config_args.append('--enable-fftw')\r\n            config_args.append ('--with-fftw-lib= %s' % spec['fftw'].prefix.lib)\r\n            config_args.append ('--with-fftw-inc= %s' % spec['fftw'].prefix.include)\r\n            if '+measure' in spec:\r\n\t\t config_args.append('--enable-fftwmeasure')\r\n            if '+estimate' in spec:\r\n\t\t config_args.append('--enable-fftwestimate')\r\n            if '+patient' in spec:\r\n                 config_args.append('--enable-fftwpatient')\r\n\r\n        if '+essl' in spec:\r\n            config_args.append('--enable-essl')\r\n            config_args.append ('--with-essl-lib= %s' % spec['essl'].prefix.lib)\r\n            config_args.append ('--with-essl-inc= %s' % spec['essl'].prefix.include)\r\n\r\n\tif '+mkl' in spec:\r\n            config_args.append('--enable-mkl')\r\n            config_args.append ('--with-mkl-lib= %s' % spec['mkl'].prefix.lib)\r\n            config_args.append ('--with-mkl-inc= %s' % spec['mkl'].prefix.include)\t\r\n\r\n        configure( *config_args)\r\n\r\n        make()\r\n        make('install')\r\n```\r\n**package.yaml**\r\n```yaml\r\npackages:\r\n    fftw:\r\n        modules:\r\n             fftw: fftw \r\n        buildable: False\r\n\r\n    mvapich2:\r\n        modules:\r\n             mvapich2: mvapich2_ib\r\n        buildable: False\r\n\r\n    openmpi:\r\n        modules:\r\n             openmpi: openmpi_ib\r\n        buildable: False\r\n\r\n    intel-mpi:\r\n        modules:\r\n             intel-mpi: intelmpi\r\n        buildable: False\r\n    \r\n```\r\n",
    "performed_via_github_app": null
}