{
    "url": "https://api.github.com/repos/spack/spack/issues/17322",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/17322/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/17322/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/17322/events",
    "html_url": "https://github.com/spack/spack/issues/17322",
    "id": 648605174,
    "node_id": "MDU6SXNzdWU2NDg2MDUxNzQ=",
    "number": 17322,
    "title": "Installation issue: openmpi@3.1.6 %gcc@8.4.0",
    "user": {
        "login": "chchang6",
        "id": 11529389,
        "node_id": "MDQ6VXNlcjExNTI5Mzg5",
        "avatar_url": "https://avatars.githubusercontent.com/u/11529389?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chchang6",
        "html_url": "https://github.com/chchang6",
        "followers_url": "https://api.github.com/users/chchang6/followers",
        "following_url": "https://api.github.com/users/chchang6/following{/other_user}",
        "gists_url": "https://api.github.com/users/chchang6/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/chchang6/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/chchang6/subscriptions",
        "organizations_url": "https://api.github.com/users/chchang6/orgs",
        "repos_url": "https://api.github.com/users/chchang6/repos",
        "events_url": "https://api.github.com/users/chchang6/events{/privacy}",
        "received_events_url": "https://api.github.com/users/chchang6/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2020-07-01T01:32:50Z",
    "updated_at": "2020-07-09T21:14:50Z",
    "closed_at": "2020-07-09T21:14:50Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Thanks for taking the time to report this build failure. To proceed with the report please:\r\n\r\n1. Title the issue \"Installation issue: <name-of-the-package>\".\r\n2. Provide the information required below.\r\n\r\nWe encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively! -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n<!-- Fill in the exact spec you are trying to build and the relevant part of the error message -->\r\n```console\r\n$ spack install openmpi@3.1.6 %gcc@8.4.0 +cuda+cxx+cxx_exceptions fabrics=ucx -gpfs+pmi schedulers=slurm\r\n```\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n* **Spack:** 0.14.2-1624-212299a\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos7-skylake_avx512\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\npackages.yaml:\r\n```console\r\npackages:\r\n  binutils:\r\n    version: [2.29.1]\r\n  netcdf:\r\n    variants: maxdims=65536 maxvars=524288\r\n  hdf5:\r\n    variants: +cxx+hl+fortran+szip\r\n  slurm:\r\n    paths:\r\n      slurm@19-05-0-2: /nopt/slurm/current\r\n    buildable: False\r\n  intel-mkl:\r\n     paths:\r\n       intel-mkl@2020.1.217: /nopt/nrel/apps/compilers/intel/2020.1.217/mkl\r\n     buildable: False\r\n  rdma-core:\r\n     paths:\r\n       rdma-core: /lib64\r\n     buildable: False\r\n  hwloc:\r\n    variants: +cuda ~nvml ~gl\r\n  fftw:\r\n    variants: +fma simd=avx2,avx512\r\n  all:\r\n    compiler: [gcc@8.4.0, intel@19.1.1.217]\r\n    # Spack uses build_type=RelWithDebInfo by default for CMake packages\r\n    # and creates huge binaries unless you do this:\r\n    variants: build_type=Release\r\n    target: [x86_64]\r\n    providers:\r\n      mpi: [openmpi@3.1.3, intel-mpi@2019.5.222]\r\n      blas: [netlib-lapack@3.8.0, intel-mkl@2020.1.217]\r\n      lapack: [netlib-lapack@3.8.0, intel-mkl@2020.1.217]\r\n```\r\n\r\n### Additional information\r\n* The build fails during UCX installation.\r\n* I'm also confused why UCX is being built without CUDA, since OpenMPI is being requested with it.\r\n* Not sure why shmem.h is being included from the OpenMPI 1.10.7 build done prior to this one (openmpi@3.1.6).\r\n\r\n```console\r\n...\r\n==> 9016: Installing ucx\r\n==> Using cached archive: /nopt/nrel/apps/base/2020-05-12/spack/var/spack/cache/_source-cache/archive/e4/e400f7aa5354971c8f5ac6b881dc2846143851df868088c37d432c076445628d.tar.gz\r\n==> Staging archive: /tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/ucx-1.8.0.tar.gz\r\n==> Created stage in /tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde\r\n==> No patches needed for ucx\r\n==> 9016: ucx: Building ucx [AutotoolsPackage]\r\n==> 9016: ucx: Executing phase: 'autoreconf'\r\n==> 9016: ucx: Executing phase: 'configure'\r\n==> 9016: ucx: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n\r\n4 errors found in build log:\r\n     826    Making all in test/mpi\r\n     827    make[2]: Entering directory `/tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-src/test/mpi'\r\n     828      CC       test_memhooks.o\r\n     829      CC       shmem_pingpong.o\r\n     830      CC       test_memhooks_lib.lo\r\n     831    shmem_pingpong.c: In function 'run_pingpong':\r\n  >> 832    shmem_pingpong.c:72:34: error: passing argument 1 of 'shmem_int_wait_until' discards 'volatile' qualifier from pointer target type [-Werror=disc\r\n            arded-qualifiers]\r\n     833                 shmem_int_wait_until(rsn, SHMEM_CMP_EQ, sn);\r\n     834                                      ^~~\r\n     835    In file included from shmem_pingpong.c:13:\r\n     836    /nopt/nrel/apps/base/2020-05-12/spack/opt/spack/linux-centos7-x86_64/gcc-8.4.0/openmpi-1.10.7-unlnregriwszfdzpmhbspyijylt4vras/include/shmem.h:2\r\n            88:49: note: expected 'int *' but argument is of type 'volatile int *'\r\n     837     OSHMEM_DECLSPEC  void shmem_int_wait_until(int *addr, int cmp, int value);\r\n     838                                                ~~~~~^~~~\r\n     839    cc1: all warnings being treated as errors\r\n  >> 840    make[2]: *** [shmem_pingpong.o] Error 1\r\n     841    make[2]: *** Waiting for unfinished jobs....\r\n     842    make[2]: Leaving directory `/tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-src/test/mpi'\r\n  >> 843    make[1]: *** [all-recursive] Error 1\r\n     844    make[1]: Leaving directory `/tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-src'\r\n  >> 845    make: *** [all] Error 2\r\n\r\nSee build log for details:\r\n  /tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-build-out.txt\r\n\r\n==> Error: Failed to install ucx due to ChildError: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n4 errors found in build log:\r\n     826    Making all in test/mpi\r\n     827    make[2]: Entering directory `/tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-src/test/mpi'\r\n     828      CC       test_memhooks.o\r\n     829      CC       shmem_pingpong.o\r\n     830      CC       test_memhooks_lib.lo\r\n     831    shmem_pingpong.c: In function 'run_pingpong':\r\n  >> 832    shmem_pingpong.c:72:34: error: passing argument 1 of 'shmem_int_wait_until' discards 'volatile' qualifier from pointer target type [-Werror=disc\r\n            arded-qualifiers]\r\n     833                 shmem_int_wait_until(rsn, SHMEM_CMP_EQ, sn);\r\n     834                                      ^~~\r\n     835    In file included from shmem_pingpong.c:13:\r\n     836    /nopt/nrel/apps/base/2020-05-12/spack/opt/spack/linux-centos7-x86_64/gcc-8.4.0/openmpi-1.10.7-unlnregriwszfdzpmhbspyijylt4vras/include/shmem.h:2\r\n            88:49: note: expected 'int *' but argument is of type 'volatile int *'\r\n     837     OSHMEM_DECLSPEC  void shmem_int_wait_until(int *addr, int cmp, int value);\r\n     838                                                ~~~~~^~~~\r\n     839    cc1: all warnings being treated as errors\r\n  >> 840    make[2]: *** [shmem_pingpong.o] Error 1\r\n     841    make[2]: *** Waiting for unfinished jobs....\r\n     842    make[2]: Leaving directory `/tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-src/test/mpi'\r\n  >> 843    make[1]: *** [all-recursive] Error 1\r\n     844    make[1]: Leaving directory `/tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-src'\r\n  >> 845    make: *** [all] Error 2\r\n\r\nSee build log for details:\r\n  /tmp/cchang/spack-stage/spack-stage-ucx-1.8.0-wix255r63ctwidsxwkgn74r3cttzmmde/spack-build-out.txt\r\nTraceback (most recent call last):\r\n  File \"/nopt/nrel/apps/base/2020-05-12/spack/lib/spack/spack/build_environment.py\", line 838, in child_process\r\n    return_value = function()\r\n  File \"/nopt/nrel/apps/base/2020-05-12/spack/lib/spack/spack/installer.py\", line 1140, in build_process\r\n    phase(pkg.spec, pkg.prefix)\r\n  File \"/nopt/nrel/apps/base/2020-05-12/spack/lib/spack/spack/package.py\", line 108, in phase_wrapper\r\n    phase(spec, prefix)\r\n  File \"/nopt/nrel/apps/base/2020-05-12/spack/lib/spack/spack/build_systems/autotools.py\", line 331, in build\r\n    inspect.getmodule(self).make(*self.build_targets)\r\n  File \"/nopt/nrel/apps/base/2020-05-12/spack/lib/spack/spack/build_environment.py\", line 133, in __call__\r\n    return super(MakeExecutable, self).__call__(*args, **kwargs)\r\n  File \"/nopt/nrel/apps/base/2020-05-12/spack/lib/spack/spack/util/executable.py\", line 189, in __call__\r\n    proc.returncode, long_msg)\r\nspack.util.executable.ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n\r\n==> Warning: Skipping build of openmpi since ucx failed\r\n==> Error: Installation of openmpi failed.  Review log for details\r\n```\r\n\r\n<!-- Please upload the following files. They should be present in the stage directory of the failing build. Also upload any config.log or similar file if one exists. -->\r\n* [spack-build-out.txt](https://github.com/spack/spack/files/4855076/spack-build-out.txt)\r\n* [spack-build-env.txt](https://github.com/spack/spack/files/4855078/spack-build-env.txt)\r\n* [spack-configure-args.txt](https://github.com/spack/spack/files/4855093/spack-configure-args.txt)\r\n\r\n<!-- Some packages have maintainers who have volunteered to debug build failures. Run `spack maintainers <name-of-the-package>` and @mention them here if they exist. -->\r\n@hppritcha\r\n\r\n### General information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [x] I have uploaded the build log and environment files\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}