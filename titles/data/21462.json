{
    "url": "https://api.github.com/repos/spack/spack/issues/21462",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/21462/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/21462/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/21462/events",
    "html_url": "https://github.com/spack/spack/issues/21462",
    "id": 800054213,
    "node_id": "MDU6SXNzdWU4MDAwNTQyMTM=",
    "number": 21462,
    "title": "Installation issue: Error: NoLibrariesError: Unable to recursively locate hpcx libraries",
    "user": {
        "login": "arstgr",
        "id": 78465331,
        "node_id": "MDQ6VXNlcjc4NDY1MzMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/78465331?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/arstgr",
        "html_url": "https://github.com/arstgr",
        "followers_url": "https://api.github.com/users/arstgr/followers",
        "following_url": "https://api.github.com/users/arstgr/following{/other_user}",
        "gists_url": "https://api.github.com/users/arstgr/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/arstgr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/arstgr/subscriptions",
        "organizations_url": "https://api.github.com/users/arstgr/orgs",
        "repos_url": "https://api.github.com/users/arstgr/repos",
        "events_url": "https://api.github.com/users/arstgr/events{/privacy}",
        "received_events_url": "https://api.github.com/users/arstgr/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2021-02-03T07:21:46Z",
    "updated_at": "2021-02-06T05:59:26Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Thanks for taking the time to report this build failure. To proceed with the report please:\r\n\r\n1. Title the issue \"Installation issue: <name-of-the-package>\".\r\n2. Provide the information required below.\r\n\r\nWe encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively! -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n<!-- Fill in the exact spec you are trying to build and the relevant part of the error message -->\r\n```console\r\n$ spack install --dirty cp2k@7.1 +mpi+libxc+openmp smm=libsmm %gcc@9.2.0 cppflags=\"-O3 -fopenmp\" cflags=\"-O3 -fopenmp\" fflags=\"-O3 -fopenmp\" ^mpi@3: ^hpcx@2.7.0 ^scalapack ^openblas threads=openmp ^fftw +openmp\r\n```\r\n\r\n```console\r\nmodule list:\r\n1) /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/modulefiles/hpcx   \r\n2) mpi/hpcx-v2.7.0\r\n3) gcc-9.2.0\r\n```\r\n\r\n```console\r\nls /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\nbin  etc  include  lib  share  tests\r\n```\r\n\r\n### The error:\r\n==> Installing cp2k\r\n==> No binary for cp2k found: installing from source\r\n==> cp2k: Executing phase: 'edit'\r\n==> Error: NoLibrariesError: Unable to recursively locate hpcx libraries in /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\n\r\n/share/apps/spack/0.15.4/spack/var/spack/repos/builtin/packages/cp2k/package.py:356, in edit:\r\n        353            ldflags.append(scalapack.search_flags)\r\n        354\r\n        355            libs.extend(scalapack)\r\n==>    356            libs.extend(spec['mpi:cxx'].libs)\r\n        357            libs.extend(self.compiler.stdcxx_libs)\r\n        358\r\n        359            if 'wannier90' in spec:\r\n\r\nSee build log for details:\r\n  /mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3/spack-build-out.txt\r\n\r\n### The error report when installing with --debug option:\r\n==> [2021-02-03-06:35:28.736670] No patches needed for cp2k\r\n==> [2021-02-03-06:35:28.736766] cp2k: Building cp2k [MakefilePackage]\r\n==> [2021-02-03-06:35:28.742824] cp2k: Executing phase: 'edit'\r\n==> [2021-02-03-06:35:28.854134] Error: NoLibrariesError: Unable to recursively locate hpcx libraries in /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\n\r\n/share/apps/spack/0.15.4/spack/var/spack/repos/builtin/packages/cp2k/package.py:356, in edit:\r\n        353            ldflags.append(scalapack.search_flags)\r\n        354\r\n        355            libs.extend(scalapack)\r\n==>    356            libs.extend(spec['mpi:cxx'].libs)\r\n        357            libs.extend(self.compiler.stdcxx_libs)\r\n        358\r\n        359            if 'wannier90' in spec:\r\n\r\nSee build log for details:\r\n  /mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3/spack-build-out.txt\r\n\r\n### installing with --debug option\r\n==> [2021-02-03-06:35:19.277923] Fetching from https://[ihadtoremoveit]/linux-centos7-x86_64-gcc-9.2.0-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3.spec.yaml failed.\r\n==> [2021-02-03-06:35:19.282132] No binary for cp2k found: installing from source\r\n==> [2021-02-03-06:35:19.433639] [TOOLCHAIN] MATCH Gcc\r\n==> [2021-02-03-06:35:19.443560] No libraries found for libint\r\n==> [2021-02-03-06:35:19.468881] No libraries found for hpcx\r\n==> [2021-02-03-06:35:19.531921] No headers found for netlib-scalapack\r\n==> [2021-02-03-06:35:20.108131] [DEPRECATED METHOD]\r\n\"hpcx\" still defines the deprecated method \"setup_dependent_environment\" [should be split into \"setup_dependent_build_environment\" and \"setup_dependent_run_environment\"]\r\n==> [2021-02-03-06:35:20.185029] '/apps/spack/hbv2/linux-centos7-x86_64/gcc-9.2.0/python-3.7.7-ztnaxbsqvgz65imyxdyrqzbek47xln4j/bin/python3.7' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\n==> [2021-02-03-06:35:20.349113] '/opt/gcc-9.2.0/bin/g++' '-v' '/tmp/spack-implicit-link-infopk2wqtiv/main.c' '-o' '/tmp/spack-implicit-link-infopk2wqtiv/output'\r\n==> [2021-02-03-06:35:20.407268] parsing implicit link info\r\n==> [2021-02-03-06:35:20.407602] linker line:  /opt/gcc-9.2.0/libexec/gcc/x86_64-pc-linux-gnu/9.2.0/collect2 -plugin /opt/gcc-9.2.0/libexec/gcc/x86_64-pc-linux-gnu/9.2.0/liblto_plugin.so -plugin-opt=/opt/gcc-9.2.0/libexec/gcc/x86_64-pc-linux-gnu/9.2.0/lto-wrapper -plugin-opt=-fresolution=/tmp/ccA1FnlG.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --eh-frame-hdr -m elf_x86_64 -dynamic-linker /lib64/ld-linux-x86-64.so.2 -o /tmp/spack-implicit-link-infopk2wqtiv/output /lib/../lib64/crt1.o /lib/../lib64/crti.o /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/crtbegin.o -L/opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0 -L/opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../lib64 -L/lib/../lib64 -L/usr/lib/../lib64 -L/opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi/lib -L/opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/nccl_rdma_sharp_plugin/lib -L/opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/sharp/lib -L/opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hcoll/lib -L/opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hmc/lib -L/opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ucx/lib -L/opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../.. /tmp/ccXNzHqD.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/crtend.o /lib/../lib64/crtn.o\r\n==> [2021-02-03-06:35:20.407679] linkdir: /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0\r\n==> [2021-02-03-06:35:20.407741] linkdir: /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../lib64\r\n==> [2021-02-03-06:35:20.407769] linkdir: /lib/../lib64\r\n==> [2021-02-03-06:35:20.407793] linkdir: /usr/lib/../lib64\r\n==> [2021-02-03-06:35:20.407816] linkdir: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi/lib\r\n==> [2021-02-03-06:35:20.407840] linkdir: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/nccl_rdma_sharp_plugin/lib\r\n==> [2021-02-03-06:35:20.407863] linkdir: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/sharp/lib\r\n==> [2021-02-03-06:35:20.407885] linkdir: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hcoll/lib\r\n==> [2021-02-03-06:35:20.407907] linkdir: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hmc/lib\r\n==> [2021-02-03-06:35:20.407930] linkdir: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ucx/lib\r\n==> [2021-02-03-06:35:20.407952] linkdir: /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../..\r\n==> [2021-02-03-06:35:20.407989] found raw link dirs: /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0, /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../../../lib64, /lib/../lib64, /usr/lib/../lib64, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/nccl_rdma_sharp_plugin/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/sharp/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hcoll/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hmc/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ucx/lib, /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0/../../..\r\n==> [2021-02-03-06:35:20.408088] found link dirs: /opt/gcc-9.2.0/lib/gcc/x86_64-pc-linux-gnu/9.2.0, /opt/gcc-9.2.0/lib64, /lib64, /usr/lib64, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/nccl_rdma_sharp_plugin/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/sharp/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hcoll/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/hmc/lib, /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ucx/lib, /opt/gcc-9.2.0/lib\r\n==> [2021-02-03-06:35:20.467145] Using cached archive: /apps/spack/cache/_source-cache/archive/cc/ccd711a09a426145440e666310dd01cc5772ab103493c4ae6a3470898cd0addb.tar.bz2\r\n==> [2021-02-03-06:35:20.519181] Staging archive: /mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3/cp2k-7.1.tar.bz2\r\n==> [2021-02-03-06:35:20.520239] '/usr/bin/tar' '-xf' '/mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3/cp2k-7.1.tar.bz2'\r\n==> [2021-02-03-06:35:28.735985] Created stage in /mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3\r\n==> [2021-02-03-06:35:28.736670] No patches needed for cp2k\r\n==> [2021-02-03-06:35:28.736766] cp2k: Building cp2k [MakefilePackage]\r\n==> [2021-02-03-06:35:28.742824] cp2k: Executing phase: 'edit'\r\n==> [2021-02-03-06:35:28.854134] Error: NoLibrariesError: Unable to recursively locate hpcx libraries in /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\n\r\n/share/apps/spack/0.15.4/spack/var/spack/repos/builtin/packages/cp2k/package.py:356, in edit:\r\n        353            ldflags.append(scalapack.search_flags)\r\n        354\r\n        355            libs.extend(scalapack)\r\n==>    356            libs.extend(spec['mpi:cxx'].libs)\r\n        357            libs.extend(self.compiler.stdcxx_libs)\r\n        358\r\n        359            if 'wannier90' in spec:\r\n\r\nSee build log for details:\r\n  /mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3/spack-build-out.txt\r\nTraceback (most recent call last):\r\n  File \"/share/apps/spack/0.15.4/spack/lib/spack/spack/build_environment.py\", line 846, in child_process\r\n    return_value = function()\r\n  File \"/share/apps/spack/0.15.4/spack/lib/spack/spack/installer.py\", line 1150, in build_process\r\n    phase(pkg.spec, pkg.prefix)\r\n  File \"/share/apps/spack/0.15.4/spack/lib/spack/spack/package.py\", line 108, in phase_wrapper\r\n    phase(spec, prefix)\r\n  File \"/share/apps/spack/0.15.4/spack/var/spack/repos/builtin/packages/cp2k/package.py\", line 357, in edit\r\n    libs.extend(self.compiler.stdcxx_libs)\r\n  File \"/share/apps/spack/0.15.4/spack/lib/spack/spack/spec.py\", line 877, in __get__\r\n    value = f()\r\n  File \"/share/apps/spack/0.15.4/spack/lib/spack/spack/spec.py\", line 869, in <lambda>\r\n    callbacks_chain.append(lambda: self.default(self, instance, cls))\r\n  File \"/share/apps/spack/0.15.4/spack/lib/spack/spack/spec.py\", line 808, in _libs_default_handler\r\n    raise spack.error.NoLibrariesError(msg.format(spec.name, spec.prefix))\r\nspack.error.NoLibrariesError: Unable to recursively locate hpcx libraries in /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\n==> [2021-02-03-06:35:28.854476] Flagging cp2k as failed: NoLibrariesError: Unable to recursively locate hpcx libraries in /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\n/share/apps/spack/0.15.4/spack/var/spack/repos/builtin/packages/cp2k/package.py:356, in edit:\r\n        353            ldflags.append(scalapack.search_flags)\r\n        354\r\n        355            libs.extend(scalapack)\r\n==>    356            libs.extend(spec['mpi:cxx'].libs)\r\n        357            libs.extend(self.compiler.stdcxx_libs)\r\n        358\r\n        359            if 'wannier90' in spec:\r\n\r\nSee build log for details:\r\n  /mnt/resource/scratch/spack-stage/hpcuser/spack-stage-cp2k-7.1-k5y5v3kkvnjxgbwleh3q6t33dmz5usx3/spack-build-out.txt\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n* **Spack:** 0.15.4\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos7-x86_64\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\nTrying to install cp2k on a system using hpcx mpi library. The file packages.yaml looks like this (indentation was not maintained here):\r\npackages:\r\n  hpcx:\r\n    paths:\r\n       hpcx@2.7.0: /opt/hpcx-v2.7.0-gcc-MLNX_OFED_LINUX-5.1-0.6.6.0-redhat7.6-x86_64/ompi\r\n    buildable: False\r\n  gcc:\r\n    modules:\r\n       gcc@9.2.0: gcc-9.2.0\r\n    buildable: False\r\n  all:\r\n    compiler: [gcc, intel, pgi, clang, xl, nag, fj]\r\n    providers:\r\n      D: [ldc]\r\n      awk: [gawk]\r\n      blas: [openblas]\r\n      daal: [intel-daal]\r\n      elf: [elfutils]\r\n      fftw-api: [fftw]\r\n      gl: [mesa+opengl, opengl]\r\n      glx: [mesa+glx, opengl]\r\n      glu: [mesa-glu, openglu]\r\n      golang: [gcc]\r\n      ipp: [intel-ipp]\r\n      java: [openjdk, jdk, ibm-java]\r\n      jpeg: [libjpeg-turbo, libjpeg]\r\n      lapack: [openblas]\r\n      mariadb-client: [mariadb-c-client, mariadb]\r\n      mkl: [intel-mkl]\r\n      mpe: [mpe2]\r\n      mpi: [openmpi, mpich, mvapich2, hpcx]\r\n      mysql-client: [mysql, mariadb-c-client]\r\n      opencl: [pocl]\r\n      pil: [py-pillow]\r\n      pkgconfig: [pkgconf, pkg-config]\r\n      scalapack: [netlib-scalapack]\r\n      szip: [libszip, libaec]\r\n      tbb: [intel-tbb]\r\n      unwind: [libunwind]\r\n    permissions:\r\n      read: world\r\n      write: user\r\n\r\n\r\n### Additional information\r\n\r\n<!-- Please upload the following files. They should be present in the stage directory of the failing build. Also upload any config.log or similar file if one exists. -->\r\n* [spack-build-out.txt](\r\n==> [2021-02-03-06:35:28.742824] cp2k: Executing phase: 'edit'\r\n==> [2021-02-03-06:35:28.783778] '/apps/spack/hbv2/linux-centos7-x86_64/gcc-9.2.0/pkgconf-1.7.3-vpumgc4ptlmuyk4qb6vj7fjrwme4sqtw/bin/pkg-config' '--cflags' 'libint2'\r\n==> [2021-02-03-06:35:28.790460] '/apps/spack/hbv2/linux-centos7-x86_64/gcc-9.2.0/pkgconf-1.7.3-vpumgc4ptlmuyk4qb6vj7fjrwme4sqtw/bin/pkg-config' '--libs' 'libint2')\r\n\r\n\r\n<!-- Some packages have maintainers who have volunteered to debug build failures. Run `spack maintainers <name-of-the-package>` and @mention them here if they exist. --> @dev-zero could you please take a look? many thanks in advance. \r\n\r\n### General information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [x] I have uploaded the build log and environment files\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}