{
    "url": "https://api.github.com/repos/spack/spack/issues/13512",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13512/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13512/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13512/events",
    "html_url": "https://github.com/spack/spack/issues/13512",
    "id": 514864343,
    "node_id": "MDU6SXNzdWU1MTQ4NjQzNDM=",
    "number": 13512,
    "title": "Print test-only dependencies with `spack spec`",
    "user": {
        "login": "SteVwonder",
        "id": 874707,
        "node_id": "MDQ6VXNlcjg3NDcwNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/874707?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SteVwonder",
        "html_url": "https://github.com/SteVwonder",
        "followers_url": "https://api.github.com/users/SteVwonder/followers",
        "following_url": "https://api.github.com/users/SteVwonder/following{/other_user}",
        "gists_url": "https://api.github.com/users/SteVwonder/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SteVwonder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SteVwonder/subscriptions",
        "organizations_url": "https://api.github.com/users/SteVwonder/orgs",
        "repos_url": "https://api.github.com/users/SteVwonder/repos",
        "events_url": "https://api.github.com/users/SteVwonder/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SteVwonder/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908756,
            "node_id": "MDU6TGFiZWw3MzkwODc1Ng==",
            "url": "https://api.github.com/repos/spack/spack/labels/feature",
            "name": "feature",
            "color": "84b6eb",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-10-30T17:47:55Z",
    "updated_at": "2019-10-30T18:29:00Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "I would like to see test-only dependencies when running `spack spec`, even if it is gated behind an argument/flag.\r\n\r\n### Rationale\r\nI added `depends_on(\"valgrind\", type=\"test\")` to the `flux-core` package, but when I run `spack spec -t flux-core`, it is not included in the spec despite being built and used when I run `spack install --test=root flux-core`.\r\n\r\n```\r\n\u2192 spack spec -t flux-core | grep valgrind\r\n\r\n\u2192 spack spec -t flux-core  \r\nInput spec\r\n--------------------------------\r\n[    ]  flux-core\r\n\r\nConcretized\r\n--------------------------------\r\n[    ]  flux-core@0.11.3%gcc@7.4.0~cuda~docs arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]      ^czmq@4.1.1%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b   ]          ^autoconf@2.69%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b r ]              ^m4@1.4.18%gcc@7.4.0 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 +sigsegv arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                  ^libsigsegv@2.12%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b rt]              ^perl@5.30.0%gcc@7.4.0+cpanm+shared+threads arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                  ^gdbm@1.18.1%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                      ^readline@8.0%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                          ^ncurses@6.1%gcc@7.4.0~symlinks~termlib arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                              ^pkgconf@1.6.3%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b   ]          ^automake@1.16.1%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b   ]          ^libtool@2.4.6%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^libuuid@1.0.3%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^libzmq@4.3.2%gcc@7.4.0+libsodium arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]              ^libsodium@1.0.17%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]      ^hwloc@1.11.11%gcc@7.4.0~cairo~cuda~gl+libxml2~nvml+pci+shared arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^libpciaccess@0.13.5%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b   ]              ^util-macros@1.19.1%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^libxml2@2.9.9%gcc@7.4.0~python arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]              ^libiconv@1.16%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[blr ]              ^xz@5.2.4%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]              ^zlib@1.2.11%gcc@7.4.0+optimize+pic+shared arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^numactl@2.0.12%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]      ^jansson@2.9%gcc@7.4.0 build_type=RelWithDebInfo +shared arch=linux-ubuntu18.04-ivybridge\r\n[b   ]          ^cmake@3.15.4%gcc@7.4.0~doc+ncurses+openssl+ownlibs~qt arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]              ^openssl@1.1.1d%gcc@7.4.0+systemcerts arch=linux-ubuntu18.04-ivybridge\r\n[blr ]      ^lua@5.1.5%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[  r ]          ^unzip@6.0%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]      ^lua-luaposix@33.4.0%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]      ^lz4@1.9.2%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b r ]      ^py-cffi@1.13.0%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^libffi@3.2.1%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b r ]          ^py-pycparser@2.19%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b   ]              ^py-setuptools@41.4.0%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[blr ]                  ^python@3.7.4%gcc@7.4.0+bz2+ctypes+dbm+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4~uuid+zlib arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                      ^bzip2@1.0.8%gcc@7.4.0+shared arch=linux-ubuntu18.04-ivybridge\r\n[b   ]                          ^diffutils@3.7%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                      ^expat@2.2.9%gcc@7.4.0+libbsd arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                          ^libbsd@0.9.1%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                      ^gettext@0.20.1%gcc@7.4.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                          ^tar@1.32%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]                      ^sqlite@3.30.1%gcc@7.4.0~column_metadata+fts~functions~rtree arch=linux-ubuntu18.04-ivybridge\r\n[b r ]      ^py-pyyaml@5.1.2%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]          ^libyaml@0.2.2%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[b r ]      ^py-six@1.12.0%gcc@7.4.0 arch=linux-ubuntu18.04-ivybridge\r\n[bl  ]      ^yaml-cpp@0.6.2%gcc@7.4.0 build_type=RelWithDebInfo +pic+shared~tests arch=linux-ubuntu18.04-ivybridge\r\n```\r\n\r\n### Description\r\n\r\nI think this use-case isn't all that common for users, so it is probably wise to gate this functionality behind a flag to `spack spec` so that test-only dependencies are only included when you explicitly ask for it.  Otherwise, \"surprising\" transitive dependencies may appear in the spec.  For example, depending on `valgrind` for tests only (as above) results in `openmpi` becoming a dependency.\r\n\r\nI think supporting something like `spack spec --include-test-only flux-core` (or equivalent) would be very helpful to package maintainers without surprising end-users.",
    "performed_via_github_app": null
}