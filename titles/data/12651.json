{
    "url": "https://api.github.com/repos/spack/spack/issues/12651",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12651/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12651/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12651/events",
    "html_url": "https://github.com/spack/spack/issues/12651",
    "id": 487169706,
    "node_id": "MDU6SXNzdWU0ODcxNjk3MDY=",
    "number": 12651,
    "title": "tests: test_stage fails when run with `-k`",
    "user": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tldahlgren",
            "id": 35777542,
            "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tldahlgren",
            "html_url": "https://github.com/tldahlgren",
            "followers_url": "https://api.github.com/users/tldahlgren/followers",
            "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
            "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
            "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
            "repos_url": "https://api.github.com/users/tldahlgren/repos",
            "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-08-29T20:50:08Z",
    "updated_at": "2019-10-10T23:50:07Z",
    "closed_at": "2019-10-10T23:50:07Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "It appears the `test_stage` test fails when run tests filtered on stage.\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack test -k stage\r\n$ spack test -k test_stage\r\n```\r\n\r\n### Error Message\r\n\r\nThe test checks to ensure the `mock_stage` directory was used and fails.  In the first case, the first default`config:build_stage` directory is used for staging.  In the second case, the first path in the `config:build_stage` directory of `test/data/config.yaml` is used.\r\n\r\n```console\r\nspec = mpileaks@2.3%gcc@4.5.0~debug~opt+shared+static arch=test-debian6-x86_64 ^callp... arch=test-debian6-x86_64 ^mpich@3.0.4%gcc@4.5.0~debug arch=test-debian6-x86_64\r\n\r\n    def check_stage(spec):\r\n        spec = Spec(spec).concretized()\r\n        for dep in spec.traverse():\r\n            stage_name = \"%s-%s-%s\" % (dep.name, dep.version, dep.dag_hash())\r\n>           assert os.path.isdir(os.path.join(root, stage_name))\r\nE           AssertionError: assert False\r\nE            +  where False = <function isdir at 0x2aaaaab64050>('/tmp/yser/pytest-of-user/pytest-0/mock-stage0/mpileaks-2.3-b4ervofanrurvlocnwdcezqekdphknd6')\r\nE            +    where <function isdir at 0x2aaaaab64050> = <module 'posixpath' from '/usr/tce/packages/python/python-2.7.16/lib/python2.7/posixpath.pyc'>.isdir\r\nE            +      where <module 'posixpath' from '/usr/tce/packages/python/python-2.7.16/lib/python2.7/posixpath.pyc'> = os.path\r\nE            +    and   '/tmp/user/pytest-of-user/pytest-0/mock-stage0/mpileaks-2.3-b4ervofanrurvlocnwdcezqekdphknd6' = <function join at 0x2aaaaab64f50>('/tmp/user/pytest-of-user/pytest-0/mock-stage0', 'mpileaks-2.3-b4ervofanrurvlocnwdcezqekdphknd6')\r\nE            +      where <function join at 0x2aaaaab64f50> = <module 'posixpath' from '/usr/tce/packages/python/python-2.7.16/lib/python2.7/posixpath.pyc'>.join\r\nE            +        where <module 'posixpath' from '/usr/tce/packages/python/python-2.7.16/lib/python2.7/posixpath.pyc'> = os.path\r\n```\r\n\r\n### Information on your system\r\n\r\n```console\r\nLinux ... SMP Tue May 14 18:38:00 PDT 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n",
    "performed_via_github_app": null
}