{
    "url": "https://api.github.com/repos/spack/spack/issues/9698",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9698/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9698/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9698/events",
    "html_url": "https://github.com/spack/spack/issues/9698",
    "id": 376314856,
    "node_id": "MDU6SXNzdWUzNzYzMTQ4NTY=",
    "number": 9698,
    "title": "Installation issue: singularity@develop",
    "user": {
        "login": "tomtok9",
        "id": 2410695,
        "node_id": "MDQ6VXNlcjI0MTA2OTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2410695?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tomtok9",
        "html_url": "https://github.com/tomtok9",
        "followers_url": "https://api.github.com/users/tomtok9/followers",
        "following_url": "https://api.github.com/users/tomtok9/following{/other_user}",
        "gists_url": "https://api.github.com/users/tomtok9/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tomtok9/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tomtok9/subscriptions",
        "organizations_url": "https://api.github.com/users/tomtok9/orgs",
        "repos_url": "https://api.github.com/users/tomtok9/repos",
        "events_url": "https://api.github.com/users/tomtok9/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tomtok9/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2018-11-01T09:25:15Z",
    "updated_at": "2019-05-03T01:27:14Z",
    "closed_at": "2019-05-03T01:27:14Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I tried to get singularity at leas v3.0.0 running because some of our researchers will use it. So far I was not successful. \r\n\r\n```console\r\n$ spack install singularity@develop\r\n\r\n==> Executing phase: 'autoreconf'\r\n==> Configure script not found: trying to generate it\r\n==> Warning: *********************************************************\r\n==> Warning: * If the default procedure fails, consider implementing *\r\n==> Warning: *        a custom AUTORECONF phase in the package       *\r\n==> Warning: *********************************************************\r\n==> '/home/kramert/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/libtool-2.4.6-jher54m7efbgqjarpywxcb3yxmelyswk/bin\r\n/libtoolize'\r\nlibtoolize: putting auxiliary files in '.'.\r\nlibtoolize: linking file './ltmain.sh'\r\n==> '/home/kramert/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/automake-1.16.1-p2omviwtyjez7ba5cfhofw3tlr5l7jog/b\r\nin/aclocal'\r\naclocal: error: 'configure.ac' is required\r\n```\r\n\r\n### Platform and user environment\r\n\r\n```commandline\r\n$ uname -a \r\nLinux naoki 4.15.0-38-generic #41-Ubuntu SMP Wed Oct 10 10:59:38 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:\tUbuntu 18.04.1 LTS\r\n``` \r\n\r\n### Additional information\r\n\r\n```console\r\n$ spack spec --install-status <spec>\r\nInput spec\r\n--------------------------------\r\n     singularity@develop\r\n\r\nConcretized\r\n--------------------------------\r\n     singularity@develop%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^autoconf@2.69%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^m4@1.4.18%gcc@7.3.0 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,c0a408fbffb7255fcc75e26bd8edab116fc81d216bfd18b473668b7739a4158e,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 +sigsegv arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^libsigsegv@2.11%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^perl@5.26.2%gcc@7.3.0+cpanm patches=0eac10ed90aeb0459ad8851f88081d439a4e41978e586ec743069e8b059370ac +shared+threads arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^gdbm@1.14.1%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]                  ^readline@7.0%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]                      ^ncurses@6.1%gcc@7.3.0~symlinks~termlib arch=linux-ubuntu18.04-x86_64 \r\n[+]                          ^pkgconf@1.4.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^automake@1.16.1%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^libarchive@3.3.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^bzip2@1.0.6%gcc@7.3.0+shared arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^diffutils@3.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^expat@2.2.5%gcc@7.3.0+libbsd arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^libbsd@0.8.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^libxml2@2.9.8%gcc@7.3.0~python arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^xz@5.2.4%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^zlib@1.2.11%gcc@7.3.0+optimize+pic+shared arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^lz4@1.8.1.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^lzma@4.32.7%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^lzo@2.09%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^nettle@3.4%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]              ^gmp@6.1.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]                  ^libtool@2.4.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^openssl@1.0.2o%gcc@7.3.0+systemcerts arch=linux-ubuntu18.04-x86_64 \r\n\r\n...\r\n```\r\nI think the new version is rewritten in GO probably there is the issue.  (https://www.sylabs.io/guides/3.0/user-guide/quick_start.html#quick-installation-steps)\r\n\r\nI tried to update the package.py file and changed different things  to add v.3.0.0. \r\n```\r\n# Copyright 2013-2018 Lawrence Livermore National Security, LLC and other\r\n# Spack Project Developers. See the top-level COPYRIGHT file for details.\r\n#\r\n# SPDX-License-Identifier: (Apache-2.0 OR MIT)\r\n\r\nfrom spack import *\r\n\r\nimport os\r\n\r\nclass Singularity(Package):\r\n    \"\"\"Singularity is a container platform focused on supporting 'Mobility of\r\n       Compute'\"\"\"\r\n\r\n    homepage = \"https://www.sylabs.io/singularity/\"\r\n    url      = \"https://github.com/singularityware/singularity/releases/download/2.5.2/singularity-2.5.2.tar.gz\"\r\n    git      = \"https://github.com/singularityware/singularity.git\"\r\n    cwd = os.getcwd()\r\n    # Versions before 2.5.2 suffer from a serious security problem.\r\n    # https://nvd.nist.gov/vuln/detail/CVE-2018-12021\r\n    version('develop', branch='master')\r\n    version('v3.0.0', '019afc549c838ff08cabffe094c194b9')\r\n    version('2.6.0', sha256='7c425211a099f6fa6f74037e6e17be58fb5923b0bd11aea745e48ef83c488b49')\r\n    version('2.5.2', '2edc1a8ac9a4d7d26fba6244f1c5fd95')\r\n\r\n    depends_on('go', when='@v3.0.0:')\r\n    depends_on('libuuid', when='@v3.0.0:')\r\n    depends_on('libgpg-error', when='@v3.0.0:')\r\n    depends_on('m4',       type='build', when='@v3.0.0:')\r\n    depends_on('autoconf', type='build', when='@v3.0.0:')\r\n    depends_on('automake', type='build', when='@v3.0.0:')\r\n    depends_on('libtool',  type='build', when='@v3.0.0:')\r\n    \r\n    depends_on('libarchive', when='@2.5.2:')\r\n    # these are only needed if we're grabbing the unreleased tree\r\n    depends_on('m4',       type='build', when='@develop')\r\n    depends_on('autoconf', type='build', when='@develop')\r\n    depends_on('automake', type='build', when='@develop')\r\n    depends_on('libtool',  type='build', when='@develop')\r\n    depends_on('libuuid',  type='build', when='@develop')\r\n    depends_on('libgpg-error',  type='build', when='@develop')\r\n    \r\n    phases = ['configure', 'build', 'install']\r\n    \r\n    def configure(self, spec, prefix):\r\n        configure = Executable('./mconfig')\r\n        configure()\r\n        #configure(*self.configure_args())\r\n    \r\n    def build(self, spec, prefix):\r\n        #prefix = 'builddir'\r\n        print(os.getcwd())\r\n        make('-C builddir',parallel=False) \r\n        #make()\r\n    def install(self, spec, prefix):\r\n        prefix = 'builddir'\r\n        make('install', parallel=False)    \r\n    # When installing as root, the copy has to run before chmod runs\r\n    #def install(self, spec, prefix):\r\n     #   make('install', parallel=False)\r\n\r\n```\r\nBut this does not build either. this change breaks all previous version but my goal was to get v3.0.0 running. With the changes, it can configure. Building phase fails because it could not find the makefile in the created builddir folder. \r\nWhen I go to the staging dir and tried to compile it by my self it fails because the path is not valid GO path.\r\n\r\n```\r\n/home/kramert/spack/var/spack/stage/singularity-v3.0.0-ql3y7ccdpb4uayw247ektovohk4zqxrd/singularity and /tmp/kramert/spack-stage/spack-stage-9wsa60o2/singularity are not within any known GOPATH\r\n...\r\n```\r\nI'm new to spack package building and so far I could not figure out how to add the prefix builddir correctly and make the path a valid GOPATH. \r\n\r\n",
    "performed_via_github_app": null
}