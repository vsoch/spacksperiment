{
    "url": "https://api.github.com/repos/spack/spack/issues/13963",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13963/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13963/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13963/events",
    "html_url": "https://github.com/spack/spack/issues/13963",
    "id": 531945712,
    "node_id": "MDU6SXNzdWU1MzE5NDU3MTI=",
    "number": 13963,
    "title": "Inconsistency in environment defaults creates package conflicts in view",
    "user": {
        "login": "sethrj",
        "id": 741229,
        "node_id": "MDQ6VXNlcjc0MTIyOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sethrj",
        "html_url": "https://github.com/sethrj",
        "followers_url": "https://api.github.com/users/sethrj/followers",
        "following_url": "https://api.github.com/users/sethrj/following{/other_user}",
        "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions",
        "organizations_url": "https://api.github.com/users/sethrj/orgs",
        "repos_url": "https://api.github.com/users/sethrj/repos",
        "events_url": "https://api.github.com/users/sethrj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sethrj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 537065486,
            "node_id": "MDU6TGFiZWw1MzcwNjU0ODY=",
            "url": "https://api.github.com/repos/spack/spack/labels/environments",
            "name": "environments",
            "color": "d4c5f9",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tgamblin",
            "id": 299842,
            "node_id": "MDQ6VXNlcjI5OTg0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tgamblin",
            "html_url": "https://github.com/tgamblin",
            "followers_url": "https://api.github.com/users/tgamblin/followers",
            "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
            "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
            "organizations_url": "https://api.github.com/users/tgamblin/orgs",
            "repos_url": "https://api.github.com/users/tgamblin/repos",
            "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tgamblin/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-12-03T12:20:18Z",
    "updated_at": "2020-05-06T20:16:12Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "By default, environments are created with `view: true`, generating a tree with all the combined packages. However, the default is *also* to concretize packages separately, potentially leading to multiple versions of the same package. Consequently, the default options will easily generate errors with very simple environments, depending on package defaults.\r\n\r\nI believe the default should be to concretize requirements together; or failing that to *not* generate a view.\r\n\r\n### Steps to reproduce the issue\r\n\r\nTake the example of installing HDF5, which has a default of `~fortran`, and Silo, which by default requires HDF5.\r\n\r\n```console\r\n$ spack env create test\r\n$ spack env activate test\r\n$ spack add hdf5+fortran+hl~mpi\r\n$ spack add silo~mpi\r\n$ spack concretize -f\r\n$ spack install\r\n```\r\n\r\n### Error Message\r\n\r\n```console\r\n==> Updating view at /rnsdhpc/code/spack/var/spack/environments/test/.spack-env/view\r\n==> Error: [/rnsdhpc/code/spack/var/spack/environments/test/.spack-env/view] Package conflict detected:\r\n   (Linked) hdf5@1.10.5%clang@11.0.0-apple~cxx~debug+fortran+hl~mpi+pic+shared~szip~threadsafe arch=darwin-mojave-x86_64/zrrs2ar\r\n(Specified) hdf5@1.10.5%clang@11.0.0-apple~cxx~debug~fortran~hl~mpi+pic+shared~szip~threadsafe arch=darwin-mojave-x86_64/q2msaaj\r\n==> Installing environment test\r\n==> hdf5 is already installed in /rnsdhpc/code/spack/opt/spack2/clang/hdf5/zrrs2ar\r\n==> silo is already installed in /rnsdhpc/code/spack/opt/spack2/clang/silo/voajwje\r\n==> Updating view at /rnsdhpc/code/spack/var/spack/environments/test/.spack-env/view\r\n==> Error: [/rnsdhpc/code/spack/var/spack/environments/test/.spack-env/view] Package conflict detected:\r\n   (Linked) hdf5@1.10.5%clang@11.0.0-apple~cxx~debug+fortran+hl~mpi+pic+shared~szip~threadsafe arch=darwin-mojave-x86_64/zrrs2ar\r\n(Specified) hdf5@1.10.5%clang@11.0.0-apple~cxx~debug~fortran~hl~mpi+pic+shared~szip~threadsafe arch=darwin-mojave-x86_64/q2msaaj\r\n```\r\n\r\n### Information on your system\r\n\r\nI'm running on a mac, and for the purposes of this test I removed my `packages.yaml` file.",
    "performed_via_github_app": null
}