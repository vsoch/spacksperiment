{
    "url": "https://api.github.com/repos/spack/spack/issues/5634",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/5634/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/5634/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/5634/events",
    "html_url": "https://github.com/spack/spack/pull/5634",
    "id": 263331994,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTQ1MDY5Mjgz",
    "number": 5634,
    "title": "Don't check package.installed in _mark_concrete if value=True",
    "user": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-10-06T04:18:06Z",
    "updated_at": "2017-10-06T21:23:29Z",
    "closed_at": "2017-10-06T21:23:29Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/5634",
        "html_url": "https://github.com/spack/spack/pull/5634",
        "diff_url": "https://github.com/spack/spack/pull/5634.diff",
        "patch_url": "https://github.com/spack/spack/pull/5634.patch"
    },
    "body": "Fixes https://github.com/LLNL/spack/issues/5633\r\n\r\n@becker33 @tgamblin\r\n\r\nspec and spec.package.spec can refer to different objects in the database. When these two instances of spec differ in terms of the value of the 'concrete' property, Spec._mark_concrete can fail when checking Spec.package.installed (which requires package.spec to be concrete). This skips the check for spec.package.installed when _mark_concrete is called with 'True' (in other words, when the database is marking all specs as being concrete).\r\n\r\nFor a concrete example of\r\n\r\n> spec and spec.package.spec can refer to different objects in the database.\r\n\r\nIn #5633 we have a case like X->Y where X is libtiff and Y is libjpeg-turbo which itself has 1 build dependency\r\n\r\n* repository.get was first called with the non-concrete copy of `libjpeg-turbo@1.5.0%gcc@4.6.1 arch=linux-rhel6-x86_64` (this happens sometime during concretization), so the package stored in repository has package.spec.concrete = False\r\n* database however stores a copy of `libjpeg-turbo@1.5.0%gcc@4.6.1 arch=linux-rhel6-x86_64` and considers it concrete (because it marks it as such) and it is ok with omitting the dependency because it is a build dep\r\n* `database._add` assigns the concrete version of 'libjpeg-turbo@1.5.0%gcc@4.6.1 arch=linux-rhel6-x86_64' to libtiff\r\n* when that libjpeg spec calls package, it will match the repository key of the package associated with the non-concrete spec and so it will get that package",
    "performed_via_github_app": null
}