{
    "url": "https://api.github.com/repos/spack/spack/issues/2924",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2924/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2924/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2924/events",
    "html_url": "https://github.com/spack/spack/issues/2924",
    "id": 202885337,
    "node_id": "MDU6SXNzdWUyMDI4ODUzMzc=",
    "number": 2924,
    "title": "install fails looking for `modulecmd`",
    "user": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446645732,
            "node_id": "MDU6TGFiZWw0NDY2NDU3MzI=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-environment",
            "name": "build-environment",
            "color": "bfdadc",
            "default": false,
            "description": null
        },
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 20,
    "created_at": "2017-01-24T17:24:53Z",
    "updated_at": "2017-06-21T16:58:42Z",
    "closed_at": "2017-06-21T16:58:42Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "A user reported this error.\r\n\r\nIt looks like [`load_module` in `build_enviroment.py`](https://github.com/LLNL/spack/blob/develop/lib/spack/spack/build_environment.py#L129) will fail if `modulecmd` is not available.  \r\n\r\n@alalazo: Is it supposed to be possible to get to this code if the system supports modules?  Seems like we should check for `modulecmd` up front.  I haven't dug into this yet.\r\n\r\n\r\n```console\r\ngalaxy:~>spack -d -v mirror list                                                                      \r\n==> Reading config file /local/cjn/.spack/linux/mirrors.yaml                                         \r\nlocal_filesystem    file:///ROWAN/group/pts/spack_mirror/spack-mirror-2017-01-24\r\n\r\ngalaxy:~>spack -d -v install zlib\r\n==> Reading config file /ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/etc/spack/defaults/packages.yaml\r\n==> READ LOCK: /local/cjn/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquiring]\r\n==> READ LOCK: /local/cjn/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Released]\r\n==> Reading config file /local/cjn/.spack/linux/compilers.yaml\r\n==> READ LOCK: /ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/opt/spack/.spack-db/prefix_lock[3332486004197984765:1] [Acquiring]\r\n==> READ LOCK: /ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/opt/spack/.spack-db/prefix_lock[3332486004197984765:1] [Released]\r\n==> Installing zlib\r\n==> Error: AttributeError: 'NoneType' object has no attribute 'add_default_arg'\r\n/ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/lib/spack/spack/build_environment.py:567, in child_execution:\r\n     547      def child_execution(child_connection, input_stream):\r\n     548          try:\r\n     549              setup_package(pkg, dirty=dirty)\r\n     550              function(input_stream)\r\n     551              child_connection.send(None)\r\n     552          except StopIteration as e:\r\n     553              # StopIteration is used to stop installations\r\n     554              # before the final stage, mainly for debug purposes\r\n     555              tty.msg(e.message)\r\n    556              child_connection.send(None)\r\n     557          except:\r\n     558              # catch ANYTHING that goes wrong in the child process\r\n     559              exc_type, exc, tb = sys.exc_info()\r\n     560  \r\n     561              # Need to unwind the traceback in the child because traceback\r\n     562              # objects can't be sent to the parent.\r\n     563              tb_string = traceback.format_exc()\r\n     564  \r\n     565              # build up some context from the offending package so we can\r\n     566              # show that, too.\r\n  >> 567              package_context = get_package_context(tb)\r\n     568  \r\n     569              build_log = None\r\n     570              if hasattr(pkg, 'log_path'):\r\n     571                  build_log = pkg.log_path\r\n     572  \r\n     573              # make a pickleable exception to send to parent.\r\n     574              msg = \"%s: %s\" % (str(exc_type.__name__), str(exc))\r\n     575  \r\n     576              ce = ChildError(msg, tb_string, build_log, package_context)\r\n     577              child_connection.send(ce)\r\n     578  \r\n     579          finally:\r\n     580              child_connection.close()\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"/ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/lib/spack/spack/build_environment.py\", line 549, in child_execution\r\n    setup_package(pkg, dirty=dirty)\r\n  File \"/ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/lib/spack/spack/build_environment.py\", line 492, in setup_package\r\n    set_compiler_environment_variables(pkg, spack_env)\r\n  File \"/ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/lib/spack/spack/build_environment.py\", line 227, in set_compiler_environment_variables\r\n    load_module(mod)\r\n  File \"/ROWAN/group/prod/LINUX_WORKSTATION/acs/spack/spack-0.10.0/lib/spack/spack/build_environment.py\", line 129, in load_module\r\n    modulecmd.add_default_arg('python')\r\nAttributeError: 'NoneType' object has no attribute 'add_default_arg'\r\n```",
    "performed_via_github_app": null
}