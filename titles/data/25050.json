{
    "url": "https://api.github.com/repos/spack/spack/issues/25050",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/25050/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/25050/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/25050/events",
    "html_url": "https://github.com/spack/spack/issues/25050",
    "id": 951154373,
    "node_id": "MDU6SXNzdWU5NTExNTQzNzM=",
    "number": 25050,
    "title": "llvm@8 build fails on Ubuntu 20.04, GCC 9.3.0, glibc 2.31: narrowing conversion",
    "user": {
        "login": "eugeneswalker",
        "id": 38933153,
        "node_id": "MDQ6VXNlcjM4OTMzMTUz",
        "avatar_url": "https://avatars.githubusercontent.com/u/38933153?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eugeneswalker",
        "html_url": "https://github.com/eugeneswalker",
        "followers_url": "https://api.github.com/users/eugeneswalker/followers",
        "following_url": "https://api.github.com/users/eugeneswalker/following{/other_user}",
        "gists_url": "https://api.github.com/users/eugeneswalker/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/eugeneswalker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/eugeneswalker/subscriptions",
        "organizations_url": "https://api.github.com/users/eugeneswalker/orgs",
        "repos_url": "https://api.github.com/users/eugeneswalker/repos",
        "events_url": "https://api.github.com/users/eugeneswalker/events{/privacy}",
        "received_events_url": "https://api.github.com/users/eugeneswalker/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 1474769306,
            "node_id": "MDU6TGFiZWwxNDc0NzY5MzA2",
            "url": "https://api.github.com/repos/spack/spack/labels/e4s",
            "name": "e4s",
            "color": "5224ad",
            "default": false,
            "description": ""
        },
        {
            "id": 966031931,
            "node_id": "MDU6TGFiZWw5NjYwMzE5MzE=",
            "url": "https://api.github.com/repos/spack/spack/labels/ecp",
            "name": "ecp",
            "color": "79d7ea",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2021-07-23T00:23:44Z",
    "updated_at": "2021-07-23T00:24:07Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "`llvm@8` fails to build using:\r\n* `spack@develop` (91b4d974f161bb9f3e38be82b43e8566fa9f1c56 from `Thu Jul 22 10:09:18 2021 -0700`)\r\n* Ubuntu 20.04, GCC 9.3.0 (glibc 2.31)\r\n\r\nSame spec builds OK on:\r\n* RHEL 7, GCC 9.3.0 (libc 2.17)\r\n* RHEL 8, GCC 8.4.1 (libc 2.28)\r\n* Ubuntu 18.04, GCC 7.5.0 (glibc 2.27)\r\n\r\nIt looks like the issue may specifically have to do with glibc 2.31 based on:\r\n* https://stackoverflow.com/questions/63437209/error-narrowing-conversion-of-1-from-int-to-long-unsigned-int-wnarrowi\r\n* https://web.archive.org/web/20200723122730/http://www.linuxfromscratch.org/lfs/view/stable/chapter05/gcc-pass2.html\r\n\r\nConcrete spec: [llvm-wpoz2z.spec.yaml.txt](https://github.com/spack/spack/files/6866008/llvm-wpoz2z.spec.yaml.txt)\r\nBuild log: [llvm-build-out.txt](https://github.com/spack/spack/files/6866017/llvm-build-out.txt)\r\n\r\n\r\n```\r\n$> spack install \r\n...\r\n==> Installing llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/d8/d81238b4a69e93e29f74ce56f8107cbfcf0c7d7b40510b7879e98cc031e25167.tar.gz\r\n==> Applied patch /spack/var/spack/repos/builtin/packages/llvm/constexpr_longdouble.patch\r\n==> llvm: Executing phase: 'cmake'\r\n==> llvm: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j32'\r\n\r\n4 errors found in build log:\r\n     2948    cd /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/lib/BinaryFormat && /spack/lib/spack/env/gcc/g++ -D_GNU_SOURCE -D__STDC_CONSTANT_\r\n             MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/lib/BinaryFormat -I/tmp/root/s\r\n             pack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/lib/BinaryFormat -I/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.10-qlt5ajqqmtin3a\r\n             tqcycnv67oex63cvny/include/libxml2 -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/include -I/tmp/root/spack-stage/spack-stage-llv\r\n             m-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/include -std=c++11 -fPIC -fvisibility-inlines-hidden -Werror=date-time -std=c++11 -Wall -Wextra -Wno-unused-parameter -Wwrite-\r\n             strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fallthrough -Wno-maybe-uninitialized -Wno-class-memaccess -Wno-noexcept-type -Wdelete-non-virt\r\n             ual-dtor -Wno-comment -ffunction-sections -fdata-sections -O3 -DNDEBUG -MD -MT lib/BinaryFormat/CMakeFiles/LLVMBinaryFormat.dir/MsgPackWriter.cpp.o -MF CMakeFiles/LLVMBinaryFormat.di\r\n             r/MsgPackWriter.cpp.o.d -o CMakeFiles/LLVMBinaryFormat.dir/MsgPackWriter.cpp.o -c /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/lib/Bin\r\n             aryFormat/MsgPackWriter.cpp\r\n     2949    [  4%] Building C object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-x86_64.dir/floatsidf.c.o\r\n     2950    cd /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/projects/compiler-rt/lib/builtins && /spack/lib/spack/env/gcc/gcc -DVISIBILITY_HI\r\n             DDEN -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-m\r\n             vugr4t/projects/compiler-rt/lib/builtins -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/builtins -I/spack/opt/spack/linux-u\r\n             buntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.10-qlt5ajqqmtin3atqcycnv67oex63cvny/include/libxml2 -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-buil\r\n             d-mvugr4t/include -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/include -fPIC -Werror=date-time -Wall -Wextra -Wno-unused-parameter -\r\n             Wwrite-strings -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fallthrough -Wno-comment -ffunction-sections -fdata-sections -Wall -Wno-unused-parameter -O3 -DNDEB\r\n             UG  -m64 -fno-lto -std=c11 -MD -MT projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-x86_64.dir/floatsidf.c.o -MF CMakeFiles/clang_rt.builtins-x86_64.dir/floatsidf.c.o.d\r\n              -o CMakeFiles/clang_rt.builtins-x86_64.dir/floatsidf.c.o -c /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/builtins/floatsid\r\n             f.c\r\n     2951    [  4%] Building C object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-x86_64.dir/floatsisf.c.o\r\n     2952    cd /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/projects/compiler-rt/lib/builtins && /spack/lib/spack/env/gcc/gcc -DVISIBILITY_HI\r\n             DDEN -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-m\r\n             vugr4t/projects/compiler-rt/lib/builtins -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/builtins -I/spack/opt/spack/linux-u\r\n             buntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.10-qlt5ajqqmtin3atqcycnv67oex63cvny/include/libxml2 -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-buil\r\n             d-mvugr4t/include -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/include -fPIC -Werror=date-time -Wall -Wextra -Wno-unused-parameter -\r\n             Wwrite-strings -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fallthrough -Wno-comment -ffunction-sections -fdata-sections -Wall -Wno-unused-parameter -O3 -DNDEB\r\n             UG  -m64 -fno-lto -std=c11 -MD -MT projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-x86_64.dir/floatsisf.c.o -MF CMakeFiles/clang_rt.builtins-x86_64.dir/floatsisf.c.o.d\r\n              -o CMakeFiles/clang_rt.builtins-x86_64.dir/floatsisf.c.o -c /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/builtins/floatsis\r\n             f.c\r\n     2953    In file included from /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_platform_limits_posix.cc:163:\r\n  >> 2954    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_internal_defs.h:343:72: error: narrowing conversion\r\n              of '-1' from 'int' to 'long unsigned int' [-Wnarrowing]\r\n     2955      343 |     typedef char IMPL_PASTE(assertion_failed_##_, line)[2*(int)(pred)-1]\r\n     2956          |                                                                        ^\r\n     2957    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_internal_defs.h:337:30: note: in expansion of macro\r\n              'IMPL_COMPILER_ASSERT'\r\n     2958      337 | #define COMPILER_CHECK(pred) IMPL_COMPILER_ASSERT(pred, __LINE__)\r\n     2959          |                              ^~~~~~~~~~~~~~~~~~~~\r\n     2960    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_platform_limits_posix.h:1438:3: note: in expansion\r\n             of macro 'COMPILER_CHECK'\r\n\r\n     ...\r\n\r\n     2972    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_platform_limits_posix.h:1438:3: note: in expansion\r\n             of macro 'COMPILER_CHECK'\r\n     2973     1438 |   COMPILER_CHECK(sizeof(((__sanitizer_##CLASS *) NULL)->MEMBER) == \\\r\n     2974          |   ^~~~~~~~~~~~~~\r\n     2975    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_platform_limits_posix.cc:1132:1: note: in expansion\r\n              of macro 'CHECK_SIZE_AND_OFFSET'\r\n     2976     1132 | CHECK_SIZE_AND_OFFSET(ipc_perm, mode);\r\n     2977          | ^~~~~~~~~~~~~~~~~~~~~\r\n  >> 2978    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_internal_defs.h:343:70: error: size '-1' of array '\r\n             assertion_failed__1132' is negative\r\n     2979      343 |     typedef char IMPL_PASTE(assertion_failed_##_, line)[2*(int)(pred)-1]\r\n     2980          |                                                         ~~~~~~~~~~~~~^~\r\n     2981    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_internal_defs.h:337:30: note: in expansion of macro\r\n              'IMPL_COMPILER_ASSERT'\r\n     2982      337 | #define COMPILER_CHECK(pred) IMPL_COMPILER_ASSERT(pred, __LINE__)\r\n     2983          |                              ^~~~~~~~~~~~~~~~~~~~\r\n     2984    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_platform_limits_posix.h:1438:3: note: in expansion\r\n             of macro 'COMPILER_CHECK'\r\n     2985     1438 |   COMPILER_CHECK(sizeof(((__sanitizer_##CLASS *) NULL)->MEMBER) == \\\r\n     2986          |   ^~~~~~~~~~~~~~\r\n     2987    /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/sanitizer_common/sanitizer_platform_limits_posix.cc:1132:1: note: in expansion\r\n              of macro 'CHECK_SIZE_AND_OFFSET'\r\n     2988     1132 | CHECK_SIZE_AND_OFFSET(ipc_perm, mode);\r\n     2989          | ^~~~~~~~~~~~~~~~~~~~~\r\n  >> 2990    make[2]: *** [projects/compiler-rt/lib/sanitizer_common/CMakeFiles/RTSanitizerCommon.x86_64.dir/build.make:373: projects/compiler-rt/lib/sanitizer_common/CMakeFiles/RTSanitizerCommon\r\n             .x86_64.dir/sanitizer_platform_limits_posix.cc.o] Error 1\r\n     2991    make[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t'\r\n  >> 2992    make[1]: *** [CMakeFiles/Makefile2:22569: projects/compiler-rt/lib/sanitizer_common/CMakeFiles/RTSanitizerCommon.x86_64.dir/all] Error 2\r\n     2993    make[1]: *** Waiting for unfinished jobs....\r\n     2994    [  4%] Building CXX object utils/TableGen/CMakeFiles/obj.llvm-tblgen.dir/CodeGenMapTable.cpp.o\r\n     2995    cd /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/utils/TableGen && /spack/lib/spack/env/gcc/g++ -D_GNU_SOURCE -D__STDC_CONSTANT_MA\r\n             CROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/utils/TableGen -I/tmp/root/spack\r\n             -stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/utils/TableGen -I/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.10-qlt5ajqqmtin3atqcycn\r\n             v67oex63cvny/include/libxml2 -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/include -I/tmp/root/spack-stage/spack-stage-llvm-8.0.\r\n             0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/include -std=c++11 -fPIC -fvisibility-inlines-hidden -Werror=date-time -std=c++11 -Wall -Wextra -Wno-unused-parameter -Wwrite-string\r\n             s -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fallthrough -Wno-maybe-uninitialized -Wno-class-memaccess -Wno-noexcept-type -Wdelete-non-virtual-dt\r\n             or -Wno-comment -ffunction-sections -fdata-sections -O3 -DNDEBUG -MD -MT utils/TableGen/CMakeFiles/obj.llvm-tblgen.dir/CodeGenMapTable.cpp.o -MF CMakeFiles/obj.llvm-tblgen.dir/CodeGe\r\n             nMapTable.cpp.o.d -o CMakeFiles/obj.llvm-tblgen.dir/CodeGenMapTable.cpp.o -c /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/utils/TableG\r\n             en/CodeGenMapTable.cpp\r\n     2996    [  4%] Building C object projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-x86_64.dir/floattidf.c.o\r\n     2997    cd /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-mvugr4t/projects/compiler-rt/lib/builtins && /spack/lib/spack/env/gcc/gcc -DVISIBILITY_HI\r\n             DDEN -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-m\r\n             vugr4t/projects/compiler-rt/lib/builtins -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/builtins -I/spack/opt/spack/linux-u\r\n             buntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.10-qlt5ajqqmtin3atqcycnv67oex63cvny/include/libxml2 -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-buil\r\n             d-mvugr4t/include -I/tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/llvm/include -fPIC -Werror=date-time -Wall -Wextra -Wno-unused-parameter -\r\n             Wwrite-strings -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fallthrough -Wno-comment -ffunction-sections -fdata-sections -Wall -Wno-unused-parameter -O3 -DNDEB\r\n             UG  -m64 -fno-lto -std=c11 -MD -MT projects/compiler-rt/lib/builtins/CMakeFiles/clang_rt.builtins-x86_64.dir/floattidf.c.o -MF CMakeFiles/clang_rt.builtins-x86_64.dir/floattidf.c.o.d\r\n              -o CMakeFiles/clang_rt.builtins-x86_64.dir/floattidf.c.o -c /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-src/compiler-rt/lib/builtins/floattid\r\n             f.c\r\n     2998    [  4%] Linking CXX static library ../../libLLVMMCDisassembler.a\r\n\r\nSee build log for details:\r\n  /tmp/root/spack-stage/spack-stage-llvm-8.0.0-mvugr4tunlzs2yddnwu3cppvfn6nlbhd/spack-build-out.txt\r\n```\r\n\r\n\r\n",
    "performed_via_github_app": null
}