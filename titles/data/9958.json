{
    "url": "https://api.github.com/repos/spack/spack/issues/9958",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9958/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9958/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9958/events",
    "html_url": "https://github.com/spack/spack/issues/9958",
    "id": 384832866,
    "node_id": "MDU6SXNzdWUzODQ4MzI4NjY=",
    "number": 9958,
    "title": "Installation issue: curl",
    "user": {
        "login": "mathomp4",
        "id": 2982494,
        "node_id": "MDQ6VXNlcjI5ODI0OTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2982494?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mathomp4",
        "html_url": "https://github.com/mathomp4",
        "followers_url": "https://api.github.com/users/mathomp4/followers",
        "following_url": "https://api.github.com/users/mathomp4/following{/other_user}",
        "gists_url": "https://api.github.com/users/mathomp4/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mathomp4/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mathomp4/subscriptions",
        "organizations_url": "https://api.github.com/users/mathomp4/orgs",
        "repos_url": "https://api.github.com/users/mathomp4/repos",
        "events_url": "https://api.github.com/users/mathomp4/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mathomp4/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 616911200,
            "node_id": "MDU6TGFiZWw2MTY5MTEyMDA=",
            "url": "https://api.github.com/repos/spack/spack/labels/gcc",
            "name": "gcc",
            "color": "0052cc",
            "default": false,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2018-11-27T14:53:56Z",
    "updated_at": "2019-08-17T12:28:02Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\nFirst, I am actually installing `curl%gcc@8.2.0` but I've defaulted to `gcc@8.2.0` in `packages.yaml`. My code is (eventually) Fortran so `clang` can be an adventure.\r\n\r\n```console\r\n$ spack install curl\r\n==> Installing curl\r\n==> Searching for binary cache of curl\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for curl found: installing from source\r\n==> Fetching http://curl.haxx.se/download/curl-7.60.0.tar.bz2\r\n######################################################################## 100.0%\r\n==> Staging archive: /Users/mathomp4/spack/var/spack/stage/curl-7.60.0-tngzkrdmhpblo4o6cscyl2idlwmjolnf/curl-7.60.0.tar.bz2\r\n==> Created stage in /Users/mathomp4/spack/var/spack/stage/curl-7.60.0-tngzkrdmhpblo4o6cscyl2idlwmjolnf\r\n==> No patches needed for curl\r\n==> Building curl [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j4'\r\n\r\n9 errors found in build log:\r\n     909      CC       vtls/libcurl_la-darwinssl.lo\r\n     910      CC       vtls/libcurl_la-gskit.lo\r\n     911      CC       vtls/libcurl_la-mbedtls.lo\r\n     912    In file included from /System/Library/Frameworks/Security.framework/Headers/AuthSession.h:32,\r\n     913                     from /System/Library/Frameworks/Security.framework/Headers/Security.h:43,\r\n     914                     from vtls/darwinssl.c:44:\r\n  >> 915    /System/Library/Frameworks/Security.framework/Headers/Authorization.h:193:7: error: variably modified 'bytes' at file scope\r\n     916      char bytes[kAuthorizationExternalFormLength];\r\n     917           ^~~~~\r\n     918    vtls/darwinssl.c: In function 'darwinssl_version_from_curl':\r\n  >> 919    vtls/darwinssl.c:1258:10: error: implicit declaration of function '__builtin_available'; did you mean '__builtin_scalbl'? [-Werror=implicit-\r\n            function-declaration]\r\n     920           if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     921              ^~~~~~~~~~~~~~~~~~~\r\n     922              __builtin_scalbl\r\n  >> 923    vtls/darwinssl.c:1258:30: error: 'macOS' undeclared (first use in this function)\r\n     924           if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     925                                  ^~~~~\r\n     926    vtls/darwinssl.c:1258:30: note: each undeclared identifier is reported only once for each function it appears in\r\n  >> 927    vtls/darwinssl.c:1258:35: error: expected ')' before numeric constant\r\n     928           if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     929                                       ^~~~~~\r\n     930                                       )\r\n     931    vtls/darwinssl.c: In function 'set_ssl_version_min_max':\r\n  >> 932    vtls/darwinssl.c:1282:26: error: 'macOS' undeclared (first use in this function)\r\n     933       if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     934                              ^~~~~\r\n  >> 935    vtls/darwinssl.c:1282:31: error: expected ')' before numeric constant\r\n     936       if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     937                                   ^~~~~~\r\n     938                                   )\r\n     939    vtls/darwinssl.c: In function 'darwinssl_connect_step1':\r\n  >> 940    vtls/darwinssl.c:1434:30: error: 'macOS' undeclared (first use in this function)\r\n     941           if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     942                                  ^~~~~\r\n  >> 943    vtls/darwinssl.c:1434:35: error: expected ')' before numeric constant\r\n     944           if(__builtin_available(macOS 10.13, iOS 11.0, *)) {\r\n     945                                       ^~~~~~\r\n     946                                       )\r\n     947    vtls/darwinssl.c: In function 'show_verbose_server_cert':\r\n  >> 948    vtls/darwinssl.c:2517:6: error: 'SecTrustEvaluateAsync' undeclared (first use in this function); did you mean 'SecTrustEvaluate'?\r\n     949       if(SecTrustEvaluateAsync != NULL) {\r\n     950          ^~~~~~~~~~~~~~~~~~~~~\r\n     951          SecTrustEvaluate\r\n     952    cc1: some warnings being treated as errors\r\n     953    make[2]: *** [Makefile:2175: vtls/libcurl_la-darwinssl.lo] Error 1\r\n     954    make[2]: *** Waiting for unfinished jobs....\r\n\r\nSee build log for details:\r\n  /Users/mathomp4/spack/var/spack/stage/curl-7.60.0-tngzkrdmhpblo4o6cscyl2idlwmjolnf/curl-7.60.0/spack-build.out\r\n```\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```commandline\r\n$ uname -a\r\nDarwin gs6101-parcel.ndc.nasa.gov 17.7.0 Darwin Kernel Version 17.7.0: Wed Oct 10 23:06:14 PDT 2018; root:xnu-4570.71.13~1/RELEASE_X86_64 x86_64\r\n$ sw_vers\r\nProductName:\tMac OS X\r\nProductVersion:\t10.13.6\r\nBuildVersion:\t17G3025\r\n``` \r\nAnd my `packages.yaml` tries to use the system ssl, though I'm still a bit confused on how to do it on macOS as it's Libre SSL and not Open SSL. Someone on slack said to just pick a version of Open SSL and have spack pretend the system is that version.\r\n```commandline\r\n[mathomp4:~/.spack] 7d20h32m39s $ cat packages.yaml\r\npackages:\r\n   all:\r\n     compiler: [gcc@8.2.0]\r\n     providers:\r\n       mpi: [openmpi,mpich]\r\n   openssl:\r\n     paths:\r\n       openssl@1.0.2o: /usr\r\n     buildable: False\r\n   hdf5:\r\n     variants: +fortran+szip\r\n   netcdf:\r\n     variants: +hdf4+dap\r\n```\r\nI've tried building with and without the `openssl` lines in `packages.yaml` and both fail the same way.\r\n\r\nAnd here is my `compilers.yaml`:\r\n\r\n```commandline\r\n[mathomp4:~/.spack] 7d20h33m12s $ cat darwin/compilers.yaml\r\ncompilers:\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: highsierra\r\n    paths:\r\n      cc: /usr/bin/clang\r\n      cxx: /usr/bin/clang++\r\n      f77: /usr/local/bin/gfortran\r\n      fc: /usr/local/bin/gfortran\r\n    spec: clang@10.0.0-apple\r\n    target: x86_64\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: highsierra\r\n    paths:\r\n      cc: null\r\n      cxx: null\r\n      f77: /usr/local/bin/gfortran\r\n      fc: /usr/local/bin/gfortran\r\n    spec: gcc@6.3.0\r\n    target: x86_64\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: [gcc-gfortran/8.2.0]\r\n    operating_system: highsierra\r\n    paths:\r\n      cc: /Users/mathomp4/installed/Core/gcc-gfortran/8.2.0/bin/gcc\r\n      cxx: /Users/mathomp4/installed/Core/gcc-gfortran/8.2.0/bin/g++\r\n      f77: /Users/mathomp4/installed/Core/gcc-gfortran/8.2.0/bin/gfortran\r\n      fc: /Users/mathomp4/installed/Core/gcc-gfortran/8.2.0/bin/gfortran\r\n    spec: gcc@8.2.0\r\n    target: x86_64\r\n```\r\n\r\n### Additional information\r\n\r\nPer issue template, some additional information:\r\n```console\r\n[mathomp4:~/.spack] 6d21h1m10s 1 $ spack spec --install-status curl\r\nInput spec\r\n--------------------------------\r\n -   curl\r\n\r\nConcretized\r\n--------------------------------\r\n -   curl@7.60.0%gcc@8.2.0+darwinssl~libssh~libssh2~nghttp2 arch=darwin-highsierra-x86_64\r\n[+]      ^zlib@1.2.11%gcc@8.2.0+optimize+pic+shared arch=darwin-highsierra-x86_64\r\n```\r\n\r\nI have also rebuilt the package with the following options:\r\n```console\r\n$ spack -d install -j 1 curl\r\n```\r\nand will attach the files next.",
    "performed_via_github_app": null
}