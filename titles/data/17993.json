{
    "url": "https://api.github.com/repos/spack/spack/issues/17993",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/17993/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/17993/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/17993/events",
    "html_url": "https://github.com/spack/spack/issues/17993",
    "id": 677011998,
    "node_id": "MDU6SXNzdWU2NzcwMTE5OTg=",
    "number": 17993,
    "title": "Doc error? include config in env spack.yaml applied in different order than online docs say",
    "user": {
        "login": "payerle",
        "id": 19287807,
        "node_id": "MDQ6VXNlcjE5Mjg3ODA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/19287807?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/payerle",
        "html_url": "https://github.com/payerle",
        "followers_url": "https://api.github.com/users/payerle/followers",
        "following_url": "https://api.github.com/users/payerle/following{/other_user}",
        "gists_url": "https://api.github.com/users/payerle/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/payerle/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/payerle/subscriptions",
        "organizations_url": "https://api.github.com/users/payerle/orgs",
        "repos_url": "https://api.github.com/users/payerle/repos",
        "events_url": "https://api.github.com/users/payerle/events{/privacy}",
        "received_events_url": "https://api.github.com/users/payerle/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446615135,
            "node_id": "MDU6TGFiZWw0NDY2MTUxMzU=",
            "url": "https://api.github.com/repos/spack/spack/labels/configuration",
            "name": "configuration",
            "color": "bfd4f2",
            "default": false,
            "description": null
        },
        {
            "id": 537065486,
            "node_id": "MDU6TGFiZWw1MzcwNjU0ODY=",
            "url": "https://api.github.com/repos/spack/spack/labels/environments",
            "name": "environments",
            "color": "d4c5f9",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2020-08-11T16:17:57Z",
    "updated_at": "2021-02-19T13:31:47Z",
    "closed_at": "2021-02-19T13:31:47Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "The online documentation:\r\nhttps://spack.readthedocs.io/en/latest/environments.html\r\nin the section \"Included configurations\"\r\nstates\r\n\"Included configs listed later will have higher precedence, as the included configs are applied in order.\"\r\n\r\nThis does not match what I see when using included configurations.\r\n### Steps to reproduce the issue\r\n1) Clone a new spack instance, copy yaml configs from etc/spack/defaults to etc/spack, and create a compilers.yaml with system compiler\r\n\r\n2) spack env create test\r\n\r\n3) Edit the spack.yaml for test env to be\r\n```yaml\r\nspack:\r\n  specs: []\r\n  view: true\r\n  include:\r\n    - /homes/payerle/spacktest/A/test.yaml\r\n    - /homes/payerle/spacktest/B/testb.yaml\r\n```\r\n4) Create the /homes/payerle/spacktest/A/test.yaml\r\nwith contents:\r\n```yaml\r\npackages:\r\n  libiconv:\r\n    version: [1.15]\r\n```\r\n5) Create the /homes/payerle/spacktest/B/testb.yaml\r\nwith contents:\r\n```yaml\r\npackages:\r\n  libiconv:\r\n    version: [0.14]\r\n```\r\n6) Run a spec command for libiconv using the test environment:\r\n```console\r\n$ spack --debug --env test spec libiconv\r\n==> [2020-08-11-12:12:40.487271] Imported spec from built-in commands\r\n==> [2020-08-11-12:12:40.487841] Imported spec from built-in commands\r\nInput spec\r\n--------------------------------\r\nlibiconv\r\n\r\nConcretized\r\n--------------------------------\r\n==> [2020-08-11-12:12:40.489582] Reading config file /homes/payerle/spacktest/B/testb.yaml\r\n==> [2020-08-11-12:12:40.493707] Reading config file /homes/payerle/spacktest/A/test.yaml\r\n==> [2020-08-11-12:12:40.496421] Reading config file /export/data/localhome/home/payerle/git/spack.test/var/spack/environments/test/spack.yaml\r\n==> [2020-08-11-12:12:40.498496] Reading config file /export/data/localhome/home/payerle/git/spack.test/etc/spack/defaults/repos.yaml\r\n==> [2020-08-11-12:12:40.499822] Reading config file /export/data/localhome/home/payerle/git/spack.test/etc/spack/repos.yaml\r\n==> [2020-08-11-12:12:40.529911] Reading config file /export/data/localhome/home/payerle/git/spack.test/etc/spack/defaults/packages.yaml\r\n==> [2020-08-11-12:12:40.546539] Reading config file /export/data/localhome/home/payerle/git/spack.test/etc/spack/packages.yaml\r\n==> [2020-08-11-12:12:40.563246] Reading config file /export/data/localhome/home/payerle/git/spack.test/etc/spack/compilers.yaml\r\n==> [2020-08-11-12:12:40.568517] Reading config file /homes/payerle/.spack/linux/compilers.yaml\r\n==> [2020-08-11-12:12:40.579323] '/usr/bin/gcc' '-dumpversion'\r\n==> [2020-08-11-12:12:40.582085] '/usr/bin/gcc' '-dumpversion'\r\n==> [2020-08-11-12:12:40.584372] '/usr/bin/gcc' '-dumpversion'\r\n==> [2020-08-11-12:12:40.586276] Warning: gcc@rh7-4.8.5 cannot build optimized binaries for \"skylake\". Using best target possible: \"haswell\"\r\n==> [2020-08-11-12:12:40.593281] DATABASE LOCK TIMEOUT: 3s\r\n==> [2020-08-11-12:12:40.593362] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2020-08-11-12:12:40.596693] '/usr/bin/gcc' '-dumpversion'\r\nlibiconv@1.15%gcc@rh7-4.8.5 arch=linux-rhel7-haswell\r\n```\r\nAs can be seen from the debug messages and from the final result (libiconv@1.15), the testb.yaml file is applied before the test.yaml file, so test.yaml \"wins\" the conflict re libiconv version.\r\n\r\nThus the include files are applied in reverse order, with earlier files \"beating\" later files, which\r\ncontradicts the documentation.\r\n\r\nI would recommend fixing the documentation to accurately reflect what is happening.\r\n\r\n### Information on your system\r\nspack debug report\r\n* **Spack:** 0.15.3-488-313511b\r\n* **Python:** 2.7.5\r\n* **Platform:** linux-rhel7-skylake\r\n\r\n### Additional information\r\nSee also issue #17992\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output\r\n",
    "performed_via_github_app": null
}