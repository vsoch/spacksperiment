{
    "url": "https://api.github.com/repos/spack/spack/issues/5455",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/5455/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/5455/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/5455/events",
    "html_url": "https://github.com/spack/spack/issues/5455",
    "id": 259990036,
    "node_id": "MDU6SXNzdWUyNTk5OTAwMzY=",
    "number": 5455,
    "title": "Use of --dirty with externals packages and compilers (always required?)",
    "user": {
        "login": "pramodskumbhar",
        "id": 27898197,
        "node_id": "MDQ6VXNlcjI3ODk4MTk3",
        "avatar_url": "https://avatars.githubusercontent.com/u/27898197?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pramodskumbhar",
        "html_url": "https://github.com/pramodskumbhar",
        "followers_url": "https://api.github.com/users/pramodskumbhar/followers",
        "following_url": "https://api.github.com/users/pramodskumbhar/following{/other_user}",
        "gists_url": "https://api.github.com/users/pramodskumbhar/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pramodskumbhar/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pramodskumbhar/subscriptions",
        "organizations_url": "https://api.github.com/users/pramodskumbhar/orgs",
        "repos_url": "https://api.github.com/users/pramodskumbhar/repos",
        "events_url": "https://api.github.com/users/pramodskumbhar/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pramodskumbhar/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446645732,
            "node_id": "MDU6TGFiZWw0NDY2NDU3MzI=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-environment",
            "name": "build-environment",
            "color": "bfdadc",
            "default": false,
            "description": null
        },
        {
            "id": 455855856,
            "node_id": "MDU6TGFiZWw0NTU4NTU4NTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/external-packages",
            "name": "external-packages",
            "color": "c5def5",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-09-23T07:27:55Z",
    "updated_at": "2017-10-05T01:25:55Z",
    "closed_at": "2017-10-05T01:25:55Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "If we have externally installed packages or compilers with `modules` and if we specify those modules in Spack config files (`packages.yaml`, `compilers.yaml`) then we should not require `--dirty` flag. At least this is expectation from Slack discussion. But this is not the case.\r\n\r\nHere is an example:\r\n\r\nWe have gcc module as:\r\n\r\n```\r\n\u2192 module show gcc_490\r\n-------------------------------------------------------------------\r\n/gpfs/bbp.cscs.ch/home/kumbhar/my_modules/gcc_490:\r\n\r\nmodule-whatis\t Loads gcc 4.9.0 to your environment variables\r\nprepend-path\t PATH /gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/bin\r\nprepend-path\t LD_LIBRARY_PATH /gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/lib64\r\nprepend-path\t LD_LIBRARY_PATH /gpfs/bbp.cscs.ch/apps/viz/tools/mpc/mpc-1.0.2/install/lib\r\nprepend-path\t LD_LIBRARY_PATH /gpfs/bbp.cscs.ch/apps/viz/tools/mpfr/mpfr-3.1.2/install/lib\r\nprepend-path\t LD_LIBRARY_PATH /gpfs/bbp.cscs.ch/apps/viz/tools/gmp/gmp-5.1.3/install/lib\r\nprepend-path\t LD_RUN_PATH /gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/lib64\r\nprepend-path\t CPATH /gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/include\r\nprepend-path\t SEARCH_DIR /gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/lib64\r\n```\r\n\r\nWe add entry to `compilers.yaml` as:\r\n\r\n```\r\n- compiler:\r\n    flags: {}\r\n    modules:\r\n    - gcc_490\r\n    operating_system: rhel6\r\n    paths:\r\n      cc: /gpfs/bbp.cscs.ch/apps/viz/tools/gcc/gcc-4.9.0/install/bin/gcc\r\n      cxx: /gpfs/bbp.cscs.ch/apps/viz/tools/gcc/gcc-4.9.0/install/bin/g++\r\n      f77: /gpfs/bbp.cscs.ch/apps/viz/tools/gcc/gcc-4.9.0/install/bin/gfortran\r\n      fc: /gpfs/bbp.cscs.ch/apps/viz/tools/gcc/gcc-4.9.0/install/bin/gfortran\r\n    spec: gcc@4.9.0\r\n```\r\n\r\nAs we have specified module then it should work without dirty. Isn't it? But we get:\r\n\r\n```\r\n$ spack -d install -v everytrace %gcc@4.9.0\r\n...\r\n/gpfs/bbp.cscs.ch/apps/viz/tools/gcc/gcc-4.9.0/install/bin/../libexec/gcc/x86_64-unknown-linux-\r\ngnu/4.9.0/cc1: error while loading shared libraries: libmpc.so.3: cannot open shared object file: No \r\n.... \r\n\"/gpfs/bbp.cscs.ch/home/kumbhar/workarena/systems/lugviz/softwares/sources/spack/lib/\r\nspack/env/gcc/gfortran\"\r\n  is not able to compile a simple test program.\r\n....\r\n```\r\n\r\nIf I look at `spack-build.env` with and without dirty then we see that `LD_LIBRARY_PATH` is set only with `--dirty`:\r\n\r\n```\r\n \u2192 diff spack-build.env spack-build.env.dirty\r\n84a85\r\n> export CPATH=\"/gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/include:/gpfs/bbp.cscs.ch/apps/viz/tools/gmp/gmp-5.1.3/install/include:/gpfs/bbp.cscs.ch/apps/viz/tools/mpfr/mpfr-3.1.2/install/include:/gpfs/bbp.cscs.ch/apps/viz/tools/mpc/mpc-1.0.2/install/include\"\r\n112a114,115\r\n> export LD_LIBRARY_PATH=\"/gpfs/bbp.cscs.ch/apps/viz/tools/mvapich2/mvapich2-2.0.1-nocuda-slurm-14.03.4.2/install/lib:/gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/lib64:/gpfs/bbp.cscs.ch/apps/viz/tools/gmp/gmp-5.1.3/install/lib:/gpfs/bbp.cscs.ch/apps/viz/tools/mpfr/mpfr-3.1.2/install/lib:/gpfs/bbp.cscs.ch/apps/viz/tools/mpc/mpc-1.0.2/install/lib:/gpfs/bbp.cscs.ch/apps/viz/tools/git/git-1.8.4.3/install/lib\"\r\n> export LD_RUN_PATH=\"/gpfs/bbp.cscs.ch//apps/viz/tools/gcc/gcc-4.9.0/install/lib64\"\r\n```\r\n\r\ncc : @tgamblin @becker33 ",
    "performed_via_github_app": null
}