{
    "url": "https://api.github.com/repos/spack/spack/issues/22871",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22871/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22871/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22871/events",
    "html_url": "https://github.com/spack/spack/issues/22871",
    "id": 853663333,
    "node_id": "MDU6SXNzdWU4NTM2NjMzMzM=",
    "number": 22871,
    "title": "Not super consistent dependency resolution",
    "user": {
        "login": "maxim-belkin",
        "id": 13123663,
        "node_id": "MDQ6VXNlcjEzMTIzNjYz",
        "avatar_url": "https://avatars.githubusercontent.com/u/13123663?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maxim-belkin",
        "html_url": "https://github.com/maxim-belkin",
        "followers_url": "https://api.github.com/users/maxim-belkin/followers",
        "following_url": "https://api.github.com/users/maxim-belkin/following{/other_user}",
        "gists_url": "https://api.github.com/users/maxim-belkin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/maxim-belkin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/maxim-belkin/subscriptions",
        "organizations_url": "https://api.github.com/users/maxim-belkin/orgs",
        "repos_url": "https://api.github.com/users/maxim-belkin/repos",
        "events_url": "https://api.github.com/users/maxim-belkin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/maxim-belkin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 446614485,
            "node_id": "MDU6TGFiZWw0NDY2MTQ0ODU=",
            "url": "https://api.github.com/repos/spack/spack/labels/cray",
            "name": "cray",
            "color": "b60205",
            "default": false,
            "description": null
        },
        {
            "id": 512483406,
            "node_id": "MDU6TGFiZWw1MTI0ODM0MDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-high",
            "name": "impact-high",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 6,
    "created_at": "2021-04-08T16:50:36Z",
    "updated_at": "2021-04-11T07:01:10Z",
    "closed_at": "2021-04-11T07:01:10Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "The result of `spack spec` is not super consistent and depends on the flags used. This makes debugging lengthy build failures (e.g., `py-torch`) difficult...\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack spec    gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n$ spack spec -I gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n$ spack --debug --stacktrace spec    gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n$ spack --debug --stacktrace spec -I gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n```\r\n\r\n1. `spack spec ...` command resolves `diffutils` and `ncurses` to `arch=cray-cnl5-bulldozer`:\r\n    <details>\r\n    <summary><code>spack spec gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer</code></summary>\r\n\r\n    <pre>\r\n    <code>\r\n    Input spec\r\n    --------------------------------\r\n    gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n\r\n    Concretized\r\n    --------------------------------\r\n    ==> Warning: Intel's compilers may or may not optimize to the same degree for non-Intel microprocessors for optimizations that are not unique to Intel microprocessors\r\n    gettext@0.21%gcc@5.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=cray-suse_linux11-bulldozer\r\n        ^bzip2@1.0.8%gcc@5.3.0+shared arch=cray-suse_linux11-bulldozer\r\n            ^diffutils@3.7%gcc@5.3.0 <strong>arch=cray-cnl5-bulldozer</strong>\r\n                ^libiconv@1.16%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n        ^libxml2@2.9.10%gcc@5.3.0~python arch=cray-suse_linux11-bulldozer\r\n            ^pkgconf@1.7.4%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n            ^xz@5.2.5%gcc@5.3.0~pic arch=cray-suse_linux11-bulldozer\r\n            ^zlib@1.2.11%gcc@5.3.0+optimize+pic+shared arch=cray-suse_linux11-bulldozer\r\n        ^ncurses@6.2%gcc@5.3.0~symlinks+termlib abi=none <strong>arch=cray-cnl5-bulldozer</strong>\r\n        ^tar@1.34%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    </code>\r\n    </pre>\r\n    </details>\r\n\r\n2. `spack spec -I ...` command resolves `bzip2`, `libiconv`, `xz`, `zlib`, and `ncurses` to `arch=cray-cnl5-bulldozer`:\r\n\r\n    <details>\r\n    <summary>\r\n    <code>spack spec -I gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer</code>\r\n    </summary>\r\n\r\n    <pre>\r\n    <code>\r\n    Input spec\r\n    --------------------------------\r\n    -   gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n\r\n    Concretized\r\n    --------------------------------\r\n    ==> Warning: Intel's compilers may or may not optimize to the same degree for non-Intel microprocessors for optimizations that are not unique to Intel microprocessors\r\n    -   gettext@0.21%gcc@5.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=cray-suse_linux11-bulldozer\r\n    [+]      ^bzip2@1.0.8%gcc@5.3.0+shared <strong>arch=cray-cnl5-bulldozer</strong>\r\n    [+]          ^diffutils@3.7%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    [+]              ^libiconv@1.16%gcc@5.3.0 <strong>arch=cray-cnl5-bulldozer</strong>\r\n    -       ^libxml2@2.9.10%gcc@5.3.0~python arch=cray-suse_linux11-bulldozer\r\n    [+]          ^pkgconf@1.7.4%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    [+]          ^xz@5.2.5%gcc@5.3.0~pic <strong>arch=cray-cnl5-bulldozer</strong>\r\n    [+]          ^zlib@1.2.11%gcc@5.3.0+optimize+pic+shared <strong>arch=cray-cnl5-bulldozer</strong>\r\n    [+]      ^ncurses@6.2%gcc@5.3.0~symlinks+termlib abi=none <strong>arch=cray-cnl5-bulldozer</strong>\r\n    [+]      ^tar@1.34%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    </code>\r\n    </pre>\r\n    </details>\r\n\r\n3. `spack --debug --stacktrace spec` command resolves `bzip2`, `libiconv`,`pkgconf`, `zlib`, and `ncurses` to `arch=cray-cnl5-bulldozer`:\r\n    <details>\r\n    <summary>\r\n    <code>spack --debug --stacktrace spec gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer</code>\r\n    </summary>\r\n\r\n    <pre>\r\n    <code>lib/spack/spack/util/executable.py:188 ==> [2021-04-08-10:54:00.287407] '/bin/bash' '--norc' '--noprofile' '-lc' 'echo $CRAY_CPU_TARGET'\r\n    lib/spack/spack/platforms/cray.py:154 ==> [2021-04-08-10:54:00.306459] default to front-end architecture\r\n    lib/spack/spack/cmd/__init__.py:122 ==> [2021-04-08-10:54:00.466622] Imported spec from built-in commands\r\n    lib/spack/spack/cmd/__init__.py:122 ==> [2021-04-08-10:54:00.468600] Imported spec from built-in commands\r\n    Input spec\r\n    --------------------------------\r\n    gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    \r\n    Concretized\r\n    --------------------------------\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:00.475995] Reading config file /dev/shm/spack/test/etc/spack/defaults/config.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:00.550154] Reading config file /dev/shm/spack/test/etc/spack/config.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:00.559828] Reading config file /u/staff/mbelkin/.spack/config.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:01.539299] Reading config file /dev/shm/spack/test/etc/spack/defaults/repos.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:01.546097] Reading config file /dev/shm/spack/test/etc/spack/repos.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:02.983742] Reading config file /dev/shm/spack/test/etc/spack/compilers.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:04.806201] Reading config file /dev/shm/spack/test/etc/spack/defaults/packages.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-10:54:04.907017] Reading config file /dev/shm/spack/test/etc/spack/packages.yaml\r\n    dev/shm/spack/test/lib/spack/spack/main.py:431 ==> [2021-04-08-10:54:05.868855] Warning: Intel's compilers may or may not optimize to the same deg\u0440ee for non-Intel microprocessors for optimizations that are not unique to Intel microprocessors\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.186875] opt_criterion(15, version weight)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.187378] opt_criterion(14, number of non-default variants (roots))\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.187777] opt_criterion(13, multi-valued variants + preferred providers for roots)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.188175] opt_criterion(11, number of non-default variants (non-roots))\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.188569] opt_criterion(9, number of non-default providers (non-roots))\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.188961] opt_criterion(8, count of non-root multi-valued variants)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.189354] opt_criterion(7, compiler matches + number of nodes)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.189762] opt_criterion(6, version badness)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.190156] opt_criterion(5, non-preferred compilers)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.190547] opt_criterion(4, target matches)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-10:54:10.190939] opt_criterion(3, non-preferred targets)\r\n    lib/spack/spack/database.py:364 ==> [2021-04-08-10:54:10.212736] DATABASE LOCK TIMEOUT: 3s\r\n    lib/spack/spack/database.py:368 ==> [2021-04-08-10:54:10.213675] PACKAGE LOCK TIMEOUT: No timeout\r\n    gettext@0.21%gcc@5.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=cray-suse_linux11-bulldozer\r\n        ^bzip2@1.0.8%gcc@5.3.0+shared arch=cray-cnl5-bulldozer\r\n            ^diffutils@3.7%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n                ^libiconv@1.16%gcc@5.3.0 arch=cray-cnl5-bulldozer\r\n        ^libxml2@2.9.10%gcc@5.3.0~python arch=cray-suse_linux11-bulldozer\r\n            ^pkgconf@1.7.4%gcc@5.3.0 arch=cray-cnl5-bulldozer\r\n            ^xz@5.2.5%gcc@5.3.0~pic arch=cray-suse_linux11-bulldozer\r\n            ^zlib@1.2.11%gcc@5.3.0+optimize+pic+shared arch=cray-cnl5-bulldozer\r\n        ^ncurses@6.2%gcc@5.3.0~symlinks+termlib abi=none arch=cray-cnl5-bulldozer\r\n        ^tar@1.34%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    </code>\r\n    </pre>\r\n    </details>\r\n\r\n4. `spack --debug --stacktrace spec -I` command resolves `libiconv` and `xz` to `arch=cray-cnl5-bulldozer`:\r\n\r\n    <details>\r\n    <summary>\r\n    <code>spack --debug --stacktrace spec gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer</code>\r\n    </summary>\r\n\r\n    <pre>\r\n    <code>\r\n    lib/spack/spack/util/executable.py:188 ==> [2021-04-08-11:22:13.590133] '/bin/bash' '--norc' '--noprofile' '-lc' 'echo $CRAY_CPU_TARGET'\r\n    lib/spack/spack/platforms/cray.py:154 ==> [2021-04-08-11:22:13.610731] default to front-end architecture\r\n    lib/spack/spack/cmd/__init__.py:122 ==> [2021-04-08-11:22:13.802151] Imported spec from built-in commands\r\n    lib/spack/spack/cmd/__init__.py:122 ==> [2021-04-08-11:22:13.804152] Imported spec from built-in commands\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:13.808353] Reading config file /dev/shm/spack/test/etc/spack/defaults/config.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:13.881523] Reading config file /dev/shm/spack/test/etc/spack/config.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:13.891616] Reading config file /u/staff/mbelkin/.spack/config.yaml\r\n    lib/spack/spack/database.py:364 ==> [2021-04-08-11:22:13.914982] DATABASE LOCK TIMEOUT: 3s\r\n    lib/spack/spack/database.py:368 ==> [2021-04-08-11:22:13.915445] PACKAGE LOCK TIMEOUT: No timeout\r\n    Input spec\r\n    --------------------------------\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:13.993712] Reading config file /dev/shm/spack/test/etc/spack/defaults/repos.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:14.000272] Reading config file /dev/shm/spack/test/etc/spack/repos.yaml\r\n     -   gettext@0.21%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    \r\n    Concretized\r\n    --------------------------------\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:16.414900] Reading config file /dev/shm/spack/test/etc/spack/compilers.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:18.230479] Reading config file /dev/shm/spack/test/etc/spack/defaults/packages.yaml\r\n    lib/spack/spack/config.py:981 ==> [2021-04-08-11:22:18.332947] Reading config file /dev/shm/spack/test/etc/spack/packages.yaml\r\n    dev/shm/spack/test/lib/spack/spack/main.py:431 ==> [2021-04-08-11:22:19.302837] Warning: Intel's compilers may or may not optimize to the same degree for non-Intel microprocessors for optimizations that are not unique to Intel microprocessors\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.475782] opt_criterion(15, version weight)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.476663] opt_criterion(14, number of non-default variants (roots))\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.477074] opt_criterion(13, multi-valued variants + preferred providers for roots)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.477476] opt_criterion(11, number of non-default variants (non-roots))\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.477872] opt_criterion(9, number of non-default providers (non-roots))\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.478268] opt_criterion(8, count of non-root multi-valued variants)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.478662] opt_criterion(7, compiler matches + number of nodes)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.479056] opt_criterion(6, version badness)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.479450] opt_criterion(5, non-preferred compilers)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.479842] opt_criterion(4, target matches)\r\n    lib/spack/spack/solver/asp.py:1566 ==> [2021-04-08-11:22:23.480237] opt_criterion(3, non-preferred targets)\r\n     -   gettext@0.21%gcc@5.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=cray-suse_linux11-bulldozer\r\n    [+]      ^bzip2@1.0.8%gcc@5.3.0+shared arch=cray-suse_linux11-bulldozer\r\n    [+]          ^diffutils@3.7%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    [+]              ^libiconv@1.16%gcc@5.3.0 arch=cray-cnl5-bulldozer\r\n     -       ^libxml2@2.9.10%gcc@5.3.0~python arch=cray-suse_linux11-bulldozer\r\n    [+]          ^pkgconf@1.7.4%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    [+]          ^xz@5.2.5%gcc@5.3.0~pic arch=cray-cnl5-bulldozer\r\n    [+]          ^zlib@1.2.11%gcc@5.3.0+optimize+pic+shared arch=cray-suse_linux11-bulldozer\r\n     -       ^ncurses@6.2%gcc@5.3.0~symlinks+termlib abi=none arch=cray-suse_linux11-bulldozer\r\n    [+]      ^tar@1.34%gcc@5.3.0 arch=cray-suse_linux11-bulldozer\r\n    </code>\r\n    </pre>\r\n    </details>\r\n\r\n\r\n### Error Message\r\n\r\nNone\r\n\r\n### Information on your system\r\n\r\n\r\nspack debug report\r\n* **Spack:** 0.16.1-2136-68cec598dc\r\n* **Python:** 3.7.9\r\n* **Platform:** cray-suse_linux11-bulldozer\r\n* **Concretizer:** clingo\r\n\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}