{
    "url": "https://api.github.com/repos/spack/spack/issues/11105",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/11105/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/11105/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/11105/events",
    "html_url": "https://github.com/spack/spack/issues/11105",
    "id": 428906798,
    "node_id": "MDU6SXNzdWU0Mjg5MDY3OTg=",
    "number": 11105,
    "title": "'spack location' command fails",
    "user": {
        "login": "scottwittenburg",
        "id": 6527504,
        "node_id": "MDQ6VXNlcjY1Mjc1MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6527504?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scottwittenburg",
        "html_url": "https://github.com/scottwittenburg",
        "followers_url": "https://api.github.com/users/scottwittenburg/followers",
        "following_url": "https://api.github.com/users/scottwittenburg/following{/other_user}",
        "gists_url": "https://api.github.com/users/scottwittenburg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scottwittenburg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scottwittenburg/subscriptions",
        "organizations_url": "https://api.github.com/users/scottwittenburg/orgs",
        "repos_url": "https://api.github.com/users/scottwittenburg/repos",
        "events_url": "https://api.github.com/users/scottwittenburg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scottwittenburg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tgamblin",
            "id": 299842,
            "node_id": "MDQ6VXNlcjI5OTg0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tgamblin",
            "html_url": "https://github.com/tgamblin",
            "followers_url": "https://api.github.com/users/tgamblin/followers",
            "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
            "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
            "organizations_url": "https://api.github.com/users/tgamblin/orgs",
            "repos_url": "https://api.github.com/users/tgamblin/repos",
            "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tgamblin/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 4,
    "created_at": "2019-04-03T18:16:13Z",
    "updated_at": "2019-07-20T00:49:01Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "After installing a package (in this case, `diffutils`, but also tried with other packages), asking spack for the location of that packages results in an error.  I tested all the arguments to `spack location`, and it seems it's the `--build-dir` one that causes the problem.\r\n\r\n### Steps to reproduce the issue\r\n\r\nChecking what packages I have so far, it's pretty clean.\r\n\r\n```console\r\n$ spack find\r\n==> 0 installed packages\r\n```\r\n\r\nNow install a basic package.\r\n\r\n```\r\n$ spack install diffutils\r\n==> Installing diffutils\r\n==> Searching for binary cache of diffutils\r\n==> Finding buildcaches on https://mirror.spack.io\r\n==> No binary for diffutils found: installing from source\r\n==> Using cached archive: /data/scott/projects/spack/var/spack/cache/diffutils/diffutils-3.7.tar.xz\r\n==> Staging archive: /data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il/diffutils-3.7.tar.xz\r\n==> Created stage in /data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il\r\n==> No patches needed for diffutils\r\n==> Building diffutils [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed diffutils\r\n  Fetch: 0.01s.  Build: 33.05s.  Total: 33.06s.\r\n[+] /data/scott/projects/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.5.0/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il\r\n```\r\n\r\nNow run the `spack location` command on that spec.\r\n\r\n```\r\n$ spack location diffutils\r\n==> Error: [Errno 2] No such file or directory: '/data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il'\r\n```\r\n\r\nTry the other arguments to see if any of them work.\r\n\r\n```\r\n$ spack location --module-dir diffutils\r\n/data/scott/projects/spack/lib/spack/spack\r\n$ spack location --spack-root\r\n/data/scott/projects/spack\r\n$ spack location --install-dir diffutils\r\n/data/scott/projects/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.5.0/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il\r\n$ spack location --package-dir diffutils\r\n/data/scott/projects/spack/var/spack/repos/builtin/packages/diffutils\r\n$ spack location --packages\r\n/data/scott/projects/spack/var/spack/repos/builtin\r\n$ spack location --stage-dir diffutils\r\n/data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il\r\n$ spack location --stages\r\n/data/scott/projects/spack/var/spack/stage\r\n$ spack location --build-dir diffutils\r\n==> Error: [Errno 2] No such file or directory: '/data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il'\r\n```\r\n\r\n### Error Message\r\n\r\nRun that last command again to get the stack trace.\r\n\r\n```\r\n$ spack -d location --build-dir diffutils\r\n==> [2019-04-03-12:10:23.291452] Imported location from built-in commands\r\n==> [2019-04-03-12:10:23.293459] Imported location from built-in commands\r\n==> [2019-04-03-12:10:23.344303] Reading config file /data/scott/projects/spack/etc/spack/defaults/modules.yaml\r\n==> [2019-04-03-12:10:23.355828] Reading config file /data/scott/projects/spack/etc/spack/defaults/linux/modules.yaml\r\n==> [2019-04-03-12:10:23.359239] Reading config file /data/scott/projects/spack/etc/spack/defaults/config.yaml\r\n==> [2019-04-03-12:10:23.372371] Reading config file /home/scott/.spack/config.yaml\r\n==> [2019-04-03-12:10:23.390068] Reading config file /data/scott/projects/spack/etc/spack/defaults/repos.yaml\r\n==> [2019-04-03-12:10:23.439136] Reading config file /data/scott/projects/spack/etc/spack/defaults/packages.yaml\r\n==> [2019-04-03-12:10:23.461014] Reading config file /home/scott/.spack/packages.yaml\r\n==> [2019-04-03-12:10:23.469425] READ LOCK: /home/scott/.spack/cache/tags/.builtin-index.json.lock[0:0] [Acquiring]\r\n==> [2019-04-03-12:10:23.469652] READ LOCK: /home/scott/.spack/cache/tags/.builtin-index.json.lock[0:0] [Acquired]\r\n==> [2019-04-03-12:10:23.470192] READ LOCK: /home/scott/.spack/cache/tags/.builtin-index.json.lock[0:0] [Released]\r\n==> [2019-04-03-12:10:23.473840] READ LOCK: /home/scott/.spack/cache/patches/.builtin-index.json.lock[0:0] [Acquiring]\r\n==> [2019-04-03-12:10:23.474031] READ LOCK: /home/scott/.spack/cache/patches/.builtin-index.json.lock[0:0] [Acquired]\r\n==> [2019-04-03-12:10:23.488062] READ LOCK: /home/scott/.spack/cache/patches/.builtin-index.json.lock[0:0] [Released]\r\n==> [2019-04-03-12:10:23.491552] READ LOCK: /home/scott/.spack/cache/providers/.builtin-index.json.lock[0:0] [Acquiring]\r\n==> [2019-04-03-12:10:23.491732] READ LOCK: /home/scott/.spack/cache/providers/.builtin-index.json.lock[0:0] [Acquired]\r\n==> [2019-04-03-12:10:23.523688] READ LOCK: /home/scott/.spack/cache/providers/.builtin-index.json.lock[0:0] [Released]\r\n==> [2019-04-03-12:10:23.531009] Reading config file /home/scott/.spack/linux/compilers.yaml\r\nTraceback (most recent call last):\r\n  File \"/data/scott/projects/spack/bin/spack\", line 48, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/data/scott/projects/spack/lib/spack/spack/main.py\", line 695, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/data/scott/projects/spack/lib/spack/spack/main.py\", line 446, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/data/scott/projects/spack/lib/spack/spack/cmd/location.py\", line 110, in location\r\n    if not pkg.stage.source_path:\r\n  File \"/data/scott/projects/spack/lib/spack/spack/stage.py\", line 582, in source_path\r\n    return self[0].source_path\r\n  File \"/data/scott/projects/spack/lib/spack/spack/stage.py\", line 341, in source_path\r\n    for p in [os.path.join(self.path, f) for f in os.listdir(self.path)]:\r\nOSError: [Errno 2] No such file or directory: '/data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il'\r\n```\r\n\r\nBased on that information, I tried doing the install again, this time with `--keep-stage`, and after that, I no longer saw the error.\r\n\r\n```\r\n$ spack uninstall --all\r\n==> The following packages will be uninstalled:\r\n\r\n    -- linux-ubuntu16.04-x86_64 / gcc@5.5.0 -------------------------\r\n    ds255jv diffutils@3.7%gcc\r\n==> Do you want to proceed? [y/N] y\r\n==> Successfully uninstalled diffutils@3.7%gcc@5.5.0 arch=linux-ubuntu16.04-x86_64 /ds255jv\r\n$ spack find\r\n==> 0 installed packages\r\n$ spack install --keep-stage diffutils\r\n==> Installing diffutils\r\n==> Searching for binary cache of diffutils\r\n==> Finding buildcaches on https://mirror.spack.io\r\n==> No binary for diffutils found: installing from source\r\n==> Using cached archive: /data/scott/projects/spack/var/spack/cache/diffutils/diffutils-3.7.tar.xz\r\n==> Staging archive: /data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il/diffutils-3.7.tar.xz\r\n==> Created stage in /data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il\r\n==> No patches needed for diffutils\r\n==> Building diffutils [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed diffutils\r\n  Fetch: 0.01s.  Build: 34.18s.  Total: 34.19s.\r\n[+] /data/scott/projects/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.5.0/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il\r\n$ spack location diffutils\r\n/data/scott/projects/spack/var/spack/stage/diffutils-3.7-ds255jvufrjssbbpyjkg5wuweiodk7il/diffutils-3.7\r\n```\r\n\r\n### Information on your system\r\n\r\nPlatform: Linux Ubuntu 16.04 (x86_64)\r\n\r\nCustom packages.yaml:\r\n\r\n```\r\n$ cat ~/.spack/packages.yaml \r\npackages:\r\n  opengl:\r\n    paths:\r\n      opengl@4.5.0: /opt/opengl\r\n    buildable: False\r\n```\r\n\r\nCompilers:\r\n\r\n```\r\n$ spack compilers\r\n==> Available compilers\r\n-- gcc ubuntu16.04-x86_64 ---------------------------------------\r\ngcc@5.5.0  gcc@5.4.0  gcc@4.9.3  gcc@4.8\r\n```\r\n",
    "performed_via_github_app": null
}