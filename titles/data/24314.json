{
    "url": "https://api.github.com/repos/spack/spack/issues/24314",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/24314/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/24314/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/24314/events",
    "html_url": "https://github.com/spack/spack/issues/24314",
    "id": 920835713,
    "node_id": "MDU6SXNzdWU5MjA4MzU3MTM=",
    "number": 24314,
    "title": "new concretizer doesn't respect externally declared openmpi and tries to build an unbuildable spec",
    "user": {
        "login": "frankwillmore",
        "id": 508437,
        "node_id": "MDQ6VXNlcjUwODQzNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/508437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/frankwillmore",
        "html_url": "https://github.com/frankwillmore",
        "followers_url": "https://api.github.com/users/frankwillmore/followers",
        "following_url": "https://api.github.com/users/frankwillmore/following{/other_user}",
        "gists_url": "https://api.github.com/users/frankwillmore/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/frankwillmore/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/frankwillmore/subscriptions",
        "organizations_url": "https://api.github.com/users/frankwillmore/orgs",
        "repos_url": "https://api.github.com/users/frankwillmore/repos",
        "events_url": "https://api.github.com/users/frankwillmore/events{/privacy}",
        "received_events_url": "https://api.github.com/users/frankwillmore/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2426379301,
            "node_id": "MDU6TGFiZWwyNDI2Mzc5MzAx",
            "url": "https://api.github.com/repos/spack/spack/labels/alcf",
            "name": "alcf",
            "color": "17669e",
            "default": false,
            "description": ""
        },
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 966031931,
            "node_id": "MDU6TGFiZWw5NjYwMzE5MzE=",
            "url": "https://api.github.com/repos/spack/spack/labels/ecp",
            "name": "ecp",
            "color": "79d7ea",
            "default": false,
            "description": ""
        },
        {
            "id": 446623247,
            "node_id": "MDU6TGFiZWw0NDY2MjMyNDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/unreproducible",
            "name": "unreproducible",
            "color": "fbca04",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 5,
    "created_at": "2021-06-14T22:56:07Z",
    "updated_at": "2021-06-17T16:14:22Z",
    "closed_at": "2021-06-17T15:39:55Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n\u718a\u4fca\u5091@thetagpusn2:~/environments/test-external-openmpi$ cat spack.yaml\r\nspack:\r\n  config:\r\n    concretizer: original\r\n  specs:\r\n  - openmpi@4.0.5%gcc@10.2.0 target=x86_64\r\n  packages:\r\n    mpi:\r\n      buildable: false\r\n    openmpi:\r\n      externals:\r\n      - spec: openmpi@4.0.5%gcc@10.2.0 target=x86_64\r\n        prefix: /lus/theta-fs0/software/thetagpu/openmpi-4.0.5\r\n      buildable: false\r\n  compilers:\r\n  - compiler:\r\n      spec: gcc@10.2.0\r\n      paths:\r\n        cc: /gpfs/mira-home/willmore/spack/opt/spack/linux-ubuntu18.04-zen/gcc-7.5.0/gcc-10.2.0-if7f4sknxaimrlul66qhpfanqrinjeyz/bin/gcc\r\n        cxx: /gpfs/mira-home/willmore/spack/opt/spack/linux-ubuntu18.04-zen/gcc-7.5.0/gcc-10.2.0-if7f4sknxaimrlul66qhpfanqrinjeyz/bin/g++\r\n        f77: /gpfs/mira-home/willmore/spack/opt/spack/linux-ubuntu18.04-zen/gcc-7.5.0/gcc-10.2.0-if7f4sknxaimrlul66qhpfanqrinjeyz/bin/gfortran\r\n        fc: /gpfs/mira-home/willmore/spack/opt/spack/linux-ubuntu18.04-zen/gcc-7.5.0/gcc-10.2.0-if7f4sknxaimrlul66qhpfanqrinjeyz/bin/gfortran\r\n      flags: {}\r\n      operating_system: ubuntu18.04\r\n      target: x86_64\r\n      modules: []\r\n      environment: {}\r\n      extra_rpaths: []\r\n\u718a\u4fca\u5091@thetagpusn2:~/environments/test-external-openmpi$ spack concretize -f \r\n==> Concretized openmpi@4.0.5%gcc@10.2.0 arch=linux-None-x86_64\r\n -   22bmrl6  openmpi@4.0.5%gcc@10.2.0~atomics~cuda~cxx~cxx_exceptions+gpfs~internal-hwloc~java~legacylaunchers~lustre~memchecker~pmi~singularity~sqlite3+static~thread_multiple+vt+wrapper-rpath fabrics=none schedulers=none arch=linux-ubuntu18.04-x86_64\r\n\r\n==> Updating view at /gpfs/mira-home/willmore/environments/test-external-openmpi/.spack-env/view\r\n```\r\nWhen I switch to the clingo concretizer, the external is ignored:\r\n```console\r\n\u718a\u4fca\u5091@thetagpusn2:~/environments/test-external-openmpi$ vi spack.yaml\r\n\u718a\u4fca\u5091@thetagpusn2:~/environments/test-external-openmpi$ grep concretizer spack.yaml \r\n    concretizer: clingo\r\n\u718a\u4fca\u5091@thetagpusn2:~/environments/test-external-openmpi$ spack concretize -f \r\n==> Concretized openmpi@4.0.5%gcc@10.2.0 arch=linux-None-x86_64\r\n -   vmmfd3l  openmpi@4.0.5%gcc@10.2.0~atomics~cuda~cxx~cxx_exceptions+gpfs~internal-hwloc~java~legacylaunchers~lustre~memchecker~pmi~singularity~sqlite3+static~thread_multiple+vt+wrapper-rpath fabrics=none schedulers=none arch=linux-ubuntu18.04-x86_64\r\n -   3wbkz7g      ^hwloc@2.4.1%gcc@10.2.0~cairo~cuda~gl~libudev+libxml2~netloc~nvml+pci+shared arch=linux-ubuntu18.04-x86_64\r\n -   vzulv6v          ^libpciaccess@0.16%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n -   qrxq3vu              ^libtool@2.4.6%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n -   bzfpv6w                  ^m4@1.4.18%gcc@10.2.0+sigsegv patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 arch=linux-ubuntu18.04-x86_64\r\n[+]  463jvnk                      ^libsigsegv@2.12%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n[+]  4aysapw              ^pkgconf@1.7.3%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n[+]  muo4hhm              ^util-macros@1.19.1%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n[+]  vwibkyd          ^libxml2@2.9.10%gcc@10.2.0~python arch=linux-ubuntu18.04-x86_64\r\n[+]  3wgaxfy              ^libiconv@1.16%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n[+]  mh235i3              ^xz@5.2.5%gcc@10.2.0~pic arch=linux-ubuntu18.04-x86_64\r\n[+]  glt2u7u              ^zlib@1.2.11%gcc@10.2.0+optimize+pic+shared arch=linux-ubuntu18.04-x86_64\r\n -   og77s36      ^libevent@2.1.12%gcc@10.2.0+openssl arch=linux-ubuntu18.04-x86_64\r\n -   3g4hmwz          ^openssl@1.1.1j%gcc@10.2.0~docs+systemcerts arch=linux-ubuntu18.04-x86_64\r\n[+]  grji3ix              ^perl@5.32.1%gcc@10.2.0+cpanm+shared+threads arch=linux-ubuntu18.04-x86_64\r\n[+]  fle5h4p                  ^berkeley-db@18.1.40%gcc@10.2.0~docs patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=linux-ubuntu18.04-x86_64\r\n[+]  ia4egqb                  ^gdbm@1.18.1%gcc@10.2.0 patches=7f569b9287e9e5a4236636eef32ff3428f0462ec17aea359e0ebee07649f1f16 arch=linux-ubuntu18.04-x86_64\r\n[+]  ephdh34                      ^readline@8.0%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n[+]  qjpgcs6                          ^ncurses@6.2%gcc@10.2.0~symlinks+termlib arch=linux-ubuntu18.04-x86_64\r\n -   zkhukv6      ^numactl@2.0.14%gcc@10.2.0 patches=4e1d78cbbb85de625bad28705e748856033eaafab92a66dffd383a3d7e00cc94,62fc8a8bf7665a60e8f4c93ebbd535647cebf74198f7afafec4c085a8825c006 arch=linux-ubuntu18.04-x86_64\r\n -   psuoc5o          ^autoconf@2.69%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n -   zfagity          ^automake@1.16.3%gcc@10.2.0 arch=linux-ubuntu18.04-x86_64\r\n\r\n==> Updating view at /gpfs/mira-home/willmore/environments/test-external-openmpi/.spack-env/view\r\n```\r\n\r\n### Error Message\r\n\r\nN/A\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n\u718a\u4fca\u5091@thetagpusn2:~/environments/test-external-openmpi$ spack debug report \r\n* **Spack:** 0.16.1-1711-d7f1ff68fb\r\n* **Python:** 3.8.8\r\n* **Platform:** linux-ubuntu18.04-zen2\r\n* **Concretizer:** clingo\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}