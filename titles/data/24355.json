{
    "url": "https://api.github.com/repos/spack/spack/issues/24355",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/24355/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/24355/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/24355/events",
    "html_url": "https://github.com/spack/spack/pull/24355",
    "id": 922702154,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NjcxNTQ1OTIy",
    "number": 24355,
    "title": "Drastically improve YamlFilesystemView file removal performance via batching ",
    "user": {
        "login": "blackwer",
        "id": 364498,
        "node_id": "MDQ6VXNlcjM2NDQ5OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/364498?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/blackwer",
        "html_url": "https://github.com/blackwer",
        "followers_url": "https://api.github.com/users/blackwer/followers",
        "following_url": "https://api.github.com/users/blackwer/following{/other_user}",
        "gists_url": "https://api.github.com/users/blackwer/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/blackwer/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/blackwer/subscriptions",
        "organizations_url": "https://api.github.com/users/blackwer/orgs",
        "repos_url": "https://api.github.com/users/blackwer/repos",
        "events_url": "https://api.github.com/users/blackwer/events{/privacy}",
        "received_events_url": "https://api.github.com/users/blackwer/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1472097646,
            "node_id": "MDU6TGFiZWwxNDcyMDk3NjQ2",
            "url": "https://api.github.com/repos/spack/spack/labels/build-systems",
            "name": "build-systems",
            "color": "2450af",
            "default": false,
            "description": ""
        },
        {
            "id": 460427403,
            "node_id": "MDU6TGFiZWw0NjA0Mjc0MDM=",
            "url": "https://api.github.com/repos/spack/spack/labels/performance",
            "name": "performance",
            "color": "c2e0c6",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 1,
    "created_at": "2021-06-16T14:37:58Z",
    "updated_at": "2021-07-30T15:38:31Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/24355",
        "html_url": "https://github.com/spack/spack/pull/24355",
        "diff_url": "https://github.com/spack/spack/pull/24355.diff",
        "patch_url": "https://github.com/spack/spack/pull/24355.patch"
    },
    "body": "The `YamlFilesystemView.remove_file` routine has to check if the file is owned by multiple packages, so it doesn't  remove necessary files. This is done by the `YamlFilesystemView.get_all_specs` routine, which walks the entire package tree. With large numbers of packages on shared file systems, this can take O(seconds) time per file tree traversal, which adds up extremely quickly. For example, a single deactivate of a largish python package in our software stack on GPFS took approximately 40 minutes.\r\n\r\nThis patch replaces `remove_file` with a batch `remove_files` routine. This routine removes a list of files rather than a single file, requiring only one tree traversal per batch. In practice this means a package can be removed in O(seconds) time, rather than potentially hours, resulting in essentially a ~1000x speedup (ignoring initial deactivation logic, which takes about 2 minutes in our test setup).",
    "performed_via_github_app": null
}