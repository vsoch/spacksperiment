{
    "url": "https://api.github.com/repos/spack/spack/issues/6876",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/6876/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/6876/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/6876/events",
    "html_url": "https://github.com/spack/spack/issues/6876",
    "id": 287224751,
    "node_id": "MDU6SXNzdWUyODcyMjQ3NTE=",
    "number": 6876,
    "title": "Problems raising errors during install with Python 3",
    "user": {
        "login": "adamjstewart",
        "id": 12021217,
        "node_id": "MDQ6VXNlcjEyMDIxMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjstewart",
        "html_url": "https://github.com/adamjstewart",
        "followers_url": "https://api.github.com/users/adamjstewart/followers",
        "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
        "repos_url": "https://api.github.com/users/adamjstewart/repos",
        "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 509628729,
            "node_id": "MDU6TGFiZWw1MDk2Mjg3Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/error-messages",
            "name": "error-messages",
            "color": "f9d0c4",
            "default": false,
            "description": null
        },
        {
            "id": 446643530,
            "node_id": "MDU6TGFiZWw0NDY2NDM1MzA=",
            "url": "https://api.github.com/repos/spack/spack/labels/fetching",
            "name": "fetching",
            "color": "fbca04",
            "default": false,
            "description": null
        },
        {
            "id": 574328447,
            "node_id": "MDU6TGFiZWw1NzQzMjg0NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/python3",
            "name": "python3",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2018-01-09T20:45:37Z",
    "updated_at": "2018-03-23T00:37:50Z",
    "closed_at": "2018-03-23T00:37:50Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "When installing a package with a broken URL, Spack crashes when trying to raise a `FetchError` if using Python 3.\r\n\r\n### Expected Result\r\n\r\nThings work correctly when using Python 2:\r\n```\r\n$ python2 $(which spack) install example\r\n==> Installing example\r\n==> Fetching http://www.example.com/example-1.2.3.tar.gz\r\n\r\ncurl: (22) The requested URL returned error: 404 Not Found\r\n==> Fetching from http://www.example.com/example-1.2.3.tar.gz failed.\r\n==> Error: FetchError: All fetchers failed for example-1.2.3-p2xvcgjgyyiarllbm3spwju6nvxt5f36\r\nFetchError: FetchError: All fetchers failed for example-1.2.3-p2xvcgjgyyiarllbm3spwju6nvxt5f36\r\n\r\n/Users/Adam/spack/lib/spack/spack/package.py:993, in do_fetch:\r\n     25                                     self.spec.format('$_$@'), ck_msg)\r\n     26    \r\n     27            self.stage.create()\r\n  >> 28            self.stage.fetch(mirror_only)\r\n     29            self._fetch_time = time.time() - start_time\r\n     30    \r\n     31            if spack.do_checksum and self.version in self.versions:\r\n```\r\n\r\n### Actual Result\r\n\r\nWhen using Python 3, Spack crashes when trying to raise this error:\r\n```\r\n$ python3 $(which spack) install example\r\n==> Installing example\r\n==> Fetching http://www.example.com/example-1.2.3.tar.gz\r\n\r\ncurl: (22) The requested URL returned error: 404 Not Found\r\n==> Fetching from http://www.example.com/example-1.2.3.tar.gz failed.\r\nProcess Process-1:\r\nTraceback (most recent call last):\r\n  File \"/Users/Adam/spack/lib/spack/spack/build_environment.py\", line 665, in child_process\r\n    return_value = function()\r\n  File \"/Users/Adam/spack/lib/spack/spack/package.py\", line 1405, in build_process\r\n    self.do_patch()\r\n  File \"/Users/Adam/spack/lib/spack/spack/package.py\", line 1052, in do_patch\r\n    self.do_stage()\r\n  File \"/Users/Adam/spack/lib/spack/spack/package.py\", line 1006, in do_stage\r\n    self.do_fetch(mirror_only)     # this will create the stage\r\n  File \"/Users/Adam/spack/lib/spack/spack/package.py\", line 993, in do_fetch\r\n    self.stage.fetch(mirror_only)\r\n  File \"/Users/Adam/spack/lib/spack/spack/util/pattern.py\", line 87, in getter\r\n    getattr(item, self.name)(*args, **kwargs)\r\n  File \"/Users/Adam/spack/lib/spack/spack/stage.py\", line 441, in fetch\r\n    raise fs.FetchError(errMessage, None)\r\nspack.fetch_strategy.FetchError: All fetchers failed for example-1.2.3-p2xvcgjgyyiarllbm3spwju6nvxt5f36\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/Adam/anaconda3/lib/python3.6/multiprocessing/process.py\", line 258, in _bootstrap\r\n    self.run()\r\n  File \"/Users/Adam/anaconda3/lib/python3.6/multiprocessing/process.py\", line 93, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"/Users/Adam/spack/lib/spack/spack/build_environment.py\", line 686, in child_process\r\n    if hasattr(pkg, 'log_path'):\r\n  File \"/Users/Adam/spack/lib/spack/spack/package.py\", line 801, in log_path\r\n    return os.path.join(self.stage.source_path, 'spack-build.out')\r\n  File \"/Users/Adam/anaconda3/lib/python3.6/posixpath.py\", line 78, in join\r\n    a = os.fspath(a)\r\nTypeError: expected str, bytes or os.PathLike object, not NoneType\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack create\r\n# uncomment the version()\r\n$ spack install example\r\n```\r\n\r\nNote: the problem occurs only when running `spack install`, not when running `spack fetch`, so the problem may not be in the fetcher itself.\r\n\r\n@alalazo ",
    "performed_via_github_app": null
}