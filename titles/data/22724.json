{
    "url": "https://api.github.com/repos/spack/spack/issues/22724",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22724/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22724/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22724/events",
    "html_url": "https://github.com/spack/spack/issues/22724",
    "id": 848489693,
    "node_id": "MDU6SXNzdWU4NDg0ODk2OTM=",
    "number": 22724,
    "title": "Anonymous Bundle Spec",
    "user": {
        "login": "dennisklein",
        "id": 297548,
        "node_id": "MDQ6VXNlcjI5NzU0OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/297548?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dennisklein",
        "html_url": "https://github.com/dennisklein",
        "followers_url": "https://api.github.com/users/dennisklein/followers",
        "following_url": "https://api.github.com/users/dennisklein/following{/other_user}",
        "gists_url": "https://api.github.com/users/dennisklein/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/dennisklein/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dennisklein/subscriptions",
        "organizations_url": "https://api.github.com/users/dennisklein/orgs",
        "repos_url": "https://api.github.com/users/dennisklein/repos",
        "events_url": "https://api.github.com/users/dennisklein/events{/privacy}",
        "received_events_url": "https://api.github.com/users/dennisklein/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908756,
            "node_id": "MDU6TGFiZWw3MzkwODc1Ng==",
            "url": "https://api.github.com/repos/spack/spack/labels/feature",
            "name": "feature",
            "color": "84b6eb",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2021-04-01T13:52:56Z",
    "updated_at": "2021-04-01T14:10:49Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Example:\r\n```\r\nspack install { pkg@1.33.7 dist@42~graphics }%gcc@10\r\nspack load { pkg@1.33.7 dist@42 } # matches best fitting installed anonymous bundle\r\n```\r\n\r\n### Rationale\r\n\r\nStory:\r\n* As an **IT department in a scientific research centre** we would like to distribute a package `pkg` with a set of curated dependencies pinned (like a Linux distro, but only for a small set of science-sensitive dependencies) in a BundlePackage `dist`. The verification process for such a dist is significantly expensive (possibly many weeks of simulation on a parallel supercomputer) which is why we need to pin things and rolling release models are not viable.\r\n* As a **scientific user** I would like to have a simple way of loading multiple combinations of `pkg` and `dist` to be able to describe my scientific software stack completely and deterministically which is essential to the scientific method.\r\n\r\n### Description\r\n\r\nThe *anonymous bundle spec* notation would work only at root node level of a spec, e.g.\r\n\r\n```\r\nroot         = { spec-list | '{' spec-list [ spec-list ] '}' [ global_options ] }\r\nspec-list    = { spec [ dep-list ] }\r\ndep-list     = { ^ spec }\r\nspec         = id [ options ]\r\noptions      = { local_options | global_options }\r\nlocal_options = { @version-list | +variant | -variant | ~variant }\r\nglobal_options = { %compiler | arch=architecture | [ flag ]=value }\r\nflag         = { cflags | cxxflags | fcflags | fflags | cppflags |\r\n                 ldflags | ldlibs }\r\nvariant      = id\r\narchitecture = id\r\ncompiler     = id [ version-list ]\r\nversion-list = version [ { , version } ]\r\nversion      = id | id: | :id | id:id\r\nid           = [A-Za-z0-9_][A-Za-z0-9_.-]*\r\n```\r\n\r\n* All specs listed within an *anonymous bundle spec* would concretize together.\r\n* An *anonymous bundle spec* likely would not create any distinct entry in the install tree. In order to address them, e.g. for a load, one would need to specify at least the minimally qualified spec that can be uniquely matched against installed packages.\r\n\r\n### Alternatives considered\r\n\r\n#### Named environments\r\n\r\n* Changes the user interface fundamentally from basic `spack install/load`\r\n* Requires understanding of (too many) details on the behaviour by the user due to its persistent nature\r\n* Not very suitable for tracking in versioned repos because certain operations will try to modify the environment files on disk (which confuses users)\r\n\r\n#### Bundle packages\r\n\r\n* Requires to introduce a named entity into the dependency tree, e.g. from a clean intuitive tree\r\n```\r\npkg\r\n +--> dep1\r\n +--> dep2\r\n```\r\nto a convoluted tree\r\n```\r\npkg\r\n +--+ dist\r\n    +--> dep1\r\n    +--> dep2\r\n```\r\n* Or, when used as a super package `bundle ^pkg ^dist`, it needs either be created by the user to customize (changed UI, complexity) or the bundle package needs to expose all version and variants on combined namespace (changed UI, high maintainance cost).\r\n\r\n#### Combinations of the above\r\n\r\n* Combines disadvantages\r\n\r\n#### Custom extension\r\n\r\n* That introduces a new subcommand, different UI\r\n* High cost to develop/maintain (of course that's fine, if there is no general interest in such a feature)\r\n* No proof of concept done, so I do not know if an extension actually can do everything that would be needed. (At least on the load side of things, I fear extension are limited)\r\n\r\n#### Using git branches\r\n\r\n* Cannot use packages from the `builtin` repo in some case because it is strongly coupled with spack itself\r\n* Would require to multiplex multiple spack instances/repo configs, if one would want to provide multiple `dist`s in parallel\r\n\r\n### General information\r\n\r\n- [ ] I have run `spack --version` and reported the version of Spack -> not relevant\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate -> only briefly\r\n\r\nI hope I did not miss anything, please point me to any relevant discussion / feature. Thanks!\r\n",
    "performed_via_github_app": null
}