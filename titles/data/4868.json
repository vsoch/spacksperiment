{
    "url": "https://api.github.com/repos/spack/spack/issues/4868",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/4868/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/4868/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/4868/events",
    "html_url": "https://github.com/spack/spack/pull/4868",
    "id": 244812914,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTMxODgwMzEz",
    "number": 4868,
    "title": "Make testing spack commands simpler",
    "user": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 471995122,
            "node_id": "MDU6TGFiZWw0NzE5OTUxMjI=",
            "url": "https://api.github.com/repos/spack/spack/labels/commands",
            "name": "commands",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 456341797,
            "node_id": "MDU6TGFiZWw0NTYzNDE3OTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/tests",
            "name": "tests",
            "color": "b60205",
            "default": false,
            "description": "General test capability(ies)"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2017-07-22T00:50:04Z",
    "updated_at": "2017-08-02T15:44:01Z",
    "closed_at": "2017-07-23T04:27:55Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/4868",
        "html_url": "https://github.com/spack/spack/pull/4868",
        "diff_url": "https://github.com/spack/spack/pull/4868.diff",
        "patch_url": "https://github.com/spack/spack/pull/4868.patch"
    },
    "body": "This makes it easier to test command-line commands from within Spack's testing framework.  It adds a `SpackCommand` class so you can do this:\r\n\r\n```python\r\nfrom spack.main import SpackCommand\r\nuninstall = SpackCommand('uninstall')\r\nout, err = uninstall('-y', '-a', '--dependents', 'mpich')\r\n```\r\n\r\nNo more creating parsers and all that from within command tests.  Just run the command like a user would and test that.  The commands return their error and their output so you can parse that, as well.  I've redone the command tests to use this instead of all the cruft that was there before.  I also removed a bunch of unnecessary mockery from the `spack install` test, and simplified the mocking of fetches a bit.\r\n\r\nI hope this will make it easier to get coverage in some of the commands where we've been missing it.\r\n\r\n- [x] Add `SpackCommand` to make testing commands easier\r\n- [x] Rework tests of commands to use `SpackCommand`\r\n- [x] Simplify mocking in the `cmd/install` test and in general\r\n- [x] Move the `mock_archive` fixture up to the `conftest.py` level so all tests can use it\r\n- [x] Make a `mock_fetch` fixture usable by all tests\r\n\r\n",
    "performed_via_github_app": null
}