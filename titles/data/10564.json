{
    "url": "https://api.github.com/repos/spack/spack/issues/10564",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10564/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10564/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10564/events",
    "html_url": "https://github.com/spack/spack/issues/10564",
    "id": 408991818,
    "node_id": "MDU6SXNzdWU0MDg5OTE4MTg=",
    "number": 10564,
    "title": "CDash reporter fails when installing pkgs with `-f <spec.yaml>`",
    "user": {
        "login": "scottwittenburg",
        "id": 6527504,
        "node_id": "MDQ6VXNlcjY1Mjc1MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6527504?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scottwittenburg",
        "html_url": "https://github.com/scottwittenburg",
        "followers_url": "https://api.github.com/users/scottwittenburg/followers",
        "following_url": "https://api.github.com/users/scottwittenburg/following{/other_user}",
        "gists_url": "https://api.github.com/users/scottwittenburg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scottwittenburg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scottwittenburg/subscriptions",
        "organizations_url": "https://api.github.com/users/scottwittenburg/orgs",
        "repos_url": "https://api.github.com/users/scottwittenburg/repos",
        "events_url": "https://api.github.com/users/scottwittenburg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scottwittenburg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "zackgalbreath",
        "id": 224720,
        "node_id": "MDQ6VXNlcjIyNDcyMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/224720?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zackgalbreath",
        "html_url": "https://github.com/zackgalbreath",
        "followers_url": "https://api.github.com/users/zackgalbreath/followers",
        "following_url": "https://api.github.com/users/zackgalbreath/following{/other_user}",
        "gists_url": "https://api.github.com/users/zackgalbreath/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/zackgalbreath/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zackgalbreath/subscriptions",
        "organizations_url": "https://api.github.com/users/zackgalbreath/orgs",
        "repos_url": "https://api.github.com/users/zackgalbreath/repos",
        "events_url": "https://api.github.com/users/zackgalbreath/events{/privacy}",
        "received_events_url": "https://api.github.com/users/zackgalbreath/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "zackgalbreath",
            "id": 224720,
            "node_id": "MDQ6VXNlcjIyNDcyMA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/224720?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/zackgalbreath",
            "html_url": "https://github.com/zackgalbreath",
            "followers_url": "https://api.github.com/users/zackgalbreath/followers",
            "following_url": "https://api.github.com/users/zackgalbreath/following{/other_user}",
            "gists_url": "https://api.github.com/users/zackgalbreath/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/zackgalbreath/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zackgalbreath/subscriptions",
            "organizations_url": "https://api.github.com/users/zackgalbreath/orgs",
            "repos_url": "https://api.github.com/users/zackgalbreath/repos",
            "events_url": "https://api.github.com/users/zackgalbreath/events{/privacy}",
            "received_events_url": "https://api.github.com/users/zackgalbreath/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "tgamblin",
            "id": 299842,
            "node_id": "MDQ6VXNlcjI5OTg0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tgamblin",
            "html_url": "https://github.com/tgamblin",
            "followers_url": "https://api.github.com/users/tgamblin/followers",
            "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
            "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
            "organizations_url": "https://api.github.com/users/tgamblin/orgs",
            "repos_url": "https://api.github.com/users/tgamblin/repos",
            "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tgamblin/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 0,
    "created_at": "2019-02-11T21:47:45Z",
    "updated_at": "2019-02-11T21:53:40Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "When calling `spack install ...` with arguments which cause CDash reporting, passing specs to install on the command line works fine, while passing `-f <spec.yaml` causes the CDash reporter to raise an exception.\r\n\r\n### Steps to reproduce the issue\r\n\r\nGiven a spec.yaml file like this one:\r\n\r\n```console\r\n$ cat /tmp/pkgconf.yaml \r\nspec:\r\n- pkgconf:\r\n    version: 1.4.2\r\n    arch:\r\n      platform: darwin\r\n      platform_os: highsierra\r\n      target: x86_64\r\n    compiler:\r\n      name: clang\r\n      version: 9.1.0-apple\r\n    namespace: builtin\r\n    parameters:\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    hash: 564r23i4wovhvwngsweex2smvsrfug3e\r\n```\r\n\r\nAttempt to install it using the CDash reporting arguments, as follows:\r\n\r\n```console\r\n$ spack -d install \\\r\n    --cdash-upload-url 'https://cdash.spack.io/submit.php?project=Spack' \\\r\n    --cdash-build 'pkgconf@1.4.2%clang@9.1.0-apple arch=highsierra-x86_64' \\\r\n    --cdash-site 'Spack AWS Gitlab Instance' \\\r\n    --cdash-track Experimental \\\r\n    -f /tmp/pkgconf.yaml\r\n```\r\n\r\n### Error Message\r\n\r\nI cut out most of the debug output until the exception message:\r\n\r\n```console\r\n...\r\nTraceback (most recent call last):\r\n  File \"/Users/scott/projects/spack/bin/spack\", line 48, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/Users/scott/projects/spack/lib/spack/spack/main.py\", line 669, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/Users/scott/projects/spack/lib/spack/spack/main.py\", line 440, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/Users/scott/projects/spack/lib/spack/spack/cmd/install.py\", line 325, in install\r\n    install_spec(args, kwargs, abstract, concrete)\r\n  File \"/Users/scott/projects/spack/lib/spack/spack/report.py\", line 265, in __exit__\r\n    self.report_writer.build_report(self.filename, report_data)\r\n  File \"/Users/scott/projects/spack/lib/spack/spack/reporters/cdash.py\", line 185, in build_report\r\n    self.upload(phase_report)\r\n  File \"/Users/scott/projects/spack/lib/spack/spack/reporters/cdash.py\", line 239, in upload\r\n    response = opener.open(request)\r\n  File \"/usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py\", line 435, in open\r\n    response = meth(req, response)\r\n  File \"/usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py\", line 548, in http_response\r\n    'http', request, response, code, msg, hdrs)\r\n  File \"/usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py\", line 473, in error\r\n    return self._call_chain(*args)\r\n  File \"/usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py\", line 407, in _call_chain\r\n    result = func(*args)\r\n  File \"/usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py\", line 556, in http_error_default\r\n    raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)\r\nurllib2.HTTPError: HTTP Error 500: Internal Server Error\r\n```\r\n\r\nWhile it seems the package was installed (because `spack` finds it after the exception message is printed) the reporting fails.\r\n\r\n```console\r\n$ spack find\r\n==> 1 installed package\r\n-- darwin-highsierra-x86_64 / clang@9.1.0-apple -----------------\r\npkgconf@1.4.2\r\n```\r\n\r\n### Information on your system\r\n\r\nIt's probably clear from information included above this is on OSX (highsierra), using the system clang compiler.  But I have also encountered this issue on Ubuntu and Centos.\r\n",
    "performed_via_github_app": null
}