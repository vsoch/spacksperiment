{
    "url": "https://api.github.com/repos/spack/spack/issues/8745",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8745/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8745/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8745/events",
    "html_url": "https://github.com/spack/spack/issues/8745",
    "id": 342479971,
    "node_id": "MDU6SXNzdWUzNDI0Nzk5NzE=",
    "number": 8745,
    "title": "Concretization failure when using system-installed CUDA",
    "user": {
        "login": "SteVwonder",
        "id": 874707,
        "node_id": "MDQ6VXNlcjg3NDcwNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/874707?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SteVwonder",
        "html_url": "https://github.com/SteVwonder",
        "followers_url": "https://api.github.com/users/SteVwonder/followers",
        "following_url": "https://api.github.com/users/SteVwonder/following{/other_user}",
        "gists_url": "https://api.github.com/users/SteVwonder/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SteVwonder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SteVwonder/subscriptions",
        "organizations_url": "https://api.github.com/users/SteVwonder/orgs",
        "repos_url": "https://api.github.com/users/SteVwonder/repos",
        "events_url": "https://api.github.com/users/SteVwonder/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SteVwonder/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908755,
            "node_id": "MDU6TGFiZWw3MzkwODc1NQ==",
            "url": "https://api.github.com/repos/spack/spack/labels/duplicate",
            "name": "duplicate",
            "color": "cccccc",
            "default": true,
            "description": null
        },
        {
            "id": 446643530,
            "node_id": "MDU6TGFiZWw0NDY2NDM1MzA=",
            "url": "https://api.github.com/repos/spack/spack/labels/fetching",
            "name": "fetching",
            "color": "fbca04",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-07-18T20:28:41Z",
    "updated_at": "2018-07-18T21:00:56Z",
    "closed_at": "2018-07-18T20:57:29Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "When I add a system-installed version of CUDA to my `packages.yaml` along with `buildable: False`, anything that depends on cuda fails to concretize.  The main problem here being that the system-installed version of CUDA is not one of the versions explicitly listed in the cuda package.py.  If I add that version of CUDA to the package.py, then everything works as expected.  So ultimately, I think this comes down to spack being unable to automatically generate a url to download the CUDA version from.  This is potentially a symptom of #5814. \r\n\r\n### Expected Result\r\n\r\n```\r\n# herbein1 at sierra4362 in /usr/workspace/wsb/herbein1/spack_blueos_ppc/var/spack/repos on git:fix-lmod-separator \u2716\ufe0e [13:19:06]\r\n\u2192 spack spec hwloc +cuda\r\nInput spec\r\n--------------------------------\r\nhwloc+cuda\r\n\r\nConcretized\r\n--------------------------------\r\nhwloc@2.0.1%gcc@4.9.3~cairo+cuda+libxml2+pci+shared arch=linux-rhel7-ppc64le \r\n    ^cuda@9.2.64%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n    ^libpciaccess@0.13.5%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n        ^libtool@2.4.6%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n            ^m4@1.4.18%gcc@4.9.3 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,c0a408fbffb7255fcc75e26bd8edab116fc81d216bfd18b473668b7739a4158e +sigsegv arch=linux-rhel7-ppc64le \r\n                ^libsigsegv@2.11%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n        ^pkgconf@1.4.2%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n        ^util-macros@1.19.1%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n    ^libxml2@2.9.8%gcc@4.9.3~python arch=linux-rhel7-ppc64le \r\n        ^xz@5.2.4%gcc@4.9.3 arch=linux-rhel7-ppc64le \r\n        ^zlib@1.2.11%gcc@4.9.3+optimize+pic+shared arch=linux-rhel7-ppc64le \r\n```\r\n\r\n### Actual Result\r\n\r\n```\r\n# herbein1 at sierra4362 in /usr/workspace/wsb/herbein1/spack_blueos_ppc/var/spack/repos on git:fix-lmod-separator \u2716\ufe0e [13:18:44]\r\n\u2192 spack spec hwloc +cuda\r\nInput spec\r\n--------------------------------\r\nhwloc+cuda\r\n\r\nConcretized\r\n--------------------------------\r\n==> Error: Class constructor failed for package 'cuda'.\r\n\r\nCaused by:\r\nTypeError: expected string or buffer\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/repo.py\", line 833, in get\r\n    return package_class(spec)\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/package.py\", line 672, in __init__\r\n    f = fs.for_package_version(self, self.version)\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/fetch_strategy.py\", line 977, in for_package_version\r\n    url = pkg.url_for_version(version)\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/package.py\", line 794, in url_for_version\r\n    default_url, self.url_version(version))\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/url.py\", line 845, in substitute_version\r\n    ver,  vs, vl, voffs) = substitution_offsets(path)\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/url.py\", line 789, in substitution_offsets\r\n    ver,  vs, vl, vi, vregex = parse_version_offset(path)\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/url.py\", line 408, in parse_version_offset\r\n    path, ext, suffix = split_url_extension(path)\r\n  File \"/usr/workspace/wsb/herbein1/spack_blueos_ppc/lib/spack/spack/url.py\", line 346, in split_url_extension\r\n    match = re.search(r'(.*(?:sourceforge\\.net|sf\\.net)/.*)(/download)$', path)\r\n  File \"/usr/tce/packages/python/python-2.7.14/lib/python2.7/re.py\", line 146, in search\r\n    return _compile(pattern, flags).search(string)\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n# Add the config stuff pasted below into your packages.yaml\r\n$ spack spec hwloc +cuda\r\n...\r\n```\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\n\r\n 1. Sierra @ LLNL: RHEL7, ppc64le.  This is why I cannot use the spack provided CUDA, which only installs the x86 version.\r\n 2. `packages.yaml`:\r\n```\r\npackages:\r\n  all:\r\n    compiler: [gcc@6.4.0]\r\n  cuda:\r\n    buildable: False\r\n    paths:\r\n      cuda @9.2.64 target=ppc64le : /usr/tce/packages/cuda/cuda-9.2.64\r\n```",
    "performed_via_github_app": null
}