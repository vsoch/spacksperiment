{
    "url": "https://api.github.com/repos/spack/spack/issues/8733",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8733/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8733/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8733/events",
    "html_url": "https://github.com/spack/spack/issues/8733",
    "id": 342075925,
    "node_id": "MDU6SXNzdWUzNDIwNzU5MjU=",
    "number": 8733,
    "title": "Fetch mechanics broken in develop for rare but present cases",
    "user": {
        "login": "chissg",
        "id": 2372949,
        "node_id": "MDQ6VXNlcjIzNzI5NDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2372949?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chissg",
        "html_url": "https://github.com/chissg",
        "followers_url": "https://api.github.com/users/chissg/followers",
        "following_url": "https://api.github.com/users/chissg/following{/other_user}",
        "gists_url": "https://api.github.com/users/chissg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/chissg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/chissg/subscriptions",
        "organizations_url": "https://api.github.com/users/chissg/orgs",
        "repos_url": "https://api.github.com/users/chissg/repos",
        "events_url": "https://api.github.com/users/chissg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/chissg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446643530,
            "node_id": "MDU6TGFiZWw0NDY2NDM1MzA=",
            "url": "https://api.github.com/repos/spack/spack/labels/fetching",
            "name": "fetching",
            "color": "fbca04",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2018-07-17T20:39:23Z",
    "updated_at": "2018-07-26T06:10:12Z",
    "closed_at": "2018-07-26T06:10:12Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "When attempting to stage or install a package depending on a package where at least one installed version can be found via packages.yaml _but which does not have a default URL or an explicit URL for the version_, an error stack like the following will result instead of a successful build (regardless of whether the errant version satisfies the top-level package's requirements or not):\r\n```\r\n==> Error: Class constructor failed for package 'sqlite'.\r\n\r\nCaused by:\r\nTypeError: expected string or buffer\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/repo.py\", line 833, in get\r\n    return package_class(spec)\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/package.py\", line 672, in __init__\r\n    f = fs.for_package_version(self, self.version)\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/fetch_strategy.py\", line 977, in for_package_version\r\n    url = pkg.url_for_version(version)\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/package.py\", line 794, in url_for_version\r\n    default_url, self.url_version(version))\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/url.py\", line 845, in substitute_version\r\n    ver,  vs, vl, voffs) = substitution_offsets(path)\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/url.py\", line 789, in substitution_offsets\r\n    ver,  vs, vl, vi, vregex = parse_version_offset(path)\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/url.py\", line 408, in parse_version_offset\r\n    path, ext, suffix = split_url_extension(path)\r\n  File \"/home/greenc/work/cet-is/sources/spack-test/lib/spack/spack/url.py\", line 346, in split_url_extension\r\n    match = re.search(r'(.*(?:sourceforge\\.net|sf\\.net)/.*)(/download)$', path)\r\n  File \"/usr/lib64/python2.7/re.py\", line 142, in search\r\n    return _compile(pattern, flags).search(string)\r\n```\r\n\r\nIt appears that Spack is going through the fetch strategy mechanics even though (a) they're not necessary because this is a version that's already installed, and (b), the lack of either a specific or default URL for this version means that it can never be fetched anyway.\r\n\r\n### Steps to reproduce the issue\r\n\r\nFirst, ensure that your system has an installed SQLite and that it is mentioned in `packages.yaml`, like (for instance for Scientific Linux 7.4):\r\n```yaml\r\npackages:\r\n  sqlite:\r\n    paths:\r\n      sqlite@3.7.17 arch=linux-rhel7-x86_64: /usr\r\n```\r\n\r\nThen, attempt to install a package requiring SQLite, _e.g._:\r\n```console\r\n$ spack install openslide\r\n```\r\n\r\n### Information on your system\r\n\r\nScientific Linux 7.4, Spack from `upstream/develop`,  `packages.yaml` as described above.\r\n",
    "performed_via_github_app": null
}