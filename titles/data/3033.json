{
    "url": "https://api.github.com/repos/spack/spack/issues/3033",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/3033/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/3033/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/3033/events",
    "html_url": "https://github.com/spack/spack/pull/3033",
    "id": 205397017,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTA0Njg1Njg0",
    "number": 3033,
    "title": "Rework Spack help.",
    "user": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446620495,
            "node_id": "MDU6TGFiZWw0NDY2MjA0OTU=",
            "url": "https://api.github.com/repos/spack/spack/labels/WIP",
            "name": "WIP",
            "color": "ededed",
            "default": false,
            "description": null
        },
        {
            "id": 471995122,
            "node_id": "MDU6TGFiZWw0NzE5OTUxMjI=",
            "url": "https://api.github.com/repos/spack/spack/labels/commands",
            "name": "commands",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 446625544,
            "node_id": "MDU6TGFiZWw0NDY2MjU1NDQ=",
            "url": "https://api.github.com/repos/spack/spack/labels/documentation",
            "name": "documentation",
            "color": "0d5977",
            "default": true,
            "description": ""
        },
        {
            "id": 460427403,
            "node_id": "MDU6TGFiZWw0NjA0Mjc0MDM=",
            "url": "https://api.github.com/repos/spack/spack/labels/performance",
            "name": "performance",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 521903170,
            "node_id": "MDU6TGFiZWw1MjE5MDMxNzA=",
            "url": "https://api.github.com/repos/spack/spack/labels/user-experience",
            "name": "user-experience",
            "color": "bfdadc",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/spack/spack/milestones/3",
        "html_url": "https://github.com/spack/spack/milestone/3",
        "labels_url": "https://api.github.com/repos/spack/spack/milestones/3/labels",
        "id": 2905687,
        "node_id": "MDk6TWlsZXN0b25lMjkwNTY4Nw==",
        "number": 3,
        "title": "v0.11.0",
        "description": "",
        "creator": {
            "login": "tgamblin",
            "id": 299842,
            "node_id": "MDQ6VXNlcjI5OTg0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tgamblin",
            "html_url": "https://github.com/tgamblin",
            "followers_url": "https://api.github.com/users/tgamblin/followers",
            "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
            "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
            "organizations_url": "https://api.github.com/users/tgamblin/orgs",
            "repos_url": "https://api.github.com/users/tgamblin/repos",
            "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tgamblin/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 1,
        "closed_issues": 57,
        "state": "closed",
        "created_at": "2017-11-12T00:25:40Z",
        "updated_at": "2018-07-05T15:21:20Z",
        "due_on": "2018-01-17T08:00:00Z",
        "closed_at": "2018-01-17T23:02:16Z"
    },
    "comments": 12,
    "created_at": "2017-02-05T03:17:45Z",
    "updated_at": "2017-11-12T00:47:54Z",
    "closed_at": "2017-05-08T20:18:30Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/3033",
        "html_url": "https://github.com/spack/spack/pull/3033",
        "diff_url": "https://github.com/spack/spack/pull/3033.diff",
        "patch_url": "https://github.com/spack/spack/pull/3033.patch"
    },
    "body": "### Reworks the top-level Spack help to be more helpful.  \r\n\r\nTasks:\r\n- [x] Add ability to print simplified command groups\r\n- [x] Add short and long help\r\n- [x] Add epilogue to direct user to the various help commands.\r\n- [x] Finalize sections for short and long help\r\n- [x] Move most of `bin/spack` to `spack.main.main` method\r\n- [x] Lazy command loading (commands not loaded unless needed)\r\n- [x] `spack docs` command opens docs in a browser\r\n- [x] move spec syntax help to `spack help --spec`, expand examples\r\n\r\nThere are now three ways to get help:\r\n- `spack help` / `spack -h`: default short help for basic usage, with commands broken into some simple sections.\r\n- `spack help -a`: help on everything, with more commands broken into more sections.\r\n- `spack help --spec`: show help on the spec syntax\r\n- `spack docs`: open the spack help in a web browser.\r\n\r\n\r\n### The default `spack help` now looks like this:\r\n\r\n```console\r\n$ spack -h\r\nusage: spack [-hkV] <command> [...]\r\n\r\nA flexible package manager that supports multiple versions,\r\nconfigurations, platforms, and compilers.\r\n\r\nThese are common spack commands:\r\n\r\nquery packages:\r\n  list            list and search available packages\r\n  info            get detailed information on a particular package\r\n  find            list and search installed packages\r\n\r\nbuild packages:\r\n  install         build and install packages\r\n  uninstall       remove installed packages\r\n  spec            show what would be installed, given a spec\r\n\r\nenvironment:\r\n  load            add package to environment using `module load`\r\n  module          manipulate module files\r\n  unload          remove package from environment using `module unload`\r\n  view            produce a single-rooted directory view of packages\r\n\r\ncreate packages:\r\n  create          create a new package file\r\n  edit            open package files in $EDITOR\r\n\r\nsystem:\r\n  arch            print architecture information about this machine\r\n  compilers       list available compilers\r\n\r\noptional arguments:\r\n  -h, --help      show this help message and exit\r\n  -k, --insecure  do not check ssl certificates when downloading\r\n  -V, --version   show version number and exit\r\n\r\nmore help:\r\n  spack help -a          list all available commands\r\n  spack help <command>   help on a specific command\r\n  spack help --spec      help on the spec syntax\r\n  spack docs             open http://spack.rtfd.io/ in a browser\r\n```\r\n\r\n### And `spack help --all` looks like this:\r\n\r\n```console\r\n$ spack help -a\r\nusage: spack [-hdDkmpPlinesvsV] <command> [...]\r\n\r\nA flexible package manager that supports multiple versions,\r\nconfigurations, platforms, and compilers.\r\n\r\nComplete list of spack commands:\r\n\r\nadministration:\r\n  bootstrap             create a new installation of spack in another prefix\r\n  purge                 remove temporary build files and/or downloaded archives\r\n  reindex               rebuild Spack's package database\r\n\r\nquery packages:\r\n  list                  list and search available packages\r\n  info                  get detailed information on a particular package\r\n  find                  list and search installed packages\r\n  dependents            show installed packages that depend on another\r\n  graph                 generate graphs of package dependency relationships\r\n  providers             list packages that provide a particular virtual package\r\n\r\nbuild packages:\r\n  fetch                 fetch archives for packages\r\n  stage                 expand downloaded archive in preparation for install\r\n  patch                 patch expanded archive sources in preparation for install\r\n  configure             stage and configure a package but do not install\r\n  build                 stops at build stage when installing a package, if possible\r\n  restage               revert checked out package source code\r\n  install               build and install packages\r\n  uninstall             remove installed packages\r\n  clean                 remove build stage and source tarball for packages\r\n  env                   show install environment for a spec, and run commands\r\n  spec                  show what would be installed, given a spec\r\n\r\nconfiguration:\r\n  config                get and set configuration options\r\n  mirror                manage mirrors\r\n  repo                  manage package source repositories\r\n\r\ndeveloper:\r\n  debug                 debugging commands for troubleshooting Spack\r\n  diy                   do-it-yourself: build from an existing source directory\r\n  flake8                runs source code style checks on Spack. requires flake8\r\n  pkg                   query packages associated with particular git revisions\r\n  pydoc                 run pydoc from within spack\r\n  python                launch an interpreter as spack would launch a command\r\n  setup                 create a configuration script and module, but don't build\r\n  test                  run spack's unit tests\r\n  url                   debugging tool for url parsing\r\n\r\nenvironment:\r\n  cd                    cd to spack directories in the shell\r\n  load                  add package to environment using `module load`\r\n  location              print out locations of various directories used by Spack\r\n  module                manipulate module files\r\n  unload                remove package from environment using `module unload`\r\n  unuse                 remove package from environment using dotkit\r\n  use                   add package to environment using dotkit\r\n  view                  produce a single-rooted directory view of packages\r\n\r\nextensions:\r\n  activate              activate a package extension\r\n  deactivate            deactivate a package extension\r\n  extensions            list extensions for package\r\n\r\ncreate packages:\r\n  checksum              checksum available versions of a package\r\n  create                create a new package file\r\n  edit                  open package files in $EDITOR\r\n  md5                   calculate md5 checksums for files/urls\r\n  versions              list available versions of a package\r\n\r\nsystem:\r\n  arch                  print architecture information about this machine\r\n  compiler              manage compilers\r\n  compilers             list available compilers\r\n\r\noptional arguments:\r\n  -h, --help            show this help message and exit\r\n  -d, --debug           write out debug logs during compile\r\n  -D, --pdb             run spack under the pdb debugger\r\n  -k, --insecure        do not check ssl certificates when downloading\r\n  -m, --mock            use mock packages instead of real ones\r\n  -p, --profile         profile execution using cProfile\r\n  -P STAT, --sorted-profile STAT\r\n                        profile and sort by one or more of:\r\n                        [cumulative, module, ncalls, pcalls, file, line, name,\r\n                         calls, stdname, nfl, filename, cumtime, time, tottime]\r\n  --lines LINES         lines of profile output; default 20; or 'all'\r\n  -v, --verbose         print additional output during builds\r\n  -s, --stacktrace      add stacktraces to all printed statements\r\n  -V, --version         show version number and exit\r\n\r\nmore help:\r\n  spack help -a          list all available commands\r\n  spack help <command>   help on a specific command\r\n  spack help --spec      help on the spec syntax\r\n  spack docs             open http://spack.rtfd.io/ in a browser\r\n```\r\n\r\n### Help contents\r\n\r\nCommands now provide three properties that are used to auto-generate the help output:\r\n\r\n```python\r\ndescription = \"description of this command\"\r\nsection = \"developer\"\r\nlevel = \"long\"\r\n```\r\n\r\n`section` controls the top-level help sections in the help output, and `level` controls what goes in short or long help.\r\n\r\n### main.py\r\n\r\nMost of the complicated part of `bin/spack` has been moved into `lib/spack/spack/main.py`, which contains the `main(args)` method, which can be called programmatically.  It returns an exit code.  `bin/spack` now just handles setting up the system path, and then it hands off to the spack package.\r\n\r\nThere are some controls for `main.py` that let us override the default alphabetical command order and names of sections, so we can fine-tune the help output for clarity.\r\n\r\n### Lazy command loading\r\n\r\nPreviously, `spack` would build a complete parser for *all* commands every time it is run.  This means we have to load all the commands, which is a lot of python files.\r\n\r\n`main.py` is a little fancier -- it builds a minimal parser with a dummy argument first, and loads only the needed command.  This can speed things like `spack location` up, even on my laptop with SSD:\r\n\r\n`develop`:\r\n\r\n```\r\n$ time for i in $(seq 1 100); do spack location -i libelf > /dev/null; done\r\n\r\nreal\t0m32.309s\r\nuser\t0m22.511s\r\nsys\t0m8.871s\r\n```\r\n\r\n`features/better-help`:\r\n```\r\n$ time for i in $(seq 1 100); do spack location -i libelf > /dev/null; done\r\n\r\nreal\t0m23.653s\r\nuser\t0m15.879s\r\nsys\t0m6.991s\r\n```\r\n\r\nSpack only ever loads all the commands when they're needed to build the full help output.\r\n\r\n### `spack docs`\r\n\r\nThere is now a `spack docs` command that opens the spack docs in your browser.  That, the docs URL, and all the other help commands are described prominently at the bottom of the default `spack -h` output.",
    "performed_via_github_app": null
}