{
    "url": "https://api.github.com/repos/spack/spack/issues/5453",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/5453/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/5453/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/5453/events",
    "html_url": "https://github.com/spack/spack/issues/5453",
    "id": 259965823,
    "node_id": "MDU6SXNzdWUyNTk5NjU4MjM=",
    "number": 5453,
    "title": "-ldl need by silo H5open conftest, otherwise H5PL.c:(.text+0xb5): undefined reference to `dlclose'",
    "user": {
        "login": "pozulp",
        "id": 2090931,
        "node_id": "MDQ6VXNlcjIwOTA5MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2090931?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pozulp",
        "html_url": "https://github.com/pozulp",
        "followers_url": "https://api.github.com/users/pozulp/followers",
        "following_url": "https://api.github.com/users/pozulp/following{/other_user}",
        "gists_url": "https://api.github.com/users/pozulp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pozulp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pozulp/subscriptions",
        "organizations_url": "https://api.github.com/users/pozulp/orgs",
        "repos_url": "https://api.github.com/users/pozulp/repos",
        "events_url": "https://api.github.com/users/pozulp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pozulp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2017-09-23T00:07:23Z",
    "updated_at": "2017-11-23T19:52:31Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "@becker33 \r\n\r\nExecutive summary\r\n===============\r\nHDF5 1.8.11 added dynamical loading of HDF5 filters and therefore depends on libdl. When I try to build silo, which depends on hdf5, silo's configure fails on a conftest for H5open. If you google \"hdf5 dlopen\" you find [this](http://hdf-forum.184993.n3.nabble.com/Errors-compiling-against-Static-build-HDF5-1-8-11-Need-for-ldl-added-to-linker-arguments-td4026300.html) which says add \"-ldl\" to your silo ldflags. Is this what I want, and if so how should I make spack add the ldflag?\r\n\r\nNote\r\n-------\r\nI tried building silo with hdf5 1.8.10 (predates libdl dependency) but this fails with a compile error. I will report this in a separate issue (see #5454). The workaround may be as simple as adding a patch for hdf5 1.8.10 that patches the src causing the compile error. I also tried building silo with hdf5 1.10.1, the \"Preferred version\" according to spack info hdf5.\r\n\r\nMy runline and output\r\n==================\r\nWhen I run\r\n`$ ./bin/spack install --keep-stage silo@4.10.2%gcc@4.8.5~fortran+pic~shared~silex arch=linux-rhel7-x86_64 ^hdf5@1.8.12%gcc@4.8.5~cxx~debug~fortran~mpi+pic~shared~szip~threadsafe arch=linux-rhel7-x86_64`\r\nI get the following\r\n\r\n==> zlib is already installed in /home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/zlib-1.2.11-hpdicdxfq5jn2ycttiuiu42hemg444nf\r\n==> Installing hdf5\r\n==> Using cached archive: /home/pozulp1/packages/spack/var/spack/cache/hdf5/hdf5-1.8.12.tar.gz\r\n==> Already staged hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6 in /home/pozulp1/packages/spack/var/spack/stage/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6\r\n==> No patches needed for hdf5\r\n==> Building hdf5 [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed hdf5\r\n  Fetch: 0.02s.  Build: 1m 5.59s.  Total: 1m 5.61s.\r\n[+] /home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6\r\n==> Installing silo\r\n==> Fetching https://wci.llnl.gov/content/assets/docs/simulation/computer-codes/silo/silo-4.10.2/silo-4.10.2.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /home/pozulp1/packages/spack/var/spack/stage/silo-4.10.2-ovc4qkobypm6asdydhtt3eqr4pu2ivcp/silo-4.10.2.tar.gz\r\n==> Created stage in /home/pozulp1/packages/spack/var/spack/stage/silo-4.10.2-ovc4qkobypm6asdydhtt3eqr4pu2ivcp\r\n==> Applied patch remove-mpiposix.patch\r\n==> Building silo [Package]\r\n==> Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    './configure' '--prefix=/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/silo-4.10.2-ovc4qkobypm6asdydhtt3eqr4pu2ivcp' '--with-hdf5=/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6/include,/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6/lib' '--with-zlib=/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/zlib-1.2.11-hpdicdxfq5jn2ycttiuiu42hemg444nf/include,/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/zlib-1.2.11-hpdicdxfq5jn2ycttiuiu42hemg444nf/lib' '--enable-install-lite-headers' '--disable-fortran' '--disable-silex' '--disable-shared' 'CFLAGS=-fPIC' 'CXXFLAGS=-fPIC' 'FCFLAGS=-fPIC'\r\n\r\n1 error found in build log:\r\n     [ ... ]\r\n     182   checking for H5open... no\r\n     183   configure: checking if lack of zlib caused tests for hdf5 to fail...\r\n     184   checking hdf5.h usability... yes\r\n     185   checking hdf5.h presence... yes\r\n     186   checking for hdf5.h... yes\r\n     187   checking for H5open in -lhdf5... no\r\n  >> 188   configure: error:\r\n     189   You have made an explicit request for hdf5 with the --with-hdf option\r\n     190   and ./configure is unable to find hdf5 and its supporting libs, if any.\r\n     191   Please see INSTALL_FAQ for possible causes.\r\n\r\nSee build log for details:\r\n  /home/pozulp1/packages/spack/var/spack/stage/silo-4.10.2-ovc4qkobypm6asdydhtt3eqr4pu2ivcp/silo-4.10.2/spack-build.out\r\n\r\nThe contents of silo's config.log\r\n=======================\r\n[pozulp1@bubba spack]$ grep -A 10 \"checking for H5open in\" /home/pozulp1/packages/spack/var/spack/stage/silo-4.10.2-ovc4qkobypm6asdydhtt3eqr4pu2ivcp/silo-4.10.2/config.log \r\nconfigure:29453: checking for H5open in -lhdf5\r\nconfigure:29496: /home/pozulp1/packages/spack/lib/spack/env/gcc/gcc -o conftest -fPIC -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -Wdeclaration-after-statement -I/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6/include  -I/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/zlib-1.2.11-hpdicdxfq5jn2ycttiuiu42hemg444nf/include -L/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6/lib  -L/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/zlib-1.2.11-hpdicdxfq5jn2ycttiuiu42hemg444nf/lib conftest.c -lhdf5  -lz  -lz -lm >&5\r\n/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6/lib/libhdf5.a(H5PL.o): In function `H5PL_term_interface':\r\nH5PL.c:(.text+0xb5): undefined reference to `dlclose'\r\n/home/pozulp1/packages/spack/opt/spack/linux-rhel7-x86_64/gcc-4.8.5/hdf5-1.8.12-lt6wej75hjdpliylqib3sb3ouidh7jr6/lib/libhdf5.a(H5PL.o): In function `H5PL_load':\r\nH5PL.c:(.text+0x35e): undefined reference to `dlsym'\r\nH5PL.c:(.text+0x4ac): undefined reference to `dlopen'\r\nH5PL.c:(.text+0x4c7): undefined reference to `dlsym'\r\nH5PL.c:(.text+0x614): undefined reference to `dlclose'\r\nH5PL.c:(.text+0x699): undefined reference to `dlerror'\r\nH5PL.c:(.text+0x902): undefined reference to `dlclose'\r\n[pozulp1@bubba spack]$",
    "performed_via_github_app": null
}