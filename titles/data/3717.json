{
    "url": "https://api.github.com/repos/spack/spack/issues/3717",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/3717/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/3717/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/3717/events",
    "html_url": "https://github.com/spack/spack/issues/3717",
    "id": 219733161,
    "node_id": "MDU6SXNzdWUyMTk3MzMxNjE=",
    "number": 3717,
    "title": "SHA-1 prefix spec collision when specifying hashes for dependencies",
    "user": {
        "login": "wscullin",
        "id": 967536,
        "node_id": "MDQ6VXNlcjk2NzUzNg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/967536?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/wscullin",
        "html_url": "https://github.com/wscullin",
        "followers_url": "https://api.github.com/users/wscullin/followers",
        "following_url": "https://api.github.com/users/wscullin/following{/other_user}",
        "gists_url": "https://api.github.com/users/wscullin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/wscullin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/wscullin/subscriptions",
        "organizations_url": "https://api.github.com/users/wscullin/orgs",
        "repos_url": "https://api.github.com/users/wscullin/repos",
        "events_url": "https://api.github.com/users/wscullin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/wscullin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 5,
    "created_at": "2017-04-05T22:24:21Z",
    "updated_at": "2019-12-06T10:35:47Z",
    "closed_at": "2019-12-06T10:35:46Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I'm shortening flags and compiler options for the sake of brevity as the total length is 1134 chars, but can provide full paths if it matters. This may also be a variant of #1559, but it seems to be a slightly different animal.\r\n\r\nUsing the Intel compilers, pixman will only build and pass tests when optimization is set to -O0. It depends on libpng which in turn depends on zlib. I don't want to build everything -O0, so I have dependencies prebuilt with flags that generally work on our system:\r\n\r\n```bash\r\n[derp]$ spack find -fl %intel\r\n==> 3 installed packages.\r\n-- cray-cnl6-mic_knl / intel@17.0.2.174.4.9.4.0.0.0.7.5.3 -------\r\nlggn6f6 libpng@1.6.27%intel cflags=\"-mtune=knl -g -fp-model:source ...\"\r\n\r\nq6jce7a pkg-config@0.29.1%intel cflags=\"-mtune=knl -g -fp-model:source ...\"\r\n\r\nlfr2nzr zlib@1.2.11%intel cflags=\"-mtune=knl -g -fp-model:source ...\"\r\n\r\n[derp]$\r\n```\r\n\r\nI then go to build pixman and spack sees a collision with libpng's zlib dependency:\r\n```bash\r\n[derp]$ spack install pixman cflags=\"-O0\" %intel@17.0.2.174.4.9.4.0.0.0.7.5.3 ^/lggn6f6\r\n==> Installing pixman\r\n==> Installing libpng\r\n==> Error: Specs zlib@1.2.11%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -O0 -fp-model:source ...\" +pic+shared arch=cray-cnl6-mic_knl and zlib@1.2.11%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -fp-model:source ...\" +pic+shared arch=cray-cnl6-mic_knl have the same SHA-1 prefix!\r\n[derp]$\r\n```\r\n\r\nLooking at the concrete spec for what I asked to install, it looks like an issue in the concretized spec:\r\n```bash\r\n[derp]$ spack spec -L pixman ^/lggn6f6 cflags=\"-O0\"\r\nInput spec\r\n--------------------------------\r\n2o2mp55isbdd7vxariybt3apo2kaomrs  pixman cflags=\"-O0\" \r\nlggn6f6bhf7dm5w3ttosr27jqpj7ojsn      ^libpng@1.6.27%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -fp-model:source ...\"  arch=cray-cnl6-mic_knl \r\nlfr2nzrs5673spgkn4y7me2ohq5rw5oh          ^zlib@1.2.11%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -fp-model:source ...\" +pic+shared arch=cray-cnl6-mic_knl \r\n\r\nNormalized\r\n--------------------------------\r\nz566qe2kizqbln7ezlw5b3vwdccsr4gc  pixman cflags=\"-O0\" \r\nlggn6f6bhf7dm5w3ttosr27jqpj7ojsn      ^libpng@1.6.27%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -fp-model:source ...\"  arch=cray-cnl6-mic_knl \r\nlfr2nzrs5673spgkn4y7me2ohq5rw5oh          ^zlib@1.2.11%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -fp-model:source ...\" +pic+shared arch=cray-cnl6-mic_knl \r\ntiolp4xnoepfywxfos3ygzir7r3xut22      ^pkg-config\r\n\r\nConcretized\r\n--------------------------------\r\nwutzdizhy74xm6rmudjre26rclzy52bw  pixman@0.34.0%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -O0 -fp-model:source ...\"  arch=cray-cnl6-mic_knl \r\nlggn6f6bhf7dm5w3ttosr27jqpj7ojsn      ^libpng@1.6.27%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -O0 -fp-model:source ...\" arch=cray-cnl6-mic_knl \r\nlfr2nzrs5673spgkn4y7me2ohq5rw5oh          ^zlib@1.2.11%intel@17.0.2.174.4.9.4.0.0.0.7.5.3 cflags=\"-mtune=knl -g -O0 -fp-model:source ...\" +pic+shared arch=cray-cnl6-mic_knl \r\n6dkvb4htwlxxc57iymlt6uin2zjtk6tf      ^pkg-config@0.29.2%intel@17.0.2.174.4.9\r\n```\r\n",
    "performed_via_github_app": null
}