{
    "url": "https://api.github.com/repos/spack/spack/issues/18463",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/18463/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/18463/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/18463/events",
    "html_url": "https://github.com/spack/spack/issues/18463",
    "id": 691008533,
    "node_id": "MDU6SXNzdWU2OTEwMDg1MzM=",
    "number": 18463,
    "title": "Dealing with `hipcc` / AMD's clang fork",
    "user": {
        "login": "haampie",
        "id": 194764,
        "node_id": "MDQ6VXNlcjE5NDc2NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/194764?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/haampie",
        "html_url": "https://github.com/haampie",
        "followers_url": "https://api.github.com/users/haampie/followers",
        "following_url": "https://api.github.com/users/haampie/following{/other_user}",
        "gists_url": "https://api.github.com/users/haampie/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/haampie/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/haampie/subscriptions",
        "organizations_url": "https://api.github.com/users/haampie/orgs",
        "repos_url": "https://api.github.com/users/haampie/repos",
        "events_url": "https://api.github.com/users/haampie/events{/privacy}",
        "received_events_url": "https://api.github.com/users/haampie/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446615268,
            "node_id": "MDU6TGFiZWw0NDY2MTUyNjg=",
            "url": "https://api.github.com/repos/spack/spack/labels/compilers",
            "name": "compilers",
            "color": "f9d0c4",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2020-09-02T13:10:02Z",
    "updated_at": "2021-02-25T12:09:27Z",
    "closed_at": "2021-02-25T12:09:27Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Now that we have the `hip` package in Spack, we might see some new packages start using this compiler. I've been meaning to wrap hipMAGMA, and there's been some effort to make PyTorch support AMD GPU's too.\r\n\r\nPackages already using `hipcc` include [rocfft](https://github.com/spack/spack/blob/develop/var/spack/repos/builtin/packages/rocfft/package.py#L37) and [rocblas](https://github.com/spack/spack/blob/develop/var/spack/repos/builtin/packages/rocblas/package.py#L48)\r\n\r\nThere's a couple issues:\r\n\r\n1. `hipcc` is a compiler wrapper around AMD's fork of clang (the `llvm-amdgpu` package in Spack); this means packages using `hipcc` will not be using Spack's compiler wrappers. That means no standard include flags, linker flags or arch optimization flags.\r\n\r\n2. Packages compiled with `hipcc` will look like they were installed with e.g. `%gcc` in their spec, whereas they were in fact built with clang from `llvm-amdgpu`.\r\n\r\nProblem 1 was solved in https://github.com/spack/spack/pull/17271 by copying over the `clang++` compiler wrapper from spack's sources into the hip installation directory, but it seems very hacky.\r\n\r\nWould there be a better approach to deal with this?",
    "performed_via_github_app": null
}