{
    "url": "https://api.github.com/repos/spack/spack/issues/9015",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9015/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9015/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9015/events",
    "html_url": "https://github.com/spack/spack/issues/9015",
    "id": 351635753,
    "node_id": "MDU6SXNzdWUzNTE2MzU3NTM=",
    "number": 9015,
    "title": "Unexpected behaviour of 'spack mirror create'.",
    "user": {
        "login": "skosukhin",
        "id": 19591868,
        "node_id": "MDQ6VXNlcjE5NTkxODY4",
        "avatar_url": "https://avatars.githubusercontent.com/u/19591868?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/skosukhin",
        "html_url": "https://github.com/skosukhin",
        "followers_url": "https://api.github.com/users/skosukhin/followers",
        "following_url": "https://api.github.com/users/skosukhin/following{/other_user}",
        "gists_url": "https://api.github.com/users/skosukhin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/skosukhin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/skosukhin/subscriptions",
        "organizations_url": "https://api.github.com/users/skosukhin/orgs",
        "repos_url": "https://api.github.com/users/skosukhin/repos",
        "events_url": "https://api.github.com/users/skosukhin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/skosukhin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446756736,
            "node_id": "MDU6TGFiZWw0NDY3NTY3MzY=",
            "url": "https://api.github.com/repos/spack/spack/labels/mirrors",
            "name": "mirrors",
            "color": "ade2f2",
            "default": false,
            "description": null
        },
        {
            "id": 73908758,
            "node_id": "MDU6TGFiZWw3MzkwODc1OA==",
            "url": "https://api.github.com/repos/spack/spack/labels/question",
            "name": "question",
            "color": "cc317c",
            "default": true,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-08-17T15:19:27Z",
    "updated_at": "2018-12-16T18:15:23Z",
    "closed_at": "2018-12-16T18:15:23Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "There are several moments with `spack mirror create` that I would like to clarify.\r\n1. The first question is regarding the flag `--one-version-per-spec`. As far a I understand [get_matching_versions](https://github.com/spack/spack/blob/e04fb382b17ecab15ab7dffe3f92a4a282d4a256/lib/spack/spack/mirror.py#L104-L136) recieves a list of concrete specs, which means that there is only one matching version for each spec. So, it seems that we need to pass not only concrete specs but input specs (polished with the information from `packages.yaml`) as well for the flag to make sense. Correct?\r\n2. The second question is related to the first one. The following lines of code seem to be the reason for the flag not to work properly at all:\r\nhttps://github.com/spack/spack/blob/e04fb382b17ecab15ab7dffe3f92a4a282d4a256/lib/spack/spack/mirror.py#L118-L120\r\nAs far as I understand, if we limit the number of output versions, the function stops after checking the first `num_versions` versions. The problem is that not all version among the first `num_versions` potentially satisfy our spec and the condition should be something like\r\n    ```python\r\n    if num_versions and len(matching_spec) >= num_versions:\r\n        break\r\n    ```\r\n    You can try\r\n    ```console\r\n    $ spack mirror create mpich\r\n    ```\r\n3. The third question is regarding the fact that `spack mirror create` does not try to use `list_url`. Compare the results of\r\n    ```console\r\n    $ spack mirror create cdo\r\n    ```\r\n    and\r\n    ```console\r\n    $ spack fetch cdo\r\n    ```\r\n4. The last question is regarding the format of the command line. As far as I understand, the user can specify several specs at once. Specs can contain multivalue variants: `cdo grib2=grib-api`. Does `spack mirror create` parse several such specs correctly? For the command `spack env` we have a special separator `--` for this.\r\n\r\nThank you.",
    "performed_via_github_app": null
}