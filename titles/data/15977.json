{
    "url": "https://api.github.com/repos/spack/spack/issues/15977",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/15977/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/15977/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/15977/events",
    "html_url": "https://github.com/spack/spack/issues/15977",
    "id": 597515568,
    "node_id": "MDU6SXNzdWU1OTc1MTU1Njg=",
    "number": 15977,
    "title": "Chained spack installs claim dependencies are missing but can be loaded manually.",
    "user": {
        "login": "rberg2",
        "id": 20493746,
        "node_id": "MDQ6VXNlcjIwNDkzNzQ2",
        "avatar_url": "https://avatars.githubusercontent.com/u/20493746?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rberg2",
        "html_url": "https://github.com/rberg2",
        "followers_url": "https://api.github.com/users/rberg2/followers",
        "following_url": "https://api.github.com/users/rberg2/following{/other_user}",
        "gists_url": "https://api.github.com/users/rberg2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rberg2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rberg2/subscriptions",
        "organizations_url": "https://api.github.com/users/rberg2/orgs",
        "repos_url": "https://api.github.com/users/rberg2/repos",
        "events_url": "https://api.github.com/users/rberg2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rberg2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 6,
    "created_at": "2020-04-09T19:52:55Z",
    "updated_at": "2020-04-13T19:27:37Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I have several spack installs each built around a specific program such as gcc, gromacs or namd installed via rpm on a offline node for reasons out of my control. They are linked together via /etc/spack/upstreams.yaml.\r\nAnytime I use spack I get several lines of warnings claiming \"Missing dependency not in database\" however they are there if I load them manually with `spack load program /hash`.\r\n\r\n### Steps to reproduce the issue\r\nspack install gcc\r\nmove this install to another machine, chain them together and install spack to another location and\r\nspack install gromacs\r\nmove both of these installs to another machine, chain them together and install spack to another location and so on with other packages.\r\n\r\n\r\n### Error Message\r\n```console\r\nspack --debug --stacktrace find\r\nlib/spack/spack/cmd/__init__.py:102 ==> [2020-04-09-19:23:14.668111, 16235] Imported find from built-in commands\r\nlib/spack/spack/cmd/__init__.py:102 ==> [2020-04-09-19:23:14.673901, 16235] Imported find from built-in commands\r\nlib/spack/spack/config.py:706 ==> [2020-04-09-19:23:14.721046, 16235] Reading config file /apps/spack-gcc/0.14.1/etc/spack/defaults/config.yaml\r\nlib/spack/spack/config.py:706 ==> [2020-04-09-19:23:14.749131, 16235] Reading config file /etc/spack/upstreams.yaml\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.764085, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.765357, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.778101, 16235] Warning: Missing dependency not in database: bamtools/h2vqqze needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.778506, 16235] Warning: Missing dependency not in database: libtiff/hckkiok needs libjpeg-turbo-2ebud7v\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.778896, 16235] Warning: Missing dependency not in database: libtiff/hckkiok needs xz-gqw2wk5\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.779267, 16235] Warning: Missing dependency not in database: libtiff/hckkiok needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.779614, 16235] Warning: Missing dependency not in database: gawk/bus5eyo needs gettext-kywjimc\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.779966, 16235] Warning: Missing dependency not in database: gawk/bus5eyo needs libsigsegv-5kxfqjx\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.780335, 16235] Warning: Missing dependency not in database: gawk/bus5eyo needs readline-tdxl2p5\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.780728, 16235] Warning: Missing dependency not in database: boost/jnjxzfl needs bzip2-qqpuumr\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.781084, 16235] Warning: Missing dependency not in database: boost/jnjxzfl needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.781446, 16235] Warning: Missing dependency not in database: libxslt/thyub3o needs libiconv-meyg2av\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.781784, 16235] Warning: Missing dependency not in database: libxslt/thyub3o needs libxml2-3qwzb7r\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.782183, 16235] Warning: Missing dependency not in database: libxslt/thyub3o needs xz-gqw2wk5\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.782571, 16235] Warning: Missing dependency not in database: libxslt/thyub3o needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.782913, 16235] Warning: Missing dependency not in database: htslib/4h72abe needs bzip2-qqpuumr\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.783290, 16235] Warning: Missing dependency not in database: htslib/4h72abe needs xz-gqw2wk5\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.783629, 16235] Warning: Missing dependency not in database: htslib/4h72abe needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.784024, 16235] Warning: Missing dependency not in database: samtools/pshczim needs ncurses-d62oojn\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.784462, 16235] Warning: Missing dependency not in database: samtools/pshczim needs perl-l4yk7ll\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.784808, 16235] Warning: Missing dependency not in database: samtools/pshczim needs python-ox2cghb\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.785168, 16235] Warning: Missing dependency not in database: samtools/pshczim needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.785545, 16235] Warning: Missing dependency not in database: ncbi-toolkit/5pvqtfu needs bzip2-qqpuumr\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.785910, 16235] Warning: Missing dependency not in database: ncbi-toolkit/5pvqtfu needs libjpeg-turbo-2ebud7v\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.786308, 16235] Warning: Missing dependency not in database: ncbi-toolkit/5pvqtfu needs libpng-ww6h445\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.786664, 16235] Warning: Missing dependency not in database: ncbi-toolkit/5pvqtfu needs libxml2-3qwzb7r\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.787071, 16235] Warning: Missing dependency not in database: ncbi-toolkit/5pvqtfu needs sqlite-somexfu\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.787414, 16235] Warning: Missing dependency not in database: ncbi-toolkit/5pvqtfu needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.787760, 16235] Warning: Missing dependency not in database: curl/gxxf7fx needs openssl-b7clnc6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.788148, 16235] Warning: Missing dependency not in database: curl/gxxf7fx needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.789526, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.789828, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.800999, 16235] Warning: Missing dependency not in database: sqlite/somexfu needs readline-tdxl2p5\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.801452, 16235] Warning: Missing dependency not in database: sqlite/somexfu needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.801826, 16235] Warning: Missing dependency not in database: diffutils/xeil6z2 needs libiconv-meyg2av\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.802227, 16235] Warning: Missing dependency not in database: tcl/y6ilyaa needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.802583, 16235] Warning: Missing dependency not in database: tar/idiajoa needs libiconv-meyg2av\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.803039, 16235] Warning: Missing dependency not in database: python/ialqxg6 needs gdbm-cojsnrt\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.803435, 16235] Warning: Missing dependency not in database: python/ialqxg6 needs ncurses-d62oojn\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.803778, 16235] Warning: Missing dependency not in database: python/ialqxg6 needs openssl-b7clnc6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.804138, 16235] Warning: Missing dependency not in database: python/ialqxg6 needs readline-tdxl2p5\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.804504, 16235] Warning: Missing dependency not in database: python/ialqxg6 needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.804937, 16235] Warning: Missing dependency not in database: gettext/kywjimc needs libxml2-3qwzb7r\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.805303, 16235] Warning: Missing dependency not in database: gettext/kywjimc needs ncurses-d62oojn\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.805662, 16235] Warning: Missing dependency not in database: gettext/kywjimc needs xz-gqw2wk5\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.807039, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.807328, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.815474, 16235] Warning: Missing dependency not in database: libpng/ww6h445 needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.815864, 16235] Warning: Missing dependency not in database: lammps/zwsghsz needs cuda-wfuvtmy\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.816312, 16235] Warning: Missing dependency not in database: lammps/zwsghsz needs openmpi-hfuqted\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.817319, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.817578, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.825823, 16235] Warning: Missing dependency not in database: rsync/2w5rpwi needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.826276, 16235] Warning: Missing dependency not in database: wget/u5ylqt5 needs libiconv-meyg2av\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.826636, 16235] Warning: Missing dependency not in database: wget/u5ylqt5 needs openssl-b7clnc6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.826984, 16235] Warning: Missing dependency not in database: wget/u5ylqt5 needs zlib-w4v4ex6\r\nlib/spack/spack/database.py:647 ==> [2020-04-09-19:23:14.827351, 16235] Warning: Missing dependency not in database: kraken2/z6evatv needs perl-l4yk7ll\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.828350, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.828625, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.847002, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.847376, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.860017, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.860404, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/database.py:339 ==> [2020-04-09-19:23:14.870967, 16235] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:343 ==> [2020-04-09-19:23:14.871300, 16235] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/llnl/util/lock.py:537 ==> [2020-04-09-19:23:14.899294, 16235] READ LOCK (database): /apps/spack-gcc/0.14.1/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:178 ==> [2020-04-09-19:23:14.909241, 16235] read locking [0:0]: timeout 3 sec\r\nlib/spack/llnl/util/lock.py:477 ==> [2020-04-09-19:23:14.918676, 16235] READ LOCK (database): /apps/spack-gcc/0.14.1/opt/spack/.spack-db/lock[0:0] [Acquired at 19:23:14.918301]\r\nlib/spack/llnl/util/lock.py:537 ==> [2020-04-09-19:23:14.929648, 16235] READ LOCK (database): /apps/spack-gcc/0.14.1/opt/spack/.spack-db/lock[0:0] [Releasing]\r\nlib/spack/llnl/util/lock.py:477 ==> [2020-04-09-19:23:14.938208, 16235] READ LOCK (database): /apps/spack-gcc/0.14.1/opt/spack/.spack-db/lock[0:0] [Released at 19:23:14.937820]\r\nlib/spack/spack/cmd/find.py:240 ==> [2020-04-09-19:23:14.949438, 16235] 90 installed packages\r\n-- linux-centos7-broadwell / gcc@7.4.0 --------------------------\r\nautoconf@2.69                bzip2@1.0.8    expat@2.2.9   gettext@0.20.1  htslib@1.10.2       libgcrypt@1.8.5      libsigsegv@2.12  m4@1.4.18            numactl@2.0.12  perl-exporter-tiny@1.000000     popt@1.16      sqlite@3.30.1       yasm@1.3.0\r\nautoconf-archive@2019.01.06  charmpp@6.9.0  ffmpeg@4.1.1  giflib@5.1.4    hwloc@1.11.11       libgpg-error@1.36    libtiff@4.0.10   mpfr@4.0.2           openblas@0.3.8  perl-list-moreutils@0.428       python@2.7.16  tar@1.32            zlib@1.2.11\r\nautomake@1.16.1              cmake@3.16.2   fftw@3.3.8    gmp@6.1.2       kraken2@2.0.8-beta  libiconv@1.16        libtool@2.4.6    namd@2.13            openmpi@3.1.5   perl-list-moreutils-xs@0.428    python@3.7.6   tcl@8.6.8\r\nbamtools@2.5.1               cuda@10.2.89   fftw@3.3.8    gromacs@2019.4  lammps@20190807     libjpeg-turbo@2.0.3  libxml2@2.9.9    nasm@2.14.02         openssl@1.1.1d  perl-parallel-forkmanager@1.19  readline@8.0   util-macros@1.19.1\r\nboost@1.72.0                 curl@7.68.0    gawk@5.0.1    gromacs@2019.4  libbsd@0.10.0       libpciaccess@0.13.5  libxslt@1.1.33   ncbi-toolkit@22_0_0  pcre@8.43       pkgconf@1.6.3                   rsync@3.1.3    wget@1.20.3\r\nbracken@2.5.3                diffutils@3.7  gdbm@1.18.1   gsl@2.5         libffi@3.2.1        libpng@1.6.37        lzo@2.10         ncurses@6.1          perl@5.30.1     plumed@2.5.3                    samtools@1.10  xz@5.2.4\r\n\r\n-- linux-centos7-haswell / gcc@4.8.5 ----------------------------\r\nautoconf@2.69  automake@1.16.1  gcc@7.4.0  gdbm@1.18.1  gmp@6.1.2  isl@0.18  libsigsegv@2.12  libtool@2.4.6  m4@1.4.18  mpc@1.1.0  mpfr@3.1.6  ncurses@6.1  perl@5.30.1  pkgconf@1.6.3  readline@8.0  zlib@1.2.11\r\n```\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\nThis command is an invalid choice.\r\n\r\nCentos7, Spack 0.14.1, Python 2.7.5 (from centos 7), also 2.7.16 and 3.7.6 (spack loaded)\r\n\r\nSpack has been split up into several directories and packaged as RPMs. This is due to having to build on a build server. The system where this is run is offline. Additionally builds need to take less than an hour and can't be so large the security scanner bails out. :(\r\n\r\nupstreams.yaml\r\n```\r\nupstreams:\r\n  spack-instace-1:\r\n    install_tree: /apps/spack-bracken/0.14.1/opt/spack\r\n  spack-instace-2:\r\n    install_tree: /apps/spack-gcc/0.14.1/opt/spack\r\n  spack-instace-3:\r\n    install_tree: /apps/spack-gromacs/0.14.1/opt/spack\r\n  spack-instace-4:\r\n    install_tree: /apps/spack-kraken2/0.14.1/opt/spack\r\n  spack-instace-5:\r\n    install_tree: /apps/spack-lammps/0.14.1/opt/spack\r\n  spack-instace-6:\r\n    install_tree: /apps/spack-namd/0.14.1/opt/spack\r\n  spack-instace-7:\r\n    install_tree: /apps/spack-ncbi-toolkit/0.14.1/opt/spack\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\nI am running `spack clean -a` after each build to reduce package size.",
    "performed_via_github_app": null
}