{
    "url": "https://api.github.com/repos/spack/spack/issues/3153",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/3153/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/3153/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/3153/events",
    "html_url": "https://github.com/spack/spack/issues/3153",
    "id": 207909120,
    "node_id": "MDU6SXNzdWUyMDc5MDkxMjA=",
    "number": 3153,
    "title": "spack on Cray (again)",
    "user": {
        "login": "roblatham00",
        "id": 2278417,
        "node_id": "MDQ6VXNlcjIyNzg0MTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2278417?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/roblatham00",
        "html_url": "https://github.com/roblatham00",
        "followers_url": "https://api.github.com/users/roblatham00/followers",
        "following_url": "https://api.github.com/users/roblatham00/following{/other_user}",
        "gists_url": "https://api.github.com/users/roblatham00/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/roblatham00/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/roblatham00/subscriptions",
        "organizations_url": "https://api.github.com/users/roblatham00/orgs",
        "repos_url": "https://api.github.com/users/roblatham00/repos",
        "events_url": "https://api.github.com/users/roblatham00/events{/privacy}",
        "received_events_url": "https://api.github.com/users/roblatham00/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446614485,
            "node_id": "MDU6TGFiZWw0NDY2MTQ0ODU=",
            "url": "https://api.github.com/repos/spack/spack/labels/cray",
            "name": "cray",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "mamelara",
        "id": 7441417,
        "node_id": "MDQ6VXNlcjc0NDE0MTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7441417?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mamelara",
        "html_url": "https://github.com/mamelara",
        "followers_url": "https://api.github.com/users/mamelara/followers",
        "following_url": "https://api.github.com/users/mamelara/following{/other_user}",
        "gists_url": "https://api.github.com/users/mamelara/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mamelara/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mamelara/subscriptions",
        "organizations_url": "https://api.github.com/users/mamelara/orgs",
        "repos_url": "https://api.github.com/users/mamelara/repos",
        "events_url": "https://api.github.com/users/mamelara/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mamelara/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "mamelara",
            "id": 7441417,
            "node_id": "MDQ6VXNlcjc0NDE0MTc=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7441417?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/mamelara",
            "html_url": "https://github.com/mamelara",
            "followers_url": "https://api.github.com/users/mamelara/followers",
            "following_url": "https://api.github.com/users/mamelara/following{/other_user}",
            "gists_url": "https://api.github.com/users/mamelara/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/mamelara/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mamelara/subscriptions",
            "organizations_url": "https://api.github.com/users/mamelara/orgs",
            "repos_url": "https://api.github.com/users/mamelara/repos",
            "events_url": "https://api.github.com/users/mamelara/events{/privacy}",
            "received_events_url": "https://api.github.com/users/mamelara/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "becker33",
            "id": 13971568,
            "node_id": "MDQ6VXNlcjEzOTcxNTY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/becker33",
            "html_url": "https://github.com/becker33",
            "followers_url": "https://api.github.com/users/becker33/followers",
            "following_url": "https://api.github.com/users/becker33/following{/other_user}",
            "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
            "organizations_url": "https://api.github.com/users/becker33/orgs",
            "repos_url": "https://api.github.com/users/becker33/repos",
            "events_url": "https://api.github.com/users/becker33/events{/privacy}",
            "received_events_url": "https://api.github.com/users/becker33/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 14,
    "created_at": "2017-02-15T19:49:54Z",
    "updated_at": "2017-09-11T19:23:32Z",
    "closed_at": "2017-09-11T19:23:32Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "The Argonne 'Theta' system is a little bit different from the NERSC Cray machines.    I know you've been doing a lot of work on Cray systems, so I'm working from a just-checked-out 'develop' version. \r\n\r\nspack finds a whole bunch of compilers:\r\n\r\n```% spack compilers\r\n==> Available compilers\r\n-- cce ----------------------------------------------------------\r\ncce@8.5.7  cce@8.5.5  cce@8.5.4  cce@8.5.2  cce@8.5.1  cce@8.5.0  cce@8.4.6\r\n\r\n-- gcc ----------------------------------------------------------\r\ngcc@6.3.0  gcc@6.2.0  gcc@6.1.0  gcc@5.3.0  gcc@4.9.3  gcc@4.8\r\n\r\n-- intel --------------------------------------------------------\r\nintel@17.0.1.132  intel@17.0.1  intel@17.0.0.098  intel@16.0.3.210\r\n```\r\n\r\nLet's look at something simple:\r\n\r\n```\r\n% spack spec bzip2\r\nInput spec\r\n--------------------------------\r\nbzip2\r\n\r\nNormalized\r\n--------------------------------\r\nbzip2\r\n\r\nConcretized\r\n--------------------------------\r\nbzip2@1.0.6%gcc@6.3.0+shared arch=cray-CNL-mic_knl \r\n```\r\ngreat! spack found a compiler and the arch.  Let's go!\r\n\r\n```\r\n==> Installing bzip2\r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'show' 'PrgEnv-gnu'\r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv'\r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-x1' \r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-x2' \r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-cray'                                                                               ==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-intel'                                                                              ==> Error: SyntaxError: invalid syntax (<string>, line 504)   /gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py:567, in child_execution:                                                                    547      def child_execution(child_connection, input_stream): \r\n548          try:                                                              \r\n549              setup_package(pkg, dirty=dirty)                               \r\n550              function(input_stream)                                        \r\n551              child_connection.send(None)                                    \r\n552          except StopIteration as e:                                        \r\n553              # StopIteration is used to stop installations                  \r\n554              # before the final stage, mainly for debug purposes            \r\n555              tty.msg(e.message)                                             \r\n556              child_connection.send(None)                                    \r\n557          except:                                                            \r\n558              # catch ANYTHING that goes wrong in the child process         \r\n559              exc_type, exc, tb = sys.exc_info()                           \r\n560                                                                             \r\n561              # Need to unwind the traceback in the child because traceback                                                                                  562              # objects can't be sent to the parent.                         \r\n563              tb_string = traceback.format_exc()                            \r\n564                                                                             \r\n565              # build up some context from the offending package so we can                                                                                   566              # show that, too.                                           \r\n>> 567              package_context = get_package_context(tb)                     \r\n568                                                                             \r\n569              build_log = None                                              \r\n570              if hasattr(pkg, 'log_path'):                                  \r\n571                  build_log = pkg.log_path                                  \r\n572                                                                            \r\n573              # make a pickleable exception to send to parent.              \r\n574              msg = \"%s: %s\" % (str(exc_type.__name__), str(exc))\r\n575\r\n576              ce = ChildError(msg, tb_string, build_log, package_context)\r\n577              child_connection.send(ce)\r\n578\r\n579          finally:\r\n580              child_connection.close()\r\nTraceback (most recent call last):\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 549, in child_execution \r\n    setup_package(pkg, dirty=dirty)\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 492, in setup_package   \r\n    set_compiler_environment_variables(pkg, spack_env)\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 227, in set_compiler_environment_variables\r\n    load_module(mod)\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 139, in load_module\r\n    error=str), '<string>', 'exec'))\r\n  File \"<string>\", line 504\r\n    craype-mic-knl requires cce/8.4 or later, intel/14.0 or later, or gcc/5.1 or later\r\n                          ^\r\nSyntaxError: invalid syntax\r\n```\r\n\r\nI'm not really sure what's going on here.  Definitely open to the suggestion that I did not do enough configuring -- things seemed to work automatically and I have not had to edit or create any .yaml files by hand ... yet.\r\n\r\n The error is the same as in #2359 , though I don't think for the same reason.  I also found #2572 , but that's been fixed for a few months and also does not seem to be what I'm running into either.",
    "performed_via_github_app": null
}