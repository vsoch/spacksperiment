{
    "url": "https://api.github.com/repos/spack/spack/issues/10632",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10632/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10632/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10632/events",
    "html_url": "https://github.com/spack/spack/pull/10632",
    "id": 411370692,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjUzODM0Mzcz",
    "number": 10632,
    "title": "modules: fully consider external modules.",
    "user": {
        "login": "matz-e",
        "id": 2151261,
        "node_id": "MDQ6VXNlcjIxNTEyNjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2151261?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/matz-e",
        "html_url": "https://github.com/matz-e",
        "followers_url": "https://api.github.com/users/matz-e/followers",
        "following_url": "https://api.github.com/users/matz-e/following{/other_user}",
        "gists_url": "https://api.github.com/users/matz-e/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/matz-e/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/matz-e/subscriptions",
        "organizations_url": "https://api.github.com/users/matz-e/orgs",
        "repos_url": "https://api.github.com/users/matz-e/repos",
        "events_url": "https://api.github.com/users/matz-e/events{/privacy}",
        "received_events_url": "https://api.github.com/users/matz-e/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 455855856,
            "node_id": "MDU6TGFiZWw0NTU4NTU4NTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/external-packages",
            "name": "external-packages",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        },
        {
            "id": 459174375,
            "node_id": "MDU6TGFiZWw0NTkxNzQzNzU=",
            "url": "https://api.github.com/repos/spack/spack/labels/revisit",
            "name": "revisit",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2019-02-18T09:10:01Z",
    "updated_at": "2020-08-21T11:12:29Z",
    "closed_at": "2020-08-19T08:08:06Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/10632",
        "html_url": "https://github.com/spack/spack/pull/10632",
        "diff_url": "https://github.com/spack/spack/pull/10632.diff",
        "patch_url": "https://github.com/spack/spack/pull/10632.patch"
    },
    "body": "Issue: when external packages are defined with both paths and modules, Spack exhibits a preference for the path part and drops the module part when registering the package in the database. I.e, given this Python in `packages.yaml`:\r\n```\r\n  python:\r\n    version: [3.6.5]\r\n    paths:\r\n      'python@3.6.5 +dbm~optimizations+pic+pythoncmd+shared~tk~ucs4': /our/path/to/deployment/linux-rhel7-x86_64/gcc-6.4.0/python-3.6.5-ukuow6gd2f\r\n    modules:\r\n      'python@3.6.5 +dbm~optimizations+pic+pythoncmd+shared~tk~ucs4': python/3.6\r\n```\r\nAnd installing, e.g., `py-six`, I see the following entry in the database for `python`:\r\n```\r\n      \"external\": {\r\n       \"path\": \"/our/path/to/deployment/linux-rhel7-x86_64/gcc-6.4.0/python-3.6.5-ukuow6gd2f\",\r\n       \"module\": null\r\n      },\r\n\r\n```\r\nNow if I generate modules with autoload enabled, `py-six` will not load the Python module I specified as available.\r\n\r\nThis PR changes the way external paths and modules are registered by considering both together, rather than one after another (this leads to an implicit bias for paths over modules). In addition, when generating the autoload list of modules, modules for external packages will be loaded.\r\n\r\nAny thoughts on this?",
    "performed_via_github_app": null
}