{
    "url": "https://api.github.com/repos/spack/spack/issues/20040",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/20040/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/20040/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/20040/events",
    "html_url": "https://github.com/spack/spack/issues/20040",
    "id": 748092275,
    "node_id": "MDU6SXNzdWU3NDgwOTIyNzU=",
    "number": 20040,
    "title": "Issues with the new clingo concretizer",
    "user": {
        "login": "v-dobrev",
        "id": 12926030,
        "node_id": "MDQ6VXNlcjEyOTI2MDMw",
        "avatar_url": "https://avatars.githubusercontent.com/u/12926030?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/v-dobrev",
        "html_url": "https://github.com/v-dobrev",
        "followers_url": "https://api.github.com/users/v-dobrev/followers",
        "following_url": "https://api.github.com/users/v-dobrev/following{/other_user}",
        "gists_url": "https://api.github.com/users/v-dobrev/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/v-dobrev/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/v-dobrev/subscriptions",
        "organizations_url": "https://api.github.com/users/v-dobrev/orgs",
        "repos_url": "https://api.github.com/users/v-dobrev/repos",
        "events_url": "https://api.github.com/users/v-dobrev/events{/privacy}",
        "received_events_url": "https://api.github.com/users/v-dobrev/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 14,
    "created_at": "2020-11-21T19:59:01Z",
    "updated_at": "2020-12-01T09:11:41Z",
    "closed_at": "2020-12-01T09:11:41Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\nI am trying the new concretizer and ran into two issues. (I also posted these in a thread on Slack.)\r\n\r\n### Steps to reproduce the issue\r\nThe first issue is that the clingo concretizer seems to ignore some settings from `packages.yaml` like these:\r\n```yaml\r\npackages:\r\n  netlib-lapack:\r\n    variants: +external-blas~lapacke\r\n```\r\nBasically, when I run\r\n```console\r\nspack spec -I netlib-lapack\r\n```\r\nI get\r\n```console\r\nInput spec\r\n--------------------------------\r\n -   netlib-lapack\r\n\r\nConcretized\r\n--------------------------------\r\n -   netlib-lapack@3.8.0%xl_r@16.1~external-blas~ipo~lapacke+shared~xblas build_type=RelWithDebInfo patches=0046d24487c0b7cbc84527fc36300d4e970cb4191b44e8b1619523fae15137f1,5c79286f3d08a0b0f1f3acba2a92ee698647716ba8c6c0ae20c9cc2713e6f139,ad3d41fe9ff94b7661e09fceaf2b2e4b8c83510c1465c016e161541b4429b5ee arch=linux-rhel7-power9le\r\n -       ^cmake@3.14.5%xl_r@16.1~doc+ncurses+openssl+ownlibs~qt patches=1c540040c7e203dd8e27aa20345ecb07fe06570d56410a24a266ae570b1c4c39 arch=linux-rhel7-power9le\r\n```\r\nAs you can see the spec has `~external-blas` instead of `+external-blas` as specified in `packages.yaml`.\r\n\r\nThe second issue I noticed is that sometimes variants which are off by default are enabled (without explicitly being enabled anywhere). The specific case I ran into is this:\r\n```console\r\nspack spec -I mfem\r\n```\r\nwhich gives:\r\n```console\r\nInput spec\r\n--------------------------------\r\n -   mfem\r\n\r\nConcretized\r\n--------------------------------\r\n -   mfem@4.2.0%xl_r@16.1~amgx~conduit~cuda~debug~examples~gnutls~gslib~lapack~libceed~libunwind+metis~miniapps~mpfr+mpi~netcdf~occa~openmp~petsc~pumi~raja~shared+static~strumpack~suite-sparse~sundials~superlu-dist~threadsafe~umpire+zlib cuda_arch=sm_60 timer=auto arch=linux-rhel7-power9le\r\n -       ^hypre@2.20.0%xl_r@16.1~complex~debug~int64~internal-superlu~mixedint+mpi~openmp+shared+superlu-dist patches=6e3336b1d62155f6350dfe42b0f9ea25d4fa0af60c7e540959139deb93a26059 arch=linux-rhel7-power9le\r\n -           ^netlib-lapack@3.8.0%xl_r@16.1~external-blas~ipo~lapacke+shared~xblas build_type=RelWithDebInfo patches=0046d24487c0b7cbc84527fc36300d4e970cb4191b44e8b1619523fae15137f1,5c79286f3d08a0b0f1f3acba2a92ee698647716ba8c6c0ae20c9cc2713e6f139,ad3d41fe9ff94b7661e09fceaf2b2e4b8c83510c1465c016e161541b4429b5ee arch=linux-rhel7-power9le\r\n -               ^cmake@3.14.5%xl_r@16.1~doc+ncurses+openssl+ownlibs~qt patches=1c540040c7e203dd8e27aa20345ecb07fe06570d56410a24a266ae570b1c4c39 arch=linux-rhel7-power9le\r\n[+]          ^spectrum-mpi@rolling%xl_r@16.1 arch=linux-rhel7-power9le\r\n -           ^superlu-dist@6.4.0%xl_r@16.1+cuda~int64~ipo~openmp+shared build_type=RelWithDebInfo cuda_arch=none arch=linux-rhel7-power9le\r\n[+]              ^cuda@10.1.243%xl_r@16.1 arch=linux-rhel7-power9le\r\n[+]              ^metis@5.1.0%xl_r@16.1~gdb~int64~real64+shared build_type=Release patches=4991da938c1d3a1d3dea78e49bbebecba00273f98df2a656e38b83d55b281da1 arch=linux-rhel7-power9le\r\n[+]              ^parmetis@4.0.3%xl_r@16.1~gdb~int64~ipo+shared build_type=RelWithDebInfo patches=4f892531eb0a807eb1b82e683a416d3e35154a455274cf9b162fb02054d11a5b,50ed2081bc939269689789942067c58b3e522c269269a430d5d34c00edbc5870,704b84f7c7444d4372cb59cca6e1209df4ef3b033bc4ee3cf50f369bce972a9d arch=linux-rhel7-power9le\r\n[+]      ^zlib@1.2.7%xl_r@16.1+optimize+pic+shared arch=linux-rhel7-power9le\r\n```\r\nYou can see that the variant `superlu-dist` of `hypre` is enabled while its default is off (and I do not have anything related to `mfem`, `hypre`, or `superlu-dist` in my `packages.yaml`).\r\n\r\nNote that if I run\r\n```console\r\nspack spec -I hypre\r\n```\r\nI get a spec with `superlu-dist` disabled, as expected:\r\n```console\r\nInput spec\r\n--------------------------------\r\n -   hypre\r\n\r\nConcretized\r\n--------------------------------\r\n -   hypre@2.20.0%xl_r@16.1~complex~debug~int64~internal-superlu~mixedint+mpi~openmp+shared~superlu-dist patches=6e3336b1d62155f6350dfe42b0f9ea25d4fa0af60c7e540959139deb93a26059 arch=linux-rhel7-power9le\r\n -       ^netlib-lapack@3.8.0%xl_r@16.1~external-blas~ipo~lapacke+shared~xblas build_type=RelWithDebInfo patches=0046d24487c0b7cbc84527fc36300d4e970cb4191b44e8b1619523fae15137f1,5c79286f3d08a0b0f1f3acba2a92ee698647716ba8c6c0ae20c9cc2713e6f139,ad3d41fe9ff94b7661e09fceaf2b2e4b8c83510c1465c016e161541b4429b5ee arch=linux-rhel7-power9le\r\n -           ^cmake@3.14.5%xl_r@16.1~doc+ncurses+openssl+ownlibs~qt patches=1c540040c7e203dd8e27aa20345ecb07fe06570d56410a24a266ae570b1c4c39 arch=linux-rhel7-power9le\r\n[+]      ^spectrum-mpi@rolling%xl_r@16.1 arch=linux-rhel7-power9le\r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\nN/A\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\nThe output from `spack debug report` is:\r\n```console\r\n* **Spack:** 0.16.0-34-8d5a93358\r\n* **Python:** 3.8.2\r\n* **Platform:** linux-rhel7-power9le\r\n* **Concretizer:** clingo\r\n```\r\nThese observations are from LLNL's Lassen machine with custom `packages.yaml`, `compilers.yaml`, and `config.yaml` (to enable clingo) which are all placed in `<spack-root>/etc/spack/`. I've only included above the portion of `packages.yaml` that is relevant. I can post the whole files too, if necessary.\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}