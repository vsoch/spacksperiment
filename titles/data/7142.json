{
    "url": "https://api.github.com/repos/spack/spack/issues/7142",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7142/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7142/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7142/events",
    "html_url": "https://github.com/spack/spack/issues/7142",
    "id": 293018882,
    "node_id": "MDU6SXNzdWUyOTMwMTg4ODI=",
    "number": 7142,
    "title": "Problem Building OpenBLAS on macOS",
    "user": {
        "login": "citibeth",
        "id": 1924215,
        "node_id": "MDQ6VXNlcjE5MjQyMTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1924215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/citibeth",
        "html_url": "https://github.com/citibeth",
        "followers_url": "https://api.github.com/users/citibeth/followers",
        "following_url": "https://api.github.com/users/citibeth/following{/other_user}",
        "gists_url": "https://api.github.com/users/citibeth/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/citibeth/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/citibeth/subscriptions",
        "organizations_url": "https://api.github.com/users/citibeth/orgs",
        "repos_url": "https://api.github.com/users/citibeth/repos",
        "events_url": "https://api.github.com/users/citibeth/events{/privacy}",
        "received_events_url": "https://api.github.com/users/citibeth/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2018-01-31T03:26:40Z",
    "updated_at": "2018-01-31T05:24:00Z",
    "closed_at": "2018-01-31T03:26:55Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "I cloned the latest Spack on macOS 10.13.2.  This had been prepared by installing the lates Xcode 9.2 and a pre-built gfortran 6.3 (it says macOS Sierra, but there was indication it works for High Sierra as well):\r\nhttps://gcc.gnu.org/wiki/GFortranBinaries#MacOS\r\n\r\nWhen I tried to build OpenBLAS (`spack install openblas`), I get the following error:\r\n\r\n```\r\n==> Installing openblas\r\n==> Fetching http://github.com/xianyi/OpenBLAS/archive/v0.2.20.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /Users/citibob/spack/melissa/var/spack/stage/openblas-0.2.20-a2w7heujstxj3l65sbcbonk4yh6ta55z/v0.2.20.tar.gz\r\n==> Created stage in /Users/citibob/spack/melissa/var/spack/stage/openblas-0.2.20-a2w7heujstxj3l65sbcbonk4yh6ta55z\r\n==> Applied patch make.patch\r\n==> Building openblas [MakefilePackage]\r\n==> Executing phase: 'edit'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' 'CC=/Users/citibob/spack/melissa/lib/spack/env/clang/clang' 'FC=/Users/citibob/spack/melissa/lib/spack/env/clang/gfortran' 'MAKE_NO_J=1' 'USE_OPENMP=0' 'USE_THREAD=0' 'libs' 'netlib' 'shared'\r\n\r\n4 errors found in build log:\r\n     [ ... ]\r\n     4808  ar  -ru ../../libopenblas_haswell-r0.2.20.a strtri_UU_single.o strtri_UN_single.o strtri_LU_single.o strtri_LN_single.o dtrtri_UU_single.o dtrtri_UN_single.o dtrtri_LU_single.o dtrtri_LN_single.o ctrtri_UU_single.o ctrtri_UN_single.o ctrtri_LU_single.o ctrtri_LN_single.o ztrtri_UU_single.o ztrtri_UN_single.o ztrtri_LU_single.o ztrtri_LN_single.o qtrtri_UU_single.o qtrtri_UN_single.o qtrtri_LU_single.o qtrtri_LN_single.o xtrtri_UU_single.o xtrtri_UN_single.o xtrtri_LU_single.o xtrtri_LN_single.o\r\n     4809  ( cd INSTALL; /Applications/Xcode.app/Contents/Developer/usr/bin/make )\r\n     4810  /Users/citibob/spack/melissa/lib/spack/env/clang/gfortran -O2 -m128bit-long-double -Wall -m64 -fPIC -c -o lsame.o lsame.f\r\n     4811  /Users/citibob/spack/melissa/lib/spack/env/clang/gfortran -O2 -m128bit-long-double -Wall -m64 -fPIC -c -o lsametst.o lsametst.f\r\n     4812  /Users/citibob/spack/melissa/lib/spack/env/clang/gfortran -O2 -m128bit-long-double -Wall -m64 -fPIC -lgfortran -o testlsame lsame.o lsametst.o\r\n     4813  ld: library not found for -lcrt1.10.6.o\r\n  >> 4814  collect2: error: ld returned 1 exit status\r\n  >> 4815  make[2]: *** [testlsame] Error 1\r\n  >> 4816  make[1]: *** [lapack_install] Error 2\r\n  >> 4817  make: *** [netlib] Error 2\r\n```\r\n\r\nSearching around for this error yields gfortran problems.  The solution suggested is to add an `-L` flag to the gfortran command, to make it look deep within XCode.  I did this by adding to my `compilers.yaml` file, which now looks like:\r\n\r\n```\r\ncompilers:\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: highsierra\r\n    paths:\r\n      cc: /usr/bin/clang\r\n      cxx: /usr/bin/clang++\r\n      f77: /usr/local/bin/gfortran -L/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/lib\r\n      fc: /usr/local/bin/gfortran -L/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/lib\r\n    spec: clang@9.0.0-apple\r\n    target: x86_64\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: highsierra\r\n    paths:\r\n      cc: null\r\n      cxx: null\r\n      f77: /usr/local/bin/gfortran\r\n      fc: /usr/local/bin/gfortran\r\n    spec: gcc@6.3.0\r\n    target: x86_64\r\n```\r\nSure enough, the file `crt1.10.6.o` exists in that directory.  So I built again.  Spack clearly didn't like that try:\r\n```\r\n  >> 4812  /Users/citibob/spack/melissa/lib/spack/env/clang/gfortran: line 365: exec: /usr/local/bin/gfortran -L/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk/usr/lib: cannot execute: No such file or directory\r\n```\r\n\r\nSpack needed me to set the `flags` setting in `compilers.yaml`.  A little non-intuitive, maybe, but not the end of the world...\r\n\r\nA few questions:\r\n\r\n1. Why did this not happen with a Homebrew-installed `gfortran` on another system?  A: Because Homebrew built the compiler correctly to know which Xcode directory to look into.  My binary-installed `gfortran` did not know this, so I have to help it.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nSummary\r\n\r\n### Expected Result\r\n\r\nWhat you expected\r\n\r\n### Actual Result\r\n\r\nWhat happened instead\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack <command1> <spec>\r\n$ spack <command2> <spec>\r\n...\r\n```\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\n\r\n 1. which platform you are using\r\n 2. any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.)\r\n\r\n-----\r\n\r\nWe encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack!",
    "performed_via_github_app": null
}