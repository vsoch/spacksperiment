{
    "url": "https://api.github.com/repos/spack/spack/issues/22280",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22280/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22280/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22280/events",
    "html_url": "https://github.com/spack/spack/issues/22280",
    "id": 830973656,
    "node_id": "MDU6SXNzdWU4MzA5NzM2NTY=",
    "number": 22280,
    "title": "Containerize(?) Issue: Installing Axom",
    "user": {
        "login": "vsoch",
        "id": 814322,
        "node_id": "MDQ6VXNlcjgxNDMyMg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/814322?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vsoch",
        "html_url": "https://github.com/vsoch",
        "followers_url": "https://api.github.com/users/vsoch/followers",
        "following_url": "https://api.github.com/users/vsoch/following{/other_user}",
        "gists_url": "https://api.github.com/users/vsoch/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/vsoch/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vsoch/subscriptions",
        "organizations_url": "https://api.github.com/users/vsoch/orgs",
        "repos_url": "https://api.github.com/users/vsoch/repos",
        "events_url": "https://api.github.com/users/vsoch/events{/privacy}",
        "received_events_url": "https://api.github.com/users/vsoch/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2021-03-13T19:29:26Z",
    "updated_at": "2021-03-25T23:26:09Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "We are generating containers for different packages, and just hit this error for installing axom:\r\n\r\n```bash\r\n >> 410    ld: cannot find /opt/spack/opt/spack/linux-ubuntu18.04-skylake/gcc-\r\n            7.5.0/zlib-1.2.11-fz2bs562jhc2spgubs3fvq25g3qymz6x/lib: File format\r\n             not recognized\r\n  >> 411    ld: cannot find /opt/spack/opt/spack/linux-ubuntu18.04-skylake/gcc-\r\n            7.5.0/openmpi-4.0.5-dyfjml5l47dezqpamrd526ioieumu6tw/lib: File form\r\n            at not recognized\r\n```\r\n\r\nWe generate a Dockerfile by running `spack containerize` on this spack.yaml:\r\n\r\n```yaml\r\nspack:\r\n  specs: [\"axom\"]\r\n  view: true\r\n  config:\r\n    concretizer: clingo\r\n  container:\r\n    os_packages:\r\n      build:\r\n        - python3-dev\r\n    strip: false\r\n```\r\nAnd the resulting Dockerfile:\r\n\r\n```\r\n# Build stage with Spack pre-installed and ready to be used\r\nFROM spack/ubuntu-bionic:latest as builder\r\n\r\n# Install OS packages needed to build the software\r\nRUN apt-get -yqq update && apt-get -yqq upgrade \\\r\n && apt-get -yqq install python3-dev \\\r\n && rm -rf /var/lib/apt/lists/*\r\n\r\n# What we want to install and how we want to install it\r\n# is specified in a manifest file (spack.yaml)\r\nRUN mkdir /opt/spack-environment \\\r\n&&  (echo \"spack:\" \\\r\n&&   echo \"  specs:\" \\\r\n&&   echo \"  - axom\" \\\r\n&&   echo \"  view: /opt/view\" \\\r\n&&   echo \"  config:\" \\\r\n&&   echo \"    concretizer: clingo\" \\\r\n&&   echo \"    install_tree: /opt/software\" \\\r\n&&   echo \"  concretization: together\") > /opt/spack-environment/spack.yaml\r\n\r\n# Install the software, remove unnecessary deps\r\nRUN cd /opt/spack-environment && spack env activate . && spack install --fail-fast && spack gc -y\r\n\r\n# Modifications to the environment that are necessary to run\r\nRUN cd /opt/spack-environment && \\\r\n    spack env activate --sh -d . >> /etc/profile.d/z10_spack_environment.sh\r\n\r\n\r\n# Bare OS image to run the installed executables\r\nFROM ubuntu:18.04\r\n\r\nCOPY --from=builder /opt/spack-environment /opt/spack-environment\r\nCOPY --from=builder /opt/software /opt/software\r\nCOPY --from=builder /opt/view /opt/view\r\nCOPY --from=builder /etc/profile.d/z10_spack_environment.sh /etc/profile.d/z10_spack_environment.sh\r\n\r\n\r\n\r\nENTRYPOINT [\"/bin/bash\", \"--rcfile\", \"/etc/profile\", \"-l\"]\r\n```\r\n\r\nYou can see the full output [here](https://github.com/autamus/registry/pull/14/checks?check_run_id=2101261595). I'm not sure if this is something specific to GitHub actions, but if so, we'd need to be able to customize the Dockerfile for it to work. Please let me know if we can share any other information! cc @alecbcs",
    "performed_via_github_app": null
}