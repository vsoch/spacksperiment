{
    "url": "https://api.github.com/repos/spack/spack/issues/1232",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/1232/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/1232/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/1232/events",
    "html_url": "https://github.com/spack/spack/issues/1232",
    "id": 165195990,
    "node_id": "MDU6SXNzdWUxNjUxOTU5OTA=",
    "number": 1232,
    "title": "python2 & python3 bindings fail to build for opencv",
    "user": {
        "login": "mwilliammyers",
        "id": 2526129,
        "node_id": "MDQ6VXNlcjI1MjYxMjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2526129?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mwilliammyers",
        "html_url": "https://github.com/mwilliammyers",
        "followers_url": "https://api.github.com/users/mwilliammyers/followers",
        "following_url": "https://api.github.com/users/mwilliammyers/following{/other_user}",
        "gists_url": "https://api.github.com/users/mwilliammyers/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mwilliammyers/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mwilliammyers/subscriptions",
        "organizations_url": "https://api.github.com/users/mwilliammyers/orgs",
        "repos_url": "https://api.github.com/users/mwilliammyers/repos",
        "events_url": "https://api.github.com/users/mwilliammyers/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mwilliammyers/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2016-07-12T22:25:18Z",
    "updated_at": "2016-07-13T02:03:46Z",
    "closed_at": "2016-07-13T02:02:48Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "This scenario occurs at least with the following packages in the DAG:\n`opencv 3.1.0`\n`python 2.7.11`\n`python 3.5.1`\n`py-numpy 1.11.0`\n`openblas 0.2.18`\n\nI have been working on adding `cuda` support for `opencv`and in the process noticed that the `python` bindings were not being built. I am pretty sure it has to do with `numpy` throwing the error below when python tries to load it because it can't find `libopenblas.so.0`. Openblas, by default satisfies the blas requirement for `py-numpy`...\n\n```\n-- Found PythonLibs: /apps/spack/opt/spack/linux-redhat6-x86_64/gcc-6.1.0/python-3.5.1-7mzxfy5ht65wzhbjs6ibonv5buw55umv/lib/libpython3.5m.so (found suitable exact version \"3.5.1\")\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/apps/spack/opt/spack/linux-redhat6-x86_64/gcc-6.1.0/py-numpy-1.11.0-ftvt4fx5y3xasud7lf6xyk2asjnfupcz/lib/python3.5/site-packages/numpy-1.11.0-py3.5-linux-x86_64.egg/numpy/__init__.py\", line 180, in <module>\n    from . import add_newdocs\n  File \"/apps/spack/opt/spack/linux-redhat6-x86_64/gcc-6.1.0/py-numpy-1.11.0-ftvt4fx5y3xasud7lf6xyk2asjnfupcz/lib/python3.5/site-packages/numpy-1.11.0-py3.5-linux-x86_64.egg/numpy/add_newdocs.py\", line 13, in <module>\n    from numpy.lib import add_newdoc\n  File \"/apps/spack/opt/spack/linux-redhat6-x86_64/gcc-6.1.0/py-numpy-1.11.0-ftvt4fx5y3xasud7lf6xyk2asjnfupcz/lib/python3.5/site-packages/numpy-1.11.0-py3.5-linux-x86_64.egg/numpy/lib/__init__.py\", line 8, in <module>\n    from .type_check import *\n  File \"/apps/spack/opt/spack/linux-redhat6-x86_64/gcc-6.1.0/py-numpy-1.11.0-ftvt4fx5y3xasud7lf6xyk2asjnfupcz/lib/python3.5/site-packages/numpy-1.11.0-py3.5-linux-x86_64.egg/numpy/lib/type_check.py\", line 11, in <module>\n    import numpy.core.numeric as _nx\n  File \"/apps/spack/opt/spack/linux-redhat6-x86_64/gcc-6.1.0/py-numpy-1.11.0-ftvt4fx5y3xasud7lf6xyk2asjnfupcz/lib/python3.5/site-packages/numpy-1.11.0-py3.5-linux-x86_64.egg/numpy/core/__init__.py\", line 14, in <module>\n    from . import multiarray\nImportError: libopenblas.so.0: cannot open shared object file: No such file or director\n```\n\nI have tried  various different `cmake` tricks to no avail. I have even explicitly specified `openblas` as an explicit dependency to `opencv`, which obviously is not a fix, in the hopes that `spack` would add it's paths to the environment. But that didn't work probably because `spack` doesn't use `LD_LIBRARY_PATH`s etc., instead it uses `LDLIBS` and `LDPATH` (if I am not mistaken). I have also held `cmake`'s hand a little to help it find the correct python to build by doing:\n\n```\n if spec.satisfies('^python@3:'):\n            cmake_options.append('-DBUILD_opencv_python3=ON')\n        elif spec.satisfies('^python@2:2.7.11'):\n            cmake_options.append('-DBUILD_opencv_python2=ON')\n```\n\nwhich is a more elegant solution (props to `spack`!) to what `linuxbrew` and `homebrew` do [here](https://github.com/Linuxbrew/homebrew-science/blob/71e45eca40ffee8945f38695045d0e32e2245019/opencv3.rb#L141).\n\nMaybe we could try to manually specify the python lib and includes like `linuxbrew` and `homebrew` do [here](https://github.com/Linuxbrew/homebrew-science/blob/71e45eca40ffee8945f38695045d0e32e2245019/opencv3.rb#L198)? But I would rather let `cmake` work it's magic if possible...\n\nCan anyone confirm that the python bindings (manifested with a `cv.so`) are not being built for them?\n\np.s. if you run `spack` in verbose mode you can catch whether or not `cmake` has found the correct `python2` and `python3` libs etc. when it does its usual summary print out at then of the configure step, thus saving you 8ish minutes of time...\n",
    "performed_via_github_app": null
}