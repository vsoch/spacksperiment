{
    "url": "https://api.github.com/repos/spack/spack/issues/20736",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/20736/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/20736/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/20736/events",
    "html_url": "https://github.com/spack/spack/issues/20736",
    "id": 781610434,
    "node_id": "MDU6SXNzdWU3ODE2MTA0MzQ=",
    "number": 20736,
    "title": "Clingo concretizer regression",
    "user": {
        "login": "joshessman-llnl",
        "id": 68349992,
        "node_id": "MDQ6VXNlcjY4MzQ5OTky",
        "avatar_url": "https://avatars.githubusercontent.com/u/68349992?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/joshessman-llnl",
        "html_url": "https://github.com/joshessman-llnl",
        "followers_url": "https://api.github.com/users/joshessman-llnl/followers",
        "following_url": "https://api.github.com/users/joshessman-llnl/following{/other_user}",
        "gists_url": "https://api.github.com/users/joshessman-llnl/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/joshessman-llnl/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/joshessman-llnl/subscriptions",
        "organizations_url": "https://api.github.com/users/joshessman-llnl/orgs",
        "repos_url": "https://api.github.com/users/joshessman-llnl/repos",
        "events_url": "https://api.github.com/users/joshessman-llnl/events{/privacy}",
        "received_events_url": "https://api.github.com/users/joshessman-llnl/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483390,
            "node_id": "MDU6TGFiZWw1MTI0ODMzOTA=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-medium",
            "name": "impact-medium",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 8,
    "created_at": "2021-01-07T21:07:53Z",
    "updated_at": "2021-01-13T06:23:40Z",
    "closed_at": "2021-01-13T06:23:40Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\nDiscovered while merging develop into #20657, appears to have been introduced in https://github.com/spack/spack/commit/0ce08640e08de8f7313a4b3974131e2efa5249e0\r\n\r\nUsing `clingo@master` with the standard (i.e., non-CFFI) Python module:\r\n\r\n```console\r\n$ python3 -c \"import clingo; print(hasattr(clingo.Symbol, '_rep'), clingo.__version__)\" \r\nFalse 5.5.0 # False means non-CFFI\r\n$ git checkout 49ac3471cf97f5308c648a78a9fd7b0c3a083e90\r\n$ ./bin/spack spec -I libxml2+python\r\n# concretizes....\r\n$ git checkout 0ce08640e08de8f7313a4b3974131e2efa5249e0 \r\n$ ./bin/spack spec -I libxml2+python\r\nInput spec\r\n--------------------------------\r\n-   libxml2+python\r\nConcretized\r\n--------------------------------\r\n==> Error: 'sqlite'\r\n```\r\n\r\nResult of `git diff` in the spack repo:\r\n```diff\r\ndiff --git a/etc/spack/defaults/config.yaml b/etc/spack/defaults/config.yaml\r\nindex d1a7f35a6d..e8147838b6 100644\r\n--- a/etc/spack/defaults/config.yaml\r\n+++ b/etc/spack/defaults/config.yaml\r\n@@ -160,7 +160,7 @@ config:\r\n   #\r\n   # 'clingo' currently requires the clingo ASP solver to be installed and\r\n   # built with python bindings. 'original' is built in.\r\n-  concretizer: original\r\n+  concretizer: clingo\r\n\r\n\r\n   # How long to wait to lock the Spack installation database. This lock is used\r\ndiff --git a/etc/spack/defaults/packages.yaml b/etc/spack/defaults/packages.yaml\r\nindex bf9148315b..9eacff87c6 100644\r\n--- a/etc/spack/defaults/packages.yaml\r\n+++ b/etc/spack/defaults/packages.yaml\r\n@@ -53,3 +53,9 @@ packages:\r\n    permissions:\r\n      read: world\r\n      write: user\r\n+  python:\r\n+    version: [3.8.2]\r\n+    buildable: false\r\n+    externals:\r\n+    - spec: python@3.8.2\r\n+      prefix: /usr \r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\n\r\n```console\r\n$ spack spec -I libxml2+python\r\nTraceback (most recent call last):\r\n  File \"./bin/spack\", line 68, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"spack/lib/spack/spack/main.py\", line 762, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"spack/lib/spack/spack/main.py\", line 490, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"spack/lib/spack/spack/cmd/spec.py\", line 102, in spec\r\n    spec.concretize()\r\n  File \"spack/lib/spack/spack/spec.py\", line 2528, in concretize\r\n    self._new_concretize(tests)\r\n  File \"spack/lib/spack/spack/spec.py\", line 2498, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests)\r\n  File \"spack/lib/spack/spack/solver/asp.py\", line 1625, in solve\r\n    return driver.solve(setup, specs, dump, models, timers, stats, tests)\r\n  File \"spack/lib/spack/spack/solver/asp.py\", line 362, in solve\r\n    answers = builder.build_specs(tuples)\r\n  File \"spack/lib/spack/spack/solver/asp.py\", line 1549, in build_specs\r\n    action(*args)\r\n  File \"spack/lib/spack/spack/solver/asp.py\", line 1429, in version\r\n    self._specs[pkg].versions = spack.version.ver([version])\r\nKeyError: 'sqlite'\r\n```\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n* **Spack:** 0.16.0-440-0ce08640e0                                                                                                                                                                                  * **Python:** 3.8.5                                                                                                                                                                                                 * **Platform:** linux-ubuntu20.04-skylake                                                                                                                                                                           * **Concretizer:** clingo   \r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}