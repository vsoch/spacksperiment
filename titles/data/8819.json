{
    "url": "https://api.github.com/repos/spack/spack/issues/8819",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8819/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8819/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8819/events",
    "html_url": "https://github.com/spack/spack/pull/8819",
    "id": 345414921,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjA0NTc0MzE3",
    "number": 8819,
    "title": "Even better Makefile target parsing",
    "user": {
        "login": "adamjstewart",
        "id": 12021217,
        "node_id": "MDQ6VXNlcjEyMDIxMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjstewart",
        "html_url": "https://github.com/adamjstewart",
        "followers_url": "https://api.github.com/users/adamjstewart/followers",
        "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
        "repos_url": "https://api.github.com/users/adamjstewart/repos",
        "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 624275116,
            "node_id": "MDU6TGFiZWw2MjQyNzUxMTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/makefile",
            "name": "makefile",
            "color": "b60205",
            "default": false,
            "description": null
        },
        {
            "id": 456341797,
            "node_id": "MDU6TGFiZWw0NTYzNDE3OTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/tests",
            "name": "tests",
            "color": "b60205",
            "default": false,
            "description": "General test capability(ies)"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 23,
    "created_at": "2018-07-28T03:43:20Z",
    "updated_at": "2018-08-22T09:14:40Z",
    "closed_at": "2018-08-20T21:42:28Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/8819",
        "html_url": "https://github.com/spack/spack/pull/8819",
        "diff_url": "https://github.com/spack/spack/pull/8819.diff",
        "patch_url": "https://github.com/spack/spack/pull/8819.patch"
    },
    "body": "This is a continuation of #8223.\r\n\r\nIn #8818, @SteVwonder discovered a bug in my implementation. For reasons I still don't fully understand, `make -q` does not work as documented. This can easily be reproduced with the `libsigsegv` package, which does not have any dependencies. Outside of Spack, we can see that `make check` works fine, but `make -q check` crashes:\r\n```console\r\n$ make -q check\r\nMaking check in src\r\nMaking check in tests\r\n/Applications/Xcode.app/Contents/Developer/usr/bin/make  check-TESTS\r\nmake[1]: *** [check-am] Error 1\r\nmake: *** [check-recursive] Error 1\r\n$ echo $?\r\n2\r\n$ make check\r\nMaking check in src\r\nmake[1]: Nothing to be done for `check'.\r\nMaking check in tests\r\n/Applications/Xcode.app/Contents/Developer/usr/bin/make  check-TESTS\r\nPASS: sigsegv1\r\nPASS: sigsegv2\r\nPASS: sigsegv3\r\nPASS: stackoverflow1\r\nPASS: stackoverflow2\r\n============================================================================\r\nTestsuite summary for \r\n============================================================================\r\n# TOTAL: 5\r\n# PASS:  5\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  0\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\n\r\nNow please type 'make install' to install the package.\r\n$ echo $?\r\n0\r\n```\r\nThe error code for `make -q` was also unreliable, it only worked for GNU Make, not BSD Make.\r\n\r\nThe new implementation ignores the exit code and instead parses STDERR for any indications that the target does not exist. This works for both GNU Make and BSD Make.\r\n\r\nI switched from `make -q` to `make -n`. It works similarly to `make -q` (it doesn't actually run anything, just prints what would be run). The only difference is that `make -q` doesn't print an error message when using BSD Make, but `make -n` does.\r\n\r\n@SteVwonder would you mind testing this with #8818?\r\n\r\nCloses #8604",
    "performed_via_github_app": null
}