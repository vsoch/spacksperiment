{
    "url": "https://api.github.com/repos/spack/spack/issues/2028",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2028/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2028/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2028/events",
    "html_url": "https://github.com/spack/spack/pull/2028",
    "id": 183236009,
    "node_id": "MDExOlB1bGxSZXF1ZXN0ODk1MDgzMzY=",
    "number": 2028,
    "title": "Ignore GPG/PGP signatures/checksums when finding available downloads",
    "user": {
        "login": "adamjstewart",
        "id": 12021217,
        "node_id": "MDQ6VXNlcjEyMDIxMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjstewart",
        "html_url": "https://github.com/adamjstewart",
        "followers_url": "https://api.github.com/users/adamjstewart/followers",
        "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
        "repos_url": "https://api.github.com/users/adamjstewart/repos",
        "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2016-10-15T22:12:57Z",
    "updated_at": "2016-10-16T21:46:30Z",
    "closed_at": "2016-10-16T21:46:30Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/2028",
        "html_url": "https://github.com/spack/spack/pull/2028",
        "diff_url": "https://github.com/spack/spack/pull/2028.diff",
        "patch_url": "https://github.com/spack/spack/pull/2028.patch"
    },
    "body": "Fixes #282.\n\nPreviously, Spack was picking up GPG/PGP signatures/checksums when finding available downloads. This affected `spack versions`:\n\n```\n$ spack versions emacs\n==> Safe versions (already checksummed):\n  24.5\n==> Remote versions (not yet checksummed):\n  25.1.tar.gz.sig  24.4.tar.gz.sig  24.3             24.1.tar.gz.sig  23.4              23.2b.tar.gz.sig  23.1             22.2.tar.gz.sig  22.1\n  25.1             24.4             24.2.tar.gz.sig  24.1             23.3b.tar.gz.sig  23.2b             22.3.tar.gz.sig  22.2             21.4a.tar.gz.sig\n  24.5.tar.gz.sig  24.3.tar.gz.sig  24.2             23.4.tar.gz.sig  23.3b             23.1.tar.gz.sig   22.3             22.1.tar.gz.sig  21.4a\n```\n\nIt affected `spack checksum`:\n\n```\n$ spack checksum emacs\n==> Found 28 versions of emacs\n  25.1.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz.sig\n  25.1      http://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz\n  24.5.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.5.tar.gz.sig\n  24.5      http://ftp.gnu.org/gnu/emacs/emacs-24.5.tar.gz\n  24.4.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.4.tar.gz.sig\n  24.4      http://ftp.gnu.org/gnu/emacs/emacs-24.4.tar.gz\n  24.3.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.3.tar.gz.sig\n  24.3      http://ftp.gnu.org/gnu/emacs/emacs-24.3.tar.gz\n  24.2.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.2.tar.gz.sig\n  ...\n  21.4a     http://ftp.gnu.org/gnu/emacs/emacs-21.4a.tar.gz\n```\n\nAnd most annoyingly, it affected `spack create`:\n\n```\n$ spack create http://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz\n==> This looks like a URL for emacs version 25.1\n==> Creating template for package emacs\n==> Found 28 versions of emacs:\n  25.1.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz.sig\n  25.1      http://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz\n  24.5.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.5.tar.gz.sig\n  24.5      http://ftp.gnu.org/gnu/emacs/emacs-24.5.tar.gz\n  24.4.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.4.tar.gz.sig\n  24.4      http://ftp.gnu.org/gnu/emacs/emacs-24.4.tar.gz\n  24.3.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.3.tar.gz.sig\n  24.3      http://ftp.gnu.org/gnu/emacs/emacs-24.3.tar.gz\n  24.2.tar.gz.sighttp://ftp.gnu.org/gnu/emacs/emacs-24.2.tar.gz.sig\n  ...\n  21.4a     http://ftp.gnu.org/gnu/emacs/emacs-21.4a.tar.gz\n\nInclude how many checksums in the package file? (default is 5, q to abort) 2\n==> Downloading...\n==> Trying to fetch from http://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz.sig\n######################################################################## 100.0%\ntar: Unrecognized archive format\ntar: Error exit delayed from previous errors.\n==> Trying to fetch from http://ftp.gnu.org/gnu/emacs/emacs-25.1.tar.gz\n######################################################################## 100.0%\n```\n\nThis would result in a `package.py` that looks like:\n\n```\nclass Emacs(Package):                                                           \n    ...                                                                         \n    version('25.1.tar.gz.sig', '8d459795bcf4754c279dc83f0a930c0a')              \n    version('25.1'           , '95c12e6a9afdf0dcbdd7d2efa26ca42c')              \n\n    # FIXME: Add dependencies if required.                                      \n    # depends_on('foo')                                                         \n\n    def install(self, spec, prefix):                                            \n        # FIXME: Unknown build system                                           \n        make()                                                                  \n        make('install')\n```\n\nThe following keys were erroneously being picked up:\n\n```\n.asc\n.back\n.md5\n.md5.txt\n.mds\n.minisig\n.old\n.sha1\n.sha1.asc\n.sha1.txt\n.sha256\n.sha256.asc\n.sha256.txt\n.sha256sum\n.sha512\n.sig\n.sign\n.smime\n.torrent\n```\n\nMost would show up as `1.2.3.tar.gz.sig`, although keys like `.md5` and `.sha256` would show up as versions `5` and `256`. By my count, this bug affected 155 out of 998 packages (15%).\n\nThis PR adds a `$` anchor to the end of the url regex. Unfortunately, SourceForge downloads end in `1.2.3.tar.gz/download`, so I had to allow that as well.\n\nI tested these changes by diffing the output of the following script before and after the change:\n\n```\n#!/usr/bin/env bash                                                             \n\noutput=versions-download-dollar.txt                                             \nrm -f $output                                                                   \n\n# Without this, Ctrl+C will kill Spack, not the script,                         \n# meaning that the script continues running forever.                            \ntrap \"exit\" SIGINT                                                              \n\nfor package in $(spack list)                                                    \ndo                                                                              \n    echo $package | tee -a $output                                              \n    spack versions $package 2>&1 | tee -a $output                               \ndone          \n```\n\nThe result is that all 155 packages have now been corrected. I only found 2 cases where the changes negatively improved version finding abilities (`paraview` and `qhull` both found 1 fewer version). Aside from that, I think it's an overwhelming success!\n\nI tested `spack versions` on every package, but I only tested `spack checksum`, `spack create`, and `spack fetch` on a couple packages, so feel free to test it out yourself. Let me know if you want me to provide the before and after results from the script above.\n",
    "performed_via_github_app": null
}