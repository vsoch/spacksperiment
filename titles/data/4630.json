{
    "url": "https://api.github.com/repos/spack/spack/issues/4630",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/4630/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/4630/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/4630/events",
    "html_url": "https://github.com/spack/spack/issues/4630",
    "id": 239201122,
    "node_id": "MDU6SXNzdWUyMzkyMDExMjI=",
    "number": 4630,
    "title": "HDF5 installation with Intel compiler 17.0.4 and Intel MPI 2017.3",
    "user": {
        "login": "ssergien",
        "id": 29131088,
        "node_id": "MDQ6VXNlcjI5MTMxMDg4",
        "avatar_url": "https://avatars.githubusercontent.com/u/29131088?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ssergien",
        "html_url": "https://github.com/ssergien",
        "followers_url": "https://api.github.com/users/ssergien/followers",
        "following_url": "https://api.github.com/users/ssergien/following{/other_user}",
        "gists_url": "https://api.github.com/users/ssergien/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ssergien/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ssergien/subscriptions",
        "organizations_url": "https://api.github.com/users/ssergien/orgs",
        "repos_url": "https://api.github.com/users/ssergien/repos",
        "events_url": "https://api.github.com/users/ssergien/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ssergien/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 477156668,
            "node_id": "MDU6TGFiZWw0NzcxNTY2Njg=",
            "url": "https://api.github.com/repos/spack/spack/labels/intel",
            "name": "intel",
            "color": "127cc1",
            "default": false,
            "description": null
        },
        {
            "id": 459210887,
            "node_id": "MDU6TGFiZWw0NTkyMTA4ODc=",
            "url": "https://api.github.com/repos/spack/spack/labels/mpi",
            "name": "mpi",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 17,
    "created_at": "2017-06-28T15:21:17Z",
    "updated_at": "2017-08-16T17:21:08Z",
    "closed_at": "2017-08-16T17:21:08Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I was trying to install hdf5+mpi with Intel@17.0.4 and ^intel-mpi@2017.3. \r\n\r\nThe install failed with:\r\n```\r\nhyper.f90(19): (col. 12) remark: hyper_ has been targeted for automatic cpu dispatch\r\nmdset.f90(19): (col. 12) remark: multiple_dset_write_ has been targeted for automatic cpu dispatch\r\nptest.f90(20): error #7013: This module file was not generated by any release of this compiler.   [MPI]\r\n  USE MPI\r\n------^\r\nptest.f90(44): error #6404: This name does not have a type, and must have an explicit type.   [MPI_SUCCESS]\r\n  IF (mpierror .NE. MPI_SUCCESS) THEN\r\n--------------------^\r\nptest.f90(47): error #6404: This name does not have a type, and must have an explicit type.   [MPI_COMM_WORLD]\r\n  CALL mpi_comm_rank( MPI_COMM_WORLD, mpi_rank, mpierror )\r\n----------------------^\r\ncompilation aborted for ptest.f90 (code 1)\r\nmake[2]: *** [ptest.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nmake[2]: Leaving directory `/tmp/ssergien/spack-stage/spack-stage-QL8dRp/hdf5-1.10.1/fortran/testpar'\r\nmake[1]: *** [all-recursive] Error 1\r\nmake[1]: Leaving directory `/tmp/ssergien/spack-stage/spack-stage-QL8dRp/hdf5-1.10.1/fortran'\r\nmake: *** [all-recursive] Error 1\r\n```\r\nThen we changed the compilers in intel-mpi spec file from mpicc, mpicxx and mpif90 to mpiicc, mpiicpc and mpiifort:\r\n```python\r\n def setup_dependent_package(self, module, dep_spec):\r\n        bindir = self.prefix.compilers_and_libraries.linux.mpi.intel64.bin\r\n\r\n        self.spec.mpicc  = bindir.mpiicc\r\n        self.spec.mpicxx = bindir.mpiicpc\r\n        self.spec.mpifc  = bindir.mpiifort\r\n        self.spec.mpif77 = bindir.mpiifort\r\n```\r\nInstallation worked fine.\r\n\r\nThen I switched back to mpicc, mpicxx, and mpif90. And restarted install with `-d` flag. Here is what I noticed:\r\n```\r\ncompiler '/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mpi-2017.3-dfphq6kavje2olnichisvjjndtridrok/compilers_and_libraries/linux/mpi/intel64/bin/mpicc' is Intel icc-17.0.4.193\r\ncompiler '/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mpi-2017.3-dfphq6kavje2olnichisvjjndtridrok/compilers_and_libraries/linux/mpi/intel64/bin/mpif90' is Intel ifort-17.0.4.193\r\ncompiler '/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mpi-2017.3-dfphq6kavje2olnichisvjjndtridrok/compilers_and_libraries/linux/mpi/intel64/bin/mpicxx' is GNU g++-4.8.5\r\n```\r\nFor some reason mpicxx picks up the GNU compiler instead of intel.\r\n\r\n",
    "performed_via_github_app": null
}