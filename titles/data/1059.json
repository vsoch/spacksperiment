{
    "url": "https://api.github.com/repos/spack/spack/issues/1059",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/1059/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/1059/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/1059/events",
    "html_url": "https://github.com/spack/spack/pull/1059",
    "id": 160403458,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NzM4OTc3OTg=",
    "number": 1059,
    "title": "MPI : have wrappers set RPATH instead of RUNPATH",
    "user": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 11,
    "created_at": "2016-06-15T11:52:23Z",
    "updated_at": "2016-06-20T17:47:25Z",
    "closed_at": "2016-06-20T17:47:24Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/1059",
        "html_url": "https://github.com/spack/spack/pull/1059",
        "diff_url": "https://github.com/spack/spack/pull/1059.diff",
        "patch_url": "https://github.com/spack/spack/pull/1059.patch"
    },
    "body": "##### Modifications :\n- [x] removed `-Wl,--enable-new-dtags` from wrappers\n- [x] reworked `filter_compilers` in `openmpi/package.py`\n- [x] turned `os.environ` into `env` and `os.path.join` into `join_path`\n##### Details\n\nI noticed that all the MPI wrappers set `RUNPATH` instead of `RPATH` due to `-Wl,--enable-new-dtags` being present in the wrappers.  This PR filter that flag out of wrappers so that `RPATH` is set correctly.\n##### Example\n\nOn our clusters : \n\n```\n$ spack load mvapich2\n$ mpicc -Wall -Werror main.c\n$ objdump -p a.out \n\na.out:     file format elf64-x86-64\n\nProgram Header:\n    PHDR off    0x0000000000000040 vaddr 0x0000000000400040 paddr 0x0000000000400040 align 2**3\n         filesz 0x00000000000001c0 memsz 0x00000000000001c0 flags r-x\n  INTERP off    0x0000000000000200 vaddr 0x0000000000400200 paddr 0x0000000000400200 align 2**0\n         filesz 0x000000000000001c memsz 0x000000000000001c flags r--\n    LOAD off    0x0000000000000000 vaddr 0x0000000000400000 paddr 0x0000000000400000 align 2**21\n         filesz 0x0000000000000c5c memsz 0x0000000000000c5c flags r-x\n    LOAD off    0x0000000000000c60 vaddr 0x0000000000600c60 paddr 0x0000000000600c60 align 2**21\n         filesz 0x0000000000000290 memsz 0x0000000000000298 flags rw-\n DYNAMIC off    0x0000000000000c78 vaddr 0x0000000000600c78 paddr 0x0000000000600c78 align 2**3\n         filesz 0x0000000000000200 memsz 0x0000000000000200 flags rw-\n    NOTE off    0x000000000000021c vaddr 0x000000000040021c paddr 0x000000000040021c align 2**2\n         filesz 0x0000000000000020 memsz 0x0000000000000020 flags r--\nEH_FRAME off    0x0000000000000b8c vaddr 0x0000000000400b8c paddr 0x0000000000400b8c align 2**2\n         filesz 0x000000000000002c memsz 0x000000000000002c flags r--\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**4\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\n\nDynamic Section:\n  NEEDED               libmpi.so.12\n  NEEDED               libpmi2.so.0\n  NEEDED               libc.so.6\n  RUNPATH              /ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-4.4.7/gcc-5.3.0-eljjnfv6gzibirz5sorgas3bp5okusae/lib:/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-4.4.7/gcc-5.3.0-eljjnfv6gzibirz5sorgas3bp5okusae/lib64:/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/lib\n  INIT                 0x0000000000400830\n  FINI                 0x0000000000400b6c\n  INIT_ARRAY           0x0000000000600c60\n  INIT_ARRAYSZ         0x0000000000000008\n  FINI_ARRAY           0x0000000000600c68\n  FINI_ARRAYSZ         0x0000000000000008\n  HASH                 0x0000000000400240\n  STRTAB               0x00000000004004a0\n  SYMTAB               0x00000000004002d8\n  STRSZ                0x0000000000000258\n  SYMENT               0x0000000000000018\n  DEBUG                0x0000000000000000\n  PLTGOT               0x0000000000600e80\n  PLTRELSZ             0x00000000000000d8\n  PLTREL               0x0000000000000007\n  JMPREL               0x0000000000400758\n  RELA                 0x0000000000400740\n  RELASZ               0x0000000000000018\n  RELAENT              0x0000000000000018\n  VERNEED              0x0000000000400720\n  VERNEEDNUM           0x0000000000000001\n  VERSYM               0x00000000004006f8\n\nVersion References:\n  required from libc.so.6:\n    0x09691a75 0x00 02 GLIBC_2.2.5\n\n$ mpicc -show\n/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-4.4.7/gcc-5.3.0-eljjnfv6gzibirz5sorgas3bp5okusae/bin/gcc -I/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/include -L/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/lib -Wl,-rpath -Wl,/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/lib -Wl,--enable-new-dtags -lmpi -lpmi2\n\n$ /ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-4.4.7/gcc-5.3.0-eljjnfv6gzibirz5sorgas3bp5okusae/bin/gcc -I/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/include -L/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/lib -Wl,-rpath -Wl,/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/lib  -lmpi -lpmi2 main.c\n\n$ objdump -p a.out \n\na.out:     file format elf64-x86-64\n\nProgram Header:\n    PHDR off    0x0000000000000040 vaddr 0x0000000000400040 paddr 0x0000000000400040 align 2**3\n         filesz 0x00000000000001c0 memsz 0x00000000000001c0 flags r-x\n  INTERP off    0x0000000000000200 vaddr 0x0000000000400200 paddr 0x0000000000400200 align 2**0\n         filesz 0x000000000000001c memsz 0x000000000000001c flags r--\n    LOAD off    0x0000000000000000 vaddr 0x0000000000400000 paddr 0x0000000000400000 align 2**21\n         filesz 0x0000000000000c5c memsz 0x0000000000000c5c flags r-x\n    LOAD off    0x0000000000000c60 vaddr 0x0000000000600c60 paddr 0x0000000000600c60 align 2**21\n         filesz 0x0000000000000290 memsz 0x0000000000000298 flags rw-\n DYNAMIC off    0x0000000000000c78 vaddr 0x0000000000600c78 paddr 0x0000000000600c78 align 2**3\n         filesz 0x0000000000000200 memsz 0x0000000000000200 flags rw-\n    NOTE off    0x000000000000021c vaddr 0x000000000040021c paddr 0x000000000040021c align 2**2\n         filesz 0x0000000000000020 memsz 0x0000000000000020 flags r--\nEH_FRAME off    0x0000000000000b8c vaddr 0x0000000000400b8c paddr 0x0000000000400b8c align 2**2\n         filesz 0x000000000000002c memsz 0x000000000000002c flags r--\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**4\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\n\nDynamic Section:\n  NEEDED               libmpi.so.12\n  NEEDED               libpmi2.so.0\n  NEEDED               libc.so.6\n  RPATH                /ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-4.4.7/gcc-5.3.0-eljjnfv6gzibirz5sorgas3bp5okusae/lib:/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-4.4.7/gcc-5.3.0-eljjnfv6gzibirz5sorgas3bp5okusae/lib64:/ssoft/spack/develop/opt/spack/x86_E5v2_IntelIB/gcc-5.3.0/mvapich2-2.2b-6qz3ze5ipeoe5hq2k7spe37scey6uoxf/lib\n  INIT                 0x0000000000400830\n  FINI                 0x0000000000400b6c\n  INIT_ARRAY           0x0000000000600c60\n  INIT_ARRAYSZ         0x0000000000000008\n  FINI_ARRAY           0x0000000000600c68\n  FINI_ARRAYSZ         0x0000000000000008\n  HASH                 0x0000000000400240\n  STRTAB               0x00000000004004a0\n  SYMTAB               0x00000000004002d8\n  STRSZ                0x0000000000000258\n  SYMENT               0x0000000000000018\n  DEBUG                0x0000000000000000\n  PLTGOT               0x0000000000600e80\n  PLTRELSZ             0x00000000000000d8\n  PLTREL               0x0000000000000007\n  JMPREL               0x0000000000400758\n  RELA                 0x0000000000400740\n  RELASZ               0x0000000000000018\n  RELAENT              0x0000000000000018\n  VERNEED              0x0000000000400720\n  VERNEEDNUM           0x0000000000000001\n  VERSYM               0x00000000004006f8\n\nVersion References:\n  required from libc.so.6:\n    0x09691a75 0x00 02 GLIBC_2.2.5\n\n```\n",
    "performed_via_github_app": null
}