{
    "url": "https://api.github.com/repos/spack/spack/issues/21418",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/21418/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/21418/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/21418/events",
    "html_url": "https://github.com/spack/spack/issues/21418",
    "id": 798219281,
    "node_id": "MDU6SXNzdWU3OTgyMTkyODE=",
    "number": 21418,
    "title": "OpenEuler failed to test the  p4est@2.2 self-test case.",
    "user": {
        "login": "Tom-python0121",
        "id": 77763324,
        "node_id": "MDQ6VXNlcjc3NzYzMzI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/77763324?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Tom-python0121",
        "html_url": "https://github.com/Tom-python0121",
        "followers_url": "https://api.github.com/users/Tom-python0121/followers",
        "following_url": "https://api.github.com/users/Tom-python0121/following{/other_user}",
        "gists_url": "https://api.github.com/users/Tom-python0121/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/Tom-python0121/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Tom-python0121/subscriptions",
        "organizations_url": "https://api.github.com/users/Tom-python0121/orgs",
        "repos_url": "https://api.github.com/users/Tom-python0121/repos",
        "events_url": "https://api.github.com/users/Tom-python0121/events{/privacy}",
        "received_events_url": "https://api.github.com/users/Tom-python0121/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2021-02-01T10:39:55Z",
    "updated_at": "2021-02-02T11:37:09Z",
    "closed_at": "2021-02-02T11:37:09Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\nI am having trouble about openEuler failed to test the p4est@2.2 self-test case\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n[root@openEuler ~]#spack install -v --keep-stage openmpi@4.0.3\r\n[root@openEuler ~]#spack install -v --keep-stage p4est@2.2^openmpi@4.0.3\r\n[root@openEuler ~]#spack cd p4est@2.2^openmpi@4.0.3\r\n[root@openEuler spack-src]#spack load openmpi@4.0.3\r\n[root@openEuler spack-src]#spack load p4est@2.2^openmpi@4.0.3\r\n[root@openEuler spack-src]#export OMPI_ALLOW_RUN_AS_ROOT=1\r\n[root@openEuler spack-src]#export OMPI_ALLOW_RUN_AS_ROOT_CONFIRM=1\r\n[root@openEuler spack-src]#make check\r\nMaking check in sc\r\nmake[1]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake  test/sc_test_allgather test/sc_test_arrays test/sc_test_builtin test/sc_test_darray_work test/sc_test_dmatrix test/sc_test_dmatrix_pool test/sc_test_io_sink test/sc_test_keyvalue test/sc_test_node_comm test/sc_test_notify test/sc_test_reduce test/sc_test_search test/sc_test_sort test/sc_test_sortb\r\nmake[2]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake[2]: 'test/sc_test_allgather' is up to date.\r\nmake[2]: 'test/sc_test_arrays' is up to date.\r\ndepbase=`echo test/test_builtin.o | sed 's|[^/]*$|.deps/&|;s|\\.o$||'`;\\\r\n/home/spack/opt/spack/linux-openeuler20-aarch64/gcc-7.3.0/openmpi-3.1.6-aa3tfoswi3mfcgcjkf2hkplux6rikngn/bin/mpicc -DHAVE_CONFIG_H -I. -I./src  -I./src -DSC_LOG_PRIORITY=SC_LP_ESSENTIAL  -O2 -MT test/test_builtin.o -MD -MP -MF $depbase.Tpo -c -o test/test_builtin.o test/test_builtin.c &&\\\r\nmv -f $depbase.Tpo $depbase.Po\r\ntest/test_builtin.c: In function \u2018test_lua\u2019:\r\ntest/test_builtin.c:133:3: error: unknown type name \u2018lua_State\u2019; did you mean \u2018MPI_Status\u2019?\r\n   lua_State          *L = luaL_newstate ();\r\n   ^~~~~~~~~\r\n   MPI_Status\r\ntest/test_builtin.c:133:27: warning: implicit declaration of function \u2018luaL_newstate\u2019 [-Wimplicit-function-declaration]\r\n   lua_State          *L = luaL_newstate ();\r\n                           ^~~~~~~~~~~~~\r\ntest/test_builtin.c:133:27: warning: initialization makes pointer from integer without a cast [-Wint-conversion]\r\ntest/test_builtin.c:135:3: warning: implicit declaration of function \u2018lua_close\u2019; did you mean \u2018gzclose\u2019? [-Wimplicit-function-declaration]\r\n   lua_close (L);\r\n   ^~~~~~~~~\r\n   gzclose\r\nmake[2]: *** [Makefile:1693: test/test_builtin.o] Error 1\r\nmake[2]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake[1]: *** [Makefile:2640: check-am] Error 2\r\nmake[1]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake: *** [Makefile:3792: check-recursive] Error 1\r\n[root@openEuler spack-src]# vim sc/test/test_builtin.c\r\n-34 #ifdef SC_HAVE_LUA\r\n 35 #include <sc_lua.h>\r\n 36 #endif\r\n\r\n+34 #ifndef SC_HAVE_LUA\r\n 35 #include <sc_lua.h>\r\n 36 #endif\r\n\r\n-128 #ifdef SC_HAVE_LUA\r\n130 static int\r\n131 test_lua (void)\r\n132 {\r\n133   lua_State          *L = luaL_newstate ();\r\n134\r\n135   lua_close (L);\r\n136\r\n137   return 0;\r\n138 }\r\n139\r\n140 #endif /* SC_HAVE_LUA */\r\n\r\n+128 #ifndef SC_HAVE_LUA\r\n130 static int\r\n131 test_lua (void)\r\n132 {\r\n133   lua_State          *L = luaL_newstate ();\r\n134\r\n135   lua_close (L);\r\n136\r\n137   return 0;\r\n138 }\r\n139\r\n140 #endif /* SC_HAVE_LUA */\r\n\r\n-154 #ifdef SC_HAVE_LUA\r\n155   num_errors += test_lua ();\r\n156 #endif\r\n\r\n+154 #ifndef SC_HAVE_LUA\r\n155   num_errors += test_lua ();\r\n156 #endif\r\n[root@openEuler spack-src]# make check\r\nMaking check in sc\r\nmake[1]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake  test/sc_test_allgather test/sc_test_arrays test/sc_test_builtin test/sc_test_darray_work test/sc_test_dmatrix test/sc_test_dmatrix_pool test/sc_test_io_sink test/sc_test_keyvalue test/sc_test_node_comm test/sc_test_notify test/sc_test_reduce test/sc_test_search test/sc_test_sort test/sc_test_sortb\r\nmake[2]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake[2]: 'test/sc_test_allgather' is up to date.\r\nmake[2]: 'test/sc_test_arrays' is up to date.\r\ndepbase=`echo test/test_builtin.o | sed 's|[^/]*$|.deps/&|;s|\\.o$||'`;\\\r\n/home/spack/opt/spack/linux-openeuler20-aarch64/gcc-7.3.0/openmpi-3.1.6-aa3tfoswi3mfcgcjkf2hkplux6rikngn/bin/mpicc -DHAVE_CONFIG_H -I. -I./src  -I./src -DSC_LOG_PRIORITY=SC_LP_ESSENTIAL  -O2 -MT test/test_builtin.o -MD -MP -MF $depbase.Tpo -c -o test/test_builtin.o test/test_builtin.c &&\\\r\nmv -f $depbase.Tpo $depbase.Po\r\n/bin/sh ./libtool  --tag=CC   --mode=link /home/spack/opt/spack/linux-openeuler20-aarch64/gcc-7.3.0/openmpi-3.1.6-aa3tfoswi3mfcgcjkf2hkplux6rikngn/bin/mpicc  -O2   -o test/sc_test_builtin test/test_builtin.o ./src/libsc.la -llua -lz -lm\r\nlibtool: link: /home/spack/opt/spack/linux-openeuler20-aarch64/gcc-7.3.0/openmpi-3.1.6-aa3tfoswi3mfcgcjkf2hkplux6rikngn/bin/mpicc -O2 -o test/.libs/sc_test_builtin test/test_builtin.o  ./src/.libs/libsc.so -llua -lz -lm -Wl,-rpath -Wl,/home/spack/opt/spack/linux-openeuler20-aarch64/gcc-7.3.0/p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/lib\r\nmake[2]: 'test/sc_test_darray_work' is up to date.\r\nmake[2]: 'test/sc_test_dmatrix' is up to date.\r\nmake[2]: 'test/sc_test_dmatrix_pool' is up to date.\r\nmake[2]: 'test/sc_test_io_sink' is up to date.\r\nmake[2]: 'test/sc_test_keyvalue' is up to date.\r\nmake[2]: 'test/sc_test_node_comm' is up to date.\r\nmake[2]: 'test/sc_test_notify' is up to date.\r\nmake[2]: 'test/sc_test_reduce' is up to date.\r\nmake[2]: 'test/sc_test_search' is up to date.\r\nmake[2]: 'test/sc_test_sort' is up to date.\r\nmake[2]: 'test/sc_test_sortb' is up to date.\r\nmake[2]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake  check-TESTS\r\nmake[2]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake[3]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nPASS: test/sc_test_allgather\r\nPASS: test/sc_test_arrays\r\nPASS: test/sc_test_builtin\r\nPASS: test/sc_test_darray_work\r\nFAIL: test/sc_test_dmatrix\r\nPASS: test/sc_test_dmatrix_pool\r\nPASS: test/sc_test_io_sink\r\nPASS: test/sc_test_keyvalue\r\nPASS: test/sc_test_node_comm\r\nPASS: test/sc_test_notify\r\nPASS: test/sc_test_reduce\r\nPASS: test/sc_test_search\r\nPASS: test/sc_test_sort\r\nPASS: test/sc_test_sortb\r\n============================================================================\r\nTestsuite summary for libsc 2.2\r\n============================================================================\r\n# TOTAL: 14\r\n# PASS:  13\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\nSee ./test-suite.log\r\nPlease report to info@p4est.org\r\n============================================================================\r\nmake[3]: *** [Makefile:2226: test-suite.log] Error 1\r\nmake[3]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake[2]: *** [Makefile:2334: check-TESTS] Error 2\r\nmake[2]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake[1]: *** [Makefile:2641: check-am] Error 2\r\nmake[1]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src/sc'\r\nmake: *** [Makefile:3792: check-recursive] Error 1\r\n[root@openEuler spack-src]# cat sc/test-suite.log\r\n=================================\r\n   libsc 2.2: ./test-suite.log\r\n=================================\r\n\r\n# TOTAL: 14\r\n# PASS:  13\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  1\r\n# XPASS: 0\r\n# ERROR: 0\r\n\r\n.. contents:: :depth: 2\r\n\r\nFAIL: test/sc_test_dmatrix\r\n==========================\r\n\r\n[libsc] This is libsc 2.2\r\n--------------------------------------------------------------------------\r\nPrimary job  terminated normally, but 1 process returned\r\na non-zero exit code. Per user-direction, the job has been aborted.\r\n--------------------------------------------------------------------------\r\n--------------------------------------------------------------------------\r\nmpiexec detected that one or more processes exited with non-zero status, thus causing\r\nthe job to be terminated. The first process to do so was:\r\n\r\n  Process name: [[48567,1],0]\r\n  Exit code:    1\r\n--------------------------------------------------------------------------\r\nFAIL test/sc_test_dmatrix (exit status: 1)\r\n\r\n[root@openEuler spack-src]# make  check-TESTS\r\nmake[1]: Entering directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src'\r\nPASS: test/p4est_test_comm\r\nPASS: test/p4est_test_hash\r\nPASS: test/p4est_test_quadrants\r\nPASS: test/p4est_test_balance\r\nPASS: test/p4est_test_partition\r\nPASS: test/p4est_test_coarsen\r\nPASS: test/p4est_test_valid\r\nPASS: test/p4est_test_balance_type\r\nPASS: test/p4est_test_loadsave\r\nPASS: test/p4est_test_order\r\nPASS: test/p4est_test_load\r\nPASS: test/p4est_test_ghost\r\nPASS: test/p4est_test_conn_transformation\r\nPASS: test/p4est_test_iterate\r\nPASS: test/p4est_test_lnodes\r\nPASS: test/p4est_test_search\r\nPASS: test/p4est_test_brick\r\nPASS: test/p4est_test_complete_subtree\r\nPASS: test/p4est_test_partition_corr\r\nPASS: test/p4est_test_conn_complete\r\nPASS: test/p4est_test_balance_seeds\r\nPASS: test/p4est_test_wrap\r\nPASS: test/p4est_test_replace\r\nPASS: test/p4est_test_join\r\nPASS: test/p4est_test_conn_reduce\r\nPASS: test/p4est_test_plex\r\nPASS: test/p4est_test_connrefine\r\nPASS: test/p4est_test_subcomm\r\nPASS: test/p4est_test_nodes\r\nPASS: test/p8est_test_quadrants\r\nPASS: test/p8est_test_balance\r\nPASS: test/p8est_test_partition\r\nPASS: test/p8est_test_coarsen\r\nPASS: test/p8est_test_valid\r\nPASS: test/p8est_test_balance_type\r\nPASS: test/p8est_test_face_transform\r\nPASS: test/p8est_test_edge_face_corners\r\nPASS: test/p8est_test_periodic\r\nPASS: test/p8est_test_loadsave\r\nPASS: test/p8est_test_load\r\nPASS: test/p8est_test_ghost\r\nPASS: test/p8est_test_conn_transformation\r\nPASS: test/p8est_test_iterate\r\nPASS: test/p8est_test_lnodes\r\nPASS: test/p8est_test_search\r\nPASS: test/p8est_test_brick\r\nPASS: test/p8est_test_partition_corr\r\nPASS: test/p8est_test_conn_complete\r\nPASS: test/p8est_test_balance_seeds\r\nPASS: test/p8est_test_wrap\r\nPASS: test/p8est_test_replace\r\nPASS: test/p8est_test_join\r\nPASS: test/p8est_test_conn_reduce\r\nPASS: test/p8est_test_plex\r\nPASS: test/p8est_test_connrefine\r\nPASS: test/p8est_test_subcomm\r\nPASS: test/p8est_test_nodes\r\nPASS: test/p6est_test_all\r\n============================================================================\r\nTestsuite summary for p4est 2.2\r\n============================================================================\r\n# TOTAL: 58\r\n# PASS:  58\r\n# SKIP:  0\r\n# XFAIL: 0\r\n# FAIL:  0\r\n# XPASS: 0\r\n# ERROR: 0\r\n============================================================================\r\nmake[1]: Leaving directory '/home/stage/root/spack-stage-p4est-2.2-zutcbxgd4xan6exahjtpwnymbblfxpw3/spack-src'\r\n```\r\nAs you can see, Testsuite Summary for p4est 2.2 is all passed when the **make check-TESTS** is used, but Testsuite Summary for libsc 2.2 fails when the **make check** is used. I am looking for the reason but I am not, he is eager to get help in solving this thorny problem.\r\n\r\n### Information on your system\r\n\r\n[root@openEuler spack-src]# spack debug report\r\n* **Spack:** 0.16.0-77-98460b6f4\r\n* **Python:** 3.7.4\r\n* **Platform:** linux-openeuler20-aarch64\r\n* **Concretizer:** original\r\n<!-- Please include the output of `spack debug report` -->\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [ ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ ] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}