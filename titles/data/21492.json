{
    "url": "https://api.github.com/repos/spack/spack/issues/21492",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/21492/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/21492/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/21492/events",
    "html_url": "https://github.com/spack/spack/issues/21492",
    "id": 801536784,
    "node_id": "MDU6SXNzdWU4MDE1MzY3ODQ=",
    "number": 21492,
    "title": "Spack Broken after Upgrade to MacOs Big Sur",
    "user": {
        "login": "jlconlin",
        "id": 1275437,
        "node_id": "MDQ6VXNlcjEyNzU0Mzc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1275437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jlconlin",
        "html_url": "https://github.com/jlconlin",
        "followers_url": "https://api.github.com/users/jlconlin/followers",
        "following_url": "https://api.github.com/users/jlconlin/following{/other_user}",
        "gists_url": "https://api.github.com/users/jlconlin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jlconlin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jlconlin/subscriptions",
        "organizations_url": "https://api.github.com/users/jlconlin/orgs",
        "repos_url": "https://api.github.com/users/jlconlin/repos",
        "events_url": "https://api.github.com/users/jlconlin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jlconlin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2021-02-04T18:34:03Z",
    "updated_at": "2021-06-17T13:54:14Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\n\r\n### Steps to reproduce the issue\r\nI recently upgrade MacOS to Big Sur. (Spack was working previously.) Spack was broken in BigSur so I deleted everything Spack related and started over. Spack is still broken.\r\n\r\n```console\r\n$ cd $HOME\r\n$ rm -rf spack/ .spack/\r\n$ git clone https://github.com/spack/spack.git\r\n$ source spack/share/spack/setup-env.sh\r\n$ spack install libelf                                                                                                             \r\n==> Installing libelf-0.8.13-4ifw3i42jvwbag67hn5ylugghq2kmrnh\r\n==> No binary for libelf-0.8.13-4ifw3i42jvwbag67hn5ylugghq2kmrnh found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/59/591a9b4ec81c1f2042a97aa60564e0cb79d041c52faa7416acb38bc95bd2c76d.tar.gz\r\n#################################################################################################################################################### 100.0%\r\n==> libelf: Executing phase: 'autoreconf'\r\n==> libelf: Executing phase: 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-libelf-0.8.13-4ifw3i42jvwbag67hn5ylugghq2kmrnh/spack-src/configure' '--prefix=/Users/jlconlin/spack/opt/spack/darwin-bigsur-skylake/apple-clang-12.0.0/libelf-0.8.13-4ifw3i42jvwbag67hn5ylugghq2kmrnh' '--enable-shared' '--disable-dependency-tracking' '--disable-debug'\r\n\r\n1 error found in build log:\r\n     33    checking size of int... 0\r\n     34    checking size of long... 0\r\n     35    checking size of long long... 0\r\n     36    checking size of __int64... 0\r\n     37    checking for 64-bit integer... no\r\n     38    checking for 32-bit integer... no\r\n  >> 39    configure: error: neither int nor long is 32-bit\r\n\r\nSee build log for details:\r\n  /var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-libelf-0.8.13-4ifw3i42jvwbag67hn5ylugghq2kmrnh/spack-build-out.txt\r\n```\r\n\r\n`libelf` was not the only package that was struggling to install. I also tried installing `cmake`; it failed, but for different reasons.\r\n\r\n```console\r\n$ spack install cmake                                                                                                               \r\n==> Installing pkgconf-1.7.3-h7h25xohkjm36qltjovbxhgrpb7s5ett\r\n==> No binary for pkgconf-1.7.3-h7h25xohkjm36qltjovbxhgrpb7s5ett found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/b8/b846aea51cf696c3392a0ae58bef93e2e72f8e7073ca6ad1ed8b01c85871f9c0.tar.xz\r\n#################################################################################################################################################### 100.0%\r\n==> pkgconf: Executing phase: 'autoreconf'\r\n==> pkgconf: Executing phase: 'configure'\r\n==> pkgconf: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n4 errors found in build log:\r\n     114    config.status: creating tests/test_env.sh\r\n     115    config.status: creating libpkgconf/config.h\r\n     116    config.status: executing depfiles commands\r\n     117    config.status: executing libtool commands\r\n     118    ==> pkgconf: Executing phase: 'build'\r\n     119    ==> [2021-02-04-11:02:40.703748] 'make' '-j16'\r\n  >> 120    make: /var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-pkgconf-1.7.3-h7h25xohkjm36qltjovbxhgrpb7s5ett/spack-s\r\n            rc/install-sh: Permission denied\r\n  >> 121    make: /var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-pkgconf-1.7.3-h7h25xohkjm36qltjovbxhgrpb7s5ett/spack-s\r\n            rc/install-sh: Permission denied\r\n  >> 122    make: *** [libpkgconf/.deps/.dirstamp] Error 1\r\n     123    make: *** Waiting for unfinished jobs....\r\n  >> 124    make: *** [libpkgconf/.dirstamp] Error 1\r\nSee build log for details:\r\n  /var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-pkgconf-1.7.3-h7h25xohkjm36qltjovbxhgrpb7s5ett/spack-build-out.txt\r\n==> Warning: Skipping build of ncurses-6.2-gikh646beft7ztei3wiekwymc4dtwv43 since pkgconf-1.7.3-h7h25xohkjm36qltjovbxhgrpb7s5ett failed\r\n==> Warning: Skipping build of readline-8.0-cfoqvf3uxnuhf6wjwvqz3c3qgshzuhgq since ncurses-6.2-gikh646beft7ztei3wiekwymc4dtwv43 failed\r\n==> Warning: Skipping build of gdbm-1.18.1-mhckngfgvmlilgxlnchozhfsem5putka since readline-8.0-cfoqvf3uxnuhf6wjwvqz3c3qgshzuhgq failed\r\n==> Warning: Skipping build of perl-5.32.1-fyr7pumixy24t4iickul3i7iugar2arv since gdbm-1.18.1-mhckngfgvmlilgxlnchozhfsem5putka failed\r\n==> Warning: Skipping build of openssl-1.1.1i-csloafmhlbbqanwqgc6jmwo6gx7ffvjm since perl-5.32.1-fyr7pumixy24t4iickul3i7iugar2arv failed\r\n==> Warning: Skipping build of cmake-3.19.2-ur6ousaun7fyz3b2oaf3l34iiorm2p2r since openssl-1.1.1i-csloafmhlbbqanwqgc6jmwo6gx7ffvjm failed\r\n==> Installing berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm\r\n==> No binary for berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/0c/0cecb2ef0c67b166de93732769abdeba0555086d51de1090df325e18ee8da9c8.tar.gz\r\n#################################################################################################################################################### 100.0%\r\n==> berkeley-db: Executing phase: 'autoreconf'\r\n==> berkeley-db: Executing phase: 'configure'\r\n==> berkeley-db: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n4 errors found in build log:\r\n     381    libtool: compile:  /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/\r\n            spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src -O3 /private/var/folders/5t/txmxvbk97018dv7zj6mxqd1\r\n            80002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src/btree/bt_rsearch.c  -fno-common\r\n            -DPIC -o .libs/bt_rsearch.o\r\n     382    libtool: compile:  /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/\r\n            spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src -O3 /private/var/folders/5t/txmxvbk97018dv7zj6mxqd1\r\n            80002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/lang/db185/db185.c  -fno-common -DPI\r\n            C -o .libs/db185.o\r\n     383    libtool: compile:  /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/\r\n            spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src -O3 /private/var/folders/5t/txmxvbk97018dv7zj6mxqd1\r\n            80002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src/btree/bt_recno.c  -fno-common -D\r\n            PIC -o .libs/bt_recno.o\r\n     384    libtool: compile:  /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/\r\n            spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src -O3 /private/var/folders/5t/txmxvbk97018dv7zj6mxqd1\r\n            80002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src/btree/bt_put.c  -fno-common -DPI\r\n            C -o .libs/bt_put.o\r\n     385    libtool: compile:  /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/\r\n            spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src -O3 /private/var/folders/5t/txmxvbk97018dv7zj6mxqd1\r\n            80002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src/btree/bt_compress.c  -fno-common\r\n             -DPIC -o .libs/bt_compress.o\r\n     386    ./libtool --mode=compile /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlc\r\n            onlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src  -O3  /private/var/folders/5t/txmxvbk97018dv7\r\n            zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src/btree/bt_split.c\r\n  >> 387    make: ./libtool: Permission denied\r\n     388    ./libtool --mode=compile /Users/jlconlin/spack/lib/spack/env/clang/clang -c -I. -I/private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlc\r\n            onlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src  -O3  /private/var/folders/5t/txmxvbk97018dv7\r\n            zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-src/src/btree/bt_stat.c\r\n  >> 389    make: ./libtool: Permission denied\r\n  >> 390    make: *** [bt_split.lo] Error 1\r\n     391    make: *** Waiting for unfinished jobs....\r\n  >> 392    make: *** [bt_stat.lo] Error 1\r\n     393    /private/var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm\r\n            /spack-src/lang/db185/db185.c:71:7: warning: case value not in enumerated type 'DBTYPE' [-Wswitch]\r\n     394            case 0:                                 /* DB_BTREE */\r\n     395                 ^\r\n     396    1 warning generated.\r\nSee build log for details:\r\n  /var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-berkeley-db-18.1.40-ylfrfleejl6iutbxwg2kokkajcq6tqrm/spack-build-out.txt\r\n==> Installing zlib-1.2.11-xflsouiaysa3uizi6mjcwhv54aa5m6kd\r\n==> No binary for zlib-1.2.11-xflsouiaysa3uizi6mjcwhv54aa5m6kd found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/c3/c3e5e9fdd5004dcb542feda5ee4f0ff0744628baf8ed2dd5d66f8ca1197cb1a1.tar.gz\r\n#################################################################################################################################################### 100.0%\r\n==> zlib: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n4 errors found in build log:\r\n     22    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o inflate.o inflate.c\r\n     23    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o inftrees.o inftrees.c\r\n     24    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o trees.o trees.c\r\n     25    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o zutil.o zutil.c\r\n     26    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o compress.o compress.c\r\n     27    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o uncompr.o uncompr.c\r\n  >> 28    make: /Users/jlconlin/spack/lib/spack/env/clang/clang: Permission denied\r\n     29    /Users/jlconlin/spack/lib/spack/env/clang/clang -fPIC -O2 -DHAVE_HIDDEN  -c -o gzclose.o gzclose.c\r\n  >> 30    make: /Users/jlconlin/spack/lib/spack/env/clang/clang: Permission denied\r\n  >> 31    make: *** [uncompr.o] Error 1\r\n     32    make: *** Waiting for unfinished jobs....\r\n  >> 33    make: *** [gzclose.o] Error 1\r\nSee build log for details:\r\n  /var/folders/5t/txmxvbk97018dv7zj6mxqd180002jq/T/jlconlin/spack-stage/spack-stage-zlib-1.2.11-xflsouiaysa3uizi6mjcwhv54aa5m6kd/spack-build-out.txt\r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\n```console\r\n$ spack --debug --stacktrace <command>\r\n```\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n```console\r\n$ spack debug report                                                                                                                \r\n* **Spack:** 0.16.0-1133-ba70f90ee0\r\n* **Python:** 3.8.3\r\n* **Platform:** darwin-bigsur-skylake\r\n* **Concretizer:** original\r\n```\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\nThe only configuration file I have is in `$HOME/.spack/darwin/compilers.yaml`, which I did not create myself.\r\n```console\r\ncompilers:\r\n- compiler:\r\n    spec: apple-clang@12.0.0\r\n    paths:\r\n      cc: /usr/bin/clang\r\n      cxx: /usr/bin/clang++\r\n      f77:\r\n      fc:\r\n    flags: {}\r\n    operating_system: bigsur\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x ] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}