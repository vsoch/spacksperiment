{
    "url": "https://api.github.com/repos/spack/spack/issues/10000",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10000/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10000/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10000/events",
    "html_url": "https://github.com/spack/spack/issues/10000",
    "id": 386660030,
    "node_id": "MDU6SXNzdWUzODY2NjAwMzA=",
    "number": 10000,
    "title": "Unsatisfiable constraint when no explicit package version given",
    "user": {
        "login": "SteVwonder",
        "id": 874707,
        "node_id": "MDQ6VXNlcjg3NDcwNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/874707?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SteVwonder",
        "html_url": "https://github.com/SteVwonder",
        "followers_url": "https://api.github.com/users/SteVwonder/followers",
        "following_url": "https://api.github.com/users/SteVwonder/following{/other_user}",
        "gists_url": "https://api.github.com/users/SteVwonder/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SteVwonder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SteVwonder/subscriptions",
        "organizations_url": "https://api.github.com/users/SteVwonder/orgs",
        "repos_url": "https://api.github.com/users/SteVwonder/repos",
        "events_url": "https://api.github.com/users/SteVwonder/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SteVwonder/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2018-12-03T04:59:15Z",
    "updated_at": "2018-12-12T04:34:59Z",
    "closed_at": "2018-12-12T04:34:59Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "Installing `flux-core` with an explicit version (i.e., `flux-core@0.9.0`, `flux-core@0.10.0`, `flux-core@master`) works perfectly.  Attempting to install without an explicit version (i.e., `spack install flux-core`) fails when spack cannot seem to satisfy the lua dependency.  It appears as though the concretizer just grabs tha latest version of lua (5.3.X) and then some other verification pass realizes that this doesn't meet the specification for the latest version of flux-core (flux-core@0.10.0 and lua@5.1:5.2.99).\r\n\r\nMy guess is that this is either:\r\nA) improper specification of dependencies in the flux-core package\r\nB) a bug in the concretizer\r\n\r\nFlux's lua dependency specification currently looks like:\r\n```python\r\n    depends_on(\"lua\", type=('build', 'run', 'link'))\r\n    depends_on(\"lua@5.1:5.1.99\", when=\"@0.1.0:0.9.0\")\r\n    depends_on(\"lua@5.1:5.2.99\", when=\"@0.10.0:,master\")\r\n```\r\n\r\nDoes the `when` argument only apply when a user explicitly adds that variant/customization in the command?\r\n\r\n### Steps to reproduce the issue & Error Message\r\n\r\n```console\r\n$ spack -d install flux-core\r\n<snip some lines about reading configs and getting locks>\r\n--------------------------------\r\nflux-core\r\n\r\nConcretized\r\n--------------------------------\r\n==> Error: An unsatisfiable version constraint has been detected for spec:\r\n\r\n    lua@5.3.4%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n        ^ncurses@6.1%gcc@8.2.0~symlinks~termlib arch=linux-rhel7-x86_64 \r\n            ^pkgconf@1.5.4%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n        ^readline@7.0%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n        ^unzip@6.0%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    flux-core@0.10.0%gcc@8.2.0~cuda~docs arch=linux-rhel7-x86_64 \r\n        ^czmq@4.1.1%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^autoconf@2.69%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n                ^m4@1.4.18%gcc@8.2.0+sigsegv arch=linux-rhel7-x86_64 \r\n                    ^libsigsegv\r\n                ^perl@5.26.2%gcc@8.2.0+cpanm+shared+threads arch=linux-rhel7-x86_64 \r\n                    ^gdbm@1.18.1%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n                        ^readline@7.0%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n                            ^ncurses@6.1%gcc@8.2.0~symlinks~termlib arch=linux-rhel7-x86_64 \r\n                                ^pkgconf@1.5.4%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^automake@1.16.1%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^libtool@2.4.6%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^libuuid@1.0.3%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^zeromq@4.2.5%gcc@8.2.0+libsodium arch=linux-rhel7-x86_64 \r\n                ^libsodium\r\n        ^hwloc@1.11.9%gcc@8.2.0~cairo~cuda+libxml2+pci+shared arch=linux-rhel7-x86_64 \r\n            ^libpciaccess\r\n                ^util-macros\r\n            ^libxml2\r\n                ^xz\r\n                ^zlib@1.2.11%gcc@8.2.0+optimize+pic+shared arch=linux-rhel7-x86_64 \r\n            ^numactl\r\n        ^jansson@2.9%gcc@8.2.0 build_type=RelWithDebInfo +shared arch=linux-rhel7-x86_64 \r\n            ^cmake@3.13.0%gcc@8.2.0~doc+ncurses+openssl+ownlibs~qt arch=linux-rhel7-x86_64 \r\n                ^openssl@1.1.1%gcc@8.2.0+systemcerts arch=linux-rhel7-x86_64 \r\n        ^lua-luaposix@33.4.0%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^lua@5.3.4%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n                ^unzip@6.0%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n        ^munge@0.5.13%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^libgcrypt@1.8.1%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n                ^libgpg-error@1.27%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n        ^python@2.7.15%gcc@8.2.0+dbm~optimizations+pic+pythoncmd+shared~tk~ucs4 arch=linux-rhel7-x86_64 \r\n            ^bzip2@1.0.6%gcc@8.2.0+shared arch=linux-rhel7-x86_64 \r\n                ^diffutils@3.6%gcc@8.2.0 arch=linux-rhel7-x86_64 \r\n            ^sqlite@3.25.3%gcc@8.2.0~functions arch=linux-rhel7-x86_64 \r\n\r\n\r\nflux-core requires lua version 5.1:5.2.99, but spec asked for 5.3.4\r\nTraceback (most recent call last):\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/main.py\", line 669, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/main.py\", line 440, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/cmd/spec.py\", line 72, in spec\r\n    spec.concretize()\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/spec.py\", line 1865, in concretize\r\n    user_spec_deps=user_spec_deps),\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/spec.py\", line 2288, in normalize\r\n    visited, all_spec_deps, provider_index, tests)\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/spec.py\", line 2227, in _normalize_helper\r\n    dep, visited, spec_deps, provider_index, tests)\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/spec.py\", line 2168, in _merge_dependency\r\n    changed |= spec_deps[dep.name].constrain(dep)\r\n  File \"/g/g0/herbein1/Repositories/spack/lib/spack/spack/spec.py\", line 2361, in constrain\r\n    raise UnsatisfiableVersionSpecError(self.versions, other.versions)\r\nspack.spec.UnsatisfiableVersionSpecError: An unsatisfiable version constraint has been detected for spec:\r\n<snip repeated spec>\r\n```\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\n\r\n 1. TOSS3 system at LLNL",
    "performed_via_github_app": null
}