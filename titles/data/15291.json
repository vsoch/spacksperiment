{
    "url": "https://api.github.com/repos/spack/spack/issues/15291",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/15291/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/15291/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/15291/events",
    "html_url": "https://github.com/spack/spack/issues/15291",
    "id": 574111254,
    "node_id": "MDU6SXNzdWU1NzQxMTEyNTQ=",
    "number": 15291,
    "title": "Checksum and Tar Errors from Several Packages from mantevo.github.io",
    "user": {
        "login": "ilumsden",
        "id": 28907237,
        "node_id": "MDQ6VXNlcjI4OTA3MjM3",
        "avatar_url": "https://avatars.githubusercontent.com/u/28907237?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ilumsden",
        "html_url": "https://github.com/ilumsden",
        "followers_url": "https://api.github.com/users/ilumsden/followers",
        "following_url": "https://api.github.com/users/ilumsden/following{/other_user}",
        "gists_url": "https://api.github.com/users/ilumsden/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ilumsden/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ilumsden/subscriptions",
        "organizations_url": "https://api.github.com/users/ilumsden/orgs",
        "repos_url": "https://api.github.com/users/ilumsden/repos",
        "events_url": "https://api.github.com/users/ilumsden/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ilumsden/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2020-03-02T16:57:55Z",
    "updated_at": "2020-05-19T21:19:18Z",
    "closed_at": "2020-05-19T21:19:18Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "<!--*Thanks for taking the time to report this build failure. To proceed with the\r\nreport please:*\r\n1. Title the issue \"Installation issue: <name-of-the-package>\".\r\n2. Provide the information required below.\r\n\r\nWe encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n-->\r\nThis issue is essentially an expanded follow-up to #14340. \r\n\r\nI've found the following packages from Mantevo that produce checksum failures and cannot be extracted from their tarballs during install:\r\n* `cloverleaf`\r\n* `minimd`\r\n* `minighost`\r\n* `minismac2d`\r\n* `minixyce`\r\n* `hpccg`\r\n* `pathfinder`\r\n* `tealeaf`\r\n\r\nThere are several things that these packages have in common:\r\n* All come from this [GitHub repo](https://github.com/Mantevo/mantevo.github.io/tree/master/download_files).\r\n* The URL that Spack is using to get the tarball points to a Git LFS pointer file.\r\n* The actual file being obtained with `curl` seems to be the Git LFS pointer file. However, I'm still not positive that this is the case.\r\n* The pointer file's `oid` field matches the SHA256 checksum that is in the Spack package file.\r\n* The checksum that causes the mismatch can be reproduced by running `sha256sum` on this pointer file.\r\n\r\nAdditionally, when I tried manually extracting the actual tarball for `cloverleaf` using `curl` on the command line (following [these instructions](https://github.com/git-lfs/git-lfs/issues/2309#issuecomment-307242764)), I got the following:\r\n\r\n```bash\r\n$ curl -X POST -d '{\"operation\":\"download\", \"objects\":[{\"oid\": \"sha256:de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f    \", \"size\": 1756656}]}' https://github.com/Mantevo/mantevo.github.io.git/info/lfs/objects/batch\r\n\r\n{\r\n  \"message\": \"This repository is over its data quota. Account responsible for LFS bandwidth should purchase more data packs to restore access.\",\r\n  \"documentation_url\": \"https://help.github.com/articles/purchasing-additional-storage-and-bandwidth-for-an-organization/\"\r\n}\r\n```\r\n\r\nTo keep this issue from getting too lengthy, I'm only going to include the output from trying to install `cloverleaf` below, but I have gotten the same errors for all of the above packages.\r\n\r\n### Spack version\r\n<!-- Add the output to the command below -->\r\n```console\r\n$ spack --version\r\n# On my personal laptop (Ubuntu 18.04 x86_64)\r\n0.14.0-24-ae8782852\r\n# On UTK's Power9 Cluster\r\n0.14.0-21-676eb56\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n# For the checksum error\r\n$ spack install cloverleaf\r\n# For the tarball extraction error\r\n$ spack install -n cloverleaf\r\n```\r\n\r\n### Errors\r\n\r\n**On my personal laptop:**\r\n```console\r\n$ spack install cloverleaf\r\n\r\n==> 13573: Installing cloverleaf\r\n==> Fetching from /home/ilumsden/spack/var/spack/cache/_source-cache/archive/de/de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f.tar.gz failed.\r\n==> Fetching https://github.com/Mantevo/mantevo.github.io/raw/master/download_files/CloverLeaf-1.1.tar.gz\r\n################################################################################################################################## 100.0%################################################################################################################################## 100.0%\r\n==> Error: ChecksumError: sha256 checksum failed for /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz\r\n    Expected de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f but got 5a69bc3d1b4ca0d071609ecd844ba46636d5239a0acfa56e3c93fa606e112ab9\r\n\r\n/home/ilumsden/spack/lib/spack/spack/package.py:1131, in do_fetch:\r\n       1128        self.stage.fetch(mirror_only)\r\n       1129        self._fetch_time = time.time() - start_time\r\n       1130\r\n  >>   1131        if checksum and self.version in self.versions:\r\n       1132            self.stage.check()\r\n       1133\r\n       1134        self.stage.cache_local()\r\n\r\n\r\n==> Error: Failed to install cloverleaf due to ChildError: ChecksumError: sha256 checksum failed for /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz\r\n    Expected de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f but got 5a69bc3d1b4ca0d071609ecd844ba46636d5239a0acfa56e3c93fa606e112ab9\r\n/home/ilumsden/spack/lib/spack/spack/package.py:1131, in do_fetch:\r\n       1128        self.stage.fetch(mirror_only)\r\n       1129        self._fetch_time = time.time() - start_time\r\n       1130\r\n  >>   1131        if checksum and self.version in self.versions:\r\n       1132            self.stage.check()\r\n       1133\r\n       1134        self.stage.cache_local()\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ilumsden/spack/lib/spack/spack/build_environment.py\", line 801, in child_process\r\n    return_value = function()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/installer.py\", line 984, in build_process\r\n    pkg.do_patch()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1167, in do_patch\r\n    self.do_stage()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1152, in do_stage\r\n    self.do_fetch(mirror_only)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1132, in do_fetch\r\n    self.stage.check()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/util/pattern.py\", line 68, in getter\r\n    getattr(item, self.name)(*args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/stage.py\", line 490, in check\r\n    self.fetcher.check()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 73, in wrapper\r\n    return fun(self, *args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 492, in check\r\n    \"Expected %s but got %s\" % (self.digest, checker.sum))\r\nspack.fetch_strategy.ChecksumError: sha256 checksum failed for /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz\r\n    Expected de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f but got 5a69bc3d1b4ca0d071609ecd844ba46636d5239a0acfa56e3c93fa606e112ab9\r\n\r\n$ spack install -n cloverleaf\r\n\r\n==> 13599: Installing cloverleaf\r\n==> Fetching from /home/ilumsden/spack/var/spack/cache/_source-cache/archive/de/de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f.tar.gz failed.\r\n==> Fetching https://github.com/Mantevo/mantevo.github.io/raw/master/download_files/CloverLeaf-1.1.tar.gz\r\n################################################################################################################################## 100.0%################################################################################################################################## 100.0%\r\n==> Staging archive: /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz\r\n/bin/tar: This does not look like a tar archive\r\n\r\ngzip: stdin: not in gzip format\r\n/bin/tar: Child returned status 1\r\n/bin/tar: Error is not recoverable: exiting now\r\n==> Error: ProcessError: Command exited with status 2:\r\n    '/bin/tar' '-xf' '/tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz'\r\n==> Error: Failed to install cloverleaf due to ChildError: ProcessError: Command exited with status 2:\r\n    '/bin/tar' '-xf' '/tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz'Traceback (most recent call last):\r\n  File \"/home/ilumsden/spack/lib/spack/spack/build_environment.py\", line 801, in child_process\r\n    return_value = function()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/installer.py\", line 984, in build_process\r\n    pkg.do_patch()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1167, in do_patch\r\n    self.do_stage()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1153, in do_stage\r\n    self.stage.expand_archive()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/util/pattern.py\", line 68, in getter\r\n    getattr(item, self.name)(*args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/stage.py\", line 528, in expand_archive\r\n    self.fetcher.expand()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 73, in wrapper\r\n    return fun(self, *args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 434, in expand\r\n    decompress(self.archive_file)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/util/executable.py\", line 189, in __call__\r\n    proc.returncode, long_msg)\r\nspack.util.executable.ProcessError: Command exited with status 2:\r\n    '/bin/tar' '-xf' '/tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-agtpltse7hfn4qefyuwruo4lwn7eueoe/CloverLeaf-1.1.tar.gz'\r\n```\r\n\r\n**On UTK's Power9 Cluster:**\r\n```console\r\n$ spack install cloverleaf\r\n\r\n==> 94167: Installing cloverleaf\r\n==> Fetching https://github.com/Mantevo/mantevo.github.io/raw/master/download_files/CloverLeaf-1.1.tar.gz\r\n################################################################################################################################## 100.0%################################################################################################################################## 100.0%\r\n==> Error: ChecksumError: sha256 checksum failed for /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz\r\n    Expected de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f but got 5a69bc3d1b4ca0d071609ecd844ba46636d5239a0acfa56e3c93fa606e112ab9\r\n\r\n/home/ilumsden/spack/lib/spack/spack/package.py:1131, in do_fetch:\r\n       1128        self.stage.fetch(mirror_only)\r\n       1129        self._fetch_time = time.time() - start_time\r\n       1130\r\n  >>   1131        if checksum and self.version in self.versions:\r\n       1132            self.stage.check()\r\n       1133\r\n       1134        self.stage.cache_local()\r\n\r\n\r\n==> Error: Failed to install cloverleaf due to ChildError: ChecksumError: sha256 checksum failed for /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz\r\n    Expected de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f but got 5a69bc3d1b4ca0d071609ecd844ba46636d5239a0acfa56e3c93fa606e112ab9\r\n/home/ilumsden/spack/lib/spack/spack/package.py:1131, in do_fetch:\r\n       1128        self.stage.fetch(mirror_only)\r\n       1129        self._fetch_time = time.time() - start_time\r\n       1130\r\n  >>   1131        if checksum and self.version in self.versions:\r\n       1132            self.stage.check()\r\n       1133\r\n       1134        self.stage.cache_local()\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ilumsden/spack/lib/spack/spack/build_environment.py\", line 801, in child_process\r\n    return_value = function()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/installer.py\", line 984, in build_process\r\n    pkg.do_patch()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1167, in do_patch\r\n    self.do_stage()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1152, in do_stage\r\n    self.do_fetch(mirror_only)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1132, in do_fetch\r\n    self.stage.check()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/util/pattern.py\", line 68, in getter\r\n    getattr(item, self.name)(*args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/stage.py\", line 490, in check\r\n    self.fetcher.check()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 73, in wrapper\r\n    return fun(self, *args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 492, in check\r\n    \"Expected %s but got %s\" % (self.digest, checker.sum))\r\nspack.fetch_strategy.ChecksumError: sha256 checksum failed for /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz\r\n    Expected de87f7ee6b917e6b3d243ccbbe620370c62df890e3ef7bdbab46569b57be132f but got 5a69bc3d1b4ca0d071609ecd844ba46636d5239a0acfa56e3c93fa606e112ab9\r\n\r\n$ spack install -n cloverleaf\r\n\r\n==> 98004: Installing cloverleaf\r\n==> Fetching https://github.com/Mantevo/mantevo.github.io/raw/master/download_files/CloverLeaf-1.1.tar.gz\r\n################################################################################################################################## 100.0%################################################################################################################################## 100.0%\r\n==> Staging archive: /tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz\r\n/usr/bin/tar: This does not look like a tar archive\r\n\r\ngzip: stdin: not in gzip format\r\n/usr/bin/tar: Child returned status 1\r\n/usr/bin/tar: Error is not recoverable: exiting now\r\n==> Error: ProcessError: Command exited with status 2:\r\n    '/usr/bin/tar' '-xf' '/tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz'\r\n==> Error: Failed to install cloverleaf due to ChildError: ProcessError: Command exited with status 2:\r\n    '/usr/bin/tar' '-xf' '/tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz'Traceback (most recent call last):\r\n  File \"/home/ilumsden/spack/lib/spack/spack/build_environment.py\", line 801, in child_process\r\n    return_value = function()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/installer.py\", line 984, in build_process\r\n    pkg.do_patch()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1167, in do_patch\r\n    self.do_stage()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/package.py\", line 1153, in do_stage\r\n    self.stage.expand_archive()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/util/pattern.py\", line 68, in getter\r\n    getattr(item, self.name)(*args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/stage.py\", line 528, in expand_archive\r\n    self.fetcher.expand()\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 73, in wrapper\r\n    return fun(self, *args, **kwargs)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/fetch_strategy.py\", line 434, in expand\r\n    decompress(self.archive_file)\r\n  File \"/home/ilumsden/spack/lib/spack/spack/util/executable.py\", line 189, in __call__\r\n    proc.returncode, long_msg)\r\nspack.util.executable.ProcessError: Command exited with status 2:\r\n    '/usr/bin/tar' '-xf' '/tmp/ilumsden/spack-stage/spack-stage-cloverleaf-1.1-bq756364x6lklgv2g75cylfr6tbomrxg/CloverLeaf-1.1.tar.gz'\r\n```\r\n\r\n### Platform and user environment\r\n\r\n<!-- Please report your OS here:\r\n```commandline\r\n$ uname -a \r\nLinux nuvolari 4.15.0-29-generic #31-Ubuntu SMP Tue Jul 17 15:39:52 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:\tUbuntu 18.04.1 LTS\r\n``` \r\nand, if relevant, post or attach:\r\n\r\n- `packages.yaml`\r\n- `compilers.yaml`\r\n\r\nto the issue\r\n-->\r\n\r\n**On my personal laptop:**\r\n```commandline\r\n$ uname -a\r\nLinux ilumsden-XPS-15-9560 5.0.0-37-generic #40~18.04.1-Ubuntu SMP Thu Nov 14 12:06:39 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:\tUbuntu 18.04.3 LTS\r\n```\r\n\r\n**On UTK's Power9 Cluster:**\r\n```commandline\r\n$ uname -a\r\nLinux tellico-master0 4.14.0-115.10.1.el7a.ppc64le #1 SMP Wed Jun 26 09:32:17 UTC 2019 ppc64le ppc64le ppc64le GNU/Linux\r\n$ lsb_release -d\r\nDescription:\tRed Hat Enterprise Linux Server release 7.6 (Maipo)\r\n```\r\n\r\n### Additional information\r\n\r\n<!--Sometimes the issue benefits from additional details. In these cases there are\r\na few things we can suggest doing. First of all, you can post the full output of:\r\n```console\r\n$ spack spec --install-status <spec>\r\n...\r\n```\r\nto show people whether Spack installed a faulty software or if it was not able to\r\nbuild it at all. \r\n\r\nIf your build didn't make it past the configure stage, Spack as also commands to parse \r\nlogs and report error and warning messages:\r\n```console\r\n$ spack log-parse --show=errors,warnings <file-to-parse>\r\n```\r\nYou might want to run this command on the `config.log` or any other similar file\r\nfound in the stage directory: \r\n```console\r\n$ spack location -s <spec>\r\n```\r\nIn case in `config.log` there are other settings that you think might be the cause \r\nof the build failure, you can consider attaching the file to this issue.\r\n\r\nRebuilding the package with the following options:\r\n```console\r\n$ spack -d install -j 1 <spec>\r\n...\r\n```\r\nwill provide additional debug information. After the failure you will find two files in the current directory:\r\n\r\n1. `spack-cc-<spec>.in`, which contains details on the command given in input \r\n    to Spack's compiler wrapper  \r\n1. `spack-cc-<spec>.out`, which contains the command used to compile / link the \r\n    failed object after Spack's compiler wrapper did its processing \r\n\r\nYou can post or attach those files to provide maintainers with more information on what\r\nis causing the failure.-->\r\n\r\n### General information\r\n\r\n- [X] I have run `spack --version` and reported the version of Spack\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}