{
    "url": "https://api.github.com/repos/spack/spack/issues/19825",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/19825/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/19825/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/19825/events",
    "html_url": "https://github.com/spack/spack/issues/19825",
    "id": 739366770,
    "node_id": "MDU6SXNzdWU3MzkzNjY3NzA=",
    "number": 19825,
    "title": "0 cached builds after `buildcache create` error",
    "user": {
        "login": "milljm",
        "id": 6414286,
        "node_id": "MDQ6VXNlcjY0MTQyODY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6414286?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/milljm",
        "html_url": "https://github.com/milljm",
        "followers_url": "https://api.github.com/users/milljm/followers",
        "following_url": "https://api.github.com/users/milljm/following{/other_user}",
        "gists_url": "https://api.github.com/users/milljm/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/milljm/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/milljm/subscriptions",
        "organizations_url": "https://api.github.com/users/milljm/orgs",
        "repos_url": "https://api.github.com/users/milljm/repos",
        "events_url": "https://api.github.com/users/milljm/events{/privacy}",
        "received_events_url": "https://api.github.com/users/milljm/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483390,
            "node_id": "MDU6TGFiZWw1MTI0ODMzOTA=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-medium",
            "name": "impact-medium",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 13,
    "created_at": "2020-11-09T21:13:13Z",
    "updated_at": "2020-11-10T21:38:18Z",
    "closed_at": "2020-11-10T21:38:17Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install foo\r\n$ spack buildcache create --rebuild-index -a -k mirror -m mirror /foo-hash\r\n$ spack buildcache list -a\r\n==> 1 cached builds.\r\n<trimmed>\r\n$ spack install bar\r\n$ spack buildcache create -rebuild-index -a -k mirror -m mirror /bar-hash\r\n--------------------------^ accidentally used wrong switch\r\n$ spack buildcache list -a\r\n==> 0 cached builds.\r\n\r\n# repeated attempts at rebuilding the index does not solve the issue:\r\n$ spack buildcache update-index -d file:///path/to/mirror\r\n<takes it's time as if processing data, no errors>\r\n$ spack buildcache list -a\r\n==> 0 cached builds.\r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\n```console\r\n$ spack --debug --stacktrace buildcache create -rebuild-index -a -k mirror -m mirror /abc123\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2020-11-09-13:55:36.695807] Imported buildcache from built-in commands\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2020-11-09-13:55:36.699573] Imported buildcache from built-in commands\r\nusage: spack buildcache create [-hrfua] [-k key]\r\n                               (-d directory | -m mirror-name | --mirror-url mirror-url)\r\n                               [--rebuild-index] [-y SPEC_YAML]\r\n                               [--only {package,dependencies}]\r\n                               ...\r\nspack buildcache create: error: argument -r/--rel: ignored explicit argument 'ebuild-index'\r\nlib/spack/spack/config.py:909 ==> [2020-11-09-13:55:36.702023] Reading config file /data/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/config.py:909 ==> [2020-11-09-13:55:36.720273] Reading config file /home/test/.spack/config.yaml\r\nTraceback (most recent call last):\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1754, in parse_known_args\r\n    namespace, args = self._parse_known_args(args, namespace)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1960, in _parse_known_args\r\n    start_index = consume_optional(start_index)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1868, in consume_optional\r\n    raise ArgumentError(action, msg % explicit_arg)\r\nargparse.ArgumentError: argument -r/--rel: ignored explicit argument 'ebuild-index'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/data/spack/lib/spack/spack/main.py\", line 748, in main\r\n    args, unknown = parser.parse_known_args()\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1754, in parse_known_args\r\n    namespace, args = self._parse_known_args(args, namespace)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1942, in _parse_known_args\r\n    positionals_end_index = consume_positionals(start_index)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1919, in consume_positionals\r\n    take_action(action, args)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1828, in take_action\r\n    action(self, namespace, argument_values, option_string)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1128, in __call__\r\n    namespace, arg_strings = parser.parse_known_args(arg_strings, namespace)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1754, in parse_known_args\r\n    namespace, args = self._parse_known_args(args, namespace)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1942, in _parse_known_args\r\n    positionals_end_index = consume_positionals(start_index)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1919, in consume_positionals\r\n    take_action(action, args)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1828, in take_action\r\n    action(self, namespace, argument_values, option_string)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1128, in __call__\r\n    namespace, arg_strings = parser.parse_known_args(arg_strings, namespace)\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 1761, in parse_known_args\r\n    self.error(str(err))\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 2392, in error\r\n    self.exit(2, _('%s: error: %s\\n') % (self.prog, message))\r\n  File \"/data/spack/lib/spack/external/argparse.py\", line 2380, in exit\r\n    _sys.exit(status)\r\nSystemExit: 2\r\n```\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n* **Spack:** 0.15.4-1807-a62f1834c\r\n* **Python:** 3.7.3\r\n* **Platform:** linux-centos7-zen2\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n\r\n### Workaround:\r\n\r\nOnce you encounter the error, if you add a new package correctly, the buildcache returns. Still, even with a failed `list` view, my other nodes continue to download items from the buildcache correctly. So really, the error is possibly with the `list` sub-command only. Making this far less critical than it first appears.\r\n",
    "performed_via_github_app": null
}