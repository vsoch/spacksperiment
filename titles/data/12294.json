{
    "url": "https://api.github.com/repos/spack/spack/issues/12294",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12294/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12294/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12294/events",
    "html_url": "https://github.com/spack/spack/issues/12294",
    "id": 477484002,
    "node_id": "MDU6SXNzdWU0Nzc0ODQwMDI=",
    "number": 12294,
    "title": "Two ways to install from buildcache: `spack install` vs `spack buildcache install`",
    "user": {
        "login": "scottwittenburg",
        "id": 6527504,
        "node_id": "MDQ6VXNlcjY1Mjc1MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6527504?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scottwittenburg",
        "html_url": "https://github.com/scottwittenburg",
        "followers_url": "https://api.github.com/users/scottwittenburg/followers",
        "following_url": "https://api.github.com/users/scottwittenburg/following{/other_user}",
        "gists_url": "https://api.github.com/users/scottwittenburg/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scottwittenburg/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scottwittenburg/subscriptions",
        "organizations_url": "https://api.github.com/users/scottwittenburg/orgs",
        "repos_url": "https://api.github.com/users/scottwittenburg/repos",
        "events_url": "https://api.github.com/users/scottwittenburg/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scottwittenburg/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 880675484,
            "node_id": "MDU6TGFiZWw4ODA2NzU0ODQ=",
            "url": "https://api.github.com/repos/spack/spack/labels/binary-packages",
            "name": "binary-packages",
            "color": "fc5fb3",
            "default": false,
            "description": ""
        },
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 759411369,
            "node_id": "MDU6TGFiZWw3NTk0MTEzNjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/buildcache",
            "name": "buildcache",
            "color": "bf354c",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 8,
    "created_at": "2019-08-06T16:40:11Z",
    "updated_at": "2019-11-14T13:26:12Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "It seems there are two distinct ways to install a package from a binary mirror (buildcache).  The default when using `spack install` is to check configured mirrors for binaries and try to install specs from those mirrors when possible, but only inside the loop that traverses all the specs dependencies (including build dependencies).  When using `spack buildcache install`, only link and run dependencies are considered, and thus, this path is faster when installing from a buildcache where the build dependencies are not also stored (since spack will not first have to install all the build deps from source).\r\n\r\nI've looked at the code that does both of these, and it's not clear to me how to refactor the `spack install` approach so that it first tries to install just the link and run dependencies, and then only when that fails, to carry on with installing from source.\r\n\r\nOne approach might be to check mirrors first for link/run deps, and then either proceed with installation from source if any of those deps are missing, or else use the `spack buildcache install` approach if they're present.  Another approach could be to just try the equivalent of the `spack buildcache install` approach first, and only if that fails, do the normal `spack install...` process.\r\n\r\n### Steps to reproduce the issue\r\n\r\nI've done this in a basic Ubuntu Docker container, using the `develop` branch of spack, and mounting a directory where the buildcache and some other things can be saved/written. \r\n\r\n```\r\n    $ docker run --rm -v /data/scott/Documents/spack/install_from_bincache:/work -ti ubuntu:18.04\r\n```\r\n\r\nInstall some things we'll need for this test:\r\n\r\n```\r\n    root@12149ab0a2e3:/# apt-get install vim git build-essential python-dev curl gnupg2\r\n```\r\n\r\nClone spack, configure a compiler:\r\n\r\n```\r\n    root@12149ab0a2e3:/# cd /work\r\n    root@12149ab0a2e3:/work# git clone https://github.com/spack/spack.git\r\n    root@12149ab0a2e3:/work# cd spack\r\n    root@12149ab0a2e3:/work# source share/spack/setup-env.sh\r\n    root@12149ab0a2e3:/work# spack compiler find\r\n```\r\n\r\nNow check out the spec of `libxcb`:\r\n\r\n```\r\n    root@12149ab0a2e3:/work/spack# spack spec libxcb\r\n    Input spec\r\n    --------------------------------\r\n    libxcb\r\n\r\n    Concretized\r\n    --------------------------------\r\n    libxcb@1.13%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n        ^libpthread-stubs@0.4%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n        ^libxau@1.0.8%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n            ^pkgconf@1.6.1%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n            ^util-macros@1.19.1%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n            ^xproto@7.0.31%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n        ^libxdmcp@1.1.2%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n            ^libbsd@0.9.1%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n        ^xcb-proto@1.13%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n```\r\n\r\nFrom looking at the package file for libxcb, we can see that some of those are build\r\ndependencies (`pkgconf`, `util-macros`, `xcb-proto`).  Now install the package and\r\ncreate a buildcache for it (need to set up a signing key first):\r\n\r\n```\r\n    root@12149ab0a2e3:/work# spack install libxcb\r\n    root@12149ab0a2e3:/work# export SPACK_SIGNING_KEY=\"...real signing key...\"\r\n    root@12149ab0a2e3:/work# export GNUPGHOME=\"/work/spack/opt/spack/gpg\"\r\n    root@12149ab0a2e3:/work# spack gpg list\r\n    root@12149ab0a2e3:/work# echo ${SPACK_SIGNING_KEY} | base64 --decode | gpg2 --import\r\n    root@12149ab0a2e3:/work# spack buildcache create -a -f -d /work/mymirror libxcb\r\n```\r\n\r\nIf we look at the contents of the buildcache just created, we can see that not\r\nall the dependencies listed by `spack spec libxcb`, above, are present.  In fact\r\nit's missing the build dependencies, which is expected, as the code for\r\ncreating a buildcache specifically only grabs link and run dependencies.\r\n\r\n```\r\n    root@12149ab0a2e3:/work/spack# ls -al /work/mymirror/build_cache/\r\n    total 40\r\n    drwxr-xr-x 3 root root 4096 Jul 24 23:29 .\r\n    drwxr-xr-x 3 root root 4096 Jul 24 23:21 ..\r\n    -rw-r--r-- 1 root root 1383 Jul 24 23:29 index.html\r\n    drwxr-xr-x 3 root root 4096 Jul 24 23:21 linux-ubuntu18.04-x86_64\r\n    -rw-r--r-- 1 root root  613 Jul 24 23:28 linux-ubuntu18.04-x86_64-gcc-7.4.0-libbsd-0.9.1-4xrvxugozx2lpoc5cb4ipkbzh7e64qrb.spec.yaml\r\n    -rw-r--r-- 1 root root  631 Jul 24 23:28 linux-ubuntu18.04-x86_64-gcc-7.4.0-libpthread-stubs-0.4-77is2pteir3ihs3yuxwsf5f7x5tlcf36.spec.yaml\r\n    -rw-r--r-- 1 root root 1051 Jul 24 23:28 linux-ubuntu18.04-x86_64-gcc-7.4.0-libxau-1.0.8-3jfpohqjuebsm4uht2x5gba32rjedzsv.spec.yaml\r\n    -rw-r--r-- 1 root root 2787 Jul 24 23:28 linux-ubuntu18.04-x86_64-gcc-7.4.0-libxcb-1.13-myufhdg4fndsakfel5sbm3movn4eqnia.spec.yaml\r\n    -rw-r--r-- 1 root root 1054 Jul 24 23:28 linux-ubuntu18.04-x86_64-gcc-7.4.0-libxdmcp-1.1.2-fhimfa7ooiko4t2shafpwlspsqy3qyfg.spec.yaml\r\n    -rw-r--r-- 1 root root  615 Jul 24 23:29 linux-ubuntu18.04-x86_64-gcc-7.4.0-xproto-7.0.31-ib3gey4fu7oy4daowwivbcir36qkobdd.spec.yaml\r\n```\r\n\r\nNow we'll remove libxcb from our install tree, and try to re-install it from\r\nthe buildcache:\r\n\r\n```\r\n    root@12149ab0a2e3:/work# spack uninstall --all\r\n    root@12149ab0a2e3:/work/spack# spack find\r\n    ==> 0 installed packages\r\n    root@12149ab0a2e3:/work# spack install libxcb\r\n    ==> Installing libpthread-stubs\r\n    ==> Searching for binary cache of libpthread-stubs\r\n    ==> Finding buildcaches in /work/mymirror/build_cache\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libbsd-0.9.1-4xrvxugozx2lpoc5cb4ipkbzh7e64qrb.spec.yaml\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxau-1.0.8-3jfpohqjuebsm4uht2x5gba32rjedzsv.spec.yaml\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-xproto-7.0.31-ib3gey4fu7oy4daowwivbcir36qkobdd.spec.yaml\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxcb-1.13-myufhdg4fndsakfel5sbm3movn4eqnia.spec.yaml\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxdmcp-1.1.2-fhimfa7ooiko4t2shafpwlspsqy3qyfg.spec.yaml\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libpthread-stubs-0.4-77is2pteir3ihs3yuxwsf5f7x5tlcf36.spec.yaml\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64/gcc-7.4.0/libpthread-stubs-0.4/linux-ubuntu18.04-x86_64-gcc-7.4.0-libpthread-stubs-0.4-77is2pteir3ihs3yuxwsf5f7x5tlcf36.spack\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Installing libpthread-stubs from binary cache\r\n    gpg: Signature made Wed Jul 24 23:28:48 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Successfully installed libpthread-stubs from binary cache\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/libpthread-stubs-0.4-77is2pteir3ihs3yuxwsf5f7x5tlcf36\r\n    ==> Installing pkgconf\r\n    ==> Searching for binary cache of pkgconf\r\n    ==> No binary for pkgconf found: installing from source\r\n    ==> Using cached archive: /work/spack/var/spack/cache/pkgconf/pkgconf-1.6.1.tar.xz\r\n    ==> Staging archive: /work/spack/var/spack/stage/pkgconf-1.6.1-j566ycz3omr2fiizbs7kihseiaa46hl4/pkgconf-1.6.1.tar.xz\r\n    ==> Created stage in /work/spack/var/spack/stage/pkgconf-1.6.1-j566ycz3omr2fiizbs7kihseiaa46hl4\r\n    ==> No patches needed for pkgconf\r\n    ==> Building pkgconf [AutotoolsPackage]\r\n    ==> Executing phase: 'autoreconf'\r\n    ==> Executing phase: 'configure'\r\n    ==> Executing phase: 'build'\r\n    ==> Executing phase: 'install'\r\n    ==> Successfully installed pkgconf\r\n      Fetch: 0.00s.  Build: 10.69s.  Total: 10.69s.\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/pkgconf-1.6.1-j566ycz3omr2fiizbs7kihseiaa46hl4\r\n    ==> Installing util-macros\r\n    ==> Searching for binary cache of util-macros\r\n    ==> No binary for util-macros found: installing from source\r\n    ==> Using cached archive: /work/spack/var/spack/cache/util-macros/util-macros-1.19.1.tar.bz2\r\n    ==> Staging archive: /work/spack/var/spack/stage/util-macros-1.19.1-a226ran4thxadofd7yow3sfng3gy3t3k/util-macros-1.19.1.tar.bz2\r\n    ==> Created stage in /work/spack/var/spack/stage/util-macros-1.19.1-a226ran4thxadofd7yow3sfng3gy3t3k\r\n    ==> No patches needed for util-macros\r\n    ==> Building util-macros [AutotoolsPackage]\r\n    ==> Executing phase: 'autoreconf'\r\n    ==> Executing phase: 'configure'\r\n    ==> Executing phase: 'build'\r\n    ==> Executing phase: 'install'\r\n    ==> Successfully installed util-macros\r\n      Fetch: 0.00s.  Build: 1.90s.  Total: 1.90s.\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/util-macros-1.19.1-a226ran4thxadofd7yow3sfng3gy3t3k\r\n    ==> Installing xproto\r\n    ==> Searching for binary cache of xproto\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64/gcc-7.4.0/xproto-7.0.31/linux-ubuntu18.04-x86_64-gcc-7.4.0-xproto-7.0.31-ib3gey4fu7oy4daowwivbcir36qkobdd.spack\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Installing xproto from binary cache\r\n    gpg: Signature made Wed Jul 24 23:29:00 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Successfully installed xproto from binary cache\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/xproto-7.0.31-ib3gey4fu7oy4daowwivbcir36qkobdd\r\n    ==> Installing libxau\r\n    ==> Searching for binary cache of libxau\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64/gcc-7.4.0/libxau-1.0.8/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxau-1.0.8-3jfpohqjuebsm4uht2x5gba32rjedzsv.spack\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Installing libxau from binary cache\r\n    gpg: Signature made Wed Jul 24 23:28:59 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Installing patchelf\r\n    ==> Fetching file:///work/mymirror/patchelf/patchelf-0.9.tar.gz\r\n    curl: (37) Couldn't open file /work/mymirror/patchelf/patchelf-0.9.tar.gz\r\n    ==> Fetching from file:///work/mymirror/patchelf/patchelf-0.9.tar.gz failed.\r\n    ==> Fetching http://nixos.org/releases/patchelf/patchelf-0.9/patchelf-0.9.tar.gz\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Staging archive: /work/spack/var/spack/stage/patchelf-0.9-fhmhzc2wyarwcnkityt4byd7q77r62kw/patchelf-0.9.tar.gz\r\n    ==> Created stage in /work/spack/var/spack/stage/patchelf-0.9-fhmhzc2wyarwcnkityt4byd7q77r62kw\r\n    ==> No patches needed for patchelf\r\n    ==> Building patchelf [AutotoolsPackage]\r\n    ==> Executing phase: 'autoreconf'\r\n    ==> Executing phase: 'configure'\r\n    ==> Executing phase: 'build'\r\n    ==> Executing phase: 'install'\r\n    ==> Successfully installed patchelf\r\n      Fetch: 1.95s.  Build: 8.74s.  Total: 10.70s.\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/patchelf-0.9-fhmhzc2wyarwcnkityt4byd7q77r62kw\r\n    ==> Successfully installed libxau from binary cache\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/libxau-1.0.8-3jfpohqjuebsm4uht2x5gba32rjedzsv\r\n    ==> Installing libbsd\r\n    ==> Searching for binary cache of libbsd\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64/gcc-7.4.0/libbsd-0.9.1/linux-ubuntu18.04-x86_64-gcc-7.4.0-libbsd-0.9.1-4xrvxugozx2lpoc5cb4ipkbzh7e64qrb.spack\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Installing libbsd from binary cache\r\n    gpg: Signature made Wed Jul 24 23:28:50 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Successfully installed libbsd from binary cache\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/libbsd-0.9.1-4xrvxugozx2lpoc5cb4ipkbzh7e64qrb\r\n    ==> Installing libxdmcp\r\n    ==> Searching for binary cache of libxdmcp\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64/gcc-7.4.0/libxdmcp-1.1.2/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxdmcp-1.1.2-fhimfa7ooiko4t2shafpwlspsqy3qyfg.spack\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Installing libxdmcp from binary cache\r\n    gpg: Signature made Wed Jul 24 23:28:48 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Successfully installed libxdmcp from binary cache\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/libxdmcp-1.1.2-fhimfa7ooiko4t2shafpwlspsqy3qyfg\r\n    ==> Installing xcb-proto\r\n    ==> Searching for binary cache of xcb-proto\r\n    ==> No binary for xcb-proto found: installing from source\r\n    ==> Using cached archive: /work/spack/var/spack/cache/xcb-proto/xcb-proto-1.13.tar.gz\r\n    ==> Staging archive: /work/spack/var/spack/stage/xcb-proto-1.13-albm62lrpj4rlrkxvjsgztpdcghyn4tt/xcb-proto-1.13.tar.gz\r\n    ==> Created stage in /work/spack/var/spack/stage/xcb-proto-1.13-albm62lrpj4rlrkxvjsgztpdcghyn4tt\r\n    ==> No patches needed for xcb-proto\r\n    ==> Building xcb-proto [AutotoolsPackage]\r\n    ==> Executing phase: 'autoreconf'\r\n    ==> Executing phase: 'configure'\r\n    ==> Executing phase: 'build'\r\n    ==> Executing phase: 'install'\r\n    ==> Successfully installed xcb-proto\r\n      Fetch: 0.00s.  Build: 2.26s.  Total: 2.26s.\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/xcb-proto-1.13-albm62lrpj4rlrkxvjsgztpdcghyn4tt\r\n    ==> Installing libxcb\r\n    ==> Searching for binary cache of libxcb\r\n    ==> Fetching file:///work/mymirror/build_cache/linux-ubuntu18.04-x86_64/gcc-7.4.0/libxcb-1.13/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxcb-1.13-myufhdg4fndsakfel5sbm3movn4eqnia.spack\r\n    ######################################################################################################################################################################################################## 100.0%\r\n    ==> Installing libxcb from binary cache\r\n    gpg: Signature made Wed Jul 24 23:28:58 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Successfully installed libxcb from binary cache\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/libxcb-1.13-myufhdg4fndsakfel5sbm3movn4eqnia\r\n```\r\n\r\nFrom the output above, it's clear that spack is installing the build\r\ndependencies first, even though they shouldn't be strictly necessary when it\r\nwill install the package from the buildcache.  However if we try that\r\nexperiment again with buildcache install sub-command, we'll get different\r\nbehavior:\r\n\r\n```\r\n    root@12149ab0a2e3:/work/spack# spack uninstall --all\r\n    root@12149ab0a2e3:/work/spack# spack find\r\n    ==> 0 installed packages\r\n    root@12149ab0a2e3:/work/spack# spack buildcache install libxcb\r\n    ==> Finding buildcaches in /work/mymirror/build_cache\r\n    ==> buildcache spec(s) matching libxcb\r\n\r\n    ==> Installing buildcache for dependency spec libxdmcp@1.1.2%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64 ^libbsd@0.9.1%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    ==> Installing buildcache for dependency spec libbsd@0.9.1%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    ==> Already downloaded /work/spack/var/spack/stage/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libbsd-0.9.1-4xrvxugozx2lpoc5cb4ipkbzh7e64qrb.spack\r\n    ==> Installing buildcache for spec libbsd@0.9.1%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    gpg: Signature made Wed Jul 24 23:28:50 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Installing patchelf\r\n    ==> Using cached archive: /work/spack/var/spack/cache/patchelf/patchelf-0.9.tar.gz\r\n    ==> Staging archive: /work/spack/var/spack/stage/patchelf-0.9-fhmhzc2wyarwcnkityt4byd7q77r62kw/patchelf-0.9.tar.gz\r\n    ==> Created stage in /work/spack/var/spack/stage/patchelf-0.9-fhmhzc2wyarwcnkityt4byd7q77r62kw\r\n    ==> No patches needed for patchelf\r\n    ==> Building patchelf [AutotoolsPackage]\r\n    ==> Executing phase: 'autoreconf'\r\n    ==> Executing phase: 'configure'\r\n    ==> Executing phase: 'build'\r\n    ==> Executing phase: 'install'\r\n    ==> Successfully installed patchelf\r\n      Fetch: 0.01s.  Build: 6.96s.  Total: 6.97s.\r\n    [+] /work/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.4.0/patchelf-0.9-fhmhzc2wyarwcnkityt4byd7q77r62kw\r\n    ==> Already downloaded /work/spack/var/spack/stage/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxdmcp-1.1.2-fhimfa7ooiko4t2shafpwlspsqy3qyfg.spack\r\n    ==> Installing buildcache for spec libxdmcp@1.1.2%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    gpg: Signature made Wed Jul 24 23:28:48 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Installing buildcache for dependency spec libpthread-stubs@0.4%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    ==> Already downloaded /work/spack/var/spack/stage/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libpthread-stubs-0.4-77is2pteir3ihs3yuxwsf5f7x5tlcf36.spack\r\n    ==> Installing buildcache for spec libpthread-stubs@0.4%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    gpg: Signature made Wed Jul 24 23:28:48 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Installing buildcache for dependency spec libxau@1.0.8%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64 ^xproto@7.0.31%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    ==> Installing buildcache for dependency spec xproto@7.0.31%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    ==> Already downloaded /work/spack/var/spack/stage/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-xproto-7.0.31-ib3gey4fu7oy4daowwivbcir36qkobdd.spack\r\n    ==> Installing buildcache for spec xproto@7.0.31%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    gpg: Signature made Wed Jul 24 23:29:00 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Already downloaded /work/spack/var/spack/stage/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxau-1.0.8-3jfpohqjuebsm4uht2x5gba32rjedzsv.spack\r\n    ==> Installing buildcache for spec libxau@1.0.8%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    gpg: Signature made Wed Jul 24 23:28:59 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n    ==> Already downloaded /work/spack/var/spack/stage/build_cache/linux-ubuntu18.04-x86_64-gcc-7.4.0-libxcb-1.13-myufhdg4fndsakfel5sbm3movn4eqnia.spack\r\n    ==> Installing buildcache for spec libxcb@1.13%gcc@7.4.0 arch=linux-ubuntu18.04-x86_64\r\n    gpg: Signature made Wed Jul 24 23:28:58 2019 UTC\r\n    gpg:                using RSA key 3EBC745534BF2F520A0D0DDAF0EB13A2DE271C56\r\n    gpg: Good signature from \"Spack Maintainers (package-signing key) <maintainers@spack.io>\" [unknown]\r\n    gpg: WARNING: This key is not certified with a trusted signature!\r\n    gpg:          There is no indication that the signature belongs to the owner.\r\n    Primary key fingerprint: 3EBC 7455 34BF 2F52 0A0D  0DDA F0EB 13A2 DE27 1C56\r\n    ==> Relocating package from\r\n      /work/spack/opt/spack to /work/spack/opt/spack.\r\n```\r\n\r\nFrom that output, you can see that spack only needed to install `patchelf`\r\n(needed for binary relocation) from source before then installing everything\r\nelse from the binary mirror (because only link/run deps were taken).\r\n\r\n### Error Message\r\n\r\nThere is no error message resulting from this issue.\r\n\r\n### Information on your system\r\n\r\nThis issue happens on all platforms and doesn't depend on local configuration differences.\r\n",
    "performed_via_github_app": null
}