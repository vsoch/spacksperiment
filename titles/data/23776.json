{
    "url": "https://api.github.com/repos/spack/spack/issues/23776",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/23776/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/23776/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/23776/events",
    "html_url": "https://github.com/spack/spack/issues/23776",
    "id": 894898212,
    "node_id": "MDU6SXNzdWU4OTQ4OTgyMTI=",
    "number": 23776,
    "title": "amrex +rocm build fails: missing headers: rocprim/rocprim.hpp",
    "user": {
        "login": "eugeneswalker",
        "id": 38933153,
        "node_id": "MDQ6VXNlcjM4OTMzMTUz",
        "avatar_url": "https://avatars.githubusercontent.com/u/38933153?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eugeneswalker",
        "html_url": "https://github.com/eugeneswalker",
        "followers_url": "https://api.github.com/users/eugeneswalker/followers",
        "following_url": "https://api.github.com/users/eugeneswalker/following{/other_user}",
        "gists_url": "https://api.github.com/users/eugeneswalker/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/eugeneswalker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/eugeneswalker/subscriptions",
        "organizations_url": "https://api.github.com/users/eugeneswalker/orgs",
        "repos_url": "https://api.github.com/users/eugeneswalker/repos",
        "events_url": "https://api.github.com/users/eugeneswalker/events{/privacy}",
        "received_events_url": "https://api.github.com/users/eugeneswalker/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1571451565,
            "node_id": "MDU6TGFiZWwxNTcxNDUxNTY1",
            "url": "https://api.github.com/repos/spack/spack/labels/AMD",
            "name": "AMD",
            "color": "21a843",
            "default": false,
            "description": ""
        },
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 1474769306,
            "node_id": "MDU6TGFiZWwxNDc0NzY5MzA2",
            "url": "https://api.github.com/repos/spack/spack/labels/e4s",
            "name": "e4s",
            "color": "5224ad",
            "default": false,
            "description": ""
        },
        {
            "id": 966031931,
            "node_id": "MDU6TGFiZWw5NjYwMzE5MzE=",
            "url": "https://api.github.com/repos/spack/spack/labels/ecp",
            "name": "ecp",
            "color": "79d7ea",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2021-05-19T01:06:40Z",
    "updated_at": "2021-05-19T01:06:40Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "`amrex@21.05 +rocm amdgpu_target=gfx906` fails to build using:\r\n* `spack@develop` (20a99f4f046f5ad94ce0aa3457bffebd718d875a from `Tue May 18 10:50:55 2021 +0200`)\r\n* Ubuntu 20.04, GCC 9.3.0\r\n\r\nConcrete spec: [amrex-rocm.spec.yaml.txt](https://github.com/spack/spack/files/6503794/amrex-rocm.spec.yaml.txt)\r\nBuild log: [amrex-rocm-build-out.txt](https://github.com/spack/spack/files/6503804/amrex-rocm-build-out.txt)\r\n\r\n\r\nReplicate inside Docker container image `ecpe4s/ubuntu20.04-runner-x86_64:2021-05-15`\r\n```\r\n$> git clone https://github.com/spack/spack /spack\r\n$> (cd spack && git checkout 20a99f4f04)\r\n$> . /spack/share/spack/setup-env.sh\r\n\r\n$> spack mirror add E4S https://cache.e4s.io\r\n$> spack buildcache keys -it\r\nOK\r\n\r\n$> spack install --cache-only --only dependencies --include-build-deps -f ./amrex-rocm.spec.yaml\r\nOK\r\n\r\n$> spack install -f ./amrex-rocm.spec.yaml\r\n...\r\n==> Installing amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke\r\n==> Using cached archive: /spack/var/spack/cache/_source-cache/archive/eb/eb6d21e48279ad67278413c77b29a1754c18ffe741aa6b3a9f3f01eeac13177f.tar.gz\r\n==> No patches needed for amrex\r\n==> amrex: Executing phase: 'cmake'\r\n==> amrex: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n\r\n15 errors found in build log:\r\n     133    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_MultiFab.H:7:\r\n     134    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_FArrayBox.H:7:\r\n     135    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_BaseFab.H:19:\r\n     136    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_Reduce.H:5:\r\n     137    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_Gpu.H:19:\r\n     138    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_GpuLaunch.H:13:\r\n  >> 139    /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_GpuReduce.H:19:10: fatal error: 'rocprim/rocprim.hpp' file not found\r\n     140    #include <rocprim/rocprim.hpp>\r\n     141             ^~~~~~~~~~~~~~~~~~~~~\r\n     142    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX.cpp:4:\r\n     143    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_BaseFab.H:19:\r\n     144    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_Reduce.H:5:\r\n     145    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_Gpu.H:19:\r\n     146    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_GpuLaunch.H:13:\r\n  >> 147    /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_GpuReduce.H:19:10: fatal error: 'rocprim/rocprim.hpp' file not found\r\n     148    #include <rocprim/rocprim.hpp>\r\n     149             ^~~~~~~~~~~~~~~~~~~~~\r\n     150    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_DistributionMapping.cpp:3:\r\n     151    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_MultiFab.H:7:\r\n     152    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_FArrayBox.H:7:\r\n     153    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_BaseFab.H:19:\r\n\r\n....\r\n\r\n     256    /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/hip-4.1.0-qwiyvqt2rhoj35hbg4eutbf6lxpkrvtb/include/hip/hcc_detail/hip_runtime_api.h:55:41: note: expanded from macro 'DEPRECATED'\r\n     257    #define DEPRECATED(msg) __attribute__ ((deprecated(msg)))\r\n     258                                            ^\r\n     259    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_Arena.cpp:13:\r\n     260    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_Gpu.H:19:\r\n     261    In file included from /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_GpuLaunch.H:13:\r\n  >> 262    /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-src/Src/Base/AMReX_GpuReduce.H:19:10: fatal error: 'rocprim/rocprim.hpp' file not found\r\n     263    #include <rocprim/rocprim.hpp>\r\n     264             ^~~~~~~~~~~~~~~~~~~~~\r\n     265    1 warning and 1 error generated when compiling for gfx906.\r\n  >> 266    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:177: Src/CMakeFiles/amrex.dir/Base/AMReX_Random.cpp.o] Error 1\r\n     267    make[2]: *** Waiting for unfinished jobs....\r\n     268    1 warning and 1 error generated when compiling for gfx906.\r\n  >> 269    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:289: Src/CMakeFiles/amrex.dir/Base/AMReX_Arena.cpp.o] Error 1\r\n     270    1 warning and 1 error generated when compiling for gfx906.\r\n  >> 271    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:79: Src/CMakeFiles/amrex.dir/Base/AMReX_BlockMutex.cpp.o] Error 1\r\n     272    1 warning and 1 error generated when compiling for gfx906.\r\n  >> 273    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:219: Src/CMakeFiles/amrex.dir/Base/AMReX_ForkJoin.cpp.o] Error 1\r\n     274    1 warning and 1 error generated when compiling for gfx906.\r\n  >> 275    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:93: Src/CMakeFiles/amrex.dir/Base/AMReX.cpp.o] Error 1\r\n     276    1 warning and 1 error generated when compiling for gfx906.\r\n     277    1 warning and 1 error generated when compiling for gfx906.\r\n  >> 278    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:191: Src/CMakeFiles/amrex.dir/Base/AMReX_DistributionMapping.cpp.o] Error 1\r\n  >> 279    make[2]: *** [Src/CMakeFiles/amrex.dir/build.make:247: Src/CMakeFiles/amrex.dir/Base/AMReX_VisMF.cpp.o] Error 1\r\n     280    make[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-build-c2iqqoo'\r\n  >> 281    make[1]: *** [CMakeFiles/Makefile2:217: Src/CMakeFiles/amrex.dir/all] Error 2\r\n     282    make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-build-c2iqqoo'\r\n     283    make: *** [Makefile:139: all] Error 2\r\n\r\nSee build log for details:\r\n  /tmp/root/spack-stage/spack-stage-amrex-21.05-c2iqqooq7qqdu4snbn5xavx2kragc6ke/spack-build-out.txt\r\n```\r\n\r\n@mic84 @asalmgren @eschnett ",
    "performed_via_github_app": null
}