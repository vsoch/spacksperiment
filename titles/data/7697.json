{
    "url": "https://api.github.com/repos/spack/spack/issues/7697",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7697/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7697/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7697/events",
    "html_url": "https://github.com/spack/spack/issues/7697",
    "id": 312361753,
    "node_id": "MDU6SXNzdWUzMTIzNjE3NTM=",
    "number": 7697,
    "title": "Cannot build \"openmpi % clang\"",
    "user": {
        "login": "KineticTheory",
        "id": 17579601,
        "node_id": "MDQ6VXNlcjE3NTc5NjAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/17579601?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/KineticTheory",
        "html_url": "https://github.com/KineticTheory",
        "followers_url": "https://api.github.com/users/KineticTheory/followers",
        "following_url": "https://api.github.com/users/KineticTheory/following{/other_user}",
        "gists_url": "https://api.github.com/users/KineticTheory/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/KineticTheory/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/KineticTheory/subscriptions",
        "organizations_url": "https://api.github.com/users/KineticTheory/orgs",
        "repos_url": "https://api.github.com/users/KineticTheory/repos",
        "events_url": "https://api.github.com/users/KineticTheory/events{/privacy}",
        "received_events_url": "https://api.github.com/users/KineticTheory/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 459210887,
            "node_id": "MDU6TGFiZWw0NTkyMTA4ODc=",
            "url": "https://api.github.com/repos/spack/spack/labels/mpi",
            "name": "mpi",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2018-04-09T01:17:57Z",
    "updated_at": "2018-04-12T17:47:52Z",
    "closed_at": "2018-04-12T17:47:52Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Summary\r\n\r\nI'm trying to build openmpi@3.0.1 with clang@6.0.0, but the configure step fails with the following error\r\n\r\n```\r\n  configure: WARNING: Could not find functional C++ compiler, but\r\n  configure: WARNING: support for the C++ MPI bindings was requested.\r\n  configure: error: Cannot continue\r\n```\r\n\r\nThe underlying error is `error while loading shared libraries: libc++.so.1: cannot open shared object file: No such file or directory`\r\n\r\nDoes anyone have advice for this recipe?  I'm guessing someone is building OpenMPI with Clang.  Is this error possibly related to #7115?\r\n\r\n### Actual Result\r\n\r\nWhen running `spack install openmpi % clang`, the build fails.  The relevant errors are here...\r\n\r\n`spack-build.out` reports:\r\n\r\n```\r\n*** C++ compiler and preprocessor\r\nchecking whether we are using the GNU C++ compiler... (cached) yes\r\nchecking whether /home/kt/spack.20180406/lib/spack/env/clang/clang++ accepts -g... (cached) yes\r\nchecking dependency style of /home/kt/spack.20180406/lib/spack/env/clang/clang++... (cached) gcc3\r\nchecking how to run the C++ preprocessor... /home/kt/spack.20180406/lib/spack/env/clang/clang++ -E\r\nchecking if C++ compiler works... no\r\n**********************************************************************\r\n* It appears that your C++ compiler is unable to produce working\r\n* executables.  A simple test application failed to properly\r\n* execute.  Note that this is likely not a problem with Open MPI,\r\n* but a problem with the local compiler installation.  More\r\n* information (including exactly what command was given to the\r\n* compiler and what error resulted when the command was executed) is\r\n* available in the config.log file in the Open MPI build directory.\r\n**********************************************************************\r\nconfigure: WARNING: Could not find functional C++ compiler, but\r\nconfigure: WARNING: support for the C++ MPI bindings was requested.\r\nconfigure: error: Cannot continue\r\n```\r\n\r\n`config.log` reports:\r\n\r\n```\r\nconfigure:23539: checking if C++ compiler works\r\nconfigure:23583: /home/kt/spack.20180406/lib/spack/env/clang/clang++ -o conftest -O3 -DNDEBUG -finline-functions   -I/home/kt/spack.20180406/opt/spack/linux-ubuntu18.04-x86_64/clang-6.0.0/zlib-1.2.11-5qffmms6gwykcikh6aag4h3z4scrfdla/include   -L/home/kt/spack.20180406/opt/spack/linux-ubuntu18.04-x86_64/clang-6.0.0/zlib-1.2.11-5qffmms6gwykcikh6aag4h3z4scrfdla/lib conftest.cpp  -lz >&5\r\nconfigure:23583: $? = 0\r\nconfigure:23583: ./conftest\r\n./conftest: error while loading shared libraries: libc++.so.1: cannot open shared object file: No such file or directory\r\nconfigure:23583: $? = 127\r\nconfigure: program exited with status 127\r\nconfigure: failed program was:\r\n| /* confdefs.h */\r\n| #define PACKAGE_NAME \"Open MPI\"\r\n| #define PACKAGE_TARNAME \"openmpi\"\r\n| #define PACKAGE_VERSION \"3.0.1\"\r\n| #define PACKAGE_STRING \"Open MPI 3.0.1\"\r\n\r\n<snip>\r\n\r\n| #define OPAL_ALIGNMENT_DOUBLE_COMPLEX 8\r\n| #define OPAL_ALIGNMENT_LONG_DOUBLE_COMPLEX 16\r\n| #define OPAL_ALIGNMENT_VOID_P 8\r\n| #define OPAL_ALIGNMENT_SIZE_T 8\r\n| #define OPAL_CXX \"/home/kt/spack.20180406/lib/spack/env/clang/clang++\"\r\n| #define SIZEOF_BOOL 0\r\n| #define OPAL_ALIGNMENT_CXX_BOOL 1\r\n| #define OMPI_CXX \"/home/kt/spack.20180406/lib/spack/env/clang/clang++\"\r\n| /* end confdefs.h.  */\r\n| #include <string>\r\n| \r\n| int\r\n| main ()\r\n| {\r\n| std::string foo = \"Hello, world\"\r\n|   ;\r\n|   return 0;\r\n| }\r\nconfigure:23599: result: no\r\nconfigure:24458: WARNING: Could not find functional C++ compiler, but\r\nconfigure:24460: WARNING: support for the C++ MPI bindings was requested.\r\nconfigure:24462: error: Cannot continue\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install llvm\r\n# register clang@6.0.0 in compilers.yaml\r\n$ spack install openmpi % clang\r\n```\r\n\r\n### Information on your system\r\n\r\n 1. I see this error on two systems.  Once is RHEL7 the other is Ubuntu 18.04 under Windows 10 WLS.\r\n 2. I'm using the `develop` branch of spack (updated 2018-04-07).\r\n 3. configuration details:\r\n\r\n```\r\n# compilers.yaml\r\ncompilers:\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    modules: []\r\n    operating_system: ubuntu18.04\r\n    paths:\r\n      cc: /home/kt/spack.20180406/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/llvm-6.0.0-shkmxxrtlpnrhqbbgksl67arwx3ig5jb/bin/clang\r\n      cxx: /home/kt/spack.20180406/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/llvm-6.0.0-shkmxxrtlpnrhqbbgksl67arwx3ig5jb/bin/clang++\r\n      f77: gfortran\r\n      fc: gfortran\r\n    spec: clang@6.0.0\r\n    target: x86_64\r\n```\r\n\r\n* In `packages.yaml` I register cmake as an external to avoid the `spack install cmake @ clang` issue (#6844).\r\n\r\n```\r\n# packages.yaml\r\npackages:\r\n  cmake:\r\n    buildable: False\r\n    modules:\r\n      cmake: cmake\r\n```",
    "performed_via_github_app": null
}