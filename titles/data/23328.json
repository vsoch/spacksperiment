{
    "url": "https://api.github.com/repos/spack/spack/issues/23328",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/23328/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/23328/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/23328/events",
    "html_url": "https://github.com/spack/spack/issues/23328",
    "id": 870204662,
    "node_id": "MDU6SXNzdWU4NzAyMDQ2NjI=",
    "number": 23328,
    "title": "Installation issue:  hdf +external-xdr ^libtirpc failing (libtirpc issue???) ",
    "user": {
        "login": "payerle",
        "id": 19287807,
        "node_id": "MDQ6VXNlcjE5Mjg3ODA3",
        "avatar_url": "https://avatars.githubusercontent.com/u/19287807?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/payerle",
        "html_url": "https://github.com/payerle",
        "followers_url": "https://api.github.com/users/payerle/followers",
        "following_url": "https://api.github.com/users/payerle/following{/other_user}",
        "gists_url": "https://api.github.com/users/payerle/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/payerle/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/payerle/subscriptions",
        "organizations_url": "https://api.github.com/users/payerle/orgs",
        "repos_url": "https://api.github.com/users/payerle/repos",
        "events_url": "https://api.github.com/users/payerle/events{/privacy}",
        "received_events_url": "https://api.github.com/users/payerle/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 5,
    "created_at": "2021-04-28T17:54:59Z",
    "updated_at": "2021-04-29T01:56:43Z",
    "closed_at": "2021-04-29T01:56:43Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "\r\nI am attempting to build hdf on a 64 bit system using libtirpc for external-xdr, but the build fails complaining that the hdf configure parameter --enable-hdf4-xdr is not supported for 64 bit mode.\r\n\r\n(This is a re-issue of #23297 --- I am in the process of moving from spack 0.14 to the most recent 0.16.1, and somehow the spack environment used in 23297 was corrupted.  I have cleaned up, confirmed that what I am using is a recent clone of repo, and that the problem persists).\r\nDebugging the hdf configure script a bit further, it appears that spack is correctly not passing either --enable-hdf4-xdr or --disable-hdf4-xdr (due to a bug in hdf configure script the latter is treated the same as the former), and that the hdf configure script attempts to determine if an external xdr is available by compiling a test code, which fails.\r\n\r\nThe test code appears to be failing because it cannot find the libtirpc header files types.h, xdr.h, which libtirpc installs into\r\n``` `spack location -i libtirpc`/include/tirpc/rpc```\r\nbut the include directory spack is using is only\r\n``` `spack location -i libtirpc`/include ```, i.e. stops at the include directory. (I.e., the value of self.spec['rpc'].headers.cpp_flags inside the hdf recipe is \"-I\\$LIBTIRPC_PREFIX/include\" and not -I\\$LIBTIRPC_PREFIX/include/tirpc). This is causing issues because the hdf test code is doing a simple\r\n```#include <rpc/xdr.h> ``` as can be seen in the attached config.log (further down).\r\n\r\nI  believe this to be a bug in the spack recipe for libtirpc, as not only does the test code usage seem correct, but even the types.h file from libtirpc has include statements like\r\n```#include <netconfig.h>```\r\nwhich would also require the -I flags to include the tirpc subdirectory in order to work.\r\n\r\nAs a test, I manually added symlinks in the libtirpc installation directory\r\n```console\r\ncd `spack location -i libtircp`\r\ncd include\r\nln tircp/* .\r\n```\r\nand the spack installation of hdf succeeded.\r\n\r\nMy old #15993 patch explicitly added ```-I\\$LIBTIRPC_PREFIX/include/tirpc``` to the preprocessor flags, since then things have generalized into a virtual rpc dependency, but the extra 'tirpc' subdirectory got lost at some point, and without that the various rpc header files are not being found with an ```#include <rpc/xdr.h>``` or similar include directive.\r\n\r\nSo I believe the proper solution is to modify libtirpc to set compilation flags which include ```-I\\$LIBTIRCP_PREFIX/include/tirpc```, possibly in addition to \r\n```-I\\$LIBRIRPC_PREFIX/include```, but I am not sure how to achieve that in spack.  Alternatively, we could add special code to hdr to add an ```-I\\$LIBTIRPC_PREFIX/include/tirpc`` flag  if it is using external-xdr and using libtirpc as the rpc provider, but this seems like it is likely to be needed in everything that possibly uses libtirpc for rpc, and so seems poor spack design.\r\n  \r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install hdf@4.2.14 +external-xdr +fortran ~java ~netcdf +pic ~shared +szip %gcc@8.4.0\r\n...\r\nconfigure: error: --enable-hdf4-xdr is not supported for 64 bit mode.\r\n```\r\nwhere we are using libtirpc as the provider for 'rpc'\r\n\r\n### Information on your system\r\n\r\n```console$ spack debug report\r\n* **Spack:** 0.16.1-2430-47196f30d7\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rhel8-x86_64\r\n* **Concretizer:** original\r\n```\r\nAs mentioned previously, our configuration includes\r\n```console\r\npackages:\r\n  #Default settings for all packages\r\n  all:\r\n    buildable: true\r\n    providers::\r\n      ...\r\n      rpc: [libtirpc]\r\n     ...\r\n```\r\n\r\n### Additional information\r\n\r\n* [spack-configure-args.txt](https://github.com/spack/spack/files/6393800/spack-configure-args.txt)\r\n* [spack-build-out.txt](https://github.com/spack/spack/files/6393801/spack-build-out.txt)\r\n* [spack-build-env.txt](https://github.com/spack/spack/files/6393802/spack-build-env.txt)\r\n* [spack-build-02-configure-out.txt](https://github.com/spack/spack/files/6393803/spack-build-02-configure-out.txt)\r\n* [spack-build-01-autoreconf-out.txt](https://github.com/spack/spack/files/6393804/spack-build-01-autoreconf-out.txt)\r\n* [config.log](https://github.com/spack/spack/files/6393806/config.log)\r\n\r\n@lrknox as a maintainer of hdf package.\r\nNo maintainers found for libtirpc (which I suspect is the real culprit)\r\n\r\n### General information\r\n\r\n- [x ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x ] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [x ] I have uploaded the build log and environment files\r\n- [x ] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}