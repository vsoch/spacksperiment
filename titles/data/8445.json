{
    "url": "https://api.github.com/repos/spack/spack/issues/8445",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8445/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8445/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8445/events",
    "html_url": "https://github.com/spack/spack/issues/8445",
    "id": 331457767,
    "node_id": "MDU6SXNzdWUzMzE0NTc3Njc=",
    "number": 8445,
    "title": "Making SPACK aware of batch system libraries required to make OpenMPI scheduler aware",
    "user": {
        "login": "samfux84",
        "id": 11944875,
        "node_id": "MDQ6VXNlcjExOTQ0ODc1",
        "avatar_url": "https://avatars.githubusercontent.com/u/11944875?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/samfux84",
        "html_url": "https://github.com/samfux84",
        "followers_url": "https://api.github.com/users/samfux84/followers",
        "following_url": "https://api.github.com/users/samfux84/following{/other_user}",
        "gists_url": "https://api.github.com/users/samfux84/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/samfux84/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/samfux84/subscriptions",
        "organizations_url": "https://api.github.com/users/samfux84/orgs",
        "repos_url": "https://api.github.com/users/samfux84/repos",
        "events_url": "https://api.github.com/users/samfux84/events{/privacy}",
        "received_events_url": "https://api.github.com/users/samfux84/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 459210887,
            "node_id": "MDU6TGFiZWw0NTkyMTA4ODc=",
            "url": "https://api.github.com/repos/spack/spack/labels/mpi",
            "name": "mpi",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 16,
    "created_at": "2018-06-12T06:46:29Z",
    "updated_at": "2018-06-19T06:07:59Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I have built OpenMPI 3.0.1 with GCC 4.8.5 on our system. In order to be batch system aware, OpenMPI is linked against some batch system libraries:\r\n\r\n```\r\n[spackapps@eu-develop-01 lib]$ ldd libopen-rte.so\r\n        linux-vdso.so.1 =>  (0x00007fff59def000)\r\n        libbat.so => /cluster/apps/lsf/10.1/linux2.6-glibc2.3-x86_64/lib/libbat.so (0x00002b03ee883000)\r\n        liblsf.so => /cluster/apps/lsf/10.1/linux2.6-glibc2.3-x86_64/lib/liblsf.so (0x00002b03eec24000)\r\n(skipping the rest of the ldd output)\r\n```\r\n\r\nWhen I now build an application like paraview 5.4.1 with the command\r\n\r\n`spack install paraview@5.4.1+qt+hdf5+mpi~opengl2 ^qt@4.8.6+dbus+examples+gtk+krellpatch~webkit ^pango@1.40.3+X ^cairo@1.14.10+X ^harfbuzz@1.4.5 ^gdk-pixbuf@2.31.3 ^atk@2.21.90 ^gobject-introspection@1.49.1 ^hdf5@1.10.1+cxx+fortran+hl+mpi+szip ^openmpi@3.0.1+java+sqlite3 ^glib@2.56.0 ^pcre@8.41+jit %gcc@4.8.5 arch=linux-centos7-x86_64`\r\n\r\nthen it fails with some undefined reference error, due to not finding the batch system libraries that OpenMPI is linked to:\r\n\r\n```\r\n     22693    /bin/ld: warning: libbat.so, needed by /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx\r\n              5m2zfevlmin7frsnmlspvvtvcjyj/lib/libmpi_cxx.so, not found (try using -rpath or -rpath-link)\r\n     22694    /bin/ld: warning: liblsf.so, needed by /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx\r\n              5m2zfevlmin7frsnmlspvvtvcjyj/lib/libmpi_cxx.so, not found (try using -rpath or -rpath-link)\r\n  >> 22695    /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx5m2zfevlmin7frsnmlspvvtvcjyj/lib/libope\r\n              n-rte.so.40: undefined reference to `lsb_sysmsg'                                                             \r\n  >> 22696    /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx5m2zfevlmin7frsnmlspvvtvcjyj/lib/libope\r\n              n-rte.so.40: undefined reference to `lsb_launch'                                                             \r\n  >> 22697    /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx5m2zfevlmin7frsnmlspvvtvcjyj/lib/libope\r\n              n-rte.so.40: undefined reference to `lsb_init'                                                               \r\n  >> 22698    /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx5m2zfevlmin7frsnmlspvvtvcjyj/lib/libope\r\n              n-rte.so.40: undefined reference to `lsb_errno'                                                              \r\n  >> 22699    /cluster/spack/apps/linux-centos7-x86_64/gcc-4.8.5/openmpi-3.0.1-7rtx5m2zfevlmin7frsnmlspvvtvcjyj/lib/libope\r\n              n-rte.so.40: undefined reference to `lsb_getalloc'                                                           \r\n  >> 22700    collect2: error: ld returned 1 exit status\r\n  >> 22701    make[2]: *** [Utilities/LegacyColorMapXMLToJSON/CMakeFiles/vtkLegacyColorMapXMLToJSON.dir/build.make:193: bi\r\n              n/vtkLegacyColorMapXMLToJSON] Error 1  \r\n```\r\n\r\nMy question would now be, how can I provide spack the paths to this library, such that it finds them, when needed for compiling an application linked to OpenMPI ? Is there a way in spack how I can add other paths to rpath, when I build OpenMPI ? Or would this paths needed to be added when building applications depending on OpenMPI ?\r\n\r\nAny help is appreciated.",
    "performed_via_github_app": null
}