{
    "url": "https://api.github.com/repos/spack/spack/issues/11688",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/11688/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/11688/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/11688/events",
    "html_url": "https://github.com/spack/spack/pull/11688",
    "id": 455500122,
    "node_id": "MDExOlB1bGxSZXF1ZXN0Mjg3NzM0NDgy",
    "number": 11688,
    "title": "ResourceStage: use expanded archive name by default",
    "user": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2019-06-13T02:01:32Z",
    "updated_at": "2019-06-20T18:09:32Z",
    "closed_at": "2019-06-20T18:09:32Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/11688",
        "html_url": "https://github.com/spack/spack/pull/11688",
        "diff_url": "https://github.com/spack/spack/pull/11688.diff",
        "patch_url": "https://github.com/spack/spack/pull/11688.patch"
    },
    "body": "For resources, it is desirable to use the expanded archive name of the resource as the name of the directory when adding it to the root staging area.\r\n\r\n#11528 established 'spack-src' as the universal directory where source files are placed, which also affected the behavior of resources managed with Stages.\r\n\r\nThis adds a new property to Stage to remember the name of the expanded source directory, and uses this as the default name when placing a resource directory in the root staging area.\r\n\r\nThis also:\r\n\r\n* Ensures that downloaded sources are archived using the expanded archive name\r\n* Updates working_dir context manager to guarantee restoration of original working directory when an exception occurs\r\n* Adds a \"temp_cwd\" context manager which creates a temporary directory and sets it as the working directory\r\n* ~Tests handling of exploding tarballs~ (Edit 6/19: this was already handled)\r\n\r\nTODOS:\r\n\r\n- [x] Tests should be added to avoid regressions.\r\n- [x] (New: 6/14) Fix python 2.6 errors\r\n\r\nNote: this does not support resources using the `go` fetch strategy, but `go` fetching logic is currently in flux anyhow and no packages currently use `go`-based resources.\r\n\r\nNote: this undoes some changes from https://github.com/spack/spack/pull/11676 and https://github.com/spack/spack/pull/11667 that accommodated the behavior changes from #11528. Those changes are compatible with this PR but I removed them because they are not strictly required (and in general the purpose of this PR was to reduce the amount of work required to use resources). In terms of staging, this PR would work with the logic for `hpcviewer` before or after #11676, but the `hpcviewer` changes are not undone because that PR updated the directory structure for that package build.",
    "performed_via_github_app": null
}