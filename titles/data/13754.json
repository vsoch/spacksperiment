{
    "url": "https://api.github.com/repos/spack/spack/issues/13754",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13754/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13754/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13754/events",
    "html_url": "https://github.com/spack/spack/issues/13754",
    "id": 523484968,
    "node_id": "MDU6SXNzdWU1MjM0ODQ5Njg=",
    "number": 13754,
    "title": "--config-scope seems to be ignored",
    "user": {
        "login": "tjfulle",
        "id": 1564391,
        "node_id": "MDQ6VXNlcjE1NjQzOTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1564391?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tjfulle",
        "html_url": "https://github.com/tjfulle",
        "followers_url": "https://api.github.com/users/tjfulle/followers",
        "following_url": "https://api.github.com/users/tjfulle/following{/other_user}",
        "gists_url": "https://api.github.com/users/tjfulle/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tjfulle/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tjfulle/subscriptions",
        "organizations_url": "https://api.github.com/users/tjfulle/orgs",
        "repos_url": "https://api.github.com/users/tjfulle/repos",
        "events_url": "https://api.github.com/users/tjfulle/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tjfulle/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483406,
            "node_id": "MDU6TGFiZWw1MTI0ODM0MDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-high",
            "name": "impact-high",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-11-15T13:59:37Z",
    "updated_at": "2019-11-15T21:32:59Z",
    "closed_at": "2019-11-15T21:32:58Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Starting with commit 43b0356e14a8227f33040302cf948d3c98508d59, configuration scopes seem to be ignored.  For example, with one commit before (dc36b4737d16ea4aa49daa14fb782b5ea85b60e3):\r\n\r\n```console\r\n$ cd $spack_root\r\n$ git checkout dc36b4737d16ea4aa49daa14fb782b5ea85b60e3\r\n$ ./bin/spack --config-scope=<some path> config blame repos\r\n---                                            repos:\r\n<some path>/repos.yaml:2                       - $nevada_toolset2_root/var/nevada/spack/repo\r\n<spack root>/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n```\r\n\r\nbut, after 43b0356e14a8227f33040302cf948d3c98508d59 I get\r\n\r\n```console\r\n$ cd $spack_root\r\n$ git checkout develop\r\n$ ./bin/spack --config-scope=<some path> config blame repos\r\n---                                            repos:\r\n<spack root>/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n```\r\n\r\nChecking out `lib/spack/spack/relocate.py` from dc36b4737d16ea4aa49daa14fb782b5ea85b60e3 seems to resolve the issue:\r\n\r\n```console\r\n$ cd $spack_root\r\n$ git co dc36b4737d16ea4aa49daa14fb782b5ea85b60e3 -- lib/spack/spack/relocate.py\r\n$ ./bin/spack --config-scope=<some path> config blame repos\r\n---                                            repos:\r\n<some path>/repos.yaml:2                       - $nevada_toolset2_root/var/nevada/spack/repo\r\n<spack root>/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n```\r\n\r\nOne of the changes in 43b0356e14a8227f33040302cf948d3c98508d59 is to the function signature of `file_is_relocatable` from\r\n\r\n```python\r\ndef file_is_relocatable(file):\r\n    ...\r\n```\r\n\r\nTo\r\n\r\n```python\r\ndef file_is_relocatable(\r\n    file, paths_to_relocate=[spack.store.layout.root, spack.paths.prefix]):\r\n```\r\n\r\n`paths_to_relocate` is then used in the function.  Simply making the following change fixes the config scope issue for me:\r\n\r\n```python\r\ndef file_is_relocatable(file):\r\n    paths_to_relocate = [spack.store.layout.root, spack.paths.prefix]\r\n```\r\n\r\nThat said, this makes no sense to me.  The function `file_is_relocatable` is not called when `spack config blame ...` is issued (tested by dropping `assert 0` as the first line of `file_is_relocatable`).  Nevertheless, the change does fix my issue.\r\n\r\nA grep of the spack source shows:\r\n\r\n```console\r\n$ cd $spack_root\r\n$ grep -irl  --include=*.py file_is_relocatable .\r\n./lib/spack/spack/test/relocate.py\r\n./lib/spack/spack/binary_distribution.py\r\n./lib/spack/spack/relocate.py\r\n```\r\n\r\nand none of the calls use the `paths_to_relocate` argument, so the change above should be fine, and it might be best to leave mutable arguments from function signature, if possible.\r\n\r\n\r\n@becker33, since he was the author of 43b0356e\r\n",
    "performed_via_github_app": null
}