{
    "url": "https://api.github.com/repos/spack/spack/issues/16250",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/16250/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/16250/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/16250/events",
    "html_url": "https://github.com/spack/spack/issues/16250",
    "id": 605166230,
    "node_id": "MDU6SXNzdWU2MDUxNjYyMzA=",
    "number": 16250,
    "title": "pip fails with 'No module named pkg_resources' when run from env managed view",
    "user": {
        "login": "hartzell",
        "id": 312978,
        "node_id": "MDQ6VXNlcjMxMjk3OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/312978?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hartzell",
        "html_url": "https://github.com/hartzell",
        "followers_url": "https://api.github.com/users/hartzell/followers",
        "following_url": "https://api.github.com/users/hartzell/following{/other_user}",
        "gists_url": "https://api.github.com/users/hartzell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hartzell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hartzell/subscriptions",
        "organizations_url": "https://api.github.com/users/hartzell/orgs",
        "repos_url": "https://api.github.com/users/hartzell/repos",
        "events_url": "https://api.github.com/users/hartzell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hartzell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 537065486,
            "node_id": "MDU6TGFiZWw1MzcwNjU0ODY=",
            "url": "https://api.github.com/repos/spack/spack/labels/environments",
            "name": "environments",
            "color": "d4c5f9",
            "default": false,
            "description": null
        },
        {
            "id": 446619758,
            "node_id": "MDU6TGFiZWw0NDY2MTk3NTg=",
            "url": "https://api.github.com/repos/spack/spack/labels/python",
            "name": "python",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        },
        {
            "id": 877274892,
            "node_id": "MDU6TGFiZWw4NzcyNzQ4OTI=",
            "url": "https://api.github.com/repos/spack/spack/labels/views",
            "name": "views",
            "color": "70ff6d",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "adamjstewart",
            "id": 12021217,
            "node_id": "MDQ6VXNlcjEyMDIxMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/adamjstewart",
            "html_url": "https://github.com/adamjstewart",
            "followers_url": "https://api.github.com/users/adamjstewart/followers",
            "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
            "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
            "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
            "repos_url": "https://api.github.com/users/adamjstewart/repos",
            "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
            "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 8,
    "created_at": "2020-04-23T01:02:59Z",
    "updated_at": "2020-04-23T17:34:38Z",
    "closed_at": "2020-04-23T17:34:38Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I've installed an environment that includes a view.  When I try to use `pip` from that view it fails with \r\n\r\n```\r\nImportError: No module named pkg_resources\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\nI have a large Spack installation that my CI system built last night.\r\n\r\nI made a new clone of the repository and added the CI repo as an upstream (probably not important, but...).\r\n\r\nI ran `spack compiler add` to add gcc@8.4.0 to my etc/spack/compilers.yaml file for this installation, then created an environment with `spack env create --without-view ape`.\r\n\r\nI edited the `spack.yaml` to something like this (trimmed from real file):\r\n\r\n```yaml\r\n This is a Spack Environment file.\r\n #\r\n # It describes a set of packages to be installed, along with\r\n # configuration settings.\r\n spack:\r\n   include:\r\n     - /local_scratch/hartzell/spack-env-experiments/my-packages.yaml\r\n   # add package specs to the `specs` list\r\n   specs:\r\n     # many things deleted\r\n     - tmux\r\n     - tree\r\n     - vim\r\n     - wget\r\n     - zsh\r\n     - matrix:\r\n         - ['^python@2.7.16', '^python@3.7.6']\r\n         - [py-flake8, py-pip, py-virtualenv, py-setuptools]\r\n   concretization: separately\r\n   view:\r\n     the_project:\r\n       root: /tmp/moose\r\n       select:\r\n         - tmux\r\n         - py-pip^python@2.7.16\r\n         - py-setuptools^python@2.7.16\r\n         - python@2.7.16\r\n```\r\n\r\n`my-packages.yaml` sets up the compiler and java provider and then just pins versions of things that I need:\r\n\r\n```yaml\r\npackages:\r\n  all:\r\n    compiler: [gcc@8.4.0, gcc@4.8.5]\r\n    providers:\r\n      java: [openjdk]\r\n  aspell:\r\n    version: [0.60.6.1]\r\n  # ...\r\n```\r\n\r\nWhen I try to use the `pip` command from the view (e.g. to install `pipenv`), it fails.  I've tried simply putting the view's bin onto `PATH` as well as mucking about with `PYTHONPATH`.\r\n\r\n```console\r\n$ PATH=/tmp/moose/bin:$PATH pip install --user pipenv\r\nTraceback (most recent call last):\r\n  File \"/tmp/moose/bin/pip\", line 7, in <module>\r\n    from pkg_resources import load_entry_point\r\nImportError: No module named pkg_resources\r\n$ PYTHONPATH=/tmp/moose/lib/python2.7 PATH=/tmp/moose/bin:$PATH pip install --user pipenv\r\nTraceback (most recent call last):\r\n  File \"/tmp/moose/bin/pip\", line 7, in <module>\r\n    from pkg_resources import load_entry_point\r\nImportError: No module named pkg_resources\r\n$ PYTHONPATH=/tmp/moose/lib PATH=/tmp/moose/bin:$PATH pip install --user pipenv\r\nTraceback (most recent call last):\r\n  File \"/tmp/moose/bin/pip\", line 7, in <module>\r\n    from pkg_resources import load_entry_point\r\nImportError: No module named pkg_resources\r\n$\r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\n```console\r\n$ spack --debug --stacktrace <command>\r\n```\r\n\r\n### Information on your system\r\n\r\n$ spack debug report\r\n* **Spack:** 0.14.1-701-b24134320\r\n* **Python:** 2.7.5\r\n* **Platform:** linux-centos7-skylake_avx512\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [ x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ N/A] I have run the failing commands in debug mode and reported the output",
    "performed_via_github_app": null
}