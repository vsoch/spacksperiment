{
    "url": "https://api.github.com/repos/spack/spack/issues/2318",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2318/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2318/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2318/events",
    "html_url": "https://github.com/spack/spack/issues/2318",
    "id": 188922568,
    "node_id": "MDU6SXNzdWUxODg5MjI1Njg=",
    "number": 2318,
    "title": "Package depend_on('X'), but spec['X'] yields KeyError.",
    "user": {
        "login": "citibeth",
        "id": 1924215,
        "node_id": "MDQ6VXNlcjE5MjQyMTU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1924215?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/citibeth",
        "html_url": "https://github.com/citibeth",
        "followers_url": "https://api.github.com/users/citibeth/followers",
        "following_url": "https://api.github.com/users/citibeth/following{/other_user}",
        "gists_url": "https://api.github.com/users/citibeth/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/citibeth/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/citibeth/subscriptions",
        "organizations_url": "https://api.github.com/users/citibeth/orgs",
        "repos_url": "https://api.github.com/users/citibeth/repos",
        "events_url": "https://api.github.com/users/citibeth/events{/privacy}",
        "received_events_url": "https://api.github.com/users/citibeth/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2016-11-12T17:12:07Z",
    "updated_at": "2019-12-03T13:38:24Z",
    "closed_at": "2019-12-03T13:38:23Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "The build below fails with `KeyError: 'No spec with name blas in netlib-scalapack@2.0.2%gcc@4.9.3~fpic+shared arch=linux-centos7-x86_64'`.  This makes no sense, since `depends_on('blas')` is clearly in the `package.py`.  Anyone knows what's going on?  This might be related to #2310\r\n\r\n```\r\n==> Staging archive: /home2/rpfische/spack4/var/spack/stage/netlib-scalapack-2.0.2-lp76lr2jtob32jupbgayzzopayvdo7nh/scalapack-2.0.2.tgz\r\n==> Created stage in /home2/rpfische/spack4/var/spack/stage/netlib-scalapack-2.0.2-lp76lr2jtob32jupbgayzzopayvdo7nh\r\n==> No patches needed for netlib-scalapack\r\n==> Building netlib-scalapack [Package]\r\n==> Executing phase : 'install'\r\n==> Error: KeyError: 'No spec with name blas in netlib-scalapack@2.0.2%gcc@4.9.3~fpic+shared arch=linux-centos7-x86_64'\r\n/home2/rpfische/spack4/var/spack/repos/builtin/packages/netlib-scalapack/package.py:77, in install:\r\n     68       def install(self, spec, prefix):\r\n     69           options = [\r\n     70               \"-DBUILD_SHARED_LIBS:BOOL=%s\" % ('ON' if '+shared' in spec else\r\n     71                                                'OFF'),\r\n     72               \"-DBUILD_STATIC_LIBS:BOOL=%s\" % ('OFF' if '+shared' in spec else\r\n     73                                                'ON')\r\n     74           ]\r\n     75   \r\n     76           # Make sure we use Spack's Lapack:\r\n  >> 77           blas = spec['blas'].blas_libs\r\n     78           lapack = spec['lapack'].lapack_libs\r\n     79           options.extend([\r\n     80               '-DLAPACK_FOUND=true',\r\n     81               '-DLAPACK_INCLUDE_DIRS=%s' % spec['lapack'].prefix.include,\r\n     82               '-DLAPACK_LIBRARIES=%s' % (lapack.joined(';')),\r\n     83               '-DBLAS_LIBRARIES=%s' % (blas.joined(';'))\r\n     84           ])\r\n     85   \r\n     86           if '+fpic' in spec:\r\n     87               options.extend([\r\n     88                   \"-DCMAKE_C_FLAGS=-fPIC\",\r\n     89                   \"-DCMAKE_Fortran_FLAGS=-fPIC\"\r\n     90               ])\r\n     91   \r\n     92           options.extend(std_cmake_args)\r\n     93   \r\n     94           with working_dir('spack-build', create=True):\r\n     95               cmake('..', *options)\r\n     96               make()\r\n     97               make(\"install\")\r\n     98   \r\n     99           # The shared libraries are not installed correctly on Darwin:\r\n     100          if (sys.platform == 'darwin') and ('+shared' in spec):\r\n     101              fix_darwin_install_name(prefix.lib)\r\n\r\n<spack-build.out> is zero-length\r\n```\r\nHere is the concretized spec I'm trying to install...\r\n```pism@dev%gcc@4.9.3+cxx11~docs~extra+icebin~parallel-hdf5~parallel-netcdf3~parallel-netcdf4+proj~python+shared arch=linux-centos7-x86_64\r\n    ^cmake@3.6.1%gcc@4.9.3~doc+ncurses+openssl~ownlibs~qt arch=linux-centos7-x86_64\r\n        ^bzip2@1.0.6%gcc@4.9.3 arch=linux-centos7-x86_64\r\n        ^curl@7.50.3%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^openssl@system%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^zlib@1.2.8%gcc@4.9.3 arch=linux-centos7-x86_64\r\n        ^expat@2.2.0%gcc@4.9.3 arch=linux-centos7-x86_64\r\n        ^libarchive@3.2.1%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^libxml2@2.9.4%gcc@4.9.3~python arch=linux-centos7-x86_64\r\n                ^xz@5.2.2%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^lz4@131%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^lzma@4.32.7%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^lzo@2.09%gcc@4.9.3 arch=linux-centos7-x86_64\r\n            ^nettle@3.2%gcc@4.9.3 arch=linux-centos7-x86_64\r\n                ^gmp@6.1.1%gcc@4.9.3 arch=linux-centos7-x86_64\r\n                    ^m4@1.4.17%gcc@4.9.3+sigsegv arch=linux-centos7-x86_64\r\n                        ^libsigsegv@2.10%gcc@4.9.3 arch=linux-centos7-x86_64\r\n        ^ncurses@6.0%gcc@4.9.3 arch=linux-centos7-x86_64\r\n    ^fftw@3.3.5%gcc@4.9.3+float+long_double~mpi~openmp~pfft_patches~quad arch=linux-centos7-x86_64\r\n    ^gsl@2.2.1%gcc@4.9.3 arch=linux-centos7-x86_64\r\n    ^netcdf@4.4.1%gcc@4.9.3~hdf4 maxdims=1024 maxvars=8192+mpi arch=linux-centos7-x86_64\r\n        ^hdf5@1.10.0-patch1%gcc@4.9.3+cxx~debug+fortran+mpi+shared~szip~threadsafe arch=linux-centos7-x86_64\r\n            ^openmpi@1.10.1%gcc@4.9.3~mxm~pmi~psm~psm2~slurm~sqlite3~thread_multiple~tm~verbs+vt arch=linux-centos7-x86_64\r\n                ^hwloc@1.11.4%gcc@4.9.3 arch=linux-centos7-x86_64\r\n                    ^libpciaccess@0.13.4%gcc@4.9.3 arch=linux-centos7-x86_64\r\n                        ^libtool@2.4.6%gcc@4.9.3 arch=linux-centos7-x86_64\r\n                        ^pkg-config@0.29.1%gcc@4.9.3+internal_glib arch=linux-centos7-x86_64\r\n                        ^util-macros@1.19.0%gcc@4.9.3 arch=linux-centos7-x86_64\r\n    ^petsc@3.7.4%gcc@4.9.3+boost~complex~debug+double+hdf5+hypre+metis+mpi+mumps+shared+superlu-dist arch=linux-centos7-x86_64\r\n        ^hypre@2.11.1%gcc@4.9.3~internal-superlu+shared arch=linux-centos7-x86_64\r\n            ^openblas@0.2.19%gcc@4.9.3+fpic~openmp+shared arch=linux-centos7-x86_64\r\n        ^metis@5.1.0%gcc@4.9.3~debug~gdb~idx64~real64+shared arch=linux-centos7-x86_64\r\n        ^mumps@5.0.2%gcc@4.9.3+complex+double+float~idx64~metis+mpi~parmetis~ptscotch~scotch+shared arch=linux-centos7-x86_64\r\n            ^netlib-scalapack@2.0.2%gcc@4.9.3~fpic+shared arch=linux-centos7-x86_64\r\n        ^parmetis@4.0.3%gcc@4.9.3~debug~gdb+shared arch=linux-centos7-x86_64\r\n        ^superlu-dist@5.1.1%gcc@4.9.3 arch=linux-centos7-x86_64\r\n    ^proj@4.9.2%gcc@4.9.3 arch=linux-centos7-x86_64\r\n    ^python@3.5.2%gcc@4.9.3~tk~ucs4 arch=linux-centos7-x86_64\r\n        ^readline@6.3%gcc@4.9.3 arch=linux-centos7-x86_64\r\n        ^sqlite@3.8.5%gcc@4.9.3 arch=linux-centos7-x86_64\r\n    ^udunits2@2.2.20%gcc@4.9.3 arch=linux-centos7-x86_64\r\n```\r\n\r\n",
    "performed_via_github_app": null
}