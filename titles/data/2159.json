{
    "url": "https://api.github.com/repos/spack/spack/issues/2159",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2159/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2159/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2159/events",
    "html_url": "https://github.com/spack/spack/issues/2159",
    "id": 185828917,
    "node_id": "MDU6SXNzdWUxODU4Mjg5MTc=",
    "number": 2159,
    "title": "Spack using spack compiler wrappers of compilers instead of MPI compiler wrappers problematic on Apple",
    "user": {
        "login": "BarrySmith",
        "id": 512185,
        "node_id": "MDQ6VXNlcjUxMjE4NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/512185?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/BarrySmith",
        "html_url": "https://github.com/BarrySmith",
        "followers_url": "https://api.github.com/users/BarrySmith/followers",
        "following_url": "https://api.github.com/users/BarrySmith/following{/other_user}",
        "gists_url": "https://api.github.com/users/BarrySmith/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/BarrySmith/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/BarrySmith/subscriptions",
        "organizations_url": "https://api.github.com/users/BarrySmith/orgs",
        "repos_url": "https://api.github.com/users/BarrySmith/repos",
        "events_url": "https://api.github.com/users/BarrySmith/events{/privacy}",
        "received_events_url": "https://api.github.com/users/BarrySmith/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 451092161,
            "node_id": "MDU6TGFiZWw0NTEwOTIxNjE=",
            "url": "https://api.github.com/repos/spack/spack/labels/xSDK",
            "name": "xSDK",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2016-10-28T03:10:04Z",
    "updated_at": "2016-10-29T19:26:22Z",
    "closed_at": "2016-10-29T19:26:22Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "@tgamblin It seems the fact that Spack uses its wrappers around the actual compilers instead of around the MPI compiler wrappers, causes difficulties on Apples. On Apple, unlike linux, when building a shared library all dependencies need to to be resolved. This means for libraries that use MPI that all MPI calls need to be resolved. But since Spack passes t the native compilers down to the package configure/cmake, as opposed to the MPI compilers, in many cases, the MPI libraries are never passed to the shared library linker so the package cannot properly build its shared shared library. I've attached an example with a  Trilinos shared library \n\n[spack-build.out.txt](https://github.com/LLNL/spack/files/557486/spack-build.out.txt)\n\nIf I understand things correctly either spack needs to instead pass the MPI compiler wrappers as compiler names to the subpackpage buildsystems (which is what PETSc does) or pass down to the subpackages the appropriate MPI libraries so they can do the shared memory builds including links to those libraries.  Based on our experience with PETSc the second approach is  very MPI specific and fragile which is why we adopted the \"use the MPI compiler wrappers as the compilers approach\". I believe that spack should just adopt the \"MPI compiler wrappers are the compilers approach\" but I'm fine with using the true compilers approach so long as you can get it to consistently work properly on Apple systems.\n",
    "performed_via_github_app": null
}