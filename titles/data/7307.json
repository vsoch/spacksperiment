{
    "url": "https://api.github.com/repos/spack/spack/issues/7307",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7307/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7307/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7307/events",
    "html_url": "https://github.com/spack/spack/issues/7307",
    "id": 299143960,
    "node_id": "MDU6SXNzdWUyOTkxNDM5NjA=",
    "number": 7307,
    "title": "Power9: openblas does not build with XL compilers",
    "user": {
        "login": "floquet",
        "id": 13126143,
        "node_id": "MDQ6VXNlcjEzMTI2MTQz",
        "avatar_url": "https://avatars.githubusercontent.com/u/13126143?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/floquet",
        "html_url": "https://github.com/floquet",
        "followers_url": "https://api.github.com/users/floquet/followers",
        "following_url": "https://api.github.com/users/floquet/following{/other_user}",
        "gists_url": "https://api.github.com/users/floquet/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/floquet/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/floquet/subscriptions",
        "organizations_url": "https://api.github.com/users/floquet/orgs",
        "repos_url": "https://api.github.com/users/floquet/repos",
        "events_url": "https://api.github.com/users/floquet/events{/privacy}",
        "received_events_url": "https://api.github.com/users/floquet/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2018-02-21T21:57:33Z",
    "updated_at": "2020-08-24T13:33:04Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "## Summary\r\n\r\n`Openblas` builds with the XL compilers fail on the Power9 nodes on LANL's Darwin machine. Build errors have the form\r\n\r\n`use of undeclared identifier 'SGEMM_DEFAULT_UNROLL_M'`\r\n\r\n### Expected Result\r\n\r\nExpected successful `openblas` build.\r\n\r\n### Actual Result\r\n```\r\n==> Installing openblas\r\n==> Fetching file:///usr/projects/draco/vendors/spack.mirror/openblas/openblas-0.2.20.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /projects/draco/vendors/spack.power9-0.11.2/var/spack/stage/openblas-0.2.20-r5awequitfloxhx54jp7ppfqiiyzx3m6/v0.2.20.tar.gz\r\n==> Created stage in /projects/draco/vendors/spack.power9-0.11.2/var/spack/stage/openblas-0.2.20-r5awequitfloxhx54jp7ppfqiiyzx3m6\r\n==> Applied patch make.patch\r\n==> Building openblas [MakefilePackage]\r\n==> Executing phase: 'edit'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' 'CC=/projects/draco/vendors/spack.power9-0.11.2/lib/spack/env/xl/xlc' 'FC=/projects/draco/vendors/spack.power9-0.11.2/lib/spack/env/xl/xlf' 'MAKE_NO_J=1' 'USE_OPENMP=0' 'USE_THREAD=0' 'libs' 'netlib' 'shared'\r\n\r\n23 errors found in build log:\r\n     [ ... ]\r\n  >> 5     getarch_2nd.c:12:35: error: use of undeclared identifier 'SGEMM_DEFAULT_UNROLL_M'\r\n     6         printf(\"SGEMM_UNROLL_M=%d\\n\", SGEMM_DEFAULT_UNROLL_M);\r\n     7                                       ^\r\n  >> 8     getarch_2nd.c:13:35: error: use of undeclared identifier 'SGEMM_DEFAULT_UNROLL_N'\r\n     9         printf(\"SGEMM_UNROLL_N=%d\\n\", SGEMM_DEFAULT_UNROLL_N);\r\n...\r\n     114   /projects/draco/vendors/spack.power9-0.11.2/lib/spack/env/xl/xlc -c -O2 -DMAX_STACK_ALLOC=2048 -Wall -m64 -DF_INTERFACE_IBM -fPIC -DNO_WARMUP -DMAX_CPU_NUMBER=160 -DASMNAME=sgemm -DASMFNAME=sgemm -DNAME=sgemm -DCNAME=sgemm -DCHAR_NAME=\\\"sgemm\\\" -DCHAR_CNAME=\\\"sgemm\\\" -DNO_AFFINITY -I.. -I. -UDOUBLE  -UCOMPLEX gemm.c -o sgemm.o\r\n  >> 115   gemm.c:402:37: error: use of undeclared identifier 'GEMM_DEFAULT_OFFSET_A'\r\n     116     sa = (XFLOAT *)((BLASLONG)buffer +GEMM_OFFSET_A);\r\n     117                                       ^\r\n     118   ../common_param.h:971:23: note: expanded from macro 'GEMM_OFFSET_A'\r\n     119   #define GEMM_OFFSET_A   GEMM_DEFAULT_OFFSET_A\r\n     120                           ^\r\n  >> 121   gemm.c:403:37: error: use of undeclared identifier 'SGEMM_DEFAULT_P'\r\n     122     sb = (XFLOAT *)(((BLASLONG)sa + ((GEMM_P * GEMM_Q * COMPSIZE * SIZE + GEMM_ALIGN) & ~GEMM_ALIGN)) + GEMM_OFFSET_B);\r\n     123                                       ^\r\n     124   ../common_param.h:1117:18: note: expanded from macro 'GEMM_P'\r\n...\r\n```\r\n\r\n[openblas-spack-build.out.txt](https://github.com/spack/spack/files/1745856/openblas-spack-build.out.txt)\r\n[spack-cc-openblas-r5awequ.in.log](https://github.com/spack/spack/files/1745857/spack-cc-openblas-r5awequ.in.log)\r\n[spack-cc-openblas-r5awequ.out.log](https://github.com/spack/spack/files/1745858/spack-cc-openblas-r5awequ.out.log)\r\n\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install openblas % xl @ 13.1\r\n```\r\n\r\n### System information\r\n\r\n 1. Platform: Darwin @ LANL\r\n 1. Nodes: Power9\r\n 1. Spack release 0.11.2\r\n\r\n```\r\n$ uname -a\r\nLinux cn2022 4.11.0-44.4.1.el7a.ppc64le #1 SMP Sat Dec 9 02:17:51 EST 2017 ppc64le ppc64le ppc64le GNU/Linux\r\n```\r\n\r\n```\r\n$ spack arch\r\nlinux-rhel7-ppc64le\r\n```\r\n```\r\n$ xlc --version\r\nIBM XL C/C++ for Linux, V13.1.6 (Community Edition)\r\nVersion: 13.01.0006.0001\r\n/opt/ibm/xlC/13.1.6/bin/.orig/xlc: note: XL C/C++ Community Edition is a no-charge product and does not include official IBM support. You can provide feedback at the XL on POWER C/C++ Community Edition forum (http://ibm.biz/xlcpp-linux-ce). For information about a fully supported XL C/C++ compiler, visit XL C/C++ for Linux (http://ibm.biz/xlcpp-linux).\r\n\r\n$ xlf --version\r\nThe license for the ESP version of IBM XL Fortran for Linux, V16.1 (Beta) compiler product has expired.\r\n```\r\nConfiguration files:\r\n[compilers.config.txt](https://github.com/spack/spack/files/1745851/compilers.config.txt)\r\n[config.config.txt](https://github.com/spack/spack/files/1745852/config.config.txt)\r\n[modules.config.txt](https://github.com/spack/spack/files/1745853/modules.config.txt)\r\n[packages.config.txt](https://github.com/spack/spack/files/1745854/packages.config.txt)\r\n\r\n\r\n-----\r\n\r\nWe appreciate help or advise on how to fix the build script.",
    "performed_via_github_app": null
}