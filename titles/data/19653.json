{
    "url": "https://api.github.com/repos/spack/spack/issues/19653",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/19653/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/19653/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/19653/events",
    "html_url": "https://github.com/spack/spack/issues/19653",
    "id": 733903036,
    "node_id": "MDU6SXNzdWU3MzM5MDMwMzY=",
    "number": 19653,
    "title": "new arch target=graviton breaks everything on ARM/aarch64",
    "user": {
        "login": "mwkrentel",
        "id": 3969036,
        "node_id": "MDQ6VXNlcjM5NjkwMzY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3969036?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mwkrentel",
        "html_url": "https://github.com/mwkrentel",
        "followers_url": "https://api.github.com/users/mwkrentel/followers",
        "following_url": "https://api.github.com/users/mwkrentel/following{/other_user}",
        "gists_url": "https://api.github.com/users/mwkrentel/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mwkrentel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mwkrentel/subscriptions",
        "organizations_url": "https://api.github.com/users/mwkrentel/orgs",
        "repos_url": "https://api.github.com/users/mwkrentel/repos",
        "events_url": "https://api.github.com/users/mwkrentel/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mwkrentel/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483390,
            "node_id": "MDU6TGFiZWw1MTI0ODMzOTA=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-medium",
            "name": "impact-medium",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 10,
    "created_at": "2020-11-01T07:25:49Z",
    "updated_at": "2020-11-14T08:51:55Z",
    "closed_at": "2020-11-14T08:51:55Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "This is on ARM64/aarch64, fedora 26, gcc 7.3.1.\r\n\r\nThe new target=graviton for ARM64 breaks pretty much EVERYTHING, at\r\nleast for gcc.  This seems to affect only ARM, not powerpc or x86_64.\r\n\r\n```\r\n$ spack arch\r\nlinux-fedora26-graviton\r\n\r\n$ spack spec libsigsegv\r\nlibsigsegv@2.12%gcc@7.3.1 arch=linux-fedora26-graviton\r\n\r\n$ spack -d install libsigsegv\r\n...\r\n2 errors found in build log:\r\n     8     checking for a thread-safe mkdir -p... /usr/bin/mkdir -p\r\n     9     checking for gawk... gawk\r\n     10    checking whether make sets $(MAKE)... yes\r\n     11    checking whether make supports nested variables... yes\r\n     12    checking for gcc... /home/krentel/spack/spack-repo/lib/spack/env/gcc/gcc\r\n     13    checking whether the C compiler works... no\r\n  >> 14    configure: error: in `/home/krentel/spack/spack-repo/build-stage/spack-stage-libsigsegv-2.12-53nzpmnlsoniuxoiimmyjf2a57xirln6/spack-src':\r\n  >> 15    configure: error: C compiler cannot create executables\r\n     16    See `config.log' for more details\r\n```\r\n\r\nThe output of `spack -d` reveals the true problem.  target=graviton\r\ncauses -march to be set incorrectly.\r\n\r\n```\r\n[ccld] /usr/bin/gcc -march==armv8-a+crc+crypto -mtune=cortex-a72 ...\r\n```\r\n\r\nMaybe the mistake is simply the typo with two equal signs (=).\r\n\r\nAnyway, with target=aarch64, -march gets set correctly and the build\r\nsucceeds.\r\n\r\n```\r\n$ ./spack -d install libsigsegv target=aarch64\r\n\r\n[ccld] /usr/bin/gcc -march=armv8-a -mtune=generic ...\r\n```\r\n\r\n----------\r\n\r\nI traced the problem to this commit.\r\n\r\n```\r\ncommit 458d88eaad3c4e93210915ffa9b3bb64cc52d007\r\nAuthor: Massimiliano Culpo <massimiliano.culpo@gmail.com>\r\nDate:   Fri Oct 30 21:02:14 2020 +0100\r\n\r\n    Make archspec a vendored dependency (#19600)\r\n    \r\n    - Added archspec to the list of vendored dependencies\r\n    - Removed every reference to llnl.util.cpu\r\n    - Removed tests from Spack code base\r\n```\r\n\r\nBefore this commit, the default arch type is aarch64.  This commit\r\nadds the type graviton and the typo with -march.\r\n\r\nping @alalazo ",
    "performed_via_github_app": null
}