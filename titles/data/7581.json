{
    "url": "https://api.github.com/repos/spack/spack/issues/7581",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7581/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7581/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7581/events",
    "html_url": "https://github.com/spack/spack/issues/7581",
    "id": 308171803,
    "node_id": "MDU6SXNzdWUzMDgxNzE4MDM=",
    "number": 7581,
    "title": "External dependencies installed during the installation of RDPtools",
    "user": {
        "login": "fanne-stat",
        "id": 25308942,
        "node_id": "MDQ6VXNlcjI1MzA4OTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/25308942?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanne-stat",
        "html_url": "https://github.com/fanne-stat",
        "followers_url": "https://api.github.com/users/fanne-stat/followers",
        "following_url": "https://api.github.com/users/fanne-stat/following{/other_user}",
        "gists_url": "https://api.github.com/users/fanne-stat/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/fanne-stat/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/fanne-stat/subscriptions",
        "organizations_url": "https://api.github.com/users/fanne-stat/orgs",
        "repos_url": "https://api.github.com/users/fanne-stat/repos",
        "events_url": "https://api.github.com/users/fanne-stat/events{/privacy}",
        "received_events_url": "https://api.github.com/users/fanne-stat/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 446630669,
            "node_id": "MDU6TGFiZWw0NDY2MzA2Njk=",
            "url": "https://api.github.com/repos/spack/spack/labels/dependencies",
            "name": "dependencies",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 73908758,
            "node_id": "MDU6TGFiZWw3MzkwODc1OA==",
            "url": "https://api.github.com/repos/spack/spack/labels/question",
            "name": "question",
            "color": "cc317c",
            "default": true,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2018-03-23T20:39:08Z",
    "updated_at": "2019-12-17T10:18:44Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I encountered a problem when creating the package RDPtools.\r\n\r\nWhen I do `spack install rdptools` with clean stage for the first time, there will be some errors like:\r\n```console\r\n==> Installing rdptools\r\n==> Trying to clone git repository: https://github.com/rdpstaff/RDPTools.git at commit ee73c1c67d2bb577993b23b9886fa984ca974fb5\r\n==> No checksum needed when fetching with git\r\n==> Already staged rdptools-2017-05-31-qk3evxhlgj6lghxvtc652hjyfubt6na6 in /home/las_yifanzhu/spack/var/spack/stage/rdptools-2017-05-31-qk3evxhlgj6lghxvtc652hjyfubt6na6\r\n==> No patches needed for rdptools\r\n==> Building rdptools [MakefilePackage]\r\n==> Executing phase: 'edit'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j24'\r\n\r\n15 errors found in build log:\r\n     [ ... ]\r\n     5     mkdir lib\r\n     6     ant -f Clustering/build.xml jar\r\n     7     ant -f SequenceMatch/build.xml jar\r\n     8     ant -f classifier/build.xml jar\r\n     9     ant -f Framebot/build.xml jar\r\n     10    ant -f AbundanceStats/build.xml jar\r\n  >> 11    make: *** No rule to make target `ProbeMatch/dist/ProbeMatch.jar', needed by `deploy'.  Stop.\r\n     12    make: *** Waiting for unfinished jobs....\r\n     13    Buildfile: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/SequenceMatch/build.xml\r\n     14    Buildfile: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/build.xml\r\n     15    Buildfile: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Framebot/build.xml\r\n     16    Buildfile: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/AbundanceStats/build.xml\r\n     17    Buildfile: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/classifier/build.xml\r\n     [ ... ]\r\n     3675  -do-compile:\r\n     3676      [javac] Compiling 72 source files to /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/build/classes\r\n     3677      [javac] warning: [options] bootstrap class path not set in conjunction with -source 1.5\r\n     3678      [javac] warning: [options] source value 1.5 is obsolete and will be removed in a future release\r\n     3679      [javac] warning: [options] target value 1.5 is obsolete and will be removed in a future release\r\n     3680      [javac] warning: [options] To suppress warnings about obsolete options, use -Xlint:-options.\r\n  >> 3681  [javac] /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/src/edu/msu/cme/pyro/cluster/ClusterReplay.java:26: error: cannot access Taxon\r\n     3682      [javac] import edu.msu.cme.rdp.taxatree.Taxon;\r\n     3683      [javac]                                ^\r\n     3684      [javac]   bad class file: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/TaxonomyTree/dist/TaxonomyTree.jar(edu/msu/cme/rdp/taxatree/Taxon.class)\r\n     3685      [javac]     class file contains wrong class: java.lang.Exception\r\n     3686      [javac]     Please remove or make sure it appears in the correct subdirectory of the classpath.\r\n  >> 3687      [javac] /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/classifier/src/edu/msu/cme/rdp/multicompare/taxon/MCTaxon.java:22: error: cannot access Taxon\r\n     3688      [javac] import edu.msu.cme.rdp.taxatree.Taxon;\r\n     3689      [javac]                                ^\r\n     3690      [javac]   bad class file: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/TaxonomyTree/dist/TaxonomyTree.jar(edu/msu/cme/rdp/taxatree/Taxon.class)\r\n     3691      [javac]     class file contains wrong class: org.apache.commons.io.output.NullWriter\r\n     3692      [javac]     Please remove or make sure it appears in the correct subdirectory of the classpath.\r\n     3693\r\n     3694  BUILD FAILED\r\n  >> 3695  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/AbundanceStats/nbproject/build-impl.xml:896: The following error occurred while executing this line:\r\n  >> 3696  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/AbundanceStats/nbproject/build-impl.xml:1428: The following error occurred while executing this line:\r\n  >> 3697  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/nbproject/build-impl.xml:955: The following error occurred while executing this line:\r\n  >> 3698  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/nbproject/build-impl.xml:300: Compile failed; see the compiler error output for details.\r\n     3699\r\n     3700  Total time: 5 seconds\r\n     3701\r\n     3702  BUILD FAILED\r\n  >> 3703  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/classifier/nbproject/build-impl.xml:941: The following error occurred while executing this line:\r\n  >> 3704  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/classifier/nbproject/build-impl.xml:260: Compile failed; see the compiler error output for details.\r\n     3705\r\n     3706  Total time: 5 seconds\r\n  >> 3707  make: *** [AbundanceStats/dist/AbundanceStats.jar] Error 1\r\n  >> 3708  make: *** [classifier/dist/classifier.jar] Error 1\r\n  >> 3709      [javac] /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/src/edu/msu/cme/pyro/cluster/ClusterReplay.java:26: error: cannot access Taxon\r\n     3710      [javac] import edu.msu.cme.rdp.taxatree.Taxon;\r\n     3711      [javac]                                ^\r\n     3712      [javac]   bad class file: /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/TaxonomyTree/dist/TaxonomyTree.jar(edu/msu/cme/rdp/taxatree/Taxon.class)\r\n     3713      [javac]     class file contains wrong class: java.lang.Exception\r\n     3714      [javac]     Please remove or make sure it appears in the correct subdirectory of the classpath.\r\n     3715\r\n     3716  BUILD FAILED\r\n  >> 3717  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/nbproject/build-impl.xml:955: The following error occurred while executing this line:\r\n  >> 3718  /tmp/las_yifanzhu/spack-stage/spack-stage-zrzoEl/RDPTools/Clustering/nbproject/build-impl.xml:300: Compile failed; see the compiler error output for details.\r\n     3719\r\n     3720  Total time: 5 seconds\r\n  >> 3721  make: *** [Clustering/dist/Clustering.jar] Error 1\r\n``` \r\nBut when I do `spack install rdptools` for the second time, installation is then successful and rdptools works well. \r\n\r\nThis is probably because of rdptools are downloading some external dependencies during the 'build' phase. It downloads and installs something called \"ivy\" with ant (which is a dependency in the receipe) its and uses \"ivy\" to install some external dependencies. An example is from one of the submodules of RDPtools (See \"build.xml\" and \"ivy.xml\"):\r\nhttps://github.com/rdpstaff/Clustering/tree/a0490b09db52c2750e317314944aa1d89234215c\r\n\r\nSo are there any suggestion on how to create this package?\r\n\r\nMy receipe for rdptools is now like this:\r\n```python\r\nfrom spack import *\r\nimport glob\r\nimport os.path\r\n\r\n\r\nclass Rdptools(MakefilePackage):\r\n    \"\"\"An open source command-line tool suite for performing a complete\r\n       workflow of analysis tasks of NGS data.\"\"\"\r\n\r\n    homepage = \"https://github.com/rdpstaff/RDPTools\"\r\n    url      = \"https://github.com/rdpstaff/RDPTools\"\r\n\r\n    version('2017-05-31', commit='ee73c1c67d2bb577993b23b9886fa984ca974fb5',\r\n            git='https://github.com/rdpstaff/RDPTools.git', submodules=True)\r\n\r\n    depends_on('jdk', type=('build', 'run'))\r\n    depends_on('ant@1.9.0:1.9.9', type=('build', 'run'))\r\n\r\n    def install(self, spec, prefix):\r\n        mkdirp(prefix.bin)\r\n        mkdirp(prefix.jar)\r\n        for jar_file in glob.glob(join_path(self.stage.source_path, '*.jar')):\r\n            install(jar_file, prefix.jar)\r\n\r\n            jar_name = os.path.basename(jar_file).replace('.jar', '')\r\n            script_sh = join_path(os.path.dirname(__file__), jar_name + '.sh')\r\n            script = join_path(prefix.bin, jar_name)\r\n            install(script_sh, script)\r\n            set_executable(script)\r\n\r\n            java = join_path(self.spec['jdk'].prefix.bin, 'java')\r\n            kwargs = {'backup': False}\r\n            filter_file('^java', java, script, **kwargs)\r\n            filter_file(jar_name + '.jar', join_path(prefix.jar, jar_name + '.jar'),\r\n                        script, **kwargs)\r\n```\r\n",
    "performed_via_github_app": null
}