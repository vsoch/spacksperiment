{
    "url": "https://api.github.com/repos/spack/spack/issues/3998",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/3998/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/3998/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/3998/events",
    "html_url": "https://github.com/spack/spack/issues/3998",
    "id": 224489303,
    "node_id": "MDU6SXNzdWUyMjQ0ODkzMDM=",
    "number": 3998,
    "title": "Packages should be able to modify injected compiler flags.",
    "user": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446645732,
            "node_id": "MDU6TGFiZWw0NDY2NDU3MzI=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-environment",
            "name": "build-environment",
            "color": "bfdadc",
            "default": false,
            "description": null
        },
        {
            "id": 446615268,
            "node_id": "MDU6TGFiZWw0NDY2MTUyNjg=",
            "url": "https://api.github.com/repos/spack/spack/labels/compilers",
            "name": "compilers",
            "color": "f9d0c4",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "becker33",
        "id": 13971568,
        "node_id": "MDQ6VXNlcjEzOTcxNTY4",
        "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/becker33",
        "html_url": "https://github.com/becker33",
        "followers_url": "https://api.github.com/users/becker33/followers",
        "following_url": "https://api.github.com/users/becker33/following{/other_user}",
        "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
        "organizations_url": "https://api.github.com/users/becker33/orgs",
        "repos_url": "https://api.github.com/users/becker33/repos",
        "events_url": "https://api.github.com/users/becker33/events{/privacy}",
        "received_events_url": "https://api.github.com/users/becker33/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "becker33",
            "id": 13971568,
            "node_id": "MDQ6VXNlcjEzOTcxNTY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/becker33",
            "html_url": "https://github.com/becker33",
            "followers_url": "https://api.github.com/users/becker33/followers",
            "following_url": "https://api.github.com/users/becker33/following{/other_user}",
            "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
            "organizations_url": "https://api.github.com/users/becker33/orgs",
            "repos_url": "https://api.github.com/users/becker33/repos",
            "events_url": "https://api.github.com/users/becker33/events{/privacy}",
            "received_events_url": "https://api.github.com/users/becker33/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 5,
    "created_at": "2017-04-26T14:33:38Z",
    "updated_at": "2017-07-20T03:12:01Z",
    "closed_at": "2017-07-20T03:12:01Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "@junghans @becker33 @alalazo @adamjstewart @davydden \r\n\r\nWe're thinking of adding hooks for package authors, maybe something like:\r\n\r\n```python \r\nclass Foo(Package):\r\n    def cflags(self, flags):\r\n        # any of these are legitimate implementations \r\n\r\n        # use env vars to pass to build\r\n        env['CFLAGS'] = flags\r\n        return None  # skip compiler flag injection \r\n\r\n        # or\r\n\r\n        # use compiler injected flags only\r\n        return flags\r\n\r\n        # or\r\n\r\n        # do something special\r\n        return flags + \"-special-arg\"\r\n```\r\n\r\nThe interface is notional; here we'd need more methods for other types of flags.  We might end up with just one method.\r\n\r\nBasically we'd give the package author a chance to modify the compiler  flags from the spec before we use them in compiler wrappers, and packages could inject new things into the compiler wrappers if needed. Note that the spec would retain the original flags (we can't modify a concrete spec), but at least the package would have a say about them.  \r\n\r\nThe rationale is that we currently inject without asking, even though for many packages, the natural way to pass flags to a build system is through vars like CFLAGS.  Build systems may want to skip flags for certain files, e.g. If they're known to break things. This would allow them to do that. We'd probably make CFLAGS, not injection, the default for cmake and autotools packages and keep the injection as default in PackageBase.\r\n\r\n#3962 is the first package I've seen that *really wants* injected flags, so I thought I'd ping @junghans about this.\r\n\r\nThoughts?",
    "performed_via_github_app": null
}