{
    "url": "https://api.github.com/repos/spack/spack/issues/9394",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9394/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9394/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9394/events",
    "html_url": "https://github.com/spack/spack/issues/9394",
    "id": 365636712,
    "node_id": "MDU6SXNzdWUzNjU2MzY3MTI=",
    "number": 9394,
    "title": "Corrupt installation directory during simultaneous `spack install`s",
    "user": {
        "login": "SteVwonder",
        "id": 874707,
        "node_id": "MDQ6VXNlcjg3NDcwNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/874707?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SteVwonder",
        "html_url": "https://github.com/SteVwonder",
        "followers_url": "https://api.github.com/users/SteVwonder/followers",
        "following_url": "https://api.github.com/users/SteVwonder/following{/other_user}",
        "gists_url": "https://api.github.com/users/SteVwonder/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SteVwonder/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SteVwonder/subscriptions",
        "organizations_url": "https://api.github.com/users/SteVwonder/orgs",
        "repos_url": "https://api.github.com/users/SteVwonder/repos",
        "events_url": "https://api.github.com/users/SteVwonder/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SteVwonder/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-10-01T20:48:47Z",
    "updated_at": "2020-02-25T17:23:59Z",
    "closed_at": "2020-02-19T08:04:23Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "I attempted to run 2 `spack install`s simultaneously.  I thought that the packages to be built by the commands were entirely disjoint sets, but it turned out that a recent `git pull`  pulled in a newer version of cmake (which is required by both commands).  So the first `spack install` began building the new cmake and the second `spack install` blocked waiting on the completion of that install.  Once the first `spack install` built and installed cmake, I believe that the second `spack install` began immediately building and installing cmake, causing the following warning from the first `spack install`:\r\n\r\n```\r\n==> Successfully installed cmake\r\n  Fetch: 7.85s.  Build: 3m 52.90s.  Total: 4m 0.74s.\r\n[+] /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/opt/spack/linux-rhel7-x86_64/gcc-8.2.0/cmake-3.12.2-vj5tmvsxlu3d2a7vbmsbj7l5nv3kncas\r\n==> Warning: Dependency missing due to corrupt install directory:\r\n  /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/opt/spack/linux-rhel7-x86_64/gcc-8.2.0/cmake-3.12.2-vj5tmvsxlu3d2a7vbmsbj7l5nv3kncas\r\n  Install prefix exists but contains no spec.yaml:\r\n      /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/opt/spack/linux-rhel7-x86_64/gcc-8.2.0/cmake-3.12.2-vj5tmvsxlu3d2a7vbmsbj7l5nv3kncas\r\n```\r\n\r\nThe output from the second `spack install` related to cmake is:\r\n```\r\n-- Installing: /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/opt/spack/linux-rhel7-x86_64/gcc-8.2.0/cmake-3.12.2-vj5tmvsxlu3d2a7vbmsbj7l5nv3kncas/share/cmake-3.12/completions/ctest\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/share/spack/lmod/linux-rhel7-x86_64/gcc/8.2.0/cmake/3.12.2-vj5.lua\r\nspec : cmake@3.12.2%gcc@8.2.0~doc+ncurses+openssl+ownlibs patches=dd3a40d4d92f6b2158b87d6fb354c277947c776424aa03f6dc8096cf3135f5d0 ~qt arch=linux-rhel7-x86_64  ^ncurses@6.1%gcc@8.2.0~symlinks~termlib arch=linux-rhel7-x86_64  ^openssl@1.0.\r\n2o%gcc@8.2.0+systemcerts arch=linux-rhel7-x86_64  ^pkgconf@1.4.2%gcc@8.2.0 arch=linux-rhel7-x86_64  ^zlib@1.2.11%gcc@8.2.0+optimize+pic+shared arch=linux-rhel7-x86_64\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/share/spack/modules/linux-rhel7-x86_64/cmake-3.12.2-gcc-8.2.0-vj5tmvs\r\nspec : cmake@3.12.2%gcc@8.2.0~doc+ncurses+openssl+ownlibs patches=dd3a40d4d92f6b2158b87d6fb354c277947c776424aa03f6dc8096cf3135f5d0 ~qt arch=linux-rhel7-x86_64  ^ncurses@6.1%gcc@8.2.0~symlinks~termlib arch=linux-rhel7-x86_64  ^openssl@1.0.\r\n2o%gcc@8.2.0+systemcerts arch=linux-rhel7-x86_64  ^pkgconf@1.4.2%gcc@8.2.0 arch=linux-rhel7-x86_64  ^zlib@1.2.11%gcc@8.2.0+optimize+pic+shared arch=linux-rhel7-x86_64\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /usr/workspace/wsb/herbein1/packages/toss3/toss3/spack/share/spack/dotkit/linux-rhel7-x86_64/cmake-3.12.2-gcc-8.2.0-vj5tmvs.dk\r\nspec : cmake@3.12.2%gcc@8.2.0~doc+ncurses+openssl+ownlibs patches=dd3a40d4d92f6b2158b87d6fb354c277947c776424aa03f6dc8096cf3135f5d0 ~qt arch=linux-rhel7-x86_64  ^ncurses@6.1%gcc@8.2.0~symlinks~termlib arch=linux-rhel7-x86_64  ^openssl@1.0.\r\n2o%gcc@8.2.0+systemcerts arch=linux-rhel7-x86_64  ^pkgconf@1.4.2%gcc@8.2.0 arch=linux-rhel7-x86_64  ^zlib@1.2.11%gcc@8.2.0+optimize+pic+shared arch=linux-rhel7-x86_64\r\n==> Successfully installed cmake\r\n  Fetch: 0.08s.  Build: 3m 50.76s.  Total: 3m 50.84s.\r\n```\r\n\r\nBoth builds continued on normally, and as far as I can tell, they finished successfully.  I believe the second `spack install` left the cmake installation in an OK state.  I assume nothing bad happened with the corrupt cmake installation because the package dependent on cmake (i.e., jansson) was not rebuilt by spack and the already installed version used.  I also assume this was caused by the parallel execution of the `spack install`s, but maybe something else caused it.\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\nspack install flux-sched@master # in tmux pane 1\r\nspack install flux-sched@master ^boost@1.53 # in tmux pane 2\r\n```\r\n\r\n### Error Message\r\n\r\nSee above messages in summary\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\n\r\n 1. which platform you are using: Quartz at LLNL - TOSS3",
    "performed_via_github_app": null
}