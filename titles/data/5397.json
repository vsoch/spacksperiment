{
    "url": "https://api.github.com/repos/spack/spack/issues/5397",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/5397/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/5397/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/5397/events",
    "html_url": "https://github.com/spack/spack/issues/5397",
    "id": 258905190,
    "node_id": "MDU6SXNzdWUyNTg5MDUxOTA=",
    "number": 5397,
    "title": "GCC Build Fails on AArch64",
    "user": {
        "login": "rgmiller",
        "id": 1301479,
        "node_id": "MDQ6VXNlcjEzMDE0Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1301479?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rgmiller",
        "html_url": "https://github.com/rgmiller",
        "followers_url": "https://api.github.com/users/rgmiller/followers",
        "following_url": "https://api.github.com/users/rgmiller/following{/other_user}",
        "gists_url": "https://api.github.com/users/rgmiller/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rgmiller/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rgmiller/subscriptions",
        "organizations_url": "https://api.github.com/users/rgmiller/orgs",
        "repos_url": "https://api.github.com/users/rgmiller/repos",
        "events_url": "https://api.github.com/users/rgmiller/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rgmiller/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 616911200,
            "node_id": "MDU6TGFiZWw2MTY5MTEyMDA=",
            "url": "https://api.github.com/repos/spack/spack/labels/gcc",
            "name": "gcc",
            "color": "0052cc",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 26,
    "created_at": "2017-09-19T17:41:00Z",
    "updated_at": "2020-06-27T23:51:12Z",
    "closed_at": "2020-06-27T23:51:12Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I've been testing Spack out on our Cray Envoy system and have hit a problem with the GCC build.\r\n\r\nThe end of the spack-build.out file looks like this:\r\n```\r\ncp /home/sw/arm1/.spack/var/spack/stage/gcc-7.2.0-wodkpzprkhbwcsupyybm6w6ywayku554/gcc-7.2.0/gcc/../fixincludes/README-fixinc include-fixed/README\r\nchmod a+r include-fixed/README\r\necho timestamp > stmp-int-hdrs\r\n/tmp/xmr/spack-stage/spack-stage-UotD4k/gcc-7.2.0/spack-build/./gcc/xgcc -B/tmp/xmr/spack-stage/spack-stage-UotD4k/gcc-7.2.0/spack-build/./gcc/ -nostdinc -x c /dev/null -S -o /dev/null -fself-test=/home/sw/arm1/.spack/var/spack/stage/gcc-7.2.0-wodkpzprkhbwcsupyybm6w6ywayku554/gcc-7.2.0/gcc/testsuite/selftests\r\n/tmp/xmr/spack-stage/spack-stage-UotD4k/gcc-7.2.0/spack-build/./gcc/cc1: error while loading shared libraries: libisl.so.15: cannot open shared object file: No such file or directory\r\nMakefile:1933: recipe for target 's-selftest' failed\r\nmake[3]: *** [s-selftest] Error 1\r\nrm gfortran.pod gcc.pod\r\nmake[3]: Leaving directory '/tmp/xmr/spack-stage/spack-stage-UotD4k/gcc-7.2.0/spack-build/gcc'\r\nMakefile:4585: recipe for target 'all-stage2-gcc' failed\r\nmake[2]: *** [all-stage2-gcc] Error 2\r\nmake[2]: Leaving directory '/tmp/xmr/spack-stage/spack-stage-UotD4k/gcc-7.2.0/spack-build'\r\nMakefile:22412: recipe for target 'stage2-bubble' failed\r\nmake[1]: *** [stage2-bubble] Error 2\r\nmake[1]: Leaving directory '/tmp/xmr/spack-stage/spack-stage-UotD4k/gcc-7.2.0/spack-build'\r\nMakefile:931: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n```\r\n\r\nYou can see that it can't find libisl.so.15.\r\n\r\nThe install page at the GCC [wiki](https://gcc.gnu.org/wiki/InstallingGCC)  says that configuring with the --with-mpc, --with-mpfr & --with-gmp is not recommended because you have to add those paths to LD_LIBRARY_PATH every time you use gcc.  It appears that the same applies to --with-isl, too, with the additional caveat that you need to set LD_LIBRARY_PATH before even calling make.\r\n\r\nThe wiki page offers two recommended options:\r\n1. Just use the existing system versions of libisl (and the others) or\r\n2. After unpacking the source code, execute the contrib/download_prerequisites script which will fetch the mpc, mpfr, gmp and isl source packages extract them into the gcc source tree.  Then they'll automatically be built as part of gcc.  It seems to me that this would also mean that we could remove the dependencies on mpc, mpfr, gmp & isl from the gcc package.\r\n\r\nInterestingly, I tried loading the isl module manually (which set LD_LIBRARY_PATH properly) but the build still failed.  At the moment, I'm assuming that LD_LIBRARY_PATH got reset somewhere during the build, but I haven't verified that.\r\n\r\nNote that the build worked just fine when I tried it out on my x86_64 Fedora workstation, but that was probably because a sufficiently recent version of libisl was already installed in /usr/lib64.\r\n",
    "performed_via_github_app": null
}