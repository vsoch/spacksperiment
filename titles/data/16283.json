{
    "url": "https://api.github.com/repos/spack/spack/issues/16283",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/16283/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/16283/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/16283/events",
    "html_url": "https://github.com/spack/spack/issues/16283",
    "id": 606592538,
    "node_id": "MDU6SXNzdWU2MDY1OTI1Mzg=",
    "number": 16283,
    "title": "multi-user spack unable to record installation failure info due to missing file permissions",
    "user": {
        "login": "frankwillmore",
        "id": 508437,
        "node_id": "MDQ6VXNlcjUwODQzNw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/508437?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/frankwillmore",
        "html_url": "https://github.com/frankwillmore",
        "followers_url": "https://api.github.com/users/frankwillmore/followers",
        "following_url": "https://api.github.com/users/frankwillmore/following{/other_user}",
        "gists_url": "https://api.github.com/users/frankwillmore/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/frankwillmore/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/frankwillmore/subscriptions",
        "organizations_url": "https://api.github.com/users/frankwillmore/orgs",
        "repos_url": "https://api.github.com/users/frankwillmore/repos",
        "events_url": "https://api.github.com/users/frankwillmore/events{/privacy}",
        "received_events_url": "https://api.github.com/users/frankwillmore/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483406,
            "node_id": "MDU6TGFiZWw1MTI0ODM0MDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-high",
            "name": "impact-high",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tldahlgren",
            "id": 35777542,
            "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tldahlgren",
            "html_url": "https://github.com/tldahlgren",
            "followers_url": "https://api.github.com/users/tldahlgren/followers",
            "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
            "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
            "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
            "repos_url": "https://api.github.com/users/tldahlgren/repos",
            "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2020-04-24T21:24:13Z",
    "updated_at": "2020-05-14T21:43:38Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\n\r\n### Steps to reproduce the issue\r\nUsers in play on our multiuser installation include: willmore (myself), installationtest (dummy account for testing installation), and spack (service user that owns spack) \r\nThese users are all in the 'software' group, and as such should have installation privileges, managed by Linux groups. Directories in the installation should be have 'software' as group owner with ```drwxrwsr-x``` privileges, files with ```-rw-rw-r--``` . \r\n \r\nRunning 'spack install spack-dummy-package' (a testing package that actually builds) as installationtest user will generate the following error if it was not the last user to write  ```/lus/theta-fs0/software/spack/spack-dev/opt/spack/.spack-db/failures```.  \r\n\r\nIn this instance, a package failed to install because a proxy was not available for fetching the package, and spack attempted and was ***unable to record this failure*** due to permissions having not been set correctly on the failures directory: (see error message below)\r\n\r\n```\r\nspack@thetalogin5:~/alcf/tests> ll /lus/theta-fs0/software/spack/spack-dev/opt/spack/.spack-db/failures -d\r\ndrwxr-sr-x 2 spack software 4096 Apr 24 18:57 /lus/theta-fs0/software/spack/spack-dev/opt/spack/.spack-db/failures\r\n```\r\n\r\n```\r\nconsole\r\n$ spack <command1> <spec>\r\n$ spack <command2> <spec>\r\n...\r\n```\r\n\r\n### Error Message\r\n\r\n```\r\n==> 26740: Installing spack-dummy-package\r\n==> Cloning git repository: https://github.com/frankwillmore/spack-dummy-package.git on branch master\r\nfatal: unable to access 'https://github.com/frankwillmore/spack-dummy-package.git/': Failed to connect to proxy port 3128: No route to host\r\n==> Fetching from [git] https://github.com/frankwillmore/spack-dummy-package.git on branch master failed.\r\n==> Error: FetchError: All fetchers failed for spack-stage-spack-dummy-package-master-ol67tuxscyx5nafhuy3peoqiwdlr43j7\r\n\r\n/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/package.py:1127, in do_fetch:\r\n       1124                raise FetchError(\"Will not fetch %s\" %\r\n       1125                                 self.spec.format('{name}{@version}'), ck_msg)\r\n       1126\r\n  >>   1127        self.stage.create()\r\n       1128        self.stage.fetch(mirror_only)\r\n       1129        self._fetch_time = time.time() - start_time\r\n       1130\r\n\r\n\r\n==> Error: Failed to install spack-dummy-package due to ChildError: FetchError: All fetchers failed for spack-stage-spack-dummy-package-master-ol67tuxscyx5nafhuy3peoqiwdlr43j7\r\n/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/package.py:1127, in do_fetch:\r\n       1124                raise FetchError(\"Will not fetch %s\" %\r\n       1125                                 self.spec.format('{name}{@version}'), ck_msg)\r\n       1126\r\n  >>   1127        self.stage.create()\r\n       1128        self.stage.fetch(mirror_only)\r\n       1129        self._fetch_time = time.time() - start_time\r\n       1130\r\n\r\nTraceback (most recent call last):\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/build_environment.py\", line 801, in child_process\r\n    return_value = function()\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/installer.py\", line 1046, in build_process\r\n    pkg.do_patch()\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/package.py\", line 1167, in do_patch\r\n    self.do_stage()\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/package.py\", line 1152, in do_stage\r\n    self.do_fetch(mirror_only)\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/package.py\", line 1128, in do_fetch\r\n    self.stage.fetch(mirror_only)\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/util/pattern.py\", line 68, in getter\r\n    getattr(item, self.name)(*args, **kwargs)\r\n  File \"/lus/theta-fs0/software/spack/spack-dev/lib/spack/spack/stage.py\", line 476, in fetch\r\n    raise fs.FetchError(err_msg, None)\r\nspack.fetch_strategy.FetchError: All fetchers failed for spack-stage-spack-dummy-package-master-ol67tuxscyx5nafhuy3peoqiwdlr43j7\r\n\r\n==> Error: [Errno 13] Permission denied: '/lus/theta-fs0/software/spack/spack-dev/opt/spack/.spack-db/failures/spack-dummy-package-5ra5hmhuk5447crlpqph3dwn3oluqjkt'\r\n```\r\n### Information on your system\r\n\r\nThis is on ALCF theta, a Cray XC-40 running sles12/cnl6. \r\n\r\n***This is one of a number of similar file ownership issues that crop up when different users access the installation, as many files are either generated or re-written without group write permissons, e.g. :***\r\n\r\n```\r\n-rw-r--r-- 1 willmore software 168607 Apr 24 19:00 /lus/theta-fs0/software/spack/spack-dev/var/spack/misc-cache/patches/builtin-index.json\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [ ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}