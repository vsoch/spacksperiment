{
    "url": "https://api.github.com/repos/spack/spack/issues/2808",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2808/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2808/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2808/events",
    "html_url": "https://github.com/spack/spack/issues/2808",
    "id": 200151444,
    "node_id": "MDU6SXNzdWUyMDAxNTE0NDQ=",
    "number": 2808,
    "title": "Spack provides wrong path for include library",
    "user": {
        "login": "chvillanuevap",
        "id": 3827771,
        "node_id": "MDQ6VXNlcjM4Mjc3NzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3827771?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/chvillanuevap",
        "html_url": "https://github.com/chvillanuevap",
        "followers_url": "https://api.github.com/users/chvillanuevap/followers",
        "following_url": "https://api.github.com/users/chvillanuevap/following{/other_user}",
        "gists_url": "https://api.github.com/users/chvillanuevap/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/chvillanuevap/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/chvillanuevap/subscriptions",
        "organizations_url": "https://api.github.com/users/chvillanuevap/orgs",
        "repos_url": "https://api.github.com/users/chvillanuevap/repos",
        "events_url": "https://api.github.com/users/chvillanuevap/events{/privacy}",
        "received_events_url": "https://api.github.com/users/chvillanuevap/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2017-01-11T17:07:22Z",
    "updated_at": "2017-09-11T02:04:03Z",
    "closed_at": "2017-09-11T02:04:03Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I am trying to setup my own package for Spack using a very simple C++ program:\r\n\r\n```\r\n// in test.cpp\r\n#include <iostream>\r\n#include <armadillo>\r\n\r\nusing namespace std;\r\nusing namespace arma;\r\n\r\nint main()\r\n{\r\n\tmat A = randu<mat>(4,5);\r\n\tmat B = randu<mat>(4,5);\r\n\r\n\tcout << A*B.t() << endl;\r\n\r\n\treturn 0;\r\n}\r\n```\r\n\r\nThe program depends on the library Armadillo. I compile the program using CMake; here is my CMakeLists.txt file:\r\n\r\n```\r\nproject(test)\r\n\r\n# -----------------------------------------------------------------------------\r\n\r\n# Require CMake 2.8.\r\ncmake_minimum_required(VERSION 2.8)\r\n\r\n# -----------------------------------------------------------------------------\r\n# CMake policies.\r\n\r\n# VERSION not allowed in project() unless CMP0048 is set to NEW.\r\ncmake_policy(SET CMP0048 NEW)\r\n\r\n# Allow creating targets with reserved names\r\n# or which do not match the validity pattern.\r\ncmake_policy(SET CMP0037 OLD)\r\n\r\n# -----------------------------------------------------------------------------\r\n\r\nfind_package(Armadillo)\r\n\r\nif(ARMADILLO_FOUND)\r\n    list(APPEND OLIVE_DEFINITIONS \"-DHAVE_ARMA\")\r\n    list(APPEND OLIVE_INCLUDE_DIRS \"${ARMADILLO_INCLUDE_DIRS}\")\r\nelse()\r\n    MESSAGE(FATAL_ERROR \"A library with Armadillo API is not found.\")\r\nendif()\r\n\r\n# -----------------------------------------------------------------------------  \r\n\r\nfind_package(BLAS REQUIRED)\r\n\r\nfind_package(LAPACK REQUIRED)\r\n\r\nif(LAPACK_FOUND)\r\n    list(APPEND OLIVE_LIBRARIES ${LAPACK_LIBRARIES})\r\nelse()\r\n    MESSAGE(FATAL_ERROR \"A library with LAPACK API is not found.\")\r\nendif()\r\n    \r\n# -----------------------------------------------------------------------------  \r\n\r\n# Preprocessor definitions.\r\nforeach(OLIVE_DEFINITION ${OLIVE_DEFINITIONS})\r\n    add_definitions(${OLIVE_DEFINITION})\r\nendforeach()\r\n\r\n# Include directories.\r\nforeach(OLIVE_INCLUDE_DIR ${OLIVE_INCLUDE_DIRS})\r\n    include_directories(${OLIVE_INCLUDE_DIR})\r\nendforeach()\r\n\r\n# Linker directories.\r\nforeach(OLIVE_LIBRARY_DIR ${OLIVE_LIBRARY_DIRS})\r\n    link_directories(${OLIVE_LIBRARY_DIR})\r\nendforeach()\r\n\r\n# Executable.\r\nadd_executable (test test.cpp)\r\ntarget_link_libraries(test ${OLIVE_LIBRARIES})\r\n```\r\n\r\nThen I create a package using the `spack create` command:\r\n\r\n```\r\nfrom spack import *\r\n\r\nclass Olive(CMakePackage):\r\n\r\n    homepage = \"http://www.example.com\"\r\n    url      = \"file:///home/chvillanuevap/Workspace/olive-1.0.0.tar.gz\"\r\n\r\n    version('1.0.0', '4d594401468e9a7766c2c2e0f1c0c4e2')\r\n\r\n    depends_on('cmake', type='build')\r\n    depends_on('armadillo')\r\n\r\n    def cmake_args(self):\r\n        args = []\r\n        return args\r\n```\r\n\r\nWhen I run `spack install olive`, I get the following error:\r\n\r\n```\r\nBuilding CXX object CMakeFiles/test.dir/test.cpp.o\r\n/home/chvillanuevap/Workspace/spack/lib/spack/env/gcc/g++   -DHAVE_ARMA -I/home/chvillanuevap/Workspace/spack/opt/spack/linux-ubuntu16-x86_64/gcc-5.4.0/armadillo-7.500.0-k7fwnukwvvyzgfxhyhhwwxjhaohmdmit/include  -O2 -g -DNDEBUG   -o CMakeFiles/test.dir/test.cpp.o -c /home/chvillanuevap/Workspace/spack/var/spack/stage/olive-1.0.0-io6llpqdxqohx457argmnsjqtq4fpmhr/olive/test.cpp\r\nIn file included from /home/chvillanuevap/Workspace/spack/opt/spack/linux-ubuntu16-x86_64/gcc-5.4.0/armadillo-7.500.0-k7fwnukwvvyzgfxhyhhwwxjhaohmdmit/include/armadillo:83:0,\r\n                 from /home/chvillanuevap/Workspace/spack/var/spack/stage/olive-1.0.0-io6llpqdxqohx457argmnsjqtq4fpmhr/olive/test.cpp:2:\r\n/home/chvillanuevap/Workspace/spack/opt/spack/linux-ubuntu16-x86_64/gcc-5.4.0/armadillo-7.500.0-k7fwnukwvvyzgfxhyhhwwxjhaohmdmit/include/armadillo_bits/include_superlu.hpp:91:53: fatal error: /home/chvillanuevap/Workspace/spack/opt/spack/1-ubuntu16-x86_64/gcc-5.4.0/superlu-5.2.1-lrqbalx6k6q6btuxmszymj7p5dal65d2/include/supermatrix.h: No such file or directory\r\n```\r\n\r\nNotice how the path for SuperLU (a dependency of Armadillo) says `1-ubuntu16-x86_64` for the architecture instead of the correct `linux-ubuntu16-x86_64`. Why does this happen?",
    "performed_via_github_app": null
}