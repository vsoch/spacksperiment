{
    "url": "https://api.github.com/repos/spack/spack/issues/13733",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13733/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13733/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13733/events",
    "html_url": "https://github.com/spack/spack/issues/13733",
    "id": 522944722,
    "node_id": "MDU6SXNzdWU1MjI5NDQ3MjI=",
    "number": 13733,
    "title": "Cryptic error message when configuring a compiler for a specific target",
    "user": {
        "login": "cdfh",
        "id": 825890,
        "node_id": "MDQ6VXNlcjgyNTg5MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/825890?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cdfh",
        "html_url": "https://github.com/cdfh",
        "followers_url": "https://api.github.com/users/cdfh/followers",
        "following_url": "https://api.github.com/users/cdfh/following{/other_user}",
        "gists_url": "https://api.github.com/users/cdfh/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/cdfh/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cdfh/subscriptions",
        "organizations_url": "https://api.github.com/users/cdfh/orgs",
        "repos_url": "https://api.github.com/users/cdfh/repos",
        "events_url": "https://api.github.com/users/cdfh/events{/privacy}",
        "received_events_url": "https://api.github.com/users/cdfh/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446615268,
            "node_id": "MDU6TGFiZWw0NDY2MTUyNjg=",
            "url": "https://api.github.com/repos/spack/spack/labels/compilers",
            "name": "compilers",
            "color": "f9d0c4",
            "default": false,
            "description": null
        },
        {
            "id": 509628729,
            "node_id": "MDU6TGFiZWw1MDk2Mjg3Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/error-messages",
            "name": "error-messages",
            "color": "f9d0c4",
            "default": false,
            "description": null
        },
        {
            "id": 512483297,
            "node_id": "MDU6TGFiZWw1MTI0ODMyOTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-low",
            "name": "impact-low",
            "color": "fef2c0",
            "default": false,
            "description": ""
        },
        {
            "id": 1574436554,
            "node_id": "MDU6TGFiZWwxNTc0NDM2NTU0",
            "url": "https://api.github.com/repos/spack/spack/labels/microarchitectures",
            "name": "microarchitectures",
            "color": "011970",
            "default": false,
            "description": ""
        },
        {
            "id": 446623896,
            "node_id": "MDU6TGFiZWw0NDY2MjM4OTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/platform-support",
            "name": "platform-support",
            "color": "bfdadc",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "becker33",
            "id": 13971568,
            "node_id": "MDQ6VXNlcjEzOTcxNTY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/becker33",
            "html_url": "https://github.com/becker33",
            "followers_url": "https://api.github.com/users/becker33/followers",
            "following_url": "https://api.github.com/users/becker33/following{/other_user}",
            "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
            "organizations_url": "https://api.github.com/users/becker33/orgs",
            "repos_url": "https://api.github.com/users/becker33/repos",
            "events_url": "https://api.github.com/users/becker33/events{/privacy}",
            "received_events_url": "https://api.github.com/users/becker33/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 8,
    "created_at": "2019-11-14T15:49:02Z",
    "updated_at": "2020-02-21T22:50:55Z",
    "closed_at": "2020-02-21T22:50:55Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I have clang correctly configured in my `compilers.yaml` file with `target: ivybridge`.\r\n\r\nUpon attempting to install any arbitrary package with `%clang`, spack fails:\r\n\r\n```console\r\n$ spack install bash%clang@8.0.0\r\n==> Error: No compilers with spec clang@8.0.0 found for operating system ubuntu16.04 and target ivybridge.\r\nRun 'spack compiler find' to add compilers.\r\n```\r\nChanging `target` to `linux-ubuntu16.04-ivybridge` does not fix the error. Changing to `x86_64` _does_ fix the error, but reporting this as a bug because `ivybridge` is an appropriate target and the compiler has been appropriately configured for it.\r\n\r\n### Steps to reproduce the issue\r\n\r\nEdit `compilers.yaml` and change the target of a compiler to the output of `spack arch -t`. Then attempt to install any package with the affected compiler.\r\n\r\n### Error Message\r\n\r\n```console\r\n$ spack -d --stacktrace install bash%clang@8.0.0\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.315799] Reading config file /home/hdiags/src/spack/etc/spack/defaults/modules.yaml\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.328014] Reading config file /home/hdiags/src/spack/etc/spack/defaults/linux/modules.yaml\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.330991] Reading config file /home/hdiags/src/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/cmd/__init__.py:101 ==> [2019-11-14-15:33:01.347916] Imported install from built-in commands\r\nlib/spack/spack/cmd/__init__.py:101 ==> [2019-11-14-15:33:01.349093] Imported install from built-in commands\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.367195] Reading config file /home/hdiags/src/spack/etc/spack/defaults/repos.yaml\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.368930] Reading config file /home/hdiags/src/spack/etc/spack/repos.yaml\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.369852] Reading config file /home/hdiags/.spack/linux/repos.yaml\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.422301] Reading config file /home/hdiags/src/spack/etc/spack/defaults/packages.yaml\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.435570] Reading config file /home/hdiags/src/spack/etc/spack/packages.yaml\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.443640] READ LOCK: /home/hdiags/.spack/cache/providers/.builtin-index.json.lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.444069] READ LOCK: /home/hdiags/.spack/cache/providers/.builtin-index.json.lock[0:0] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.465539] READ LOCK: /home/hdiags/.spack/cache/providers/.builtin-index.json.lock[0:0] [Released]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.468488] READ LOCK: /home/hdiags/.spack/cache/patches/.builtin-index.json.lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.468827] READ LOCK: /home/hdiags/.spack/cache/patches/.builtin-index.json.lock[0:0] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.476680] READ LOCK: /home/hdiags/.spack/cache/patches/.builtin-index.json.lock[0:0] [Released]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.478625] READ LOCK: /home/hdiags/.spack/cache/tags/.builtin-index.json.lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.478946] READ LOCK: /home/hdiags/.spack/cache/tags/.builtin-index.json.lock[0:0] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.479452] READ LOCK: /home/hdiags/.spack/cache/tags/.builtin-index.json.lock[0:0] [Released]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.487132] READ LOCK: /home/hdiags/.spack/cache/providers/.hdiags-index.json.lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.487653] READ LOCK: /home/hdiags/.spack/cache/providers/.hdiags-index.json.lock[0:0] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.488146] READ LOCK: /home/hdiags/.spack/cache/providers/.hdiags-index.json.lock[0:0] [Released]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.488749] READ LOCK: /home/hdiags/.spack/cache/patches/.hdiags-index.json.lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.489359] READ LOCK: /home/hdiags/.spack/cache/patches/.hdiags-index.json.lock[0:0] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.489827] READ LOCK: /home/hdiags/.spack/cache/patches/.hdiags-index.json.lock[0:0] [Released]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.490399] READ LOCK: /home/hdiags/.spack/cache/tags/.hdiags-index.json.lock[0:0] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.490866] READ LOCK: /home/hdiags/.spack/cache/tags/.hdiags-index.json.lock[0:0] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-14-15:33:01.491371] READ LOCK: /home/hdiags/.spack/cache/tags/.hdiags-index.json.lock[0:0] [Released]\r\nlib/spack/spack/config.py:706 ==> [2019-11-14-15:33:01.502424] Reading config file /home/hdiags/.spack/linux/compilers.yaml\r\nlib/spack/spack/cmd/install.py:266 ==> [2019-11-14-15:33:01.518251] UnavailableCompilerVersionError: No compilers with spec clang@8.0.0 found for operating system ubuntu16.04 and target ivybridge.\r\n    Run 'spack compiler find' to add compilers.\r\nlib/spack/spack/main.py:718 ==> [2019-11-14-15:33:01.518412] UnavailableCompilerVersionError: No compilers with spec clang@8.0.0 found for operating system ubuntu16.04 and target ivybridge.\r\n    Run 'spack compiler find' to add compilers.\r\nlib/spack/spack/error.py:55 ==> [2019-11-14-15:33:01.518641] Error: No compilers with spec clang@8.0.0 found for operating system ubuntu16.04 and target ivybridge.\r\nRun 'spack compiler find' to add compilers.\r\nTraceback (most recent call last):\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/main.py\", line 715, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/main.py\", line 457, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/cmd/install.py\", line 264, in install\r\n    args.package, concretize=True, tests=tests)\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/cmd/__init__.py\", line 141, in parse_specs\r\n    spec.concretize(tests=tests)  # implies normalize\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/spec.py\", line 2151, in concretize\r\n    self._concretize_helper(concretizer))\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/spec.py\", line 1979, in _concretize_helper\r\n    concretizer, presets, visited\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/spec.py\", line 1991, in _concretize_helper\r\n    concretizer.concretize_compiler(self),\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/concretize.py\", line 376, in concretize_compiler\r\n    other_compiler, spec.architecture)\r\n  File \"/home/hdiags/src/spack/lib/spack/spack/concretize.py\", line 611, in _compiler_concretization_failure\r\n    raise UnavailableCompilerVersionError(compiler_spec, arch)\r\nspack.concretize.UnavailableCompilerVersionError: No compilers with spec clang@8.0.0 found for operating system ubuntu16.04 and target ivybridge.\r\n    Run 'spack compiler find' to add compilers.\r\n\r\n```\r\n\r\n### Information on your system\r\n\r\nAffects me on both `master` and `develop` (`HEAD` at 3f861e18b).\r\n\r\n```console\r\n$ spack arch\r\nlinux-ubuntu16.04-ivybridge\r\n```\r\nAffects me for both clang and gcc:\r\n\r\n```console\r\n$ cat ~/.spack/linux/compilers.yaml\r\ncompilers:\r\n- compiler:\r\n    modules: []\r\n    target: ivybridge\r\n    operating_system: ubuntu16.04\r\n    paths:\r\n      cxx: /usr/bin/g++-5\r\n      fc: /usr/bin/gfortran-5\r\n      f77: /usr/bin/gfortran-5\r\n      cc: /usr/bin/gcc-5\r\n    extra_rpaths: []\r\n    environment: {}\r\n    spec: gcc@5.4.0\r\n    flags: {}\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: [/home/hdiags/src/spack/opt/spack/linux-ubuntu16.04-ivybridge/gcc-5.4.0/llvm-8.0.0-cie23zscq3gpdqpvb5gutx3exqldhdgo/lib]\r\n    flags: {}\r\n    modules: [llvm-8.0.0-gcc-5.4.0-cie23zs]\r\n    operating_system: ubuntu16.04\r\n    paths:\r\n      cc: /home/hdiags/src/spack/opt/spack/linux-ubuntu16.04-ivybridge/gcc-5.4.0/llvm-8.0.0-cie23zscq3gpdqpvb5gutx3exqldhdgo/bin/clang\r\n      cxx: /home/hdiags/src/spack/opt/spack/linux-ubuntu16.04-ivybridge/gcc-5.4.0/llvm-8.0.0-cie23zscq3gpdqpvb5gutx3exqldhdgo/bin/clang++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    spec: clang@8.0.0\r\n    target: ivybridge\r\n```\r\n",
    "performed_via_github_app": null
}