{
    "url": "https://api.github.com/repos/spack/spack/issues/16073",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/16073/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/16073/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/16073/events",
    "html_url": "https://github.com/spack/spack/issues/16073",
    "id": 600368471,
    "node_id": "MDU6SXNzdWU2MDAzNjg0NzE=",
    "number": 16073,
    "title": "Installation issue: py-tensorboard-plugin-wit fails due to ijar binary and python path issues",
    "user": {
        "login": "ajw1980",
        "id": 1461301,
        "node_id": "MDQ6VXNlcjE0NjEzMDE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1461301?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajw1980",
        "html_url": "https://github.com/ajw1980",
        "followers_url": "https://api.github.com/users/ajw1980/followers",
        "following_url": "https://api.github.com/users/ajw1980/following{/other_user}",
        "gists_url": "https://api.github.com/users/ajw1980/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ajw1980/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ajw1980/subscriptions",
        "organizations_url": "https://api.github.com/users/ajw1980/orgs",
        "repos_url": "https://api.github.com/users/ajw1980/repos",
        "events_url": "https://api.github.com/users/ajw1980/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ajw1980/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2020-04-15T15:04:43Z",
    "updated_at": "2020-11-13T14:12:35Z",
    "closed_at": "2020-10-19T18:15:52Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I got close to building py-tensorboard in a centos6 container, but there are some problems with py-tensorboard-plugin-wit. First problem was bazel downloads a binary version of ijar, which has a newer glibc requirement. That seems to be fixed with --define=EXECUTOR=remote.\r\n\r\nSecond problem is that bazel does not find the right python. I tried to override that  '--action_env=PATH=' + self.spec['python'].prefix.bin + ':/usr/local/bin:/bin:/usr/bin', or '--python_path=' + spec['python'].command.path, but neither one worked.\r\n\r\n\r\n```\r\n==> [2020-04-14-08:40:20.611620, 34090] 'bazel' '--nohome_rc' '--nosystem_rc' '--output_user_root=/tmp/spack/tb-plugin' 'run' '--define=EXECUTOR=remote' '--action_env=PATH=/shared/spack/opt/spack/linux-centos6-core2/gcc-8.3.0/python-3.8.2-6smbhjpagb4iy47tnlqfvapod4ywtwei/bin:/usr/local/bin:/bin:/usr/bin' '--python_path=/shared/spack/opt/spack/linux-centos6-core2/gcc-8.3.0/python-3.8.2-6smbhjpagb4iy47tnlqfvapod4ywtwei/bin/python3.8' '--verbose_failures' '--subcommands=pretty_print' 'tensorboard_plugin_wit/pip_package:build_pip_package'\r\n... [snipped]\r\nERROR: /tmp/spack/tb-plugin/72eb62ffed23b5896fcd31e9ab54c009/external/org_tensorflow_tensorboard/tensorboard/components/vz_sorting/BUILD:8:1: Compiling 4 TypeScript files @org_tensorflow_tensorboard//tensorboard/components/vz_sorting:vz_sorting failed (Exit 1) execrooter failed: error executing command\r\n  (cd /tmp/spack/tb-plugin/72eb62ffed23b5896fcd31e9ab54c009/sandbox/linux-sandbox/260/execroot/ai_google_pair_wit && \\\r\n  exec env - \\\r\n  bazel-out/host/bin/external/org_tensorflow_tensorboard/tensorboard/scripts/execrooter bazel-out/k8-fastbuild/bin/external/org_tensorflow_tensorboard/tensorboard/components/vz_sorting/vz_sorting-tsc-execroot.json)\r\nExecution platform: @bazel_tools//platforms:host_platform\r\n\r\nUse --sandbox_debug to see verbose messages from the sandbox\r\nError occurred while attempting to use the default Python toolchain (@rules_python//python:autodetecting_toolchain).\r\nAccording to '/usr/bin/python -V', version is 'Python 2.6.6', but we need version 3. PATH is:\r\n\r\n/usr/local/bin:/bin:/usr/bin\r\n\r\nPlease ensure an interpreter with version 3 is available on this platform as 'python3' or 'python', or else register an appropriate Python toolchain as per the documentation for py_runtime_pair (https://github.com/bazelbuild/rules_python/blob/master/docs/python.md#py_runtime_pair).\r\n\r\nNote that prior to Bazel 0.27, there was no check to ensure that the interpreter's version matched the version declared by the target (#4815). If your build worked prior to Bazel 0.27, and you're sure your targets do not require Python 3, you can opt out of this version check by using the non-strict autodetecting toolchain instead of the standard autodetecting toolchain. This can be done by passing the flag `--extra_toolchains=@rules_python//python:autodetecting_toolchain_nonstrict` on the command line or adding it to your bazelrc.\r\n----------------\r\nNote: The failure of target @org_tensorflow_tensorboard//tensorboard/scripts:execrooter (with exit code 1) may have been caused by the fact that it is running under Python 3 instead of Python 2. Examine the error to determine if that appears to be the problem. Since this target is built in the host configuration, the only way to change its version is to set --host_force_python=PY2, which affects the entire build.\r\n\r\nIf this error started occurring in Bazel 0.27 and later, it may be because the Python toolchain now enforces that targets analyzed as PY2 and PY3 run under a Python 2 and Python 3 interpreter, respectively. See https://github.com/bazelbuild/bazel/issues/7899 for more information.\r\n```\r\n\r\nHere is the diff from what I tried:\r\n```\r\n--- a/var/spack/repos/builtin/packages/py-tensorboard-plugin-wit/package.py\r\n+++ b/var/spack/repos/builtin/packages/py-tensorboard-plugin-wit/package.py\r\n@@ -53,6 +53,9 @@ def build(self, spec, prefix):\r\n               '--nosystem_rc',\r\n               '--output_user_root=' + tmp_path,\r\n               'run',\r\n+              '--define=EXECUTOR=remote',\r\n+              '--action_env=PATH=' + self.spec['python'].prefix.bin + ':/usr/local/bin:/bin:/usr/bin',\r\n+              '--python_path=' + spec['python'].command.path,\r\n               '--verbose_failures',\r\n               '--subcommands=pretty_print',\r\n               'tensorboard_plugin_wit/pip_package:build_pip_package')\r\n```",
    "performed_via_github_app": null
}