{
    "url": "https://api.github.com/repos/spack/spack/issues/9160",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9160/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9160/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9160/events",
    "html_url": "https://github.com/spack/spack/issues/9160",
    "id": 356220078,
    "node_id": "MDU6SXNzdWUzNTYyMjAwNzg=",
    "number": 9160,
    "title": "Spack sets RUNPATH instead of RPATH on latest Ubuntu LTS",
    "user": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446779717,
            "node_id": "MDU6TGFiZWw0NDY3Nzk3MTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/rpath",
            "name": "rpath",
            "color": "bfdadc",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 12,
    "created_at": "2018-09-01T17:36:40Z",
    "updated_at": "2019-10-23T20:22:24Z",
    "closed_at": "2019-10-23T20:22:24Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "I tried to check the RPATH of a few applications installed with Spack on my Ubuntu 18.04 and found out that Spack was setting RUNPATH instead of RPATH.\r\n\r\n### Steps to reproduce the issue\r\n\r\nI was able to reproduce the issue using a docker image, and it seems related to the Ubuntu version:\r\n```console\r\n$ docker run -it --rm ubuntu:18.04 /bin/bash\r\nroot@ab5ae0326b89:~# apt update && apt upgrade\r\nroot@ab5ae0326b89:~# apt install gcc g++ git curl make python tar xz-utils\r\nroot@ab5ae0326b89:~# git clone https://github.com/spack/spack.git\r\nroot@ab5ae0326b89:~# . spack/share/spack/setup-env.sh\r\nroot@ab5ae0326b89:~# spack install pkgconf\r\n==> Installing pkgconf\r\n==> Using cached archive: /spack/var/spack/cache/pkgconf/pkgconf-1.4.2.tar.xz\r\n==> Staging archive: /spack/var/spack/stage/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc/pkgconf-1.4.2.tar.xz\r\n==> Created stage in /spack/var/spack/stage/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc\r\n==> No patches needed for pkgconf\r\n==> Building pkgconf [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed pkgconf\r\n  Fetch: 0.00s.  Build: 7.17s.  Total: 7.17s.\r\n[+] /spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc\r\n```\r\n\r\n### Error Message\r\nAt this point, trying to check the dynamic section of the ELF executable:\r\n```console\r\nroot@ab5ae0326b89:~# objdump -x /spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc/bin/pkgconf\r\n/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc/bin/pkgconf:     file format elf64-x86-64\r\n/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc/bin/pkgconf\r\narchitecture: i386:x86-64, flags 0x00000150:\r\nHAS_SYMS, DYNAMIC, D_PAGED\r\nstart address 0x0000000000003200\r\n\r\nProgram Header:\r\n    PHDR off    0x0000000000000040 vaddr 0x0000000000000040 paddr 0x0000000000000040 align 2**3\r\n         filesz 0x00000000000001f8 memsz 0x00000000000001f8 flags r--\r\n  INTERP off    0x0000000000000238 vaddr 0x0000000000000238 paddr 0x0000000000000238 align 2**0\r\n         filesz 0x000000000000001c memsz 0x000000000000001c flags r--\r\n    LOAD off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**21\r\n         filesz 0x00000000000075a0 memsz 0x00000000000075a0 flags r-x\r\n    LOAD off    0x0000000000007bf0 vaddr 0x0000000000207bf0 paddr 0x0000000000207bf0 align 2**21\r\n         filesz 0x0000000000000b10 memsz 0x0000000000000c78 flags rw-\r\n DYNAMIC off    0x0000000000007c10 vaddr 0x0000000000207c10 paddr 0x0000000000207c10 align 2**3\r\n         filesz 0x0000000000000210 memsz 0x0000000000000210 flags rw-\r\n    NOTE off    0x0000000000000254 vaddr 0x0000000000000254 paddr 0x0000000000000254 align 2**2\r\n         filesz 0x0000000000000044 memsz 0x0000000000000044 flags r--\r\nEH_FRAME off    0x0000000000006d58 vaddr 0x0000000000006d58 paddr 0x0000000000006d58 align 2**2\r\n         filesz 0x0000000000000144 memsz 0x0000000000000144 flags r--\r\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**4\r\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\r\n   RELRO off    0x0000000000007bf0 vaddr 0x0000000000207bf0 paddr 0x0000000000207bf0 align 2**0\r\n         filesz 0x0000000000000410 memsz 0x0000000000000410 flags r--\r\n\r\nDynamic Section:\r\n  NEEDED               libpkgconf.so.3\r\n  NEEDED               libc.so.6\r\n  RUNPATH              /spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc/lib:/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/pkgconf-1.4.2-gavqfquorv7kyfjbib5w3w5odhfkuggc/lib64\r\n  INIT                 0x0000000000001cf8\r\n  FINI                 0x0000000000004f04\r\n...\r\n```\r\n### Additional information \r\nRepeating the same procedure on the previous LTS (Ubuntu 16.04) gives instead the expected result:\r\n```console\r\nroot@aaf643ede7cc:/spack# objdump -x /spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.4.0/pkgconf-1.4.2-fovrh7alpft646n6mhis5mml6k6e5f4v/bin/pkgconf\r\n\r\n/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.4.0/pkgconf-1.4.2-fovrh7alpft646n6mhis5mml6k6e5f4v/bin/pkgconf:     file format elf64-x86-64\r\n/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.4.0/pkgconf-1.4.2-fovrh7alpft646n6mhis5mml6k6e5f4v/bin/pkgconf\r\narchitecture: i386:x86-64, flags 0x00000112:\r\nEXEC_P, HAS_SYMS, D_PAGED\r\nstart address 0x0000000000402780\r\n\r\nProgram Header:\r\n    PHDR off    0x0000000000000040 vaddr 0x0000000000400040 paddr 0x0000000000400040 align 2**3\r\n         filesz 0x00000000000001f8 memsz 0x00000000000001f8 flags r-x\r\n  INTERP off    0x0000000000000238 vaddr 0x0000000000400238 paddr 0x0000000000400238 align 2**0\r\n         filesz 0x000000000000001c memsz 0x000000000000001c flags r--\r\n    LOAD off    0x0000000000000000 vaddr 0x0000000000400000 paddr 0x0000000000400000 align 2**21\r\n         filesz 0x0000000000007224 memsz 0x0000000000007224 flags r-x\r\n    LOAD off    0x0000000000007df0 vaddr 0x0000000000607df0 paddr 0x0000000000607df0 align 2**21\r\n         filesz 0x00000000000003fc memsz 0x0000000000000578 flags rw-\r\n DYNAMIC off    0x0000000000007e08 vaddr 0x0000000000607e08 paddr 0x0000000000607e08 align 2**3\r\n         filesz 0x00000000000001f0 memsz 0x00000000000001f0 flags rw-\r\n    NOTE off    0x0000000000000254 vaddr 0x0000000000400254 paddr 0x0000000000400254 align 2**2\r\n         filesz 0x0000000000000044 memsz 0x0000000000000044 flags r--\r\nEH_FRAME off    0x0000000000006a10 vaddr 0x0000000000406a10 paddr 0x0000000000406a10 align 2**2\r\n         filesz 0x000000000000013c memsz 0x000000000000013c flags r--\r\n   STACK off    0x0000000000000000 vaddr 0x0000000000000000 paddr 0x0000000000000000 align 2**4\r\n         filesz 0x0000000000000000 memsz 0x0000000000000000 flags rw-\r\n   RELRO off    0x0000000000007df0 vaddr 0x0000000000607df0 paddr 0x0000000000607df0 align 2**0\r\n         filesz 0x0000000000000210 memsz 0x0000000000000210 flags r--\r\n\r\nDynamic Section:\r\n  NEEDED               libpkgconf.so.3\r\n  NEEDED               libc.so.6\r\n  RPATH                /spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.4.0/pkgconf-1.4.2-fovrh7alpft646n6mhis5mml6k6e5f4v/lib:/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-5.4.0/pkgconf-1.4.2-fovrh7alpft646n6mhis5mml6k6e5f4v/lib64\r\n...\r\n```\r\nso this seems to be related in some way to the version of the OS.\r\n\r\n### Information on your system\r\n\r\nThe bug can be reproduced on the latest Ubuntu LTS docker image (`ubuntu:18.04`), while it's not there in the previous LTS (`ubuntu:16.04`).",
    "performed_via_github_app": null
}