{
    "url": "https://api.github.com/repos/spack/spack/issues/4046",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/4046/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/4046/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/4046/events",
    "html_url": "https://github.com/spack/spack/issues/4046",
    "id": 225184843,
    "node_id": "MDU6SXNzdWUyMjUxODQ4NDM=",
    "number": 4046,
    "title": "sbang fails when original line includes switches",
    "user": {
        "login": "hartzell",
        "id": 312978,
        "node_id": "MDQ6VXNlcjMxMjk3OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/312978?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hartzell",
        "html_url": "https://github.com/hartzell",
        "followers_url": "https://api.github.com/users/hartzell/followers",
        "following_url": "https://api.github.com/users/hartzell/following{/other_user}",
        "gists_url": "https://api.github.com/users/hartzell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hartzell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hartzell/subscriptions",
        "organizations_url": "https://api.github.com/users/hartzell/orgs",
        "repos_url": "https://api.github.com/users/hartzell/repos",
        "events_url": "https://api.github.com/users/hartzell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hartzell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-04-28T20:27:50Z",
    "updated_at": "2017-11-23T14:38:00Z",
    "closed_at": "2017-11-23T14:38:00Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I'm trying to sbang-ify bits of automake (#3719).  The scripts in question all start off with \r\n\r\n```\r\n#!/very/long/path/to/perl -w\r\n```\r\n\r\nWhen run under `sbang` (with a -x added to its own sbang line), they do this:\r\n\r\n```\r\n+ [[ hB != hxB ]]\r\n+ XTRACE_STATE=-x\r\n+ [[ hxB != hxB ]]                                                                                                                                                                                                 + VERBOSE_STATE=+v                                                                                                                                                                                                 + set +xv\r\n+ unset XTRACE_STATE VERBOSE_STATE\r\n+ script=bin/aclocal\r\n+ lines=0\r\n+ read line\r\n+ (( lines < 2 ))\r\n+ [[ #!/bin/bash /sc1/apps/spack/v0.0.10/bin/sbang = \\#\\!* ]]\r\n+ interpreter='/bin/bash /sc1/apps/spack/v0.0.10/bin/sbang'\r\n+ lines=1\r\n+ read line\r\n+ (( lines < 2 ))\r\n+ [[ #!/home/hartzelg/tmp/spack-automake-3719/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.24.1-j6bsz4heoekfacvjx6w2tof76g5suovl/bin/perl -w = \\#\\!* ]]\r\n+ interpreter='/home/hartzelg/tmp/spack-automake-3719/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.24.1-j6bsz4heoekfacvjx6w2tof76g5suovl/bin/perl -w'\r\n+ lines=2\r\n+ read line\r\n+ (( lines < 2 ))\r\n+ echo 'YIKES: /home/hartzelg/tmp/spack-automake-3719/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.24.1-j6bsz4heoekfacvjx6w2tof76g5suovl/bin/perl -w\"'\r\nYIKES: /home/hartzelg/tmp/spack-automake-3719/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.24.1-j6bsz4heoekfacvjx6w2tof76g5suovl/bin/perl -w\"\r\n+ [[ -n /home/hartzelg/tmp/spack-automake-3719/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.24.1-j6bsz4heoekfacvjx6w2tof76g5suovl/bin/perl -w ]]\r\n+ [[ perl -w = \\p\\e\\r\\l ]]\r\n+ exec /home/hartzelg/tmp/spack-automake-3719/opt/spack/linux-centos7-x86_64/gcc-4.8.5/perl-5.24.1-j6bsz4heoekfacvjx6w2tof76g5suovl/bin/perl -w bin/aclocal\r\n/blah/apps/spack/v0.0.10/bin/sbang: line 111: -w: No such file or directory\r\nerror: sbang found no interpreter in -w\r\n```\r\n\r\nI think that I see two issues:\r\n\r\n1. need to break the interpreter into space separated words, exec the first one and add the rest to the arguments\r\n2. need to do the comparison to \"perl\" *after* we trim the arguments.\r\n\r\nAm I walking into a well-known door or am I onto something?\r\n\r\ng.\r\n\r\n",
    "performed_via_github_app": null
}