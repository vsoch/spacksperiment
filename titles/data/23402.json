{
    "url": "https://api.github.com/repos/spack/spack/issues/23402",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/23402/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/23402/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/23402/events",
    "html_url": "https://github.com/spack/spack/issues/23402",
    "id": 874704375,
    "node_id": "MDU6SXNzdWU4NzQ3MDQzNzU=",
    "number": 23402,
    "title": "CUDA version 8 and lower does not install correctly",
    "user": {
        "login": "w8jcik",
        "id": 3964620,
        "node_id": "MDQ6VXNlcjM5NjQ2MjA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3964620?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w8jcik",
        "html_url": "https://github.com/w8jcik",
        "followers_url": "https://api.github.com/users/w8jcik/followers",
        "following_url": "https://api.github.com/users/w8jcik/following{/other_user}",
        "gists_url": "https://api.github.com/users/w8jcik/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/w8jcik/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/w8jcik/subscriptions",
        "organizations_url": "https://api.github.com/users/w8jcik/orgs",
        "repos_url": "https://api.github.com/users/w8jcik/repos",
        "events_url": "https://api.github.com/users/w8jcik/events{/privacy}",
        "received_events_url": "https://api.github.com/users/w8jcik/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 618601843,
            "node_id": "MDU6TGFiZWw2MTg2MDE4NDM=",
            "url": "https://api.github.com/repos/spack/spack/labels/cuda",
            "name": "cuda",
            "color": "85b737",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2021-05-03T16:05:43Z",
    "updated_at": "2021-07-01T19:04:04Z",
    "closed_at": "2021-07-01T19:04:04Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "@Rombur  @ax3l CUDA packages in versions 8, 7, 6 install but they have only `bin` directory with one file and `pkgconfig` with a few `.pc` files. Everything else is missing. Also a clear error appears when install is run with `-v` switch.\r\n\r\n### Steps to reproduce the issue\r\n\r\nSetup Spack on Ubuntu 20.04 (I am providing Dockerfile which you can run or review the setup procedure), then\r\n\r\n```sh\r\n$ spack install cuda@7.5.18\r\n```\r\n\r\nsucceeds, but when inspecting what was installed, there is nothing interesting inside\r\n\r\n```sh\r\n$ ls spack/opt/spack/linux-ubuntu21.04-x86_64/gcc-10.3.0/cuda-7.5.18-zulvhwufkr2hadarn6lht2u2hpnxsqhg/**\r\nbin:\r\nuninstall_cuda_7.5.pl\r\n\r\npkgconfig:\r\ncublas-7.5.pc  cudart-7.5.pc  cufftw-7.5.pc   curand-7.5.pc    cusparse-7.5.pc  nppi-7.5.pc  nvrtc-7.5.pc\r\ncuda-7.5.pc    cufft-7.5.pc   cuinj64-7.5.pc  cusolver-7.5.pc  nppc-7.5.pc      npps-7.5.pc  nvToolsExt-7.5.pc\r\n```\r\n\r\nIt is an issue with older versions only. For example CUDA `spack install cuda@9.0.176` and newer works just fine.\r\n\r\n### Information on my system\r\n\r\n* **Spack:** 0.16.1\r\n* **Python:** 3.8.5\r\n* **Platform:** linux-ubuntu20.04-skylake\r\n\r\nNo issues with installing other packages, for example Gromacs with CUDA and OpenMPI installs and works without any problems.\r\n\r\n### Additional information\r\n\r\nI was trying to fix it and made following observation\r\n\r\nWhen run Spack with `-v` switch, `spack install -v cuda@7.5.18`, installation exits with 0 code, but it actually fails with the message\r\n\r\n```\r\nCan't locate InstallUtils.pm in @INC ...\r\n```\r\n\r\nAfter searching for _Can't locate InstallUtils.pm in @ INC_ in Google, it looks like it is a common issue and people are doing this workaround which doesn't look well\r\n\r\n```\r\n1. unpack .run file ./cuda*.run --tar mxvf\r\n2. copy InstallUtils.pm to /usr/lib/x86_64-linux-gnu/perl-base \r\n3. export $PERL5LIB\r\n```\r\n\r\nhttps://forums.developer.nvidia.com/t/cant-locate-installutils-pm-in-inc/46952/2\r\n\r\nMaybe `env.set('PERL5LIB', <something>)` needs to be added, but I don't understand fully what is the issue.\r\n\r\nI was searching for `InstallUtils` module but I am not sure if it exists outside of archive provided by Nvidia.\r\n\r\nAlso checked Spack versions down to 0.11, it has the same problem with older CUDA.\r\n\r\nMaybe it is related to Ubuntu because search results talk mostly about Ubuntu. But maybe Ubuntu is just popular. Some search results for Fedora appear as well.\r\n\r\n### Build logs\r\n\r\nI cannot find the logs mentioned in the issue guidelines, maybe because the build doesn't fail, but I am attaching output from `install -v`\r\n\r\n`/tmp/cuda_install_677.log`\r\n\r\n```\r\nInstalling the CUDA Toolkit in /home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/cuda-7.5.18-4resccyax4stxchu53nzyt3ki6a2n4vo ...\r\nVerifying archive integrity... All good.\r\n\r\nUncompressing NVIDIA CUDA....................\r\nCan't locate InstallUtils.pm in @INC (you may need to install the InstallUtils module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.30.0 /usr/local/share/perl/5.30.0 /usr/lib/x86_64-linux-gnu/perl5/5.30 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.30 /usr/share/perl/5.30 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at ./install-linux.pl line 6.\r\n\r\nBEGIN failed--compilation aborted at ./install-linux.pl line 6.\r\n\r\nVerifying archive integrity... All good.\r\n\r\nUncompressing NVIDIA CUDA Samples.........\r\nCan't locate InstallUtils.pm in @INC (you may need to install the InstallUtils module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.30.0 /usr/local/share/perl/5.30.0 /usr/lib/x86_64-linux-gnu/perl5/5.30 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.30 /usr/share/perl/5.30 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at ./install-sdk-linux.pl line 6.\r\n\r\nBEGIN failed--compilation aborted at ./install-sdk-linux.pl line 6.\r\n\r\n'uninstall_cuda_7.5.pl' -> '/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/cuda-7.5.18-4resccyax4stxchu53nzyt3ki6a2n4vo/bin/uninstall_cuda_7.5.pl'\r\n\r\n===========\r\n= Summary =\r\n===========\r\n\r\nDriver:   Not Selected\r\nToolkit:  Installation Failed\r\nSamples:  Not Selected\r\n```\r\n\r\n`export`\r\n\r\n```\r\ndeclare -x CMAKE_PREFIX_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/perl-5.32.0-u6vu3por473nartqgj4yisbnwud6bhgr:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd\"\r\ndeclare -x CPLUS_INCLUDE_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/include\"\r\ndeclare -x C_INCLUDE_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/include\"\r\ndeclare -x HOME=\"/home/user\"\r\ndeclare -x HOSTNAME=\"9785e8573985\"\r\ndeclare -x INCLUDE=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/include:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/include\"\r\ndeclare -x LD_LIBRARY_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/perl-5.32.0-u6vu3por473nartqgj4yisbnwud6bhgr/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/lib\"\r\ndeclare -x LESSCLOSE=\"/usr/bin/lesspipe %s %s\"\r\ndeclare -x LESSOPEN=\"| /usr/bin/lesspipe %s\"\r\ndeclare -x LIBRARY_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/perl-5.32.0-u6vu3por473nartqgj4yisbnwud6bhgr/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/lib\"\r\ndeclare -x LS_COLORS=\"rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:\"\r\ndeclare -x MANPATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/perl-5.32.0-u6vu3por473nartqgj4yisbnwud6bhgr/man:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/share/man:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/share/man\"\r\ndeclare -x MODULEPATH=\"/home/user/.spack/root/share/spack/modules/linux-ubuntu20.04-broadwell\"\r\ndeclare -x NVIDIA_DRIVER_CAPABILITIES=\"compute,utility\"\r\ndeclare -x NVIDIA_VISIBLE_DEVICES=\"all\"\r\ndeclare -x OLDPWD=\"/home/user\"\r\ndeclare -x PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/perl-5.32.0-u6vu3por473nartqgj4yisbnwud6bhgr/bin:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/bin:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/bin:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/bin:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/bin:/home/user/.spack/root/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\r\ndeclare -x PKG_CONFIG_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/lib/pkgconfig:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/lib/pkgconfig\"\r\ndeclare -x PWD=\"/home/user/.spack/root\"\r\ndeclare -x SHLVL=\"1\"\r\ndeclare -x SPACK_LD_LIBRARY_PATH=\"/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/perl-5.32.0-u6vu3por473nartqgj4yisbnwud6bhgr/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/gdbm-1.18.1-gkhie6ngl6pemrncgg5l6sfw73edyjwm/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/readline-8.0-b5sbr6vjal7wxgvr3zdo25crkkir3jwn/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/ncurses-6.2-3knykvmtzoj5zgjcztz342hwgruoaymc/lib:/home/user/.spack/root/opt/spack/linux-ubuntu20.04-broadwell/gcc-6.5.0/berkeley-db-18.1.40-ng7hfe4v54m7vooyvdv6ka4v3jveiwnd/lib\"\r\ndeclare -x SPACK_LOADED_HASHES=\"u6vu3por473nartqgj4yisbnwud6bhgr:gkhie6ngl6pemrncgg5l6sfw73edyjwm:b5sbr6vjal7wxgvr3zdo25crkkir3jwn:3knykvmtzoj5zgjcztz342hwgruoaymc:ng7hfe4v54m7vooyvdv6ka4v3jveiwnd\"\r\ndeclare -x SPACK_ROOT=\"/home/user/.spack/root\"\r\ndeclare -x TERM=\"xterm\"\r\ndeclare -x _sp_initializing\r\n```\r\n\r\n### Dockerfile\r\n\r\nTo reproduce this easily I am attaching a docker file\r\n\r\n`Dockerfile`\r\n\r\n```\r\nFROM ubuntu:20.04\r\n\r\n# Spack dependencies\r\n\r\nRUN apt-get update && DEBIAN_FRONTEND=noninteractive \\\r\n    apt-get install -y build-essential python3 python3-pip \\\r\n    tar gzip unzip bzip2 xz-utils zstd patch git curl gnupg2 \\\r\n  && rm -rf /var/lib/apt/lists/*\r\n\r\nRUN apt-get update && DEBIAN_FRONTEND=noninteractive \\\r\n    apt-get install -y nvidia-driver-460-server \\\r\n  && rm -rf /var/lib/apt/lists/*\r\n\r\nENV NVIDIA_VISIBLE_DEVICES all\r\nENV NVIDIA_DRIVER_CAPABILITIES compute,utility\r\n\r\n# Spack\r\n\r\nRUN useradd -m user\r\n\r\nUSER user\r\n\r\nRUN mkdir -p ~/.spack && git clone --depth 1 --single-branch \\\r\n    --branch \"v0.16.1\" https://github.com/spack/spack.git ~/.spack/root\r\n\r\nADD packages.yaml /home/user/.spack/packages.yaml\r\n\r\nWORKDIR /home/user\r\n\r\nRUN bash -c \"echo source ~/.spack/root/share/spack/setup-env.sh >> ~/.bashrc\"\r\n\r\n# Compiler\r\n\r\nRUN bash -c \"source ~/.spack/root/share/spack/setup-env.sh \\\r\n    && spack install gcc@6.5.0 \\\r\n    && spack load gcc@6.5.0 \\\r\n    && spack compiler find\"\r\n\r\nADD packages.yaml /home/user/.spack/packages.yaml\r\n\r\n# CUDA package\r\n\r\nRUN bash -c \"source ~/.spack/root/share/spack/setup-env.sh \\\r\n    && spack install cuda@7.5.18\"\r\n```\r\n\r\n`packages.yaml`\r\n\r\n```\r\npackages:\r\n  all:\r\n    compiler: [\"gcc@6.5.0\"]\r\n    target: [broadwell]\r\n```\r\n\r\n### General information\r\n\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [x] I have uploaded the build log and environment files\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}