{
    "url": "https://api.github.com/repos/spack/spack/issues/10028",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10028/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10028/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10028/events",
    "html_url": "https://github.com/spack/spack/pull/10028",
    "id": 387936479,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MjM2MzE1Mzg1",
    "number": 10028,
    "title": "bugfix: multimethod inheritance",
    "user": {
        "login": "becker33",
        "id": 13971568,
        "node_id": "MDQ6VXNlcjEzOTcxNTY4",
        "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/becker33",
        "html_url": "https://github.com/becker33",
        "followers_url": "https://api.github.com/users/becker33/followers",
        "following_url": "https://api.github.com/users/becker33/following{/other_user}",
        "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
        "organizations_url": "https://api.github.com/users/becker33/orgs",
        "repos_url": "https://api.github.com/users/becker33/repos",
        "events_url": "https://api.github.com/users/becker33/events{/privacy}",
        "received_events_url": "https://api.github.com/users/becker33/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-12-05T20:40:47Z",
    "updated_at": "2018-12-17T19:15:59Z",
    "closed_at": "2018-12-06T23:48:24Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/10028",
        "html_url": "https://github.com/spack/spack/pull/10028",
        "diff_url": "https://github.com/spack/spack/pull/10028.diff",
        "patch_url": "https://github.com/spack/spack/pull/10028.patch"
    },
    "body": "Multimethods (using the `@when` decorator) previously did not work with package inheritance.\r\n\r\nIf package `foo` extended package `bar` and `bar` used multimethods, `spack install foo` would enter an infinite recursion and hit python's maximum recursion depth.\r\n\r\nThis was due to our reliance on the `super` method to recurse up the method resolution order. The `super` builtin ~uses~ returns a proxy object that delegates method lookup to the superclass but does not change the bound object of methods of the proxy object. This lead to a recursion error when searching for possible matches for a multimethod.\r\n\r\nThis PR changes the search algorithm for multimethods to use `inspect.getmro()` to search the MRO DAG for the class and uses an iterative instead of recursive algorithm to ensure we follow MRO properly when looking for matching specs in multimethods.\r\n\r\nThis also includes some refactoring of the Spec object that @tgamblin found convenient to do at the same time. It removes the `parse_anonymous_spec` call from multimethod.py, relying on the newer anonymous spec feature.",
    "performed_via_github_app": null
}