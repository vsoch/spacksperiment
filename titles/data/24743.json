{
    "url": "https://api.github.com/repos/spack/spack/issues/24743",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/24743/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/24743/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/24743/events",
    "html_url": "https://github.com/spack/spack/pull/24743",
    "id": 938453301,
    "node_id": "MDExOlB1bGxSZXF1ZXN0Njg0ODM2NzIx",
    "number": 24743,
    "title": "perl: add dependencies for bzip2 and zlib",
    "user": {
        "login": "mwkrentel",
        "id": 3969036,
        "node_id": "MDQ6VXNlcjM5NjkwMzY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3969036?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mwkrentel",
        "html_url": "https://github.com/mwkrentel",
        "followers_url": "https://api.github.com/users/mwkrentel/followers",
        "following_url": "https://api.github.com/users/mwkrentel/following{/other_user}",
        "gists_url": "https://api.github.com/users/mwkrentel/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mwkrentel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mwkrentel/subscriptions",
        "organizations_url": "https://api.github.com/users/mwkrentel/orgs",
        "repos_url": "https://api.github.com/users/mwkrentel/repos",
        "events_url": "https://api.github.com/users/mwkrentel/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mwkrentel/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446630669,
            "node_id": "MDU6TGFiZWw0NDY2MzA2Njk=",
            "url": "https://api.github.com/repos/spack/spack/labels/dependencies",
            "name": "dependencies",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 729584669,
            "node_id": "MDU6TGFiZWw3Mjk1ODQ2Njk=",
            "url": "https://api.github.com/repos/spack/spack/labels/update-package",
            "name": "update-package",
            "color": "c68137",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2021-07-07T03:54:10Z",
    "updated_at": "2021-07-07T13:34:16Z",
    "closed_at": "2021-07-07T09:25:57Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/24743",
        "html_url": "https://github.com/spack/spack/pull/24743",
        "diff_url": "https://github.com/spack/spack/pull/24743.diff",
        "patch_url": "https://github.com/spack/spack/pull/24743.patch"
    },
    "body": "Perl keeps copies of the bzip2 and zlib source code in its own source\r\ntree and by default uses them in favor of outside libraries.  Instead,\r\nput these dependencies under control of spack and tell perl to use the\r\nspack-built versions.\r\n\r\n----------\r\n\r\nThis all started when `spack install perl` failed on stria at Sandia\r\nNatl Labs.\r\n\r\nTurns out that perl keeps its own copies of the sources for bzip2 and zlib\r\n(or parts thereof) and either uses its own copy or an external copy based on\r\nsome environ vars in `cpan/Compress-Raw-Bzip2/Makefile.PL`\r\n\r\n```\r\nmy $BUILD_BZIP2 = defined($ENV{BUILD_BZIP2}) ? $ENV{BUILD_BZIP2} : 1;\r\nmy $BZIP2_LIB = defined($ENV{BZIP2_LIB}) ? $ENV{BZIP2_LIB} : 'bzip2-src';\r\nmy $BZIP2_INCLUDE = defined($ENV{BZIP2_INCLUDE}) ? $ENV{BZIP2_INCLUDE} : '.';\r\n```\r\n\r\nThe problem on stria was that a bzip2 module set `BZIP2_LIB` and\r\n`BZIP2_INC`, but not `BZIP2_INCLUDE`.  That is, half of the environment\r\nwas pointing to perl's internal bzip2 and half to the external\r\nversion.  This confused the Makefiles and broke the build.\r\n\r\nAnyway, there are two solutions, either always use the internal copy\r\nor always use the external version.\r\n\r\n1. always use perl's internal copy.\r\npros: simpler, fewer dependencies, this is how spack has built perl\r\nsince forever.\r\ncons: uses perl's vendor copies of bzip2, not the spack ones.\r\n\r\n2. always use external (spack) version.\r\npros: puts dependencies under spack control.\r\ncons: adds extra dependencies.\r\n\r\nBut spack really needs to make a decision, we can't leave it up to\r\nlocal environment settings.  That would mean either option could\r\nhappen with the same hash.  Plus, it wouldn't fix the failure on stria.\r\n\r\nOriginally, I chose (1) and submitted PR #24605.  But the consensus in\r\n#24605 was for (2), so I'm closing #24605 and opening this PR.\r\n\r\nI'm still a bit uneasy about adding two new dependencies to perl, but we'll\r\nsee how it goes.\r\n\r\nPing @becker33 @michaelkuhn @mjwoods @hartzell @alalazo @gartung\r\n@jrood-nrel @adamjstewart @scheibelp @tgamblin\r\n\r\nin case anyone has strong feelings about (1) vs. (2).\r\n\r\nAnd no, don't make me maintainer.\r\n",
    "performed_via_github_app": null
}