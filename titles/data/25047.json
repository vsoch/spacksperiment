{
    "url": "https://api.github.com/repos/spack/spack/issues/25047",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/25047/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/25047/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/25047/events",
    "html_url": "https://github.com/spack/spack/issues/25047",
    "id": 951070434,
    "node_id": "MDU6SXNzdWU5NTEwNzA0MzQ=",
    "number": 25047,
    "title": "raja test failure on shared library ",
    "user": {
        "login": "shahzebsiddiqui",
        "id": 12942230,
        "node_id": "MDQ6VXNlcjEyOTQyMjMw",
        "avatar_url": "https://avatars.githubusercontent.com/u/12942230?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/shahzebsiddiqui",
        "html_url": "https://github.com/shahzebsiddiqui",
        "followers_url": "https://api.github.com/users/shahzebsiddiqui/followers",
        "following_url": "https://api.github.com/users/shahzebsiddiqui/following{/other_user}",
        "gists_url": "https://api.github.com/users/shahzebsiddiqui/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/shahzebsiddiqui/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/shahzebsiddiqui/subscriptions",
        "organizations_url": "https://api.github.com/users/shahzebsiddiqui/orgs",
        "repos_url": "https://api.github.com/users/shahzebsiddiqui/repos",
        "events_url": "https://api.github.com/users/shahzebsiddiqui/events{/privacy}",
        "received_events_url": "https://api.github.com/users/shahzebsiddiqui/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483390,
            "node_id": "MDU6TGFiZWw1MTI0ODMzOTA=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-medium",
            "name": "impact-medium",
            "color": "fef2c0",
            "default": false,
            "description": ""
        },
        {
            "id": 1858171143,
            "node_id": "MDU6TGFiZWwxODU4MTcxMTQz",
            "url": "https://api.github.com/repos/spack/spack/labels/stand-alone-tests",
            "name": "stand-alone-tests",
            "color": "5ec0d6",
            "default": false,
            "description": "Stand-alone (or smoke) tests for installed packages"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tldahlgren",
            "id": 35777542,
            "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tldahlgren",
            "html_url": "https://github.com/tldahlgren",
            "followers_url": "https://api.github.com/users/tldahlgren/followers",
            "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
            "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
            "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
            "repos_url": "https://api.github.com/users/tldahlgren/repos",
            "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2021-07-22T21:18:09Z",
    "updated_at": "2021-07-29T19:09:06Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Here is an example script from Cori running the raja test via `spack test`\r\n\r\n```\r\n#!/bin/bash\r\n\r\n\r\n######## START OF PRE COMMANDS ######## \r\nmodule load e4s\r\n######## END OF PRE COMMANDS   ######## \r\n\r\n\r\nsource /global/common/software/spackecp/e4s-21.02/spack/share/spack/setup-env.sh\r\nspack test run  --alias raja@0.13.0 raja@0.13.0\r\nspack test results  -- raja@0.13.0\r\n```\r\n\r\n### Error Message\r\n\r\nWe are getting error message where raja library is not found. \r\n\r\n```\r\n==> Error: TestFailure: 7 tests failed.\r\nCommand exited with status 127:\r\n    './ex5_line-of-sight_solution'\r\n./ex5_line-of-sight_solution: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     1    ==> Testing package raja-0.13.0-xjqerqf\r\n     2    ==> [2021-07-22-09:08:49.796598] test: checking output of ex5_line-of\r\n          -sight_solution for ['RAJA sequential', 'RAJA OpenMP', 'result -- PAS\r\n          S']\r\n     3    ==> [2021-07-22-09:08:49.797557] './ex5_line-of-sight_solution'\r\n     4    ./ex5_line-of-sight_solution: error while loading shared libraries: l\r\n          ibRAJA.so: cannot open shared object file: No such file or directory\r\n     5    FAILED: Command exited with status 127:\r\n     6        './ex5_line-of-sight_solution'\r\n  >> 7    ./ex5_line-of-sight_solution: error while loading shared libraries: l\r\n          ibRAJA.so: cannot open shared object file: No such file or directory\r\n     8    \r\n     9      File \"/global/common/software/spackecp/e4s-21.02/spack/bin/spack\", \r\n          line 71, in <module>\r\nCommand exited with status 127:\r\n    './ex6_stencil-offset-layout_solution'\r\n./ex6_stencil-offset-layout_solution: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     46        self.run_test(exe, [], expected, installed=False,\r\n     47    ==> [2021-07-22-09:08:49.818996] test: checking output of ex6_stenci\r\n           l-offset-layout_solution for ['RAJA Views \\\\(permuted\\\\)', 'result -\r\n           - PASS']\r\n     48    ==> [2021-07-22-09:08:49.819946] './ex6_stencil-offset-layout_soluti\r\n           on'\r\n     49    ./ex6_stencil-offset-layout_solution: error while loading shared lib\r\n           raries: libRAJA.so: cannot open shared object file: No such file or \r\n           directory\r\n     50    FAILED: Command exited with status 127:\r\n     51        './ex6_stencil-offset-layout_solution'\r\n  >> 52    ./ex6_stencil-offset-layout_solution: error while loading shared lib\r\n           raries: libRAJA.so: cannot open shared object file: No such file or \r\n           directory\r\n     53    \r\nCommand exited with status 127:\r\n    './ex8_tiled-matrix-transpose_solution'\r\n./ex8_tiled-matrix-transpose_solution: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     91        self.run_test(exe, [], expected, installed=False,\r\n     92    ==> [2021-07-22-09:08:49.831069] test: checking output of ex8_tiled-\r\n           matrix-transpose_solution for ['parallel top inner loop', 'collapsed\r\n            inner loops', 'result -- PASS']\r\n     93    ==> [2021-07-22-09:08:49.831971] './ex8_tiled-matrix-transpose_solut\r\n           ion'\r\n     94    ./ex8_tiled-matrix-transpose_solution: error while loading shared li\r\n           braries: libRAJA.so: cannot open shared object file: No such file or\r\n            directory\r\n     95    FAILED: Command exited with status 127:\r\n     96        './ex8_tiled-matrix-transpose_solution'\r\n  >> 97    ./ex8_tiled-matrix-transpose_solution: error while loading shared li\r\n           braries: libRAJA.so: cannot open shared object file: No such file or\r\n            directory\r\n     98    \r\n     99      File \"/global/common/software/spackecp/e4s-21.02/spack/bin/spack\",\r\n            line 71, in <module>\r\nCommand exited with status 127:\r\n    './kernel-dynamic-tile'\r\n./kernel-dynamic-tile: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     136        self.run_test(exe, [], expected, installed=False,\r\n     137    ==> [2021-07-22-09:08:49.844390] test: checking output of kernel-dy\r\n            namic-tile for ['Running index', '(24,24)']\r\n     138    ==> [2021-07-22-09:08:49.845350] './kernel-dynamic-tile'\r\n     139    ./kernel-dynamic-tile: error while loading shared libraries: libRAJ\r\n            A.so: cannot open shared object file: No such file or directory\r\n     140    FAILED: Command exited with status 127:\r\n     141        './kernel-dynamic-tile'\r\n  >> 142    ./kernel-dynamic-tile: error while loading shared libraries: libRAJ\r\n            A.so: cannot open shared object file: No such file or directory\r\n     143    \r\nCommand exited with status 127:\r\n    './plugin-example'\r\n./plugin-example: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     181        self.run_test(exe, [], expected, installed=False,\r\n     182    ==> [2021-07-22-09:08:49.859722] test: checking output of plugin-ex\r\n            ample for ['Launching host kernel for the 10 time']\r\n     183    ==> [2021-07-22-09:08:49.860615] './plugin-example'\r\n     184    ./plugin-example: error while loading shared libraries: libRAJA.so:\r\n             cannot open shared object file: No such file or directory\r\n     185    FAILED: Command exited with status 127:\r\n     186        './plugin-example'\r\n  >> 187    ./plugin-example: error while loading shared libraries: libRAJA.so:\r\n             cannot open shared object file: No such file or directory\r\n     188    \r\n     189      File \"/global/common/software/spackecp/e4s-21.02/spack/bin/spack\"\r\n            , line 71, in <module>\r\nCommand exited with status 127:\r\n    './tut_batched-matrix-multiply'\r\n./tut_batched-matrix-multiply: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     226        self.run_test(exe, [], expected, installed=False,\r\n     227    ==> [2021-07-22-09:08:49.876906] test: checking output of tut_batch\r\n            ed-matrix-multiply for ['result -- PASS']\r\n     228    ==> [2021-07-22-09:08:49.877746] './tut_batched-matrix-multiply'\r\n     229    ./tut_batched-matrix-multiply: error while loading shared libraries\r\n            : libRAJA.so: cannot open shared object file: No such file or direc\r\n            tory\r\n     230    FAILED: Command exited with status 127:\r\n     231        './tut_batched-matrix-multiply'\r\n  >> 232    ./tut_batched-matrix-multiply: error while loading shared libraries\r\n            : libRAJA.so: cannot open shared object file: No such file or direc\r\n            tory\r\n     233    \r\n     234      File \"/global/common/software/spackecp/e4s-21.02/spack/bin/spack\"\r\n            , line 71, in <module>\r\nCommand exited with status 127:\r\n    './wave-eqn'\r\n./wave-eqn: error while loading shared libraries: libRAJA.so: cannot open shared object file: No such file or directory\r\n1 error found in test log:\r\n     271        self.run_test(exe, [], expected, installed=False,\r\n     272    ==> [2021-07-22-09:08:49.895297] test: checking output of wave-eqn \r\n            for ['Max Error = 2', 'Evolved solution to time']\r\n     273    ==> [2021-07-22-09:08:49.896196] './wave-eqn'\r\n     274    ./wave-eqn: error while loading shared libraries: libRAJA.so: canno\r\n            t open shared object file: No such file or directory\r\n     275    FAILED: Command exited with status 127:\r\n     276        './wave-eqn'\r\n  >> 277    ./wave-eqn: error while loading shared libraries: libRAJA.so: canno\r\n            t open shared object file: No such file or directory\r\n     278    \r\n     279      File \"/global/common/software/spackecp/e4s-21.02/spack/bin/spack\"\r\n            , line 71, in <module>\r\n/global/common/software/spackecp/e4s-21.02/spack/lib/spack/spack/build_environment.py:872, in _setup_pkg_and_run:\r\n        869        tb_string = traceback.format_exc()\r\n        870\r\n        871        # build up some context from the offending package so we can\r\n  >>    872        # show that, too.\r\n        873        package_context = get_package_context(tb)\r\n        874\r\n        875        logfile = None\r\nSee test log for details:\r\n  /global/homes/e/e4s/.spack/test/ckzv2cvyttacaubxb5arnsmeq7zpiewv/raja-0.13.0-xjqerqf-test-out.txt\r\n```\r\n\r\nI can confirm that there is a shared library **libRAJA.so** so its not why linker is not picking up the library when `spack test` is run for the spec. Does spack not setup the environment to load the appropriate paths including `LD_LIBRARY_PATH` for the install root so it picks up the library. \r\n\r\n```\r\nsiddiq90@cori04> ls $(spack location -i raja@0.13.0)/lib\r\nlibRAJA.so  pkgconfig\r\n```\r\n\r\nThis test can be reproduced by running the example script on Cori as is.\r\n\r\n### Information on your system\r\n\r\n```\r\nsiddiq90@cori04> spack debug report\r\n* **Spack:** 0.16.1-1522-4acb3cea22\r\n* **Python:** 3.6.12\r\n* **Platform:** cray-sles15-haswell\r\n* **Concretizer:** original\r\n```\r\n\r\n### Additional information\r\n\r\n- Documentation: https://docs.nersc.gov/applications/e4s/cori/21.02/\r\n- Spack configuration: https://github.com/spack/spack-configs/tree/main/NERSC/cori/e4s-21.02\r\n- Raja Test in buildtest: https://github.com/buildtesters/buildtest-cori/blob/devel/buildspecs/e4s/21.02/raja.yml\r\n- CDASH build: https://my.cdash.org/test/37402699\r\n\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n\r\n",
    "performed_via_github_app": null
}