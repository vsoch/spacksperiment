{
    "url": "https://api.github.com/repos/spack/spack/issues/12733",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/12733/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/12733/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/12733/events",
    "html_url": "https://github.com/spack/spack/pull/12733",
    "id": 490105299,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MzE0Nzc2NDM5",
    "number": 12733,
    "title": "Bugfix/Feature: Refactor #12516 stage path handling; resolve `spack clean` (#12633, #13006)",
    "user": {
        "login": "tldahlgren",
        "id": 35777542,
        "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
        "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tldahlgren",
        "html_url": "https://github.com/tldahlgren",
        "followers_url": "https://api.github.com/users/tldahlgren/followers",
        "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
        "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
        "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
        "repos_url": "https://api.github.com/users/tldahlgren/repos",
        "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 1566617052,
            "node_id": "MDU6TGFiZWwxNTY2NjE3MDUy",
            "url": "https://api.github.com/repos/spack/spack/labels/bugfix",
            "name": "bugfix",
            "color": "c4aaef",
            "default": false,
            "description": ""
        },
        {
            "id": 456121338,
            "node_id": "MDU6TGFiZWw0NTYxMjEzMzg=",
            "url": "https://api.github.com/repos/spack/spack/labels/refactoring",
            "name": "refactoring",
            "color": "f28f2a",
            "default": false,
            "description": null
        },
        {
            "id": 1371552534,
            "node_id": "MDU6TGFiZWwxMzcxNTUyNTM0",
            "url": "https://api.github.com/repos/spack/spack/labels/stage",
            "name": "stage",
            "color": "b50fc1",
            "default": false,
            "description": ""
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        },
        {
            "login": "tldahlgren",
            "id": 35777542,
            "node_id": "MDQ6VXNlcjM1Nzc3NTQy",
            "avatar_url": "https://avatars.githubusercontent.com/u/35777542?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tldahlgren",
            "html_url": "https://github.com/tldahlgren",
            "followers_url": "https://api.github.com/users/tldahlgren/followers",
            "following_url": "https://api.github.com/users/tldahlgren/following{/other_user}",
            "gists_url": "https://api.github.com/users/tldahlgren/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tldahlgren/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tldahlgren/subscriptions",
            "organizations_url": "https://api.github.com/users/tldahlgren/orgs",
            "repos_url": "https://api.github.com/users/tldahlgren/repos",
            "events_url": "https://api.github.com/users/tldahlgren/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tldahlgren/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 16,
    "created_at": "2019-09-06T03:13:13Z",
    "updated_at": "2019-10-22T20:52:41Z",
    "closed_at": "2019-10-16T21:55:38Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/12733",
        "html_url": "https://github.com/spack/spack/pull/12733",
        "diff_url": "https://github.com/spack/spack/pull/12733.diff",
        "patch_url": "https://github.com/spack/spack/pull/12733.patch"
    },
    "body": "Fixes #12633 \r\nFixes #13006 \r\n\r\nResolves post-merge issues in #12516, which primarily revolve around:\r\n\r\n-  replacing use of path indexing with more idiomatic python;\r\n- fixing access check when creating stage root directory and raising an OSError whenever a subdirectory cannot be accessed; \r\n- generating a warning (versus assertion error) if the user does not own a descendant of the `$user` directory; and\r\n- changing the stage directory name to prepend `spack-stage-` to directories to be purged.\r\n\r\nTODO:\r\n- [x] Add `prefixes` function to `filesystems.py`\r\n- [x] Change `_create_stage_root` to use `prefixes`\r\n- [x] Change `_create_stage_root` to check access at each (created) level\r\n- [x] Change `_create_stage_root` to display warning if subdir of `$user` not owned by user\r\n- [x] Change `_resolve_paths` to use `replace` instead of `os.path.join`\r\n- [x] Address new code coverage issues in `_create_stage_root`\r\n- [x] Address new code coverage issue in `_resolve_paths`\r\n- [x] Prepend `spack-stage-` to (unnamed) package stage directories and change stage's `purge` to remove only these directories.\r\n- [x] Remove unnecessary `yield`s from stage-related fixtures\r\n- [x] Make the spack stage variable public and drop `stage-` (from `spack-stage-`)\r\n- [x] Add function to split the prefix list (by entry) -- called `partition` -- to simplify processing in `stage.py` and the associated test\r\n- [x] Clarify purpose in `test_create_stage_root_non_uid` docstring \r\n- [x] Remove unnecessary restoration of `monkeypatch`'d `os.stat` for Python 3.5 and 3.6\r\n~- [ ] Add tests for new `_create_stage_root` warnings~\r\n- [x] Resolve issues related to dropping restoration of `monkeypatch`'d `os.stat`\r\n- [x] Replace `args[0]` with `errno` for `exc_info`\r\n- [x] Remove `can_access` check on `_create_stage_root` user path processing\r\n- [x] Change new `filesystem` `partition` function to `partition_path`\r\n- [x] Replace empty string checks\r\n- [x] Add/update `partition_path`-related comments\r\n- [x] Replace hard-coded 2 with `errno.ENOENT` in a `try-except` block\r\n- [x] Update `build_stage` configuration comments to reflect prepending `spack-stage-`\r\n- [x] Correct test `check_stage_dir_perms` prefix handling\r\n- [x] Add examples to `prefixes` docstring\r\n- [x] Simplify `prefixes` parts extraction (so more \"blunt\")\r\n- [x] Replace enumerate with range in `prefixes`\r\n- [x] Add explicit `prefixes` unit tests",
    "performed_via_github_app": null
}