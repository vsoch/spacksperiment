{
    "url": "https://api.github.com/repos/spack/spack/issues/15194",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/15194/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/15194/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/15194/events",
    "html_url": "https://github.com/spack/spack/issues/15194",
    "id": 570232049,
    "node_id": "MDU6SXNzdWU1NzAyMzIwNDk=",
    "number": 15194,
    "title": "Concretization Issue due to new fftw variants",
    "user": {
        "login": "marvinbernhardt",
        "id": 25516935,
        "node_id": "MDQ6VXNlcjI1NTE2OTM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/25516935?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/marvinbernhardt",
        "html_url": "https://github.com/marvinbernhardt",
        "followers_url": "https://api.github.com/users/marvinbernhardt/followers",
        "following_url": "https://api.github.com/users/marvinbernhardt/following{/other_user}",
        "gists_url": "https://api.github.com/users/marvinbernhardt/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/marvinbernhardt/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/marvinbernhardt/subscriptions",
        "organizations_url": "https://api.github.com/users/marvinbernhardt/orgs",
        "repos_url": "https://api.github.com/users/marvinbernhardt/repos",
        "events_url": "https://api.github.com/users/marvinbernhardt/events{/privacy}",
        "received_events_url": "https://api.github.com/users/marvinbernhardt/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483297,
            "node_id": "MDU6TGFiZWw1MTI0ODMyOTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-low",
            "name": "impact-low",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2020-02-25T00:30:04Z",
    "updated_at": "2020-03-11T22:03:00Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I run spac spec to concretize votca-csg. When I try to use an existing gromacs package, it fails due to the fftw package. I have some old fftw packages so this is almost certainly related to https://github.com/spack/spack/pull/12889.\r\n\r\n### Steps to reproduce the issue\r\n\r\nhave some old gromacs and old fftw and then execute\r\n```console\r\n$ spack  spec -I votca-csg ^/qmpnnzb\r\n==> [2020-02-25-01:21:23.418631] Reading config file /shared/spack/etc/spack/defaults/modules.yaml\r\n==> [2020-02-25-01:21:23.435872] Reading config file /shared/spack/etc/spack/defaults/linux/modules.yaml\r\n==> [2020-02-25-01:21:23.441325] Reading config file /shared/spack/etc/spack/defaults/config.yaml\r\n==> [2020-02-25-01:21:23.472134] Reading config file /shared/spack/etc/spack/config.yaml\r\n==> [2020-02-25-01:21:23.476842] Imported spec from built-in commands\r\n==> [2020-02-25-01:21:23.477859] Imported spec from built-in commands\r\n==> [2020-02-25-01:21:23.497424] DATABASE LOCK TIMEOUT: 120s\r\n==> [2020-02-25-01:21:23.497515] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2020-02-25-01:21:23.498248] READ LOCK: /shared/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> [2020-02-25-01:21:23.498532] READ LOCK: /shared/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> [2020-02-25-01:21:23.585342] READ LOCK: /shared/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> [2020-02-25-01:21:23.586214] READ LOCK: /shared/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> [2020-02-25-01:21:23.586456] READ LOCK: /shared/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\nInput spec\r\n--------------------------------\r\n==> [2020-02-25-01:21:23.673003] Reading config file /shared/spack/etc/spack/defaults/repos.yaml\r\n -   votca-csg\r\n -       ^gromacs@2019.5%gcc@8.2.0 build_type=RelWithDebInfo ~cuda~double~mpi~plumed+rdtscp+shared simd=SSE2 arch=linux-fedora29-x86_64\r\n -           ^fftw@3.3.8%gcc@8.2.0+double+float~fma+long_double+mpi~openmp~pfft_patches~quad simd=avx,avx2,sse2 arch=linux-fedora29-x86_64\r\n -               ^openmpi@2.1.1%gcc@8.2.0~cuda+cxx_exceptions fabrics=auto ~java~legacylaunchers~memchecker~pmi schedulers=auto ~sqlite3~thread_multiple+vt arch=linux-fedora29-x86_64\r\n\r\nConcretized\r\n--------------------------------\r\n==> [2020-02-25-01:21:23.884246] READ LOCK: /shared/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\nTraceback (most recent call last):\r\n  File \"/shared/spack/bin/spack\", line 64, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/shared/spack/lib/spack/spack/main.py\", line 715, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/shared/spack/lib/spack/spack/main.py\", line 457, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/shared/spack/lib/spack/spack/cmd/spec.py\", line 101, in spec\r\n    spec.concretize()\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2149, in concretize\r\n    user_spec_deps=user_spec_deps),\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2626, in normalize\r\n    visited, all_spec_deps, provider_index, tests)\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2565, in _normalize_helper\r\n    dep, visited, spec_deps, provider_index, tests)\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2524, in _merge_dependency\r\n    visited, spec_deps, provider_index, tests)\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2565, in _normalize_helper\r\n    dep, visited, spec_deps, provider_index, tests)\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2524, in _merge_dependency\r\n    visited, spec_deps, provider_index, tests)\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2553, in _normalize_helper\r\n    dep = self._evaluate_dependency_conditions(dep_name)\r\n  File \"/shared/spack/lib/spack/spack/spec.py\", line 2372, in _evaluate_dependency_conditions\r\n    substitute_abstract_variants(self)\r\n  File \"/shared/spack/lib/spack/spack/variant.py\", line 603, in substitute_abstract_variants\r\n    pkg_variant = spec.package_class.variants[name]\r\nKeyError: 'double'\r\n```\r\nI used pdb and found out the KeyError in the last mentioned line is related to the fftw spec not containing the double variant.\r\n\r\n```console\r\n$ spack find -lvd /qmpnnzb\r\n==> 1 installed package\r\n-- linux-fedora29-x86_64 / gcc@8.2.0 ----------------------------\r\nqmpnnzb gromacs@2019.5 build_type=RelWithDebInfo ~cuda~double~mpi~plumed+rdtscp+shared simd=SSE2\r\ngkxnhig     fftw@3.3.8+double+float~fma+long_double+mpi~openmp~pfft_patches~quad simd=avx,avx2,sse2\r\n7evvvkr         openmpi@2.1.1~cuda+cxx_exceptions fabrics=auto ~java~legacylaunchers~memchecker~pmi schedulers=auto ~sqlite3~thread_multiple+vt\r\n\r\n$ spack find -lv fftw\r\n==> 3 installed packages\r\n-- linux-fedora29-x86_64 / gcc@8.2.0 ----------------------------\r\nmu7tk3e fftw@3.3.8+double+float~fma+long_double~mpi+openmp~pfft_patches~quad simd=avx,avx2,sse2  e4wa6u5 fftw@3.3.8~mpi~openmp~pfft_patches precision=double,float\r\ngkxnhig fftw@3.3.8+double+float~fma+long_double+mpi~openmp~pfft_patches~quad simd=avx,avx2,sse2\r\n```\r\n\r\n### Information on your system\r\n\r\nI'm on master branch commit f9658e8958d58223e1ac0d2c872c20b235d5593d\r\nFedora release 29\r\n\r\nIs there some way i can resolve this or is this a bug?",
    "performed_via_github_app": null
}