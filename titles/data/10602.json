{
    "url": "https://api.github.com/repos/spack/spack/issues/10602",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/10602/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/10602/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/10602/events",
    "html_url": "https://github.com/spack/spack/issues/10602",
    "id": 410276092,
    "node_id": "MDU6SXNzdWU0MTAyNzYwOTI=",
    "number": 10602,
    "title": "Installation issue: cp2k@6.1",
    "user": {
        "login": "jabl",
        "id": 392634,
        "node_id": "MDQ6VXNlcjM5MjYzNA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/392634?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jabl",
        "html_url": "https://github.com/jabl",
        "followers_url": "https://api.github.com/users/jabl/followers",
        "following_url": "https://api.github.com/users/jabl/following{/other_user}",
        "gists_url": "https://api.github.com/users/jabl/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jabl/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jabl/subscriptions",
        "organizations_url": "https://api.github.com/users/jabl/orgs",
        "repos_url": "https://api.github.com/users/jabl/repos",
        "events_url": "https://api.github.com/users/jabl/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jabl/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 8,
    "created_at": "2019-02-14T12:27:21Z",
    "updated_at": "2019-03-14T16:07:30Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install cp2k@6.1\r\n... \r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j40' 'ARCH=linux-ubuntu18.04-x86_64-gcc' 'VERSION=popt'\r\n...\r\n/usr/bin/gcc -c -O2 -mtune=native -funroll-loops -ffast-math -ftree-vectorize -D__FFTW3 -D__LIBINT -D__LIBINT_MAX_AM=6 -D__LIBDERIV_MAX_AM1=5 -I/usr/include -I/usr/include/python3.6m -I/usr/include/x86_64-linux-gnu -I/usr/include/x86_64-linux-gnu/hwloc/autogen -I/usr/include/x86_64-linux-gnu/gnu -I/usr/include/x86_64-linux-gnu/asm -I/usr/include/x86_64-linux-gnu/sys -I/usr/include/x86_64-linux-gnu/c++/7/ext -I/usr/include/x86_64-linux-gnu/c++/7/bits -I/usr/include/x86_64-linux-gnu/bits -I/usr/include/x86_64-linux-gnu/bits/types -I/usr/include/x86_64-linux-gnu/python3.6m -I/usr/include/layout -I/usr/include/icu-le-hb/layout -I/usr/include/harfbuzz -I/usr/include/libpng16 -I/usr/include/gio-unix-2.0/gio -I/usr/include/lzma -I/usr/include/unicode -I/usr/include/graphite2 -I/usr/include/readline -I/usr/include/glib-2.0 -I/usr/include/glib-2.0/gio -I/usr/include/glib-2.0/gobject -I/usr/include/glib-2.0/glib -I/usr/include/glib-2.0/glib/deprecated -I/usr/include/neteconet -I/usr/include/hwloc -I/usr/include/infiniband -I/usr/include/rdma -I/usr/include/rdma/hfi -I/usr/include/libltdl -I/usr/include/rpc -I/usr/include/arpa -I/usr/include/netinet -I/usr/include/misc -I/usr/include/netatalk -I/usr/include/asm-generic -I/usr/include/netax25 -I/usr/include/drm -I/usr/include/xen -I/usr/include/netrom -I/usr/include/video -I/usr/include/nfs -I/usr/include/netiucv -I/usr/include/sound -I/usr/include/netipx -I/usr/include/scsi -I/usr/include/scsi/fc -I/usr/include/netash -I/usr/include/net -I/usr/include/linux -I/usr/include/linux/netfilter_ipv6 -I/usr/include/linux/tc_act -I/usr/include/linux/nfsd -I/usr/include/linux/caif -I/usr/include/linux/hsi -I/usr/include/linux/netfilter_ipv4 -I/usr/include/linux/genwqe -I/usr/include/linux/netfilter_bridge -I/usr/include/linux/netfilter_arp -I/usr/include/linux/android -I/usr/include/linux/tc_ematch -I/usr/include/linux/dvb -I/usr/include/linux/hdlc -I/usr/include/linux/cifs -I/usr/include/linux/sunrpc -I/usr/include/linux/iio -I/usr/include/linux/wimax -I/usr/include/linux/raid -I/usr/include/linux/can -I/usr/include/linux/netfilter -I/usr/include/linux/netfilter/ipset -I/usr/include/linux/sched -I/usr/include/linux/mmc -I/usr/include/linux/byteorder -I/usr/include/linux/isdn -I/usr/include/linux/spi -I/usr/include/linux/usb -I/usr/include/c++/7 -I/usr/include/c++/7/debug -I/usr/include/c++/7/backward -I/usr/include/c++/7/decimal -I/usr/include/c++/7/ext -I/usr/include/c++/7/parallel -I/usr/include/c++/7/experimental/bits -I/usr/include/c++/7/tr1 -I/usr/include/c++/7/profile -I/usr/include/c++/7/profile/impl -I/usr/include/c++/7/bits -I/usr/include/netpacket -I/usr/include/rpcsvc -I/usr/include/protocols -I/usr/include/netrose -I/usr/include/mtd -D__MPI_VERSION=3 -D__parallel -D__SCALAPACK -D__LIBXC -I/benchmarks/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.3.0/libxc-4.3.2-y5cncqwewxgnmbi4iwbdud54yliqkx65/include -D__LIBXSMM  /benchmarks/spack/var/spack/stage/cp2k-6.1-vc2sbev7ppgzzcfo2cdqytqunlcnl6mi/cp2k-6.1/src/sockets.c\r\n\r\n...\r\n\r\n       41     In file included from /benchmarks/spack/var/spack/stage/cp2k-6.1-vc2sbev7ppgzzcfo2cdqytqunlcnl6mi/cp2k-6.1/src/sockets.c:38:0:\r\n  >> 42     /usr/include/x86_64-linux-gnu/bits/stdio.h:20:3: error: #error \"Never include <bits/stdio.h> directly; use <stdio.h> instead.\"\r\n     43      # error \"Never include <bits/stdio.h> directly; use <stdio.h> instead.\"\r\n\r\n```\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```commandline\r\n$ uname -a \r\nLinux 546a2df817b6 3.10.0-957.1.3.el7.x86_64 #1 SMP Thu Nov 29 14:49:43 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n# grep PRETTY /etc/os-release \r\nPRETTY_NAME=\"Ubuntu 18.04.1 LTS\"\r\n``` \r\n\r\nand, if relevant, post or attach:\r\n\r\n- `packages.yaml`\r\n```\r\n---\r\n# Tell spack to use system packages for openblas, openmpi etc.\r\npackages:\r\n  openmpi:\r\n    paths:\r\n      openmpi@2.1.1%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  openblas:\r\n    paths:\r\n      openblas@0.2.20%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  fftw:\r\n    paths:\r\n      fftw@3.3.7%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  autoconf:\r\n    paths:\r\n      autoconf@2.69%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  automake:\r\n    paths:\r\n      automake@1.15%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libtool:\r\n    paths:\r\n      libtool@2.4.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  python:\r\n    paths:\r\n      python@2.7.15%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libsigsegv:\r\n    paths:\r\n      libsigsegv@2.12%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  diffutils:\r\n    paths:\r\n      diffutils@3.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  bzip2:\r\n    paths:\r\n      bzip2@1.0.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  pkgconf:\r\n    paths:\r\n      pkgconf@0.9.12%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  ncurses:\r\n    paths:\r\n      ncurses@6.1%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  readline:\r\n    paths:\r\n      readline@7.0%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  gdbm:\r\n    paths:\r\n      gdbm@1.14.1%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  perl:\r\n    paths:\r\n      perl@5.26.1%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  zlib:\r\n    paths:\r\n      zlib@1.2.11%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  openssl:\r\n    paths:\r\n      openssl@1.1.0g%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  curl:\r\n    paths:\r\n      curl@7.58.0%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libbsd:\r\n    paths:\r\n      libbsd@0.8.7%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  expat:\r\n    paths:\r\n      expat@2.2.5%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  xz:\r\n    paths:\r\n      xz@5.2.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libxml2:\r\n    paths:\r\n      libxml2@2.9.4%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  lz4:\r\n    paths:\r\n      lz4@0.0~r131%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  lzo:\r\n    paths:\r\n      lzo@2.08%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  m4:\r\n    paths:\r\n      m4@1.4.18%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  gmp:\r\n    paths:\r\n      gmp@6.1.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  nettle:\r\n    paths:\r\n      nettle@3.4%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libarchive:\r\n    paths:\r\n      libarchive@3.2.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libuv:\r\n    paths:\r\n      libuv@1.18.0%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  rhash:\r\n    paths:\r\n      rhash@1.3.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  cmake:\r\n    paths:\r\n      cmake@3.10.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  numactl:\r\n    paths:\r\n      numactl@2.0.11%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  hwloc:\r\n    paths:\r\n      hwloc@1.11.9%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  libpciaccess:\r\n    paths:\r\n      libpciaccess@0.14%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n  netlib-scalapack:\r\n    paths:\r\n      netlib-scalapack@2.0.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64: /usr\r\n    buildable: False\r\n\r\n```\r\n\r\n### Additional information\r\n\r\nSo the reason for this error seems to be that in the compile command there's spurious extra include paths that are causing the problems. That is, since /usr/include/bits is before /usr/include, `#include <stdio.h>` leads to trying to include `bits/stdio.h` rather than `stdio.h`.\r\n\r\nIf I don't use the packages.yaml above it all seems to work. So somehow using the packages.yaml spack adds these extra include paths?\r\n\r\nOutput of:\r\n```console\r\n# spack spec --install-status cp2k@6.1\r\nInput spec\r\n--------------------------------\r\n -   cp2k@6.1\r\n\r\nConcretized\r\n--------------------------------\r\n -   cp2k@6.1%gcc@7.3.0 blas=openblas ~elpa+libxc+mpi~openmp~pexsi~plumed smm=libxsmm arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^fftw@3.3.7%gcc@7.3.0+double+float~fma+long_double+mpi~openmp~pfft_patches~quad simd=avx,avx2,sse2 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^libint@1.1.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^autoconf@2.69%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^automake@1.15%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]          ^libtool@2.4.6%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^libxc@4.3.2%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^libxsmm@1.10%gcc@7.3.0~debug~header-only arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^netlib-scalapack@2.0.2%gcc@7.3.0 build_type=RelWithDebInfo patches=e8f30dd1f26e523dfb552f8d7b8ad26ac88fc0c8d72e3d4f9a9717a3383e0b33 ~pic+shared arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^openblas@0.2.20%gcc@7.3.0 cpu_target=auto ~ilp64 patches=47cfa7a952ac7b2e4632c73ae199d69fb54490627b66a62c681e21019c4ddc9d +pic+shared threads=none ~virtual_machine arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^openmpi@2.1.1%gcc@7.3.0~cuda+cxx_exceptions fabrics=auto ~java~legacylaunchers~memchecker~pmi schedulers=auto ~sqlite3~thread_multiple+vt arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^pkgconf@0.9.12%gcc@7.3.0 arch=linux-ubuntu18.04-x86_64 \r\n[+]      ^python@2.7.15%gcc@7.3.0+dbm~optimizations patches=123082ab3483ded78e86d7c809e98a804b3465b4683c96bd79a2fd799f572244 +pic+pythoncmd+shared~tk~ucs4 arch=linux-ubuntu18.04-x86_64 \r\n...\r\n```\r\n",
    "performed_via_github_app": null
}