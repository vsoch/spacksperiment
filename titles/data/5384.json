{
    "url": "https://api.github.com/repos/spack/spack/issues/5384",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/5384/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/5384/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/5384/events",
    "html_url": "https://github.com/spack/spack/pull/5384",
    "id": 258287134,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTQxNDc3MDEy",
    "number": 5384,
    "title": "'spack install' can overwrite an existing installation",
    "user": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2017-09-17T08:01:13Z",
    "updated_at": "2017-10-24T19:33:03Z",
    "closed_at": "2017-10-24T19:32:31Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/5384",
        "html_url": "https://github.com/spack/spack/pull/5384",
        "diff_url": "https://github.com/spack/spack/pull/5384.diff",
        "patch_url": "https://github.com/spack/spack/pull/5384.patch"
    },
    "body": "`spack install` can now reinstall a spec even if it has dependents, via the `--overwrite` option. This option moves the current installation in a temporary directory. If the reinstallation is successful the temporary is removed, otherwise a rollback is performed.\r\n\r\nThis PR permits to reinstall a 'faulty' production installation even if dependents are already in place.  A common use case is `python`. Its package doesn't fail if some builtin modules cannot be built, and if the build of an entire environment is automated you may discover the missing modules after a fair amount of python packages have already been installed.\r\n\r\n##### Example\r\n\r\nAn example of use:\r\n```console\r\n$ spack install zlib\r\n==> zlib is already installed in /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n\r\n$ spack install --overwrite zlib\r\n==> The following package will be reinstalled:\r\n\r\n-- linux-ubuntu14.04-x86_64 / gcc@4.8 ---------------------------\r\nurcxcax zlib@1.2.11%gcc+pic+shared\r\n\r\n==> Do you want to proceed? [y/N] y\r\n==> Installing zlib\r\n==> Using cached archive: /home/mculpo/PycharmProjects/spack/var/spack/cache/zlib/zlib-1.2.11.tar.gz\r\n==> Staging archive: /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/zlib-1.2.11.tar.gz\r\n==> Created stage in /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n==> Building zlib [Package]\r\n==> Executing phase: 'install'\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/modules/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/dotkit/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax.dk\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> Successfully installed zlib\r\n  Fetch: 0.01s.  Build: 2.23s.  Total: 2.24s.\r\n[+] /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n```\r\nA debug run gives more information on what is going on:\r\n```console\r\n$ spack -d install --overwrite -y zlib\r\n==> Reading config file /home/mculpo/PycharmProjects/spack/etc/spack/defaults/packages.yaml\r\n==> Reading config file /home/mculpo/PycharmProjects/spack/etc/spack/packages.yaml\r\n==> READ LOCK: /home/mculpo/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquiring]\r\n==> READ LOCK: /home/mculpo/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquired]\r\n==> READ LOCK: /home/mculpo/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Released]\r\n==> Reading config file /home/mculpo/PycharmProjects/spack/etc/spack/compilers.yaml\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> TEMPORARY DIRECTORY CREATED [/tmp/tmplXrF5G]\r\n==> DIRECTORY MOVED [src=/home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn, dest=/tmp/tmplXrF5G]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquired]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Released]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquiring]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquired]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Released]\r\n==> Installing zlib dependencies\r\n==> Installing zlib\r\n==> Reading config file /home/mculpo/.spack/mirrors.yaml\r\n==> Reading config file /home/mculpo/.spack/linux/mirrors.yaml\r\n==> Using cached archive: /home/mculpo/PycharmProjects/spack/var/spack/cache/zlib/zlib-1.2.11.tar.gz\r\n==> Staging archive: /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/zlib-1.2.11.tar.gz\r\n==> '/bin/tar' '-xf' '/home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/zlib-1.2.11.tar.gz'\r\n==> Created stage in /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n==> Building zlib [Package]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/var/spack/stage/.lock[5277869744181012648:1] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/var/spack/stage/.lock[5277869744181012648:1] [Acquired]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquired]\r\n==> Executing phase: 'install'\r\n==> Installing /tmp/pytest-of-mculpo/pytest-113/test_keep_exceptions0/tmp/spack-stage/spack-stage-cU93jY/zlib-1.2.11/spack-build.out to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/build.out\r\n==> Installing /tmp/pytest-of-mculpo/pytest-113/test_keep_exceptions0/tmp/spack-stage/spack-stage-cU93jY/zlib-1.2.11/spack-build.env to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/build.env\r\n==> Installing /home/mculpo/PycharmProjects/spack/var/spack/repos/builtin/packages/zlib/w_patch.patch to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/repos/builtin/packages/zlib\r\n==> Installing /home/mculpo/PycharmProjects/spack/var/spack/repos/builtin/packages/zlib/package.py to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/repos/builtin/packages/zlib\r\n==> \tWRITE : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64 /urcxcax [/home/mculpo/PycharmProjects/spack/share/spack/modules/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax]\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/modules/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> \tWRITE : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64 /urcxcax [/home/mculpo/PycharmProjects/spack/share/spack/dotkit/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax.dk]\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/dotkit/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax.dk\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Released]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/var/spack/stage/.lock[5277869744181012648:1] [Released]\r\n==> Successfully installed zlib\r\n  Fetch: 0.00s.  Build: 1.70s.  Total: 1.71s.\r\n[+] /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> link /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn -> /tmp/pytest-of-mculpo/pytest-113/test_keep_exceptions0/tmp/spack-stage/spack-stage-M4FBpL\r\n==> TEMPORARY DIRECTORY DELETED [/tmp/tmplXrF5G]\r\n```",
    "performed_via_github_app": null
}