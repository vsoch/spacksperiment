{
    "url": "https://api.github.com/repos/spack/spack/issues/8612",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/8612/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/8612/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/8612/events",
    "html_url": "https://github.com/spack/spack/pull/8612",
    "id": 337010391,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTk4MzI2MzEx",
    "number": 8612,
    "title": "Spack can be extended with external commands",
    "user": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 471995122,
            "node_id": "MDU6TGFiZWw0NzE5OTUxMjI=",
            "url": "https://api.github.com/repos/spack/spack/labels/commands",
            "name": "commands",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 73908756,
            "node_id": "MDU6TGFiZWw3MzkwODc1Ng==",
            "url": "https://api.github.com/repos/spack/spack/labels/feature",
            "name": "feature",
            "color": "84b6eb",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 10,
    "created_at": "2018-06-29T14:00:35Z",
    "updated_at": "2019-03-29T08:13:29Z",
    "closed_at": "2019-03-28T23:56:37Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/8612",
        "html_url": "https://github.com/spack/spack/pull/8612",
        "diff_url": "https://github.com/spack/spack/pull/8612.diff",
        "patch_url": "https://github.com/spack/spack/pull/8612.patch"
    },
    "body": "fixes #7967 \r\n\r\nThis PR gives Spack the ability to hook external commands. This is done adding a new keyword (`extensions`) to `config.yaml`, which contains a list of paths pointing to valid extensions.\r\n\r\n### Changelist\r\n\r\n- [x] Added support to hook external commands\r\n- [ ] Added support to `spack create`, so that it can create a stub structure for extensions\r\n- [ ] Added documentation on external commands\r\n\r\n### What is a valid extension?\r\nA valid extension is any path in your filesystem which respect a certain naming and layout for files:\r\n```console\r\n$ tree spack-scripting/\r\nspack-scripting/ # The top level directory must match the format 'spack-{extension_name}'\r\n\u251c\u2500\u2500 pytest.ini # Optional file if the extension ships its own tests\r\n\u251c\u2500\u2500 scripting # Folder that may contain modules that are needed for the extension commands\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 cmd # Folder containing extension commands\r\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 filter.py # A new command that will be available \r\n\u2514\u2500\u2500 tests # Tests for this extension\r\n    \u251c\u2500\u2500 conftest.py \r\n    \u2514\u2500\u2500 test_filter.py\r\n\u2514\u2500\u2500 templates # Templates that may be needed by the extension\r\n```\r\nBoth naming and layout are tentative at the moment, so comments to improve them are welcome.\r\n\r\n### Example\r\nTo try out a sample extension:\r\n1. Clone spack somewhere. \r\n2. Clone [this repository](https://github.com/alalazo/spack-scripting):\r\n```console\r\n$ pwd\r\n/home/user\r\n\r\n$ mkdir tmp && cd tmp\r\n$ git clone https://github.com/alalazo/spack-scripting.git\r\nCloning into 'spack-scripting'...\r\nremote: Counting objects: 11, done.\r\nremote: Compressing objects: 100% (7/7), done.\r\nremote: Total 11 (delta 0), reused 11 (delta 0), pack-reused 0\r\nReceiving objects: 100% (11/11), done.\r\n```\r\n3. Add the following line to `config.yaml`:\r\n```yaml\r\nconfig:\r\n  extensions:\r\n    -  /home/user/tmp/spack-scripting\r\n```\r\n4. To check that everything is hooked properly, try looking for the filter command:\r\n```console\r\n$ spack filter --help\r\nusage: spack filter [-h] [--installed | --not-installed]\r\n                    [--explicit | --implicit] [--output OUTPUT]\r\n                    ...\r\n\r\nfilter specs based on their properties\r\n\r\npositional arguments:\r\n  specs            specs to be filtered\r\n\r\noptional arguments:\r\n  -h, --help       show this help message and exit\r\n  --installed      select installed specs\r\n  --not-installed  select specs that are not yet installed\r\n  --explicit       select specs that were installed explicitly\r\n  --implicit       select specs that are not installed or were installed implicitly\r\n  --output OUTPUT  where to dump the result\r\n```\r\n5. You can also run the unit tests that are shipped with an extension:\r\n```console\r\n$ spack test --extension=scripting\r\n============================================================== test session starts ===============================================================\r\nplatform linux -- Python 3.6.5, pytest-3.2.5, py-1.4.34, pluggy-0.4.0\r\nrootdir: /home/mculpo/tmp/spack-scripting, inifile: pytest.ini\r\ncollected 5 items                                                                                                                                 \r\n\r\ntests/test_filter.py ...xx\r\n============================================================ short test summary info =============================================================\r\nXFAIL tests/test_filter.py::test_filtering_specs[flags3-specs3-expected3]\r\nXFAIL tests/test_filter.py::test_filtering_specs[flags4-specs4-expected4]\r\n\r\n=========================================================== slowest 20 test durations ============================================================\r\n4.82s setup    tests/test_filter.py::test_filtering_specs[flags0-specs0-expected0]\r\n0.20s teardown tests/test_filter.py::test_filtering_specs[flags4-specs4-expected4]\r\n0.17s call     tests/test_filter.py::test_filtering_specs[flags4-specs4-expected4]\r\n0.14s call     tests/test_filter.py::test_filtering_specs[flags2-specs2-expected2]\r\n0.13s call     tests/test_filter.py::test_filtering_specs[flags3-specs3-expected3]\r\n0.13s call     tests/test_filter.py::test_filtering_specs[flags1-specs1-expected1]\r\n0.11s call     tests/test_filter.py::test_filtering_specs[flags0-specs0-expected0]\r\n0.00s setup    tests/test_filter.py::test_filtering_specs[flags3-specs3-expected3]\r\n0.00s setup    tests/test_filter.py::test_filtering_specs[flags2-specs2-expected2]\r\n0.00s setup    tests/test_filter.py::test_filtering_specs[flags4-specs4-expected4]\r\n0.00s setup    tests/test_filter.py::test_filtering_specs[flags1-specs1-expected1]\r\n0.00s teardown tests/test_filter.py::test_filtering_specs[flags2-specs2-expected2]\r\n0.00s teardown tests/test_filter.py::test_filtering_specs[flags0-specs0-expected0]\r\n0.00s teardown tests/test_filter.py::test_filtering_specs[flags3-specs3-expected3]\r\n0.00s teardown tests/test_filter.py::test_filtering_specs[flags1-specs1-expected1]\r\n====================================================== 3 passed, 2 xfailed in 5.78 seconds =======================================================\r\n```",
    "performed_via_github_app": null
}