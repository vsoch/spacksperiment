{
    "url": "https://api.github.com/repos/spack/spack/issues/24306",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/24306/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/24306/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/24306/events",
    "html_url": "https://github.com/spack/spack/issues/24306",
    "id": 920675158,
    "node_id": "MDU6SXNzdWU5MjA2NzUxNTg=",
    "number": 24306,
    "title": "Lmod isn't exporting DYLD_FALLBACK_LIBRARY_PATH on Big Sur",
    "user": {
        "login": "sethrj",
        "id": 741229,
        "node_id": "MDQ6VXNlcjc0MTIyOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sethrj",
        "html_url": "https://github.com/sethrj",
        "followers_url": "https://api.github.com/users/sethrj/followers",
        "following_url": "https://api.github.com/users/sethrj/following{/other_user}",
        "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions",
        "organizations_url": "https://api.github.com/users/sethrj/orgs",
        "repos_url": "https://api.github.com/users/sethrj/repos",
        "events_url": "https://api.github.com/users/sethrj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sethrj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        },
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "sethrj",
        "id": 741229,
        "node_id": "MDQ6VXNlcjc0MTIyOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sethrj",
        "html_url": "https://github.com/sethrj",
        "followers_url": "https://api.github.com/users/sethrj/followers",
        "following_url": "https://api.github.com/users/sethrj/following{/other_user}",
        "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions",
        "organizations_url": "https://api.github.com/users/sethrj/orgs",
        "repos_url": "https://api.github.com/users/sethrj/repos",
        "events_url": "https://api.github.com/users/sethrj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sethrj/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "sethrj",
            "id": 741229,
            "node_id": "MDQ6VXNlcjc0MTIyOQ==",
            "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sethrj",
            "html_url": "https://github.com/sethrj",
            "followers_url": "https://api.github.com/users/sethrj/followers",
            "following_url": "https://api.github.com/users/sethrj/following{/other_user}",
            "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions",
            "organizations_url": "https://api.github.com/users/sethrj/orgs",
            "repos_url": "https://api.github.com/users/sethrj/repos",
            "events_url": "https://api.github.com/users/sethrj/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sethrj/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 4,
    "created_at": "2021-06-14T18:36:36Z",
    "updated_at": "2021-06-14T20:18:01Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Spack-generated lmod files are defining DYLD_FALLBACK_LIBRARY_PATH as a shell variable but (silently) not exporting it. This is apparently a new  security feature on Big Sur. I'm not 100%  sure I understand the behavior yet: whether the issue only shows up with forking, with the `env` command, or with bash. See [this stackexchange question](https://apple.stackexchange.com/questions/212945/unable-to-set-dyld-fallback-library-path-in-shell-on-osx-10-11-1) and [this Apple documentation on System Integrity Protection](https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/RuntimeProtections/RuntimeProtections.html).\r\n\r\nWe might want/have to  remove `DYLD_FALLBACK_LIBRARY_PATH` or add some special exception? because it's *very* confusing behavior for a user to do `export VAR=VALUE` and see `echo $VAR` work but then have `env | grep VAR` hide it. I only asked the user to do this out of desperation (eliminating the impossible, etc.).\r\n\r\n@adamjstewart I know you're a mac user so maybe you've seen this? I only noticed it because I was using `DYLD_FALLBACK_LIBRARY_PATH` to internally set up the `CMAKE_INSTALL_RPATH` on an in-house code.\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ echo $BASH_VERSION\r\n5.1.8(1)-release\r\n$ type module\r\nmodule is a function\r\nmodule ()\r\n{\r\n    eval $($LMOD_CMD bash \"$@\") && eval $(${LMOD_SETTARG_CMD:-:} -s sh)\r\n}\r\n$ $LMOD_CMD bash load zlib > loadme.sh; chmod a+x loadme.sh\r\n$ grep DYLD loadme.sh\r\nDYLD_FALLBACK_LIBRARY_PATH=/rnsdhpc/code/spack/opt/spack/apple-clang/zlib/w2ka2t3/lib;\r\nexport DYLD_FALLBACK_LIBRARY_PATH;\r\n$ source loadme.sh\r\n$ echo $DYLD_FALLBACK_LIBRARY_PATH\r\n/rnsdhpc/code/spack/opt/spack/apple-clang/zlib/w2ka2t3/lib\r\n$ env | grep DYLD\r\n__LMOD_REF_COUNT_DYLD_FALLBACK_LIBRARY_PATH=/rnsdhpc/code/spack/opt/spack/apple-clang/zlib/w2ka2t3/lib:1\r\n$ echo $PKG_CONFIG_PATH\r\n/rnsdhpc/code/spack/opt/spack/apple-clang/zlib/w2ka2t3/lib/pkgconfig\r\n$ env | grep PKG_CONFIG_PATH\r\nPKG_CONFIG_PATH=/rnsdhpc/code/spack/opt/spack/apple-clang/zlib/w2ka2t3/lib/pkgconfig\r\n__LMOD_REF_COUNT_PKG_CONFIG_PATH=/rnsdhpc/code/spack/opt/spack/apple-clang/zlib/w2ka2t3/lib/pkgconfig:1\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.2-3119-2b53d84a56\r\n* **Python:** 3.8.5\r\n* **Platform:** darwin-bigsur-skylake\r\n* **Concretizer:** original",
    "performed_via_github_app": null
}