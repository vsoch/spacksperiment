{
    "url": "https://api.github.com/repos/spack/spack/issues/14729",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/14729/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/14729/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/14729/events",
    "html_url": "https://github.com/spack/spack/issues/14729",
    "id": 559181477,
    "node_id": "MDU6SXNzdWU1NTkxODE0Nzc=",
    "number": 14729,
    "title": "Py-numpy Intel/GCC check logic fails when using cflags rather than modules",
    "user": {
        "login": "sethrj",
        "id": 741229,
        "node_id": "MDQ6VXNlcjc0MTIyOQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sethrj",
        "html_url": "https://github.com/sethrj",
        "followers_url": "https://api.github.com/users/sethrj/followers",
        "following_url": "https://api.github.com/users/sethrj/following{/other_user}",
        "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions",
        "organizations_url": "https://api.github.com/users/sethrj/orgs",
        "repos_url": "https://api.github.com/users/sethrj/repos",
        "events_url": "https://api.github.com/users/sethrj/events{/privacy}",
        "received_events_url": "https://api.github.com/users/sethrj/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 477156668,
            "node_id": "MDU6TGFiZWw0NzcxNTY2Njg=",
            "url": "https://api.github.com/repos/spack/spack/labels/intel",
            "name": "intel",
            "color": "127cc1",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tgamblin",
            "id": 299842,
            "node_id": "MDQ6VXNlcjI5OTg0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tgamblin",
            "html_url": "https://github.com/tgamblin",
            "followers_url": "https://api.github.com/users/tgamblin/followers",
            "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
            "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
            "organizations_url": "https://api.github.com/users/tgamblin/orgs",
            "repos_url": "https://api.github.com/users/tgamblin/repos",
            "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tgamblin/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 8,
    "created_at": "2020-02-03T16:08:46Z",
    "updated_at": "2020-02-06T19:55:10Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\nBuild numpy with an intel compiler, except use cflags/cxxflags to explicitly specify the compiler toolchain rather than relying on user environment/modules.\r\n\r\n```console\r\n$ spack install py-numpy %intel@18.0.2\r\n...\r\n==> Error: InstallError: The GCC version that the Intel compiler uses must be >= 4.8. The GCC in use is 4.4.7\r\n\r\n/projects/spack/var/spack/repos/builtin/packages/py-numpy/package.py:121, in flag_handler:\r\n        118            if gcc_version < Version('4.8'):\r\n        119                raise InstallError('The GCC version that the Intel compiler '\r\n        120                                   'uses must be >= 4.8. The GCC in use is '\r\n  >>    121                                   '{0}'.format(gcc_version))\r\n        122            if gcc_version <= Version('5.1'):\r\n        123                flags.append(self.compiler.c99_flag)\r\n        124        return (flags, None, None)\r\n```\r\n\r\nThis results from checking introduced in https://github.com/spack/spack/pull/14360 . Removing that check allows the build to succeed.\r\n\r\n### Platform and user environment\r\n\r\nPlease report your OS here:\r\n```commandline\r\n$ uname -a \r\nLinux node13.ornl.gov 2.6.32-431.el6.x86_64 #1 SMP Sun Nov 10 22:19:54 EST 2013 x86_64 x86_64 x86_64 GNU/Linux\r\n$ lsb_release -d\r\nDescription:    Red Hat Enterprise Linux Workstation release 6.5 (Santiago)\r\n``` \r\n\r\nIntel compiler definition:\r\n```yaml\r\n- compiler:\r\n    spec: intel@18.0.2\r\n    paths:\r\n      cc: /opt/intel-2018/bin/icc\r\n      cxx: /opt/intel-2018/bin/icpc\r\n      f77: /opt/intel-2018/bin/ifort\r\n      fc: /opt/intel-2018/bin/ifort\r\n    flags:\r\n      cflags: -gcc-name=/projects/spack/opt/spack/gcc-4.4.7/gcc/rml7vcp/bin/gcc\r\n      cxxflags: -gxx-name=/projects/spack/opt/spack/gcc-4.4.7/gcc/rml7vcp/bin/g++\r\n    operating_system: rhel6\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths:\r\n     - /projects/spack/opt/spack/gcc-4.4.7/gcc/rml7vcp/lib64\r\n```\r\nwhere `gcc/rml7vcp` is `gcc@6.5.0~binutils languages=c,c++,fortran ~nvptx~piclibs~strip`.\r\n\r\n### Notes\r\n\r\nThis issue is tied up in the bigger problems of how to use spack-installed compilers as spack compilers, and how to treat Intel's dependency on the GCC environment. I think explicitly specifying the flags and rpaths rather than modules is the safest and most robust way to build out an intel toolchain. This is especially true because it's impossible to `module load` multiple compilers simultaneously.",
    "performed_via_github_app": null
}