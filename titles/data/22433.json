{
    "url": "https://api.github.com/repos/spack/spack/issues/22433",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22433/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22433/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22433/events",
    "html_url": "https://github.com/spack/spack/pull/22433",
    "id": 836989539,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTk3NDIxNDQy",
    "number": 22433,
    "title": "concretizer: improve display of optimization criteria",
    "user": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 471995122,
            "node_id": "MDU6TGFiZWw0NzE5OTUxMjI=",
            "url": "https://api.github.com/repos/spack/spack/labels/commands",
            "name": "commands",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 521903170,
            "node_id": "MDU6TGFiZWw1MjE5MDMxNzA=",
            "url": "https://api.github.com/repos/spack/spack/labels/user-experience",
            "name": "user-experience",
            "color": "bfdadc",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2021-03-21T05:25:14Z",
    "updated_at": "2021-04-02T08:54:51Z",
    "closed_at": "2021-04-02T08:54:50Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/22433",
        "html_url": "https://github.com/spack/spack/pull/22433",
        "diff_url": "https://github.com/spack/spack/pull/22433.diff",
        "patch_url": "https://github.com/spack/spack/pull/22433.patch"
    },
    "body": "By default, clingo doesn't show any optimization criteria (maximized or minimized sums) if the set they aggregate is empty. Per the clingo mailing list, we can get around that by adding, e.g.:\r\n\r\n```\r\n#minimize{ 0@2 : #true }.\r\n```\r\n\r\nfor the 2nd criterion. This forces clingo to print out the criterion but does not affect the optimization.\r\n\r\nThis PR adds directives as above for all of our optimization criteria, as well as facts with descriptions of each criterion,like this:\r\n\r\n```\r\nopt_criterion(2, \"number of non-default variants\")\r\n```\r\n\r\nWe use facts in `concretize.lp` rather than hard-coding these in `asp.py` so that the names can be maintained in the same place as the other optimization criteria.\r\n\r\nThe now-displayed weights and the names are used to display optimization output like this:\r\n\r\n```console\r\n(spackle):solver> spack solve --show opt zlib\r\n==> Best of 0 answers.\r\n==> Optimization Criteria:\r\n  Priority  Criterion                                            Value\r\n  1         version weight                                           0\r\n  2         number of non-default variants (roots)                   0\r\n  3         multi-valued variants + preferred providers for roots    0\r\n  4         number of non-default variants (non-roots)               0\r\n  5         number of non-default providers (non-roots)              0\r\n  6         count of non-root multi-valued variants                  0\r\n  7         compiler matches + number of nodes                       1\r\n  8         version badness                                          0\r\n  9         non-preferred compilers                                  0\r\n  10        target matches                                           0\r\n  11        non-preferred targets                                    0\r\n\r\nzlib@1.2.11%apple-clang@12.0.0+optimize+pic+shared arch=darwin-catalina-skylake\r\n```\r\n\r\nNote that this is all hidden behind a `--show opt` option to `spack solve`. Optimization weights are no longer shown by default, but you can at least inspect them and more easily understand what is going on.\r\n\r\n- [x] always show optimization criteria in `clingo` output\r\n- [x] add `opt_criterion()` facts for all optimizationc criteria\r\n- [x] make display of opt criteria optional in `spack solve`\r\n- [x] rework how optimization criteria are displayed, and add a `--show opt`ddoptiong to `spack solve`",
    "performed_via_github_app": null
}