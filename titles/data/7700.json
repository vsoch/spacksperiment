{
    "url": "https://api.github.com/repos/spack/spack/issues/7700",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7700/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7700/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7700/events",
    "html_url": "https://github.com/spack/spack/issues/7700",
    "id": 312528270,
    "node_id": "MDU6SXNzdWUzMTI1MjgyNzA=",
    "number": 7700,
    "title": "py-py2cairo with python3 build error",
    "user": {
        "login": "gozwei",
        "id": 16445765,
        "node_id": "MDQ6VXNlcjE2NDQ1NzY1",
        "avatar_url": "https://avatars.githubusercontent.com/u/16445765?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gozwei",
        "html_url": "https://github.com/gozwei",
        "followers_url": "https://api.github.com/users/gozwei/followers",
        "following_url": "https://api.github.com/users/gozwei/following{/other_user}",
        "gists_url": "https://api.github.com/users/gozwei/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gozwei/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gozwei/subscriptions",
        "organizations_url": "https://api.github.com/users/gozwei/orgs",
        "repos_url": "https://api.github.com/users/gozwei/repos",
        "events_url": "https://api.github.com/users/gozwei/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gozwei/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 574328447,
            "node_id": "MDU6TGFiZWw1NzQzMjg0NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/python3",
            "name": "python3",
            "color": "006b75",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-04-09T13:21:19Z",
    "updated_at": "2019-10-22T03:05:34Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "I'm trying to install `pygtk` for `python3`\r\n\r\n`spack install --use-cache py-pygtk%gcc@7.3.0 ^python@3.6.5 ^glib@2.55.1`\r\n\r\nI need to specify `^glib@2.55.1` because newer glib fails to compile on our HPC (https://github.com/spack/spack/issues/7607)\r\n\r\nMultiple dependencies are installed successfully, until: \r\n\r\n```==> Installing py-py2cairo\r\n==> Searching for binary cache of py-py2cairo\r\n==> Warning: No Spack mirrors are currently configured\r\n==> No binary for py-py2cairo found: installing from source\r\n==> Using cached archive: /cfs/fs2/home/users/mpolkowski/spack/var/spack/cache/py-py2cairo/py-py2cairo-1.10.0.tar.bz2\r\n==> Staging archive: /cfs/fs2/home/users/mpolkowski/spack/var/spack/stage/py-py2cairo-1.10.0-orta3kep6zvdrj6kf3emg27wnyoxsmlp/py2cairo-1.10.0.tar.bz2\r\n==> Created stage in /cfs/fs2/home/users/mpolkowski/spack/var/spack/stage/py-py2cairo-1.10.0-orta3kep6zvdrj6kf3emg27wnyoxsmlp\r\n==> No patches needed for py-py2cairo\r\n==> Building py-py2cairo [WafPackage]\r\n==> Executing phase: 'configure'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    '/cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/python-3.6.5-an4tzucegt4pvrhczfszojh7xp2u3bt2/bin/python3.6' 'waf' '-j20' 'configure' '--prefix=/cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/py-py2cairo-1.10.0-orta3kep6zvdrj6kf3emg27wnyoxsmlp'\r\nSee build log for details:\r\n  /cfs/fs2/home/users/mpolkowski/spack/var/spack/stage/py-py2cairo-1.10.0-orta3kep6zvdrj6kf3emg27wnyoxsmlp/py2cairo-1.10.0/spack-build.out\r\n```\r\n`spack-build.out` contents: \r\n\r\n```==> Executing phase: 'configure'\r\n==> '/cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/python-3.6.5-an4tzucegt4pvrhczfszojh7xp2u3bt2/bin/python3.6' 'waf' '-j20' 'configure' '--prefix=/cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/py-py2cairo-1.10.0-orta3kep6zvdrj6kf3emg27wnyoxsmlp'\r\nSetting top to                           : /ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0 \r\nSetting out to                           : /ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/build_directory \r\nChecking for 'gcc' (c compiler)          : ok \r\nChecking for program python              : /cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/python-3.6.5-an4tzucegt4pvrhczfszojh7xp2u3bt2/bin/python \r\npython executable '/cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/python-3.6.5-an4tzucegt4pvrhczfszojh7xp2u3bt2/bin/python' different from sys.executable '/cfs/fs2/home/users/mpolkowski/spack/opt/spack/linux-scientific6-x86_64/gcc-7.3.0/python-3.6.5-an4tzucegt4pvrhczfszojh7xp2u3bt2/bin/python3.6'\r\nChecking for python version              : (3, 6, 5, 'final', 0) \r\nChecking for library python3.6           :   ./options()\r\n  ./configure()\r\nTraceback (most recent call last):\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Scripting.py\", line 93, in waf_entry_point\r\n    run_commands()\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Scripting.py\", line 145, in run_commands\r\n    run_command(cmd_name)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Scripting.py\", line 138, in run_command\r\n    ctx.execute()\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Configure.py\", line 124, in execute\r\n    super(ConfigurationContext,self).execute()\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Context.py\", line 87, in execute\r\n    self.recurse([os.path.dirname(g_module.root_path)])\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Context.py\", line 127, in recurse\r\n    user_function(self)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/wscript\", line 29, in configure\r\n    ctx.check_python_headers()\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Configure.py\", line 214, in fun\r\n    return f(*k,**kw)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Tools/python.py\", line 133, in check_python_headers\r\n    result=conf.check(lib=name,uselib='PYEMBED',libpath=path,mandatory=False)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Configure.py\", line 214, in fun\r\n    return f(*k,**kw)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Tools/c_config.py\", line 357, in check\r\n    ret=self.run_c_code(*k,**kw)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Configure.py\", line 214, in fun\r\n    return f(*k,**kw)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Tools/c_config.py\", line 435, in run_c_code\r\n    bld.compile()\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Build.py\", line 191, in compile\r\n    self.store()\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Utils.py\", line 300, in f\r\n    ret=fun(*k,**kw)\r\n  File \"/ram/tmp/mpolkowski/spack-stage/spack-stage-Gau3VJ/py2cairo-1.10.0/.waf3-1.6.3-3c3129a3ec8fb4a5bbc7ba3161463b22/waflib/Build.py\", line 164, in store\r\n    cPickle.dump(data,f)\r\nAttributeError: Can't pickle local object 'Context.__init__.<locals>.node_class'\r\n```\r\n\r\nIf I do `spack install --use-cache py-pygtk%gcc@7.3.0 ^python@2.7.14 ^glib@2.55.1` it installs with no error. ",
    "performed_via_github_app": null
}