{
    "url": "https://api.github.com/repos/spack/spack/issues/22861",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22861/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22861/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22861/events",
    "html_url": "https://github.com/spack/spack/issues/22861",
    "id": 853350960,
    "node_id": "MDU6SXNzdWU4NTMzNTA5NjA=",
    "number": 22861,
    "title": "==> Error: [Errno 37] No locks available",
    "user": {
        "login": "ikitayama",
        "id": 962791,
        "node_id": "MDQ6VXNlcjk2Mjc5MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/962791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ikitayama",
        "html_url": "https://github.com/ikitayama",
        "followers_url": "https://api.github.com/users/ikitayama/followers",
        "following_url": "https://api.github.com/users/ikitayama/following{/other_user}",
        "gists_url": "https://api.github.com/users/ikitayama/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ikitayama/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ikitayama/subscriptions",
        "organizations_url": "https://api.github.com/users/ikitayama/orgs",
        "repos_url": "https://api.github.com/users/ikitayama/repos",
        "events_url": "https://api.github.com/users/ikitayama/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ikitayama/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 3,
    "created_at": "2021-04-08T11:04:44Z",
    "updated_at": "2021-04-09T04:20:32Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install gcc or whatever spec\r\n```\r\n\r\n### Error Message\r\n\r\n<!-- If Spack reported an error, provide the error message. If it did not report an error but the output appears incorrect, provide the incorrect output. If there was no error message and no output but the result is incorrect, describe how it does not match what you expect. -->\r\n```console\r\n$ spack --debug --stacktrace install gcc\r\n\r\n$ spack --debug --stacktrace install gcc\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-04-08-13:03:03.032227] Imported install from built-in commands\r\nlib/spack/spack/config.py:981 ==> [2021-04-08-13:03:03.038651] Reading config file /users/kitayama/projects/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-04-08-13:03:03.089444] Imported install from built-in commands\r\nlib/spack/spack/config.py:981 ==> [2021-04-08-13:03:03.093661] Reading config file /users/kitayama/projects/spack/etc/spack/defaults/repos.yaml\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.484900] libtool applying constraint m4@1.4.6:\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.487252] libtool applying constraint m4@1.4.6:\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.492920] autoconf applying constraint m4@1.4.6:\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.519350] ncurses applying constraint pkgconfig\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.521281] readline applying constraint ncurses\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.523040] gdbm applying constraint readline\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.524781] perl applying constraint berkeley-db\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.526476] perl applying constraint gdbm\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.531062] help2man applying constraint perl\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.542263] gettext applying constraint iconv\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.544319] help2man applying constraint perl\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.546177] help2man applying constraint gettext\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.548100] autoconf applying constraint m4@1.4.6:\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.549946] autoconf applying constraint perl\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.551825] autoconf applying constraint help2man\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.557187] automake applying constraint perl\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.559126] automake applying constraint autoconf\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.561027] gmp applying constraint m4\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.562934] gmp applying constraint libtool\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.564808] gmp applying constraint autoconf\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.566691] gmp applying constraint automake\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.574286] diffutils applying constraint iconv\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.577084] gcc applying constraint gmp@4.3.2:\r\nlib/spack/spack/spec.py:2811 ==> [2021-04-08-13:03:05.581716] gcc applying constraint diffutils\r\nlib/spack/spack/config.py:981 ==> [2021-04-08-13:03:05.641360] Reading config file /users/kitayama/projects/spack/etc/spack/defaults/packages.yaml\r\nTraceback (most recent call last):\r\n  File \"/users/kitayama/projects/spack/bin/spack\", line 76, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/main.py\", line 772, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/main.py\", line 496, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/cmd/install.py\", line 319, in install\r\n    args.spec, concretize=True, tests=tests)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/cmd/__init__.py\", line 164, in parse_specs\r\n    spec.concretize(tests=tests)  # implies normalize\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/spec.py\", line 2573, in concretize\r\n    self._old_concretize(tests)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/spec.py\", line 2372, in _old_concretize\r\n    self._expand_virtual_packages(concretizer),\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/spec.py\", line 2275, in _expand_virtual_packages\r\n    candidates = concretizer.choose_virtual_or_external(spec)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/concretize.py\", line 144, in choose_virtual_or_external\r\n    candidates = self._valid_virtuals_and_externals(spec)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/concretize.py\", line 99, in _valid_virtuals_and_externals\r\n    candidates = spack.repo.path.providers_for(spec)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 90, in converter\r\n    return function(self, spec_like, *args, **kwargs)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 591, in providers_for\r\n    providers = self.provider_index.providers_for(vpkg_spec)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 575, in provider_index\r\n    self._provider_index.merge(repo.provider_index)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 985, in provider_index\r\n    return self.index['providers']\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 407, in __getitem__\r\n    self._build_all_indexes()\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 422, in _build_all_indexes\r\n    self.indexes[name] = self._build_index(name, indexer)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/repo.py\", line 447, in _build_index\r\n    with misc_cache.write_transaction(cache_filename) as (old, new):\r\n  File \"/users/kitayama/projects/spack/lib/spack/llnl/util/lock.py\", line 566, in __enter__\r\n    if self._enter() and self._acquire_fn:\r\n  File \"/users/kitayama/projects/spack/lib/spack/llnl/util/lock.py\", line 602, in _enter\r\n    return self._lock.acquire_write(self._timeout)\r\n  File \"/users/kitayama/projects/spack/lib/spack/llnl/util/lock.py\", line 330, in acquire_write\r\n    wait_time, nattempts = self._lock(fcntl.LOCK_EX, timeout=timeout)\r\n  File \"/users/kitayama/projects/spack/lib/spack/spack/util/lock.py\", line 31, in _lock\r\n    return super(Lock, self)._lock(op, timeout)\r\n  File \"/users/kitayama/projects/spack/lib/spack/llnl/util/lock.py\", line 186, in _lock\r\n    if self._poll_lock(op):\r\n  File \"/users/kitayama/projects/spack/lib/spack/llnl/util/lock.py\", line 210, in _poll_lock\r\n    self._length, self._start, os.SEEK_SET)\r\nOSError: [Errno 37] No locks available\r\n```\r\n\r\n### Information on your system\r\n\r\n<!-- Please include the output of `spack debug report` -->\r\n\r\n<!-- If you have any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.) you can add that here as well. -->\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ ] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "performed_via_github_app": null
}