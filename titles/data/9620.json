{
    "url": "https://api.github.com/repos/spack/spack/issues/9620",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9620/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9620/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9620/events",
    "html_url": "https://github.com/spack/spack/issues/9620",
    "id": 373256408,
    "node_id": "MDU6SXNzdWUzNzMyNTY0MDg=",
    "number": 9620,
    "title": "Some modules in packages.yaml break installation",
    "user": {
        "login": "bebosudo",
        "id": 1922124,
        "node_id": "MDQ6VXNlcjE5MjIxMjQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1922124?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bebosudo",
        "html_url": "https://github.com/bebosudo",
        "followers_url": "https://api.github.com/users/bebosudo/followers",
        "following_url": "https://api.github.com/users/bebosudo/following{/other_user}",
        "gists_url": "https://api.github.com/users/bebosudo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bebosudo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bebosudo/subscriptions",
        "organizations_url": "https://api.github.com/users/bebosudo/orgs",
        "repos_url": "https://api.github.com/users/bebosudo/repos",
        "events_url": "https://api.github.com/users/bebosudo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bebosudo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446632829,
            "node_id": "MDU6TGFiZWw0NDY2MzI4Mjk=",
            "url": "https://api.github.com/repos/spack/spack/labels/modules",
            "name": "modules",
            "color": "fef2c0",
            "default": false,
            "description": null
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "alalazo",
            "id": 4199709,
            "node_id": "MDQ6VXNlcjQxOTk3MDk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/alalazo",
            "html_url": "https://github.com/alalazo",
            "followers_url": "https://api.github.com/users/alalazo/followers",
            "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
            "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
            "organizations_url": "https://api.github.com/users/alalazo/orgs",
            "repos_url": "https://api.github.com/users/alalazo/repos",
            "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
            "received_events_url": "https://api.github.com/users/alalazo/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 1,
    "created_at": "2018-10-24T00:29:02Z",
    "updated_at": "2020-08-23T18:03:41Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I'm running spack to install hdf5, using an openmpi installed as an external module.\r\n\r\n### Steps to reproduce the issue\r\n\r\nI installed openmpi 2.1.2 compiled with PGI 18.4 (the openmpi is provided inside the PGI 18.4 compiler installer): I created an [environment module](http://modules.sourceforge.net/) to provide it to users.\r\n\r\nI edited `/opt/spack/etc/spack/packages.yaml`:\r\n```yaml\r\npackages:\r\n  openmpi:\r\n    modules:\r\n      openmpi@2.1.2%pgi@18.4 arch=linux-centos7-x86_64: openmpi/2.1.2/pgi/18.4\r\n```\r\n\r\n\r\n### Error Message\r\n\r\n```console\r\n# spack -sd install -v hdf5 %pgi@18.4\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/modules.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/linux/modules.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/config.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/config.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/repos.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/packages.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/packages.yaml\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /root/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /root/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /root/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Released]\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/compilers.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /root/.spack/linux/compilers.yaml\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/usr/bin/ibv_devices'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'unload' 'gnu'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'openmpi/2.1.2/pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:169 ==> Module name: openmpi/2.1.2/pgi/18.4\r\n-git/lib/spack/spack/util/module_cmd.py:176 ==> Package directory variable prefix: PGI\r\n-git/lib/spack/spack/database.py:192 ==> DATABASE LOCK TIMEOUT: 120s\r\n-git/lib/spack/spack/database.py:196 ==> PACKAGE LOCK TIMEOUT: No timeout\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[7237514367513727526:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[7237514367513727526:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/lock[0:0] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/lock[0:0] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/lock[0:0] [Released]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[7237514367513727526:1] [Released]\r\n-git/lib/spack/spack/stage.py:475 ==> link /opt/spack-git/var/spack/stage/hdf5-1.10.3-zdq2d4ki4iseyysdqfrmww3itl6keeg7 -> /tmp/root/spack-stage/spack-stage-97skazlk\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[7237514367513727526:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[7237514367513727526:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[7237514367513727526:1] [Released]\r\n-git/lib/spack/spack/package.py:1388 ==> Installing hdf5 dependencies\r\n-git/lib/spack/spack/package.py:1263 ==> openmpi@2.1.2 : has external module in openmpi/2.1.2/pgi/18.4\r\n-git/lib/spack/spack/package.py:1265 ==> openmpi@2.1.2 : is actually installed in /opt/cluster/software/openmpi/2.1.2/pgi/18.4\r\n-git/lib/spack/spack/package.py:1274 ==> openmpi@2.1.2 : already registered in DB\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Released]\r\n-git/lib/spack/spack/stage.py:475 ==> link /opt/spack-git/var/spack/stage/zlib-1.2.11-7qttkksltwk35o3vclpsmatzs253uwur -> /tmp/root/spack-stage/spack-stage-mjdbv639\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquired]\r\n-git/lib/spack/spack/package.py:1375 ==> zlib is already installed in /opt/cluster/spack/linux-centos7-x86_64/pgi-18.4/zlib-1.2.11-7qttkksltwk35o3vclpsmatzs253uwur\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Released]\r\n-git/lib/spack/spack/package.py:1404 ==> Installing hdf5\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'unload' 'gnu'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'openmpi/2.1.2/pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'unload' 'openmpi'\r\n-git/lib/spack/spack/error.py:55 ==> Error: SyntaxError: invalid syntax (<string>, line 37)\r\n\r\n/opt/spack-git/lib/spack/spack/build_environment.py:742, in child_process:\r\n        739            tb_string = traceback.format_exc()\r\n        740\r\n        741            # build up some context from the offending package so we can\r\n  >>    742            # show that, too.\r\n        743            package_context = get_package_context(tb)\r\n        744\r\n        745            build_log = None\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/spack-git/lib/spack/spack/build_environment.py\", line 724, in child_process\r\n    setup_package(pkg, dirty=dirty)\r\n  File \"/opt/spack-git/lib/spack/spack/build_environment.py\", line 677, in setup_package\r\n    load_external_modules(pkg)\r\n  File \"/opt/spack-git/lib/spack/spack/build_environment.py\", line 618, in load_external_modules\r\n    load_module(dep.external_module)\r\n  File \"/opt/spack-git/lib/spack/spack/util/module_cmd.py\", line 122, in load_module\r\n    unload_module(text[i + 1])\r\n  File \"/opt/spack-git/lib/spack/spack/util/module_cmd.py\", line 104, in unload_module\r\n    'exec'))\r\n  File \"<string>\", line 37\r\n    Unloading openmpi/2.1.2/pgi/18.4\r\n                    ^\r\nSyntaxError: invalid syntax\r\n```\r\n\r\nThe content of the openmpi/2.1.2/pgi/18.4 module is:\r\n```tcl\r\n#%Module\r\n\r\nset name        openmpi\r\nset version     2.1.2\r\nset compiler    pgi/18.4\r\n\r\nproc ModulesHelp { } {\r\n    puts stderr \"\\tThis module provides OpenMPI $version,\";\r\n    puts stderr \"\\tcompiled with PGI 18.4 and CUDA support.\\n\";\r\n}\r\n\r\nconflict            $name\r\nset dependencies    [list $compiler]\r\nif [ module-info mode load ] {\r\n    foreach dep $dependencies {\r\n        if { ! [is-loaded $dep] } {\r\n            puts stderr \"Loading requirement $dep\"\r\n            module load $dep\r\n        }\r\n    }\r\n}\r\nforeach dep $dependencies { prereq $dep }\r\n\r\nset             topdir                  /opt/cluster/software/$name/$version/$compiler\r\n\r\nprepend-path    PATH                    \"$topdir/bin/\"\r\nprepend-path    LD_LIBRARY_PATH         \"$topdir/lib/\"\r\nprepend-path    MANPATH                 \"$topdir/share/man\"\r\nprepend-path    CPATH                   \"$topdir/include\"\r\nprepend-path    INCLUDE                 \"$topdir/include\"\r\n\r\nprepend-path    PGI_OPTL_LIB_DIRS       \"$topdir/lib\"\r\nprepend-path    PGI_OPTL_INCLUDE_DIRS   \"$topdir/include\"\r\n```\r\n\r\nThen I tried changing the module to `gnu/7.2.0`, just to see whether it would continue with the configure, and it did.\r\n```console\r\n# spack -sd install -v hdf5 %pgi@18.4\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/modules.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/linux/modules.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/config.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/config.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/repos.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/defaults/packages.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/packages.yaml\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /root/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /root/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /root/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Released]\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /opt/spack-git/etc/spack/compilers.yaml\r\n-git/lib/spack/spack/config.py:611 ==> Reading config file /root/.spack/linux/compilers.yaml\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/usr/bin/ibv_devices'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'unload' 'gnu'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'gnu/7.2.0'\r\n-git/lib/spack/spack/util/module_cmd.py:169 ==> Module name: gnu/7.2.0\r\n-git/lib/spack/spack/util/module_cmd.py:176 ==> Package directory variable prefix: GNU\r\n-git/lib/spack/spack/database.py:192 ==> DATABASE LOCK TIMEOUT: 120s\r\n-git/lib/spack/spack/database.py:196 ==> PACKAGE LOCK TIMEOUT: No timeout\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/lock[0:0] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/lock[0:0] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/lock[0:0] [Released]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Released]\r\n-git/lib/spack/spack/stage.py:475 ==> link /opt/spack-git/var/spack/stage/hdf5-1.10.3-kbyevuo7cwo2hablsyl3qudnxpw6wahq -> /tmp/root/spack-stage/spack-stage-2bcyw1sk\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Released]\r\n-git/lib/spack/spack/package.py:1388 ==> Installing hdf5 dependencies\r\n-git/lib/spack/spack/package.py:1263 ==> openmpi@2.1.2 : has external module in gnu/7.2.0\r\n-git/lib/spack/spack/package.py:1265 ==> openmpi@2.1.2 : is actually installed in /opt/cluster/software/gnu/7.2.0\r\n-git/lib/spack/spack/package.py:1274 ==> openmpi@2.1.2 : already registered in DB\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Released]\r\n-git/lib/spack/spack/stage.py:475 ==> link /opt/spack-git/var/spack/stage/zlib-1.2.11-7qttkksltwk35o3vclpsmatzs253uwur -> /tmp/root/spack-stage/spack-stage-n5qsmd07\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Acquired]\r\n-git/lib/spack/spack/package.py:1375 ==> zlib is already installed in /opt/cluster/spack/linux-centos7-x86_64/pgi-18.4/zlib-1.2.11-7qttkksltwk35o3vclpsmatzs253uwur\r\n-git/lib/spack/llnl/util/lock.py:334 ==> READ LOCK: /opt/cluster/spack/.spack-db/prefix_lock[9084774838711536351:1] [Released]\r\n-git/lib/spack/spack/package.py:1404 ==> Installing hdf5\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'unload' 'gnu'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'pgi/18.4'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'show' 'gnu/7.2.0'\r\n-git/lib/spack/spack/util/module_cmd.py:22 ==> Warning: Could not detect module function from bash. Trying to detect modulecmd from `which`\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'list'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'unload' 'gnu'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/cluster/Modules/bin/modulecmd' 'python' 'load' 'gnu/7.2.0'\r\n-git/lib/spack/spack/fetch_strategy.py:441 ==> Using cached archive: /opt/spack-git/var/spack/cache/hdf5/hdf5-1.10.3.tar.gz\r\n-git/lib/spack/spack/fetch_strategy.py:318 ==> Staging archive: /opt/spack-git/var/spack/stage/hdf5-1.10.3-kbyevuo7cwo2hablsyl3qudnxpw6wahq/hdf5-1.10.3.tar.gz\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/usr/bin/tar' '-xf' '/opt/spack-git/var/spack/stage/hdf5-1.10.3-kbyevuo7cwo2hablsyl3qudnxpw6wahq/hdf5-1.10.3.tar.gz'\r\n-git/lib/spack/spack/stage.py:445 ==> Created stage in /opt/spack-git/var/spack/stage/hdf5-1.10.3-kbyevuo7cwo2hablsyl3qudnxpw6wahq\r\n-git/lib/spack/spack/package.py:986 ==> No patches needed for hdf5\r\n-git/lib/spack/spack/package.py:1442 ==> Building hdf5 [AutotoolsPackage]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/spack-git/var/spack/stage/.lock[7485480712498726098:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/spack-git/var/spack/stage/.lock[7485480712498726098:1] [Acquired]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Acquiring]\r\n-git/lib/spack/llnl/util/lock.py:334 ==> WRITE LOCK: /opt/cluster/spack/.spack-db/prefix_lock[2898107492838592209:1] [Acquired]\r\n-git/lib/spack/spack/package.py:1478 ==> Executing phase: 'autoreconf'\r\n-git/lib/spack/spack/package.py:1478 ==> Executing phase: 'configure'\r\n-git/lib/spack/spack/util/executable.py:159 ==> '/opt/spack-git/var/spack/stage/hdf5-1.10.3-kbyevuo7cwo2hablsyl3qudnxpw6wahq/hdf5-1.10.3/configure' '--prefix=/opt/cluster/spack/linux-centos7-x86_64/pgi-18.4/hdf5-1.10.3-kbyevuo7cwo2hablsyl3qudnxpw6wahq' '--enable-unsupported' '--disable-threadsafe' '--disable-cxx' '--disable-hl' '--disable-fortran' '--without-szlib' '--enable-build-mode=production' '--enable-shared' 'CFLAGS=-fpic' 'CXXFLAGS=-fpic' 'FCFLAGS=-fpic' '--enable-parallel' 'CC=/opt/cluster/software/gnu/7.2.0/bin/mpicc' '--with-zlib=/opt/cluster/spack/linux-centos7-x86_64/pgi-18.4/zlib-1.2.11-7qttkksltwk35o3vclpsmatzs253uwur'\r\nchecking for a BSD-compatible install... /usr/bin/install -c\r\nchecking whether build environment is sane... yes\r\nchecking for a thread-safe mkdir -p... /usr/bin/mkdir -p\r\nchecking for gawk... gawk\r\nchecking whether make sets $(MAKE)... yes\r\nchecking whether make supports nested variables... yes\r\n...\r\n... Killed.\r\n```\r\n\r\nThen I guess there must be something strange in the openmpi module that spack doesn't like. Any ideas?\r\n\r\n### Information on your system\r\n\r\n 1. Centos 7.5\r\n 2. spack latest develop version from github\r\n\r\n",
    "performed_via_github_app": null
}