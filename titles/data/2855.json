{
    "url": "https://api.github.com/repos/spack/spack/issues/2855",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/2855/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/2855/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/2855/events",
    "html_url": "https://github.com/spack/spack/pull/2855",
    "id": 201448545,
    "node_id": "MDExOlB1bGxSZXF1ZXN0MTAxOTc4MTMx",
    "number": 2855,
    "title": "oce & trilinos: force rpath on Sierra to avoid issues with load commands size",
    "user": {
        "login": "davydden",
        "id": 8023934,
        "node_id": "MDQ6VXNlcjgwMjM5MzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8023934?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davydden",
        "html_url": "https://github.com/davydden",
        "followers_url": "https://api.github.com/users/davydden/followers",
        "following_url": "https://api.github.com/users/davydden/following{/other_user}",
        "gists_url": "https://api.github.com/users/davydden/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/davydden/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/davydden/subscriptions",
        "organizations_url": "https://api.github.com/users/davydden/orgs",
        "repos_url": "https://api.github.com/users/davydden/repos",
        "events_url": "https://api.github.com/users/davydden/events{/privacy}",
        "received_events_url": "https://api.github.com/users/davydden/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 508566016,
            "node_id": "MDU6TGFiZWw1MDg1NjYwMTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/cmake",
            "name": "cmake",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 446614839,
            "node_id": "MDU6TGFiZWw0NDY2MTQ4Mzk=",
            "url": "https://api.github.com/repos/spack/spack/labels/macOS",
            "name": "macOS",
            "color": "c5def5",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2017-01-18T00:47:10Z",
    "updated_at": "2017-05-28T20:55:36Z",
    "closed_at": "2017-01-23T21:59:17Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "pull_request": {
        "url": "https://api.github.com/repos/spack/spack/pulls/2855",
        "html_url": "https://github.com/spack/spack/pull/2855",
        "diff_url": "https://github.com/spack/spack/pull/2855.diff",
        "patch_url": "https://github.com/spack/spack/pull/2855.patch"
    },
    "body": "This is a continuation of https://github.com/LLNL/spack/issues/1874.\r\nIn a nutshell: macOS Sierra lowered the maximum total size of load commands for shared libraries. In Spack land, the size of those commands are mostly due to the full paths which are recorded in the install names of dependent shared libraries. An example of the load command is\r\n```\r\nLoad command 150\r\n          cmd LC_LOAD_DYLIB\r\n      cmdsize 168\r\n         name /Users/davydden/spack/opt/spack/darwin-sierra-x86_64/clang-8.0.0-apple/p4est-1.1-kup7uhxn4wk4nlsxxrmy52kx7xsmopfq/lib/libp4est-1.1.dylib (offset 24)\r\n   time stamp 2 Thu Jan  1 01:00:02 1970\r\n      current version 0.0.0\r\ncompatibility version 0.0.0\r\n```\r\n\r\nWith this change, the two packages  (`trilinos` and `oce`) are now using `@rpath`. Consequently those load commands for any package (like `dealii`) which links in other libraries from `trilinos` and `oce` become\r\n```\r\nLoad command 149\r\n          cmd LC_LOAD_DYLIB\r\n      cmdsize 56\r\n         name @rpath/lib/libTKXSBase.11.dylib (offset 24)\r\n   time stamp 2 Thu Jan  1 01:00:02 1970\r\n      current version 11.0.0\r\ncompatibility version 11.0.0\r\n```\r\nwhich is roughly 1/3 of the size.  Of course, there is a load command for each `rpath`, i.e. \r\n```\r\n          cmd LC_RPATH\r\n      cmdsize 136\r\n         path /Users/davydden/spack/opt/spack/darwin-sierra-x86_64/clang-8.0.0-apple/oce-0.18-cjpsyzsypwwzajwjbbrhnvp5suahrdf5/lib (offset 12)\r\n```\r\nbut savings come from the fact that both `trilinos` and `oce` have huge number of libs (`277` and `108`, respectively, reported from `ls -F | wc -l`).\r\n\r\nEnd results is that one does not hit the limit of load commands anymore when running executables:\r\n```\r\ndyld: Library not loaded: /Users/davydden/spack/opt/spack/darwin-sierra-x86_64/clang-8.0.0-apple/dealii-develop-cdqavnwshvx6lrmvqjogz64ukkghj2ui/lib/libdeal_II.g.8.5.0-pre.dylib\r\n  Referenced from: /Users/davydden/Desktop/work/C++/my_executable\r\n  Reason: no suitable image found.  Did find:\r\n\t/Users/davydden/spack/opt/spack/darwin-sierra-x86_64/clang-8.0.0-apple/dealii-develop-cdqavnwshvx6lrmvqjogz64ukkghj2ui/lib/libdeal_II.g.8.5.0-pre.dylib: malformed mach-o: load commands size (35112) > 32768\r\n```",
    "performed_via_github_app": null
}