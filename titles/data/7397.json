{
    "url": "https://api.github.com/repos/spack/spack/issues/7397",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/7397/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/7397/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/7397/events",
    "html_url": "https://github.com/spack/spack/issues/7397",
    "id": 302497302,
    "node_id": "MDU6SXNzdWUzMDI0OTczMDI=",
    "number": 7397,
    "title": "anyone seeing problems with libpciaccess when building on Cray XC systems?",
    "user": {
        "login": "hppritcha",
        "id": 7818666,
        "node_id": "MDQ6VXNlcjc4MTg2NjY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7818666?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hppritcha",
        "html_url": "https://github.com/hppritcha",
        "followers_url": "https://api.github.com/users/hppritcha/followers",
        "following_url": "https://api.github.com/users/hppritcha/following{/other_user}",
        "gists_url": "https://api.github.com/users/hppritcha/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hppritcha/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hppritcha/subscriptions",
        "organizations_url": "https://api.github.com/users/hppritcha/orgs",
        "repos_url": "https://api.github.com/users/hppritcha/repos",
        "events_url": "https://api.github.com/users/hppritcha/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hppritcha/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446614485,
            "node_id": "MDU6TGFiZWw0NDY2MTQ0ODU=",
            "url": "https://api.github.com/repos/spack/spack/labels/cray",
            "name": "cray",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 7,
    "created_at": "2018-03-05T22:56:23Z",
    "updated_at": "2018-03-21T03:31:17Z",
    "closed_at": "2018-03-21T03:26:43Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "\r\n-----\r\n\r\n### Summary\r\n\r\nI'm trying to install various packages on a Cray XC running CLE 6.0UP05, including HDF5, PMIx, OpenMPI, etc.  What I'm seeing is that installs fail if there is a dependency on the libpciaccess package. One cannot see this at NERSC - at least not on edison and cori since these systems are still running CLE 6UP04.  \r\n\r\n### Actual Results\r\n\r\nI've noticed dependencies on which SHA I'm on in develop, but at 35115127 I get this error\r\nwhen trying to do a spack install libpciaccess\r\n```\r\n/scratch1/users/hpp/spack@ga-fe1:/scratch1/users/hpp/spack> (develop)spack install libpciaccess\r\n==> libsigsegv is already installed in /scratch1/users/hpp/spack/opt/spack/cray-CNL-haswell/gcc-7.1.0/libsigsegv-2.11-tatqezxww74hs74fsldkwvpy6kf5isjp\r\n==> m4 is already installed in /scratch1/users/hpp/spack/opt/spack/cray-CNL-haswell/gcc-7.1.0/m4-1.4.18-uuicyh5c6ms2gfbfklywbkrqujjvepbe\r\n==> libtool is already installed in /scratch1/users/hpp/spack/opt/spack/cray-CNL-haswell/gcc-7.1.0/libtool-2.4.6-sy3pq3d4f466lgiggepp3meln2tsomrx\r\n==> pkgconf is already installed in /scratch1/users/hpp/spack/opt/spack/cray-CNL-haswell/gcc-7.1.0/pkgconf-1.4.0-ph4es5l4lx5zv367oxkd6jm7dndysuzs\r\n==> util-macros is already installed in /scratch1/users/hpp/spack/opt/spack/cray-CNL-haswell/gcc-7.1.0/util-macros-1.19.1-exb3t3uusocfq3ou63vbscihaf2sq5i5\r\n==> Installing libpciaccess\r\n==> Error: SyntaxError: invalid syntax (<string>, line 494)\r\nSyntaxError: SyntaxError: invalid syntax (<string>, line 494)\r\n\r\n/scratch1/users/hpp/spack/lib/spack/spack/build_environment.py:684, in child_process:\r\n     27    \r\n     28                # build up some context from the offending package so we can\r\n     29                # show that, too.\r\n  >> 30                package_context = get_package_context(tb)\r\n     31    \r\n     32                build_log = None\r\n     33                if hasattr(pkg, 'log_path'):\r\n\r\n```\r\nIf I do a bit of patching on build_envrionment.py to bypass what appears to be a bug in spack itself when handling an exception \r\n```\r\n==> Installing libpciaccess\r\nUnloading module PrgEnv\r\nUnloaded module PrgEnv\r\nUnloading module PrgEnv-x1\r\nUnloaded module PrgEnv-x1\r\nUnloading module PrgEnv-x2\r\nUnloaded module PrgEnv-x2\r\nUnloading module PrgEnv-cray\r\nUnloaded module PrgEnv-cray\r\nUnloading module PrgEnv-intel\r\nUnloaded module PrgEnv-intel\r\nUnloading module PrgEnv-pgi\r\nUnloaded module PrgEnv-pgi\r\nUnloading module PrgEnv-pathscale\r\nUnloaded module PrgEnv-pathscale\r\nUnloading module PrgEnv-gnu\r\ntb_string = Traceback (most recent call last):\r\n  File \"/scratch1/users/hpp/spack/lib/spack/spack/build_environment.py\", line 665, in child_process\r\n    setup_package(pkg, dirty=dirty)\r\n  File \"/scratch1/users/hpp/spack/lib/spack/spack/build_environment.py\", line 617, in setup_package\r\n    load_module(mod)\r\n  File \"/scratch1/users/hpp/spack/lib/spack/spack/util/module_cmd.py\", line 135, in load_module\r\n    error=str), '<string>', 'exec'))\r\n  File \"<string>\", line 494\r\n    rca/2.2.16-6.0.5.0_15.34__g5e09e6d.ari(21):ERROR:102: Tcl command execution failed: if { [ file exists /opt/cray/rca/2.2.16-6.0.5.0_15.34__g5e09e6d.ari/lib64/pkgconfig/cray-rca.pc ] } {\r\n```\r\n### Steps to reproduce the issue\r\n\r\nFirst find a Cray XC or similar variant (not XE since I'm pretty sure CLE 6 isn't supported on these near end-of-life systems).  Make sure its running CLE 6.0UP05 by \r\n\r\n```\r\ncat /etc/opt/cray/release/cle-release\r\n```\r\nand verifying that it reports CLE 6.0UP05.  Then,\r\n\r\n```console\r\n$ git clone git@github.com:spack/spack.git\r\n$ cd spack\r\n$ export PATH=$PWD/bin:$PATH\r\n$ spack install libpciaccess\r\n...\r\n```\r\n\r\n### Information on your system\r\n\r\n 1.  Cray XC running CLE 6.0UP05\r\n 2. Here's my module list before I do spack install\r\n```\r\nCurrently Loaded Modulefiles:\r\n  1) modules/3.2.10.6                               13) pmi/5.0.13\r\n  2) eproxy/2.0.22-6.0.5.0_2.1__g1ebe45c.ari        14) dmapp/7.1.1-6.0.5.0_49.8__g1125556.ari\r\n  3) gcc/7.2.0                                      15) gni-headers/5.0.12-6.0.5.0_2.15__g2ef1ebc.ari\r\n  4) craype-haswell                                 16) xpmem/2.2.4-6.0.5.1_8.6__g35d5e73.ari\r\n  5) craype-hugepages2M                             17) job/2.2.2-6.0.5.0_8.47__g3c644b5.ari\r\n  6) craype-network-aries                           18) dvs/2.7_2.2.52-6.0.5.2_17.6__g5170dea\r\n  7) craype/2.5.13                                  19) alps/6.5.28-6.0.5.0_18.6__g13a91b6.ari\r\n  8) cray-mpich/7.7.0                               20) rca/2.2.16-6.0.5.0_15.34__g5e09e6d.ari\r\n  9) slurm/17.02.9-SSE.6                            21) atp/2.1.1\r\n 10) cray-libsci/17.12.1                            22) perftools-base/7.0.0\r\n 11) udreg/2.3.2-6.0.5.0_13.12__ga14955a.ari        23) PrgEnv-gnu/6.0.4\r\n 12) ugni/6.0.14-6.0.5.0_16.9__g19583bb.ari\r\n```\r\n\r\n-----\r\n\r\n",
    "performed_via_github_app": null
}