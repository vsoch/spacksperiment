{
    "url": "https://api.github.com/repos/spack/spack/issues/11070",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/11070/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/11070/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/11070/events",
    "html_url": "https://github.com/spack/spack/issues/11070",
    "id": 427319249,
    "node_id": "MDU6SXNzdWU0MjczMTkyNDk=",
    "number": 11070,
    "title": "filter_compiler_wrappers()  does not wok on Cray systems as advertised",
    "user": {
        "login": "balay",
        "id": 5642668,
        "node_id": "MDQ6VXNlcjU2NDI2Njg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5642668?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/balay",
        "html_url": "https://github.com/balay",
        "followers_url": "https://api.github.com/users/balay/followers",
        "following_url": "https://api.github.com/users/balay/following{/other_user}",
        "gists_url": "https://api.github.com/users/balay/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/balay/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/balay/subscriptions",
        "organizations_url": "https://api.github.com/users/balay/orgs",
        "repos_url": "https://api.github.com/users/balay/repos",
        "events_url": "https://api.github.com/users/balay/events{/privacy}",
        "received_events_url": "https://api.github.com/users/balay/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 451092161,
            "node_id": "MDU6TGFiZWw0NTEwOTIxNjE=",
            "url": "https://api.github.com/repos/spack/spack/labels/xSDK",
            "name": "xSDK",
            "color": "b60205",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 33,
    "created_at": "2019-03-30T19:26:17Z",
    "updated_at": "2019-04-17T20:12:26Z",
    "closed_at": "2019-04-17T20:12:26Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "My understanding is filter_compiler_wrappers()  can be used to change spack compilers back to system compilers - aka mpicc wrappers [or similar use - user makefiles]. And this should work from both spack env [for dependent packages] - and outsite spack [for user compilers]\r\n\r\nThis is related to #10365\r\n\r\nHere petsc creates a user-makefile that a dependant package pflotran uses. Also petsc users who are not in spack env also use this user-makefile for compiling user applications. [aka mpicc wrapper - which internally uses system compiler]\r\n\r\nThis works for me on linux - but not Cray systems [Theta/Cori]\r\n\r\nOn cray systems - when spack attempts to install dependent package using this system compiler - the build errors out\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\nbalay@cori05:~/spack> git describe\r\nv0.8.17-10445-ge3f00750e\r\nbalay@cori05:~/spack> spack install --dirty -j8 pflotran ^hdf5+hl\r\n\r\n```\r\n\r\n### Error Message\r\n\r\n```console\r\n     9     ftn -c -fPIC     -I/global/u2/b/balay/spack/opt/spack/cray-cnl9-haswell/intel-18.0.3.222/petsc-3.11.0-rgzfigpowxqofxo5wtu5rgt6omjoxnwz/include -I/global/u2/\r\n           b/balay/spack/opt/spack/cray-cnl9-haswell/intel-18.0.3.222/hypre-2.15.1-b7sedjuhnjsi4vjw3nqhjirxeysfekvh/include -I/global/u2/b/balay/spack/opt/spack/cray-c\r\n           nl9-haswell/intel-18.0.3.222/superlu-dist-6.1.0-jcfujt5n7tfseukklffr5jkci3j3hkfb/include -I/global/u2/b/balay/spack/opt/spack/cray-cnl9-haswell/intel-18.0.3\r\n           .222/hdf5-1.10.5-hk3pedgeh6zokqckjxnspqwa6ijaqodq/include -I/global/u2/b/balay/spack/opt/spack/cray-cnl9-haswell/intel-18.0.3.222/parmetis-4.0.3-kqtzwywdfbc\r\n           plnrv62g7o6dcimvt623q/include -I/global/u2/b/balay/spack/opt/spack/cray-cnl9-haswell/intel-18.0.3.222/metis-5.1.0-2n3dm3mnxr2pq4ipm77l2vgesdue4rtm/include -\r\n           I/usr/include   -I.  -o derivatives_utilities.o derivatives_utilities.F90\r\n<snip>\r\n     12    Error:\r\n     13      cray-libsci/18.07.1 is not available for the INTEL compiler.\r\n     14    /global/u2/b/balay/spack/opt/spack/cray-cnl9-haswell/intel-18.0.3.222/petsc-3.11.0-rgzfigpowxqofxo5wtu5rgt6omjoxnwz/lib/petsc/conf/petscrules:31: recipe for\r\n            target 'derivatives_utilities.o' failed\r\n\r\n```\r\n\r\n### Information on your system\r\n\r\nAttaching config files and build logs from NERSC/Cori\r\n\r\n[console.txt](https://github.com/spack/spack/files/3025861/console.txt)\r\n[petsc-build.env.txt](https://github.com/spack/spack/files/3025862/petsc-build.env.txt)\r\n[petsc-build.out.txt](https://github.com/spack/spack/files/3025863/petsc-build.out.txt)\r\n[petscvariables.txt](https://github.com/spack/spack/files/3025864/petscvariables.txt)\r\n[pflotran-spack-build.env.txt](https://github.com/spack/spack/files/3025865/pflotran-spack-build.env.txt)\r\n[pflotran-spack-build.out.txt](https://github.com/spack/spack/files/3025866/pflotran-spack-build.out.txt)\r\n\r\n",
    "performed_via_github_app": null
}