{
    "url": "https://api.github.com/repos/spack/spack/issues/9067",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/9067/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/9067/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/9067/events",
    "html_url": "https://github.com/spack/spack/issues/9067",
    "id": 352844312,
    "node_id": "MDU6SXNzdWUzNTI4NDQzMTI=",
    "number": 9067,
    "title": "Failure in the tests for false positives in Makefiles",
    "user": {
        "login": "alalazo",
        "id": 4199709,
        "node_id": "MDQ6VXNlcjQxOTk3MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4199709?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/alalazo",
        "html_url": "https://github.com/alalazo",
        "followers_url": "https://api.github.com/users/alalazo/followers",
        "following_url": "https://api.github.com/users/alalazo/following{/other_user}",
        "gists_url": "https://api.github.com/users/alalazo/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/alalazo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alalazo/subscriptions",
        "organizations_url": "https://api.github.com/users/alalazo/orgs",
        "repos_url": "https://api.github.com/users/alalazo/repos",
        "events_url": "https://api.github.com/users/alalazo/events{/privacy}",
        "received_events_url": "https://api.github.com/users/alalazo/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 624275116,
            "node_id": "MDU6TGFiZWw2MjQyNzUxMTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/makefile",
            "name": "makefile",
            "color": "b60205",
            "default": false,
            "description": null
        },
        {
            "id": 456341797,
            "node_id": "MDU6TGFiZWw0NTYzNDE3OTc=",
            "url": "https://api.github.com/repos/spack/spack/labels/tests",
            "name": "tests",
            "color": "b60205",
            "default": false,
            "description": "General test capability(ies)"
        },
        {
            "id": 671550628,
            "node_id": "MDU6TGFiZWw2NzE1NTA2Mjg=",
            "url": "https://api.github.com/repos/spack/spack/labels/travis",
            "name": "travis",
            "color": "bfdadc",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "adamjstewart",
        "id": 12021217,
        "node_id": "MDQ6VXNlcjEyMDIxMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjstewart",
        "html_url": "https://github.com/adamjstewart",
        "followers_url": "https://api.github.com/users/adamjstewart/followers",
        "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
        "repos_url": "https://api.github.com/users/adamjstewart/repos",
        "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "adamjstewart",
            "id": 12021217,
            "node_id": "MDQ6VXNlcjEyMDIxMjE3",
            "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/adamjstewart",
            "html_url": "https://github.com/adamjstewart",
            "followers_url": "https://api.github.com/users/adamjstewart/followers",
            "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
            "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
            "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
            "repos_url": "https://api.github.com/users/adamjstewart/repos",
            "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
            "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 2,
    "created_at": "2018-08-22T08:03:33Z",
    "updated_at": "2018-08-22T14:32:25Z",
    "closed_at": "2018-08-22T14:32:25Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "I ran unit tests on `develop` at c0855d9bd54be07162435cec605a1ad5efe1e4d1 and two tests failed on my system.\r\n\r\n\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack test -k  test_negative_make_check\r\n```\r\n\r\n### Error Message\r\n\r\nThe error message I got is the following:\r\n```console\r\n$ spack test -k test_negative_make_check\r\n============================================================== test session starts ===============================================================\r\nplatform linux2 -- Python 2.7.15rc1, pytest-3.2.5, py-1.4.34, pluggy-0.4.0\r\nrootdir: /home/mculpo/PycharmProjects/spack/lib/spack/spack/test, inifile: pytest.ini\r\ncollected 1258 items                                                                                                                              \r\n\r\nbuild_systems.py .FEFE\r\n============================================================ short test summary info =============================================================\r\nFAIL build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match]\r\nFAIL build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable]\r\nERROR build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match]\r\nERROR build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable]\r\n\r\n=========================================================== slowest 20 test durations ============================================================\r\n0.17s call     build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/no_makefile]\r\n0.08s call     build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match]\r\n0.08s call     build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable]\r\n0.04s setup    build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/no_makefile]\r\n0.00s setup    build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable]\r\n0.00s setup    build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match]\r\n0.00s teardown build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match]\r\n0.00s teardown build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable]\r\n0.00s teardown build_systems.py::test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/no_makefile]\r\n===================================================================== ERRORS =====================================================================\r\n____ ERROR at teardown of test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match] _____\r\n\r\n    @pytest.fixture(scope='function', autouse=True)\r\n    def no_chdir():\r\n        \"\"\"Ensure that no test changes Spack's working dirctory.\r\n    \r\n        This prevents Spack tests (and therefore Spack commands) from\r\n        changing the working directory and causing other tests to fail\r\n        mysteriously. Tests should use ``working_dir`` or ``py.path``'s\r\n        ``.as_cwd()`` instead of ``os.chdir`` to avoid failing this check.\r\n    \r\n        We assert that the working directory hasn't changed, unless the\r\n        original wd somehow ceased to exist.\r\n    \r\n        \"\"\"\r\n        original_wd = os.getcwd()\r\n        yield\r\n        if os.path.isdir(original_wd):\r\n>           assert os.getcwd() == original_wd\r\nE           AssertionError: assert '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match' == '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test'\r\nE            +  where '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match' = <built-in function getcwd>()\r\nE            +    where <built-in function getcwd> = os.getcwd\r\n\r\n../../../../conftest.py:104: AssertionError\r\n_______ ERROR at teardown of test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable] _______\r\n\r\n    @pytest.fixture(scope='function', autouse=True)\r\n    def no_chdir():\r\n        \"\"\"Ensure that no test changes Spack's working dirctory.\r\n    \r\n        This prevents Spack tests (and therefore Spack commands) from\r\n        changing the working directory and causing other tests to fail\r\n        mysteriously. Tests should use ``working_dir`` or ``py.path``'s\r\n        ``.as_cwd()`` instead of ``os.chdir`` to avoid failing this check.\r\n    \r\n        We assert that the working directory hasn't changed, unless the\r\n        original wd somehow ceased to exist.\r\n    \r\n        \"\"\"\r\n        original_wd = os.getcwd()\r\n        yield\r\n        if os.path.isdir(original_wd):\r\n>           assert os.getcwd() == original_wd\r\nE           AssertionError: assert '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable' == '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match'\r\nE            +  where '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable' = <built-in function getcwd>()\r\nE            +    where <built-in function getcwd> = os.getcwd\r\n\r\n../../../../conftest.py:104: AssertionError\r\n==================================================================== FAILURES ====================================================================\r\n_______________ test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match] _______________\r\n\r\ndirectory = '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/partial_match'\r\nconfig = <spack.config.Configuration object at 0x7fa08e328b50>, mock_packages = None\r\n\r\n    @pytest.mark.parametrize(\r\n        'directory',\r\n        glob.iglob(os.path.join(DATA_PATH, 'make', 'negative', '*'))\r\n    )\r\n    def test_negative_make_check(directory, config, mock_packages):\r\n        \"\"\"Tests that Spack correctly ignores false positives in a Makefile.\"\"\"\r\n    \r\n        # Get a fake package\r\n        s = Spec('mpich')\r\n        s.concretize()\r\n        pkg = spack.repo.get(s)\r\n        setup_package(pkg, False)\r\n    \r\n        with working_dir(directory):\r\n>           assert not pkg._has_make_target('check')\r\nE           AssertionError: assert not True\r\nE            +  where True = <bound method Mpich._has_make_target of <spack.pkg.builtin.mock.mpich.Mpich object at 0x7fa08e174510>>('check')\r\nE            +    where <bound method Mpich._has_make_target of <spack.pkg.builtin.mock.mpich.Mpich object at 0x7fa08e174510>> = <spack.pkg.builtin.mock.mpich.Mpich object at 0x7fa08e174510>._has_make_target\r\n\r\n../../../../build_systems.py:72: AssertionError\r\n_________________ test_negative_make_check[/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable] __________________\r\n\r\ndirectory = '/home/mculpo/PycharmProjects/spack/lib/spack/spack/test/data/make/negative/variable'\r\nconfig = <spack.config.Configuration object at 0x7fa08e328b50>, mock_packages = None\r\n\r\n    @pytest.mark.parametrize(\r\n        'directory',\r\n        glob.iglob(os.path.join(DATA_PATH, 'make', 'negative', '*'))\r\n    )\r\n    def test_negative_make_check(directory, config, mock_packages):\r\n        \"\"\"Tests that Spack correctly ignores false positives in a Makefile.\"\"\"\r\n    \r\n        # Get a fake package\r\n        s = Spec('mpich')\r\n        s.concretize()\r\n        pkg = spack.repo.get(s)\r\n        setup_package(pkg, False)\r\n    \r\n        with working_dir(directory):\r\n>           assert not pkg._has_make_target('check')\r\nE           AssertionError: assert not True\r\nE            +  where True = <bound method Mpich._has_make_target of <spack.pkg.builtin.mock.mpich.Mpich object at 0x7fa08e2bb190>>('check')\r\nE            +    where <bound method Mpich._has_make_target of <spack.pkg.builtin.mock.mpich.Mpich object at 0x7fa08e2bb190>> = <spack.pkg.builtin.mock.mpich.Mpich object at 0x7fa08e2bb190>._has_make_target\r\n\r\n../../../../build_systems.py:72: AssertionError\r\n============================================================= 1255 tests deselected ==============================================================\r\n========================================== 2 failed, 1 passed, 1255 deselected, 2 error in 1.46 seconds ==========================================\r\n```\r\nWe have the same error on python 3.7 in Travis (see [here](https://travis-ci.org/spack/spack/jobs/418898260)). Looking into it it seems to be due to the string we are looking for, that in some cases uses the character `'` instead of the backtick.\r\n\r\n### Information on your system\r\n\r\n```console\r\n$ lsb_release -a && echo && uname -a && echo && make --version\r\nNo LSB modules are available.\r\nDistributor ID:\tUbuntu\r\nDescription:\tUbuntu 18.04.1 LTS\r\nRelease:\t18.04\r\nCodename:\tbionic\r\n\r\nLinux nuvolari 4.15.0-32-generic #35-Ubuntu SMP Fri Aug 10 17:58:07 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nGNU Make 4.1\r\nBuilt for x86_64-pc-linux-gnu\r\nCopyright (C) 1988-2014 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.\r\n```\r\n\r\n\r\n",
    "performed_via_github_app": null
}