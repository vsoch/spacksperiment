{
    "url": "https://api.github.com/repos/spack/spack/issues/15281",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/15281/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/15281/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/15281/events",
    "html_url": "https://github.com/spack/spack/issues/15281",
    "id": 573624607,
    "node_id": "MDU6SXNzdWU1NzM2MjQ2MDc=",
    "number": 15281,
    "title": "tmux compilation fails, unable to resolve symbol from tinfo library",
    "user": {
        "login": "hartzell",
        "id": 312978,
        "node_id": "MDQ6VXNlcjMxMjk3OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/312978?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hartzell",
        "html_url": "https://github.com/hartzell",
        "followers_url": "https://api.github.com/users/hartzell/followers",
        "following_url": "https://api.github.com/users/hartzell/following{/other_user}",
        "gists_url": "https://api.github.com/users/hartzell/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/hartzell/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hartzell/subscriptions",
        "organizations_url": "https://api.github.com/users/hartzell/orgs",
        "repos_url": "https://api.github.com/users/hartzell/repos",
        "events_url": "https://api.github.com/users/hartzell/events{/privacy}",
        "received_events_url": "https://api.github.com/users/hartzell/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2020-03-01T22:08:19Z",
    "updated_at": "2020-03-03T08:12:06Z",
    "closed_at": "2020-03-03T08:12:06Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I'm getting a dusty CI script up and running again, it hasn't been built for ~5 months.  It includes tmux and byobo; and/but tmux fails to build.\r\n\r\nThe tmux build fails because the linker can't find a definition for `setupterm`.\r\n\r\nThat symbol is included in `libtinfo`, which is installed as part of `ncurses` when the `tinfo` variant is true (which is the default).  In \"most\" (data not shown) ncurses packages the tinfo functionality is packaged into a separate `libtinfo`, but apparently there are some that roll it into a unified `libncurses`.  *Our* `ncurses` packages produces a separate `libtinfo`.\r\n\r\nThe recipe for `tmux` includes:\r\n\r\n```python\r\n     def configure_args(self):\r\n        return ['LIBTINFO_LIBS=-lncurses']\r\n```\r\n\r\nwhich was added ~3 years ago.\r\n\r\nFor our separate-`tinfo`-library setup, this is incorrect.  I'm unsure why it has worked in the past, perhaps people were picking up system libraries or something about tmux's requirements has changed.\r\n\r\nIn any case, changing this to:\r\n\r\n```python\r\n     def configure_args(self):\r\n        return ['LIBTINFO_LIBS=-ltinfo']\r\n```\r\n\r\nallows tmux to compile on my CentOS 7 system.\r\n\r\nPR to follow.\r\n\r\n### Spack version\r\n<!-- Add the output to the command below -->\r\n```console\r\n$ spack --version\r\n0.14.0-88-ac4d0c3\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install tmux # Fill in the exact spec you are using\r\n... # and the relevant part of the error message\r\n[...]\r\n/home/ghartzell/tmp/spack-20200301/lib/spack/env/gcc/gcc -D_GNU_SOURCE -I/home/ghartzell/tmp/spack-20200301/opt/spack/linux-centos7-skylake_avx512/gcc-8.2.0/ncurses-6.1-73oof6l5rzikkjvwckaoocbzyg4bvsup/include   -I/home/ghartzell/tmp/spack-20200301/opt/spack/linux-centos7-skylake_avx512/gcc-8.2.0/libevent-2.1.8-hizpaklyihvnet4de2u52gvhr63gdun4/include    -std=gnu99 -O2      -o tmux alerts.o arguments.o attributes.o cfg.o client.o cmd-attach-session.o cmd-bind-key.o cmd-break-pane.o cmd-capture-pane.o cmd-choose-tree.o cmd-command-prompt.o cmd-confirm-before.o cmd-copy-mode.o cmd-detach-client.o cmd-display-menu.o cmd-display-message.o cmd-display-panes.o cmd-find-window.o cmd-find.o cmd-if-shell.o cmd-join-pane.o cmd-kill-pane.o cmd-kill-server.o cmd-kill-session.o cmd-kill-window.o cmd-list-buffers.o cmd-list-clients.o cmd-list-keys.o cmd-list-panes.o cmd-list-sessions.o cmd-list-windows.o cmd-load-buffer.o cmd-lock-server.o cmd-move-window.o cmd-new-session.o cmd-new-window.o cmd-parse.o cmd-paste-buffer.o cmd-pipe-pane.o cmd-queue.o cmd-refresh-client.o cmd-rename-session.o cmd-rename-window.o cmd-resize-pane.o cmd-resize-window.o cmd-respawn-pane.o cmd-respawn-window.o cmd-rotate-window.o cmd-run-shell.o cmd-save-buffer.o cmd-select-layout.o cmd-select-pane.o cmd-select-window.o cmd-send-keys.o cmd-set-buffer.o cmd-set-environment.o cmd-set-option.o cmd-show-environment.o cmd-show-messages.o cmd-show-options.o cmd-source-file.o cmd-split-window.o cmd-swap-pane.o cmd-swap-window.o cmd-switch-client.o cmd-unbind-key.o cmd-wait-for.o cmd.o colour.o control-notify.o control.o environ.o format.o format-draw.o grid-view.o grid.o input-keys.o input.o job.o key-bindings.o key-string.o layout-custom.o layout-set.o layout.o log.o menu.o mode-tree.o names.o notify.o options-table.o options.o paste.o proc.o regsub.o resize.o screen-redraw.o screen-write.o screen.o server-client.o server-fn.o server.o session.o spawn.o status.o style.o tmux.o tty-acs.o tty-keys.o tty-term.o tty.o utf8.o window-buffer.o window-client.o window-clock.o window-copy.o window-tree.o window.o xmalloc.o xterm-keys.o osdep-linux.o   compat/closefrom.o compat/explicit_bzero.o compat/fgetln.o compat/freezero.o compat/getdtablecount.o compat/getprogname.o compat/recallocarray.o compat/reallocarray.o compat/setproctitle.o compat/strlcat.o compat/strlcpy.o compat/strtonum.o compat/imsg.o compat/imsg-buffer.o compat/vis.o compat/unvis.o compat/getopt.o compat/fdforkpty.o -lutil  -lncurses -L/home/ghartzell/tmp/spack-20200301/opt/spack/linux-centos7-skylake_avx512/gcc-8.2.0/libevent-2.1.8-hizpaklyihvnet4de2u52gvhr63gdun4/lib -levent    -lresolv\r\n/usr/bin/ld: tty-term.o: undefined reference to symbol 'setupterm'\r\n/home/ghartzell/tmp/spack-20200301/opt/spack/linux-centos7-skylake_avx512/gcc-8.2.0/ncurses-6.1-73oof6l5rzikkjvwckaoocbzyg4bvsup/lib/libtinfo.so.6: error adding symbols: DSO missing from command line\r\ncollect2: error: ld returned 1 exit status\r\nmake: *** [tmux] Error 1\r\n```\r\n### Platform and user environment\r\n\r\n```commandline\r\n$ uname -a\r\nLinux bifx1n03.bold.bio 3.10.0-957.1.3.el7.x86_64 #1 SMP Thu Nov 29 14:49:43 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n``` \r\n### Additional information\r\n\r\n\r\n### General information\r\n\r\n- [x] I have run `spack --version` and reported the version of Spack\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}