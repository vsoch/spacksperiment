{
    "url": "https://api.github.com/repos/spack/spack/issues/13268",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13268/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13268/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13268/events",
    "html_url": "https://github.com/spack/spack/issues/13268",
    "id": 509528521,
    "node_id": "MDU6SXNzdWU1MDk1Mjg1MjE=",
    "number": 13268,
    "title": "Activating a package against a (chained) upstream spack should fail",
    "user": {
        "login": "rmsds",
        "id": 1918414,
        "node_id": "MDQ6VXNlcjE5MTg0MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1918414?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rmsds",
        "html_url": "https://github.com/rmsds",
        "followers_url": "https://api.github.com/users/rmsds/followers",
        "following_url": "https://api.github.com/users/rmsds/following{/other_user}",
        "gists_url": "https://api.github.com/users/rmsds/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rmsds/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rmsds/subscriptions",
        "organizations_url": "https://api.github.com/users/rmsds/orgs",
        "repos_url": "https://api.github.com/users/rmsds/repos",
        "events_url": "https://api.github.com/users/rmsds/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rmsds/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 512483390,
            "node_id": "MDU6TGFiZWw1MTI0ODMzOTA=",
            "url": "https://api.github.com/repos/spack/spack/labels/impact-medium",
            "name": "impact-medium",
            "color": "fef2c0",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "scheibelp",
        "id": 1659704,
        "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/scheibelp",
        "html_url": "https://github.com/scheibelp",
        "followers_url": "https://api.github.com/users/scheibelp/followers",
        "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
        "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
        "organizations_url": "https://api.github.com/users/scheibelp/orgs",
        "repos_url": "https://api.github.com/users/scheibelp/repos",
        "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
        "received_events_url": "https://api.github.com/users/scheibelp/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "scheibelp",
            "id": 1659704,
            "node_id": "MDQ6VXNlcjE2NTk3MDQ=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1659704?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/scheibelp",
            "html_url": "https://github.com/scheibelp",
            "followers_url": "https://api.github.com/users/scheibelp/followers",
            "following_url": "https://api.github.com/users/scheibelp/following{/other_user}",
            "gists_url": "https://api.github.com/users/scheibelp/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/scheibelp/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/scheibelp/subscriptions",
            "organizations_url": "https://api.github.com/users/scheibelp/orgs",
            "repos_url": "https://api.github.com/users/scheibelp/repos",
            "events_url": "https://api.github.com/users/scheibelp/events{/privacy}",
            "received_events_url": "https://api.github.com/users/scheibelp/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 0,
    "created_at": "2019-10-20T00:55:48Z",
    "updated_at": "2020-03-17T19:37:32Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "Activating a package against a chained upstream succeeds, changing the upstream in the process, and it should not.\r\n\r\nWe are using spack chains to accelerate our test builds and found this issue when during the tests we try to activate any python packages. (In hindsight this step, activating a python package built against an upstream python, should have been dropped but we didn't consider this implication at the time.)\r\n\r\nFor example, activating py-setuptools against an upstream python creates links on the upstream python. And additionally blocks the activation of the same package on the upstream instance.\r\n\r\n### Steps to reproduce the issue\r\n```console\r\n$ git clone git@github.com:spack/spack.git upstream\r\n$ git clone git@github.com:spack/spack.git\r\n\r\n# install Python in the upstream instance\r\n$ source upstream/share/spack/setup-env.sh\r\n$ spack install python@2.7.16%gcc@8.3.0\r\n\r\n# configure the chain to point to the upstream instance\r\n$ cat spack/etc/spack/upstreams.yaml\r\nupstreams:\r\n  spack-upstream:\r\n    install_tree: (...)/upstream/opt/spack\r\n\r\n# install py-setuptools on the downstream instance and activate it\r\n$ source spack/share/spack/setup-env.sh\r\n$ spack install py-setuptools ^/(hash of upstream python)\r\n$ spack activate /(hash of py-setuptools)\r\n```\r\nAt this point under `upstream/opt/spack/(...)/python-2.7.16-(...)/{bin,lib/python2.7/site-packages}` there are links to `spack/opt/spack/(...)/py-setuptools/(...)`. So, the 'upstream' instance was changed by a command executed in the 'downstream' one.\r\n\r\n### Error Message\r\n\r\nThere was no error message when activating a package against an upstream installation, I would expect it should fail. I assumed that an upstream installation would never be touched by downstream one (and as far as I can tell nothing like this is mentioned in the documentation).\r\n\r\n### Information on system\r\n- RedHat EL 7.6\r\n- no custom configuration of spack except for `upstreams.yaml` file above\r\n- compiler used in this example was an external one (but standard `gcc`, actually deployed with spack) \r\n",
    "performed_via_github_app": null
}