{
    "url": "https://api.github.com/repos/spack/spack/issues/19764",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/19764/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/19764/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/19764/events",
    "html_url": "https://github.com/spack/spack/issues/19764",
    "id": 737225717,
    "node_id": "MDU6SXNzdWU3MzcyMjU3MTc=",
    "number": 19764,
    "title": "Artificial constraints imposed by the concretizer",
    "user": {
        "login": "victorusu",
        "id": 15230430,
        "node_id": "MDQ6VXNlcjE1MjMwNDMw",
        "avatar_url": "https://avatars.githubusercontent.com/u/15230430?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/victorusu",
        "html_url": "https://github.com/victorusu",
        "followers_url": "https://api.github.com/users/victorusu/followers",
        "following_url": "https://api.github.com/users/victorusu/following{/other_user}",
        "gists_url": "https://api.github.com/users/victorusu/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/victorusu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/victorusu/subscriptions",
        "organizations_url": "https://api.github.com/users/victorusu/orgs",
        "repos_url": "https://api.github.com/users/victorusu/repos",
        "events_url": "https://api.github.com/users/victorusu/events{/privacy}",
        "received_events_url": "https://api.github.com/users/victorusu/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 4,
    "created_at": "2020-11-05T19:57:24Z",
    "updated_at": "2020-11-17T18:04:17Z",
    "closed_at": "2020-11-17T18:04:17Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "For some packages, the concretizer creates artificial global constraints, even if one asks for specific ones.\r\nThese artificial constraints block the possibility to make certain installations even though they are completely possible outside of Spack, especially when using RPATH.\r\n\r\nAn example is to attempt to compile GROMACS 2020.4 with MPICH 3.3.2. Since GROMACS requires hwloc version up to 1.x and MPICH 3.3.x requires hwloc version 2.x.\r\n\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ git clone https://github.com/spack/spack.git\r\n$ . ./spack/share/spack/setup-env.sh\r\n$ spack spec gromacs +mpi  ^mpich ~slurm +argobots ^fftw +mpi +openmp precision=long_double,double,quad,float\r\nor\r\n$ spack spec gromacs +mpi ^hwlow@1.11.11 ^mpich ~slurm +argobots ^hwloc@2.2.0 ^fftw +mpi +openmp precision=long_double,double,quad,float\r\n```\r\n\r\nEither way, the error message is\r\n```\r\nInput spec\r\n--------------------------------\r\ngromacs+mpi\r\n    ^fftw+mpi+openmp precision=double,float,long_double,quad\r\n    ^hwloc@2.2.0\r\n    ^hwlow@1.11.11\r\n    ^mpich+argobots~slurm\r\n\r\nConcretized\r\n--------------------------------\r\n==> Error: An unsatisfiable version constraint has been detected for spec:\r\n\r\n    hwloc@2.2.0\r\n        ^pkgconf@1.4.2%gcc@8.3.1 arch=linux-centos8-broadwell\r\n\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    gromacs@2020.4%gcc@8.3.1~cuda~double~double_precision+hwloc~ipo~lapack~mdrun_only+mpi~nosuffix~opencl+openmp~plumed+shared build_type=RelWithDebInfo arch=linux-centos8-broadwell\r\n        ^cmake@3.18.4%gcc@8.3.1~doc+ncurses+openssl+ownlibs~qt arch=linux-centos8-broadwell\r\n            ^ncurses\r\n                ^pkgconf@1.4.2%gcc@8.3.1 arch=linux-centos8-broadwell\r\n            ^openssl\r\n                ^perl@5.14.0:\r\n                    ^berkeley-db\r\n                    ^gdbm\r\n                        ^readline\r\n                ^zlib\r\n        ^fftw@3.3.8%gcc@8.3.1+mpi+openmp~pfft_patches precision=double,float,long_double,quad arch=linux-centos8-broadwell\r\n            ^mpich@3.3.2%gcc@8.3.1+argobots+fortran+hwloc+hydra+libxml2+pci+romio~slurm~verbs+wrapperrpath device=ch3 netmod=tcp pmi=pmi arch=linux-centos8-broadwell\r\n                ^argobots@1.0%gcc@8.3.1~debug~valgrind arch=linux-centos8-broadwell\r\n                ^autoconf@2.67:\r\n                    ^m4@1.4.6:\r\n                ^automake@1.15:\r\n                ^findutils@4.6.0%gcc@8.3.1 arch=linux-centos8-broadwell\r\n                ^hwloc@2.2.0\r\n                ^libpciaccess\r\n                    ^libtool@2.4.4:\r\n                    ^util-macros\r\n                ^libxml2\r\n                    ^iconv\r\n                    ^xz\r\n\r\n\r\ngromacs requires hwloc version :1.999, but spec asked for 2.2.0...\r\n```\r\n\r\nIt also doesn't matter if one installs first MPICH and attempts to use it to install GROMACS\r\n```console\r\n$ spack install mpich ~slurm +argobots ^hwloc@2.2.0 \r\n==> Installing argobots\r\n==> No binary for argobots found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/36/36a0815f7bf99900a9c9c1eef61ef9b3b76aa2cfc4594a304f6c8c3296da8def.tar.gz\r\n############################################################################################################################# 100.0%\r\n==> argobots: Executing phase: 'autoreconf'\r\n==> argobots: Executing phase: 'configure'\r\n==> argobots: Executing phase: 'build'\r\n==> argobots: Executing phase: 'install'\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/argobots-1.0-hyko5poasp3efwogzzf7wbl3a2nejov5\r\n==> autoconf@2.69 : externally installed in /usr\r\n[+] /usr\r\n==> automake@1.16.1 : externally installed in /usr\r\n[+] /usr\r\n==> findutils@4.6.0 : externally installed in /usr\r\n[+] /usr\r\n==> libtool@2.4.6 : externally installed in /usr\r\n[+] /usr\r\n==> pkgconf@1.4.2 : externally installed in /usr\r\n[+] /usr\r\n==> Installing util-macros\r\n==> No binary for util-macros found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/18/18d459400558f4ea99527bc9786c033965a3db45bf4c6a32eefdc07aa9e306a6.tar.bz2\r\n############################################################################################################################# 100.0%\r\n==> util-macros: Executing phase: 'autoreconf'\r\n==> util-macros: Executing phase: 'configure'\r\n==> util-macros: Executing phase: 'build'\r\n==> util-macros: Executing phase: 'install'\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/util-macros-1.19.1-pw3zua37sci5ssxu5e6pogvsbmnstag5\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/libiconv-1.16-5xigvm27i5rrhnuzkdtoxqp4it7cferz\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/xz-5.2.5-xja6u5dzeoihio4n55fc7vu3hkvtmdte\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/zlib-1.2.11-y5gmir5k3aljdcqorisvp3emvpnohr75\r\n==> m4@1.4.18 : externally installed in /usr\r\n[+] /usr\r\n==> Installing libpciaccess\r\n==> No binary for libpciaccess found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/84/84413553994aef0070cf420050aa5c0a51b1956b404920e21b81e96db6a61a27.tar.gz\r\n############################################################################################################################# 100.0%\r\n==> libpciaccess: Executing phase: 'autoreconf'\r\n==> libpciaccess: Executing phase: 'configure'\r\n==> libpciaccess: Executing phase: 'build'\r\n==> libpciaccess: Executing phase: 'install'\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/libpciaccess-0.16-5budu7syhvxnqag4hcbd3cxuelpvp3ev\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/libxml2-2.9.10-wkncmwylkzn4hwyepm7qiwpeo75maozx\r\n==> Installing hwloc\r\n==> No binary for hwloc found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/2d/2defba03ddd91761b858cbbdc2e3a6e27b44e94696dbfa21380191328485a433.tar.gz\r\n############################################################################################################################# 100.0%\r\n==> hwloc: Executing phase: 'autoreconf'\r\n==> hwloc: Executing phase: 'configure'\r\n==> hwloc: Executing phase: 'build'\r\n==> hwloc: Executing phase: 'install'\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/hwloc-2.2.0-jrnyxhctfsc4642fbdfab3bhvckiolvp\r\n==> Installing mpich\r\n==> No binary for mpich found: installing from source\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/4b/4bfaf8837a54771d3e4922c84071ef80ffebddbb6971a006038d91ee7ef959b9.tar.gz\r\n############################################################################################################################# 100.0%\r\n==> Fetching https://spack-llnl-mirror.s3-us-west-2.amazonaws.com/_source-cache/archive/eb/eb982de3366d48cbc55eb5e0df43373a45d9f51df208abf0835a72dc6c0b4774\r\n############################################################################################################################# 100.0%\r\n==> mpich: Executing phase: 'autoreconf'\r\n==> mpich: Executing phase: 'configure'\r\n==> mpich: Executing phase: 'build'\r\n==> mpich: Executing phase: 'install'\r\n[+] /users/user/spack/opt/spack/linux-centos8-broadwell/gcc-8.3.1/mpich-3.3.2-dmeqwwj5wxgsbblcuikkffbbtux4mf4j\r\n\r\n\r\n$ spack find -vl mpich \r\n==> 1 installed package\r\n-- linux-centos8-broadwell / gcc@8.3.1 --------------------------\r\ndmeqwwj mpich@3.3.2+argobots+fortran+hwloc+hydra+libxml2+pci+romio~slurm~verbs+wrapperrpath device=ch3 netmod=tcp patches=eb982de3366d48cbc55eb5e0df43373a45d9f51df208abf0835a72dc6c0b4774 pmi=pmi\r\n\r\n\r\n$ spack spec gromacs +mpi ^hwlow@1.11.11 ^/dmeqwwj\r\nInput spec\r\n--------------------------------\r\ngromacs+mpi\r\n    ^hwlow@1.11.11\r\n    ^mpich@3.3.2%gcc@8.3.1+argobots+fortran+hwloc+hydra+libxml2+pci+romio~slurm~verbs+wrapperrpath device=ch3 netmod=tcp patches=eb982de3366d48cbc55eb5e0df43373a45d9f51df208abf0835a72dc6c0b4774 pmi=pmi arch=linux-centos8-broadwell\r\n        ^argobots@1.0%gcc@8.3.1~debug~valgrind arch=linux-centos8-broadwell\r\n        ^hwloc@2.2.0%gcc@8.3.1~cairo~cuda~gl~libudev+libxml2~netloc~nvml+pci+shared arch=linux-centos8-broadwell\r\n            ^libpciaccess@0.16%gcc@8.3.1 arch=linux-centos8-broadwell\r\n            ^libxml2@2.9.10%gcc@8.3.1~python arch=linux-centos8-broadwell\r\n                ^libiconv@1.16%gcc@8.3.1 arch=linux-centos8-broadwell\r\n                ^xz@5.2.5%gcc@8.3.1~pic arch=linux-centos8-broadwell\r\n                ^zlib@1.2.11%gcc@8.3.1+optimize+pic+shared arch=linux-centos8-broadwell\r\n\r\nConcretized\r\n--------------------------------\r\n==> Error: An unsatisfiable constrain a concrete spec constraint has been detected for spec:\r\n\r\n    hwloc@2.2.0%gcc@8.3.1~cairo~cuda~gl~libudev+libxml2~netloc~nvml+pci+shared arch=linux-centos8-broadwell\r\n        ^libpciaccess@0.16%gcc@8.3.1 arch=linux-centos8-broadwell\r\n        ^libxml2@2.9.10%gcc@8.3.1~python arch=linux-centos8-broadwell\r\n            ^libiconv@1.16%gcc@8.3.1 arch=linux-centos8-broadwell\r\n            ^xz@5.2.5%gcc@8.3.1~pic arch=linux-centos8-broadwell\r\n            ^zlib@1.2.11%gcc@8.3.1+optimize+pic+shared arch=linux-centos8-broadwell\r\n\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    gromacs@2020.4%gcc@8.3.1~cuda~double~double_precision+hwloc~ipo~lapack~mdrun_only+mpi~nosuffix~opencl+openmp~plumed+shared build_type=RelWithDebInfo arch=linux-centos8-broadwell\r\n        ^cmake@3.18.4%gcc@8.3.1~doc+ncurses+openssl+ownlibs~qt arch=linux-centos8-broadwell\r\n            ^ncurses\r\n                ^pkgconfig\r\n            ^openssl\r\n                ^perl@5.14.0:\r\n                    ^berkeley-db\r\n                    ^gdbm\r\n                        ^readline\r\n                ^zlib@1.2.11%gcc@8.3.1+optimize+pic+shared arch=linux-centos8-broadwell\r\n        ^fftw@3.3.8%gcc@8.3.1+mpi~openmp~pfft_patches precision=double,float arch=linux-centos8-broadwell\r\n            ^mpich@3.3.2%gcc@8.3.1+argobots+fortran+hwloc+hydra+libxml2+pci+romio~slurm~verbs+wrapperrpath device=ch3 netmod=tcp patches=eb982de3366d48cbc55eb5e0df43373a45d9f51df208abf0835a72dc6c0b4774 pmi=pmi arch=linux-centos8-broadwell\r\n                ^argobots@1.0%gcc@8.3.1~debug~valgrind arch=linux-centos8-broadwell\r\n                ^hwloc@2.2.0%gcc@8.3.1~cairo~cuda~gl~libudev+libxml2~netloc~nvml+pci+shared arch=linux-centos8-broadwell\r\n                    ^libpciaccess@0.16%gcc@8.3.1 arch=linux-centos8-broadwell\r\n                    ^libxml2@2.9.10%gcc@8.3.1~python arch=linux-centos8-broadwell\r\n                        ^libiconv@1.16%gcc@8.3.1 arch=linux-centos8-broadwell\r\n                        ^xz@5.2.5%gcc@8.3.1~pic arch=linux-centos8-broadwell\r\n\r\n\r\ngromacs requires hwloc constrain a concrete spec hwloc@:1.999, but spec asked for hwloc@2.2.0%gcc@8.3.1~cairo~cuda~gl~libudev+libxml2~netloc~nvml+pci+shared arch=linux-centos8-broadwell ^libiconv@1.16%gcc@8.3.1 arch=linux-centos8-broadwell ^libpciaccess@0.16%gcc@8.3.1 arch=linux-centos8-broadwell ^libxml2@2.9.10%gcc@8.3.1~python arch=linux-centos8-broadwell ^xz@5.2.5%gcc@8.3.1~pic arch=linux-centos8-broadwell ^zlib@1.2.11%gcc@8.3.1+optimize+pic+shared arch=linux-centos8-broadwell\r\n```\r\n\r\n### Information on your system\r\n\r\n```console\r\n$ spack debug report\r\n* **Spack:** 0.13.3-4834-cc6ee3e56\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos8-broadwell\r\n```\r\n\r\n",
    "performed_via_github_app": null
}