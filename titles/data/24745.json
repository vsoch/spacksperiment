{
    "url": "https://api.github.com/repos/spack/spack/issues/24745",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/24745/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/24745/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/24745/events",
    "html_url": "https://github.com/spack/spack/issues/24745",
    "id": 938657934,
    "node_id": "MDU6SXNzdWU5Mzg2NTc5MzQ=",
    "number": 24745,
    "title": "Installation issue: cannot contretize all ROCm related packages in single environment",
    "user": {
        "login": "UweSauter",
        "id": 19325781,
        "node_id": "MDQ6VXNlcjE5MzI1Nzgx",
        "avatar_url": "https://avatars.githubusercontent.com/u/19325781?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/UweSauter",
        "html_url": "https://github.com/UweSauter",
        "followers_url": "https://api.github.com/users/UweSauter/followers",
        "following_url": "https://api.github.com/users/UweSauter/following{/other_user}",
        "gists_url": "https://api.github.com/users/UweSauter/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/UweSauter/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/UweSauter/subscriptions",
        "organizations_url": "https://api.github.com/users/UweSauter/orgs",
        "repos_url": "https://api.github.com/users/UweSauter/repos",
        "events_url": "https://api.github.com/users/UweSauter/events{/privacy}",
        "received_events_url": "https://api.github.com/users/UweSauter/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "srekolam",
        "id": 67086238,
        "node_id": "MDQ6VXNlcjY3MDg2MjM4",
        "avatar_url": "https://avatars.githubusercontent.com/u/67086238?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/srekolam",
        "html_url": "https://github.com/srekolam",
        "followers_url": "https://api.github.com/users/srekolam/followers",
        "following_url": "https://api.github.com/users/srekolam/following{/other_user}",
        "gists_url": "https://api.github.com/users/srekolam/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/srekolam/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/srekolam/subscriptions",
        "organizations_url": "https://api.github.com/users/srekolam/orgs",
        "repos_url": "https://api.github.com/users/srekolam/repos",
        "events_url": "https://api.github.com/users/srekolam/events{/privacy}",
        "received_events_url": "https://api.github.com/users/srekolam/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "srekolam",
            "id": 67086238,
            "node_id": "MDQ6VXNlcjY3MDg2MjM4",
            "avatar_url": "https://avatars.githubusercontent.com/u/67086238?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/srekolam",
            "html_url": "https://github.com/srekolam",
            "followers_url": "https://api.github.com/users/srekolam/followers",
            "following_url": "https://api.github.com/users/srekolam/following{/other_user}",
            "gists_url": "https://api.github.com/users/srekolam/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/srekolam/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/srekolam/subscriptions",
            "organizations_url": "https://api.github.com/users/srekolam/orgs",
            "repos_url": "https://api.github.com/users/srekolam/repos",
            "events_url": "https://api.github.com/users/srekolam/events{/privacy}",
            "received_events_url": "https://api.github.com/users/srekolam/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 11,
    "created_at": "2021-07-07T08:58:21Z",
    "updated_at": "2021-07-30T06:34:43Z",
    "closed_at": "2021-07-20T09:29:01Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "@arjun-raj-kuppala @srekolam\r\n\r\n### Steps to reproduce the issue\r\n\r\nI'm trying to include all ROCm related packages into one environment so that a user only needs to load one module instead of (currently) 43. Also I want to keep the necessary installed dependencies to a minimum.\r\n\r\nThis fails because of some packages require different flags of `llvm-amdgpu` than others. Question is if this could somehow be unified?\r\n\r\n<!-- Fill in the exact spec you are trying to build and the relevant part of the error message -->\r\n```console\r\n$ cd /localscratch\r\n$ spack env create -d 2021-07-07\r\n$ spack env activate 2021-07-07\r\n$ cd 2021-07-07\r\n$ echo <<EOF >>spack.yaml\r\nspack:\r\n  concretization: together\r\n  packages:\r\n    all:\r\n      compiler: [gcc@10.3.0]\r\n  specs:\r\n  - matrix:\r\n    - ['%gcc@10.3.0^cmake@3.17.5']\r\n    - [atmi, comgr, hip, hipblas, hipcub, hipfft, hipfort, hipify-clang, hip-rocclr,\r\n      hipsparse, hsakmt-roct, hsa-rocr-dev, llvm-amdgpu, migraphx, miopengemm, miopen-hip,\r\n      miopen-opencl, mivisionx, rccl, rdc, rocalution, rocblas, rocfft, rocm-bandwidth-test,\r\n      rocm-clang-ocl, rocm-cmake, rocm-dbgapi, rocm-debug-agent, rocm-device-libs,\r\n      rocm-gdb, rocminfo, rocm-opencl, rocm-openmp-extras, rocm-smi-lib, rocm-tensile,\r\n      rocm-validation-suite, rocprim, rocprofiler-dev, rocrand, rocsolver, rocsparse,\r\n      rocthrust, roctracer-dev]\r\n  view: true\r\n  EOF\r\n$ spack concretize\r\n==> Error: An unsatisfiable variant constraint has been detected for spec:\r\n\r\n    llvm-amdgpu@4.2.0%gcc@10.3.0~ipo+openmp~rocm-device-libs build_type=Release arch=linux-centos7-zen2\r\n        ^cmake@3.17.5%gcc@10.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-centos7-zen2\r\n            ^ncurses@6.2%gcc@10.3.0~symlinks+termlib abi=none arch=linux-centos7-zen2\r\n                ^pkgconf@1.7.4%gcc@10.3.0 arch=linux-centos7-zen2\r\n            ^openssl@1.1.1k%gcc@10.3.0~docs+systemcerts arch=linux-centos7-zen2\r\n                ^perl@5.34.0%gcc@10.3.0+cpanm+shared+threads arch=linux-centos7-zen2\r\n                    ^berkeley-db@18.1.40%gcc@10.3.0+cxx~docs+stl arch=linux-centos7-zen2\r\n                    ^gdbm@1.19%gcc@10.3.0 arch=linux-centos7-zen2\r\n                        ^readline@8.1%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^zlib@1.2.11%gcc@10.3.0+optimize+pic+shared arch=linux-centos7-zen2\r\n        ^hwloc\r\n        ^libelf@0.8.13%gcc@10.3.0 arch=linux-centos7-zen2\r\n        ^perl-data-dumper@2.173%gcc@10.3.0 arch=linux-centos7-zen2\r\n        ^python@3.8.11%gcc@10.3.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib arch=linux-centos7-zen2\r\n            ^bzip2@1.0.8%gcc@10.3.0~debug~pic+shared arch=linux-centos7-zen2\r\n                ^diffutils@3.7%gcc@10.3.0 arch=linux-centos7-zen2\r\n                    ^libiconv@1.16%gcc@10.3.0 arch=linux-centos7-zen2\r\n            ^expat@2.3.0%gcc@10.3.0+libbsd arch=linux-centos7-zen2\r\n                ^libbsd\r\n            ^gettext@0.21%gcc@10.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-centos7-zen2\r\n                ^libxml2@2.9.10%gcc@10.3.0~python arch=linux-centos7-zen2\r\n                    ^xz@5.2.5%gcc@10.3.0~pic libs=shared,static arch=linux-centos7-zen2\r\n                ^tar\r\n            ^libffi@3.3%gcc@10.3.0 arch=linux-centos7-zen2\r\n            ^sqlite@3.35.5%gcc@10.3.0+column_metadata+fts~functions~rtree arch=linux-centos7-zen2\r\n            ^util-linux-uuid@2.36.2%gcc@10.3.0 arch=linux-centos7-zen2\r\n        ^z3@4.8.9%gcc@10.3.0~gmp~ipo+python build_type=RelWithDebInfo arch=linux-centos7-zen2\r\n            ^py-setuptools@44.1.0%gcc@10.3.0 arch=linux-centos7-zen2\r\n\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    hip@4.2.0%gcc@10.3.0~ipo build_type=RelWithDebInfo arch=linux-centos7-zen2\r\n        ^cmake@3.17.5%gcc@10.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-centos7-zen2\r\n            ^ncurses@6.2%gcc@10.3.0~symlinks+termlib abi=none arch=linux-centos7-zen2\r\n                ^pkgconf@1.7.4%gcc@10.3.0 arch=linux-centos7-zen2\r\n            ^openssl@1.1.1k%gcc@10.3.0~docs+systemcerts arch=linux-centos7-zen2\r\n                ^perl@5.34.0%gcc@10.3.0+cpanm+shared+threads arch=linux-centos7-zen2\r\n                    ^berkeley-db@18.1.40%gcc@10.3.0+cxx~docs+stl arch=linux-centos7-zen2\r\n                    ^gdbm@1.19%gcc@10.3.0 arch=linux-centos7-zen2\r\n                        ^readline@8.1%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^zlib@1.2.11%gcc@10.3.0+optimize+pic+shared arch=linux-centos7-zen2\r\n        ^comgr@4.2.0%gcc@10.3.0~ipo build_type=Release arch=linux-centos7-zen2\r\n            ^llvm-amdgpu@4.2.0%gcc@10.3.0~ipo+openmp~rocm-device-libs build_type=Release arch=linux-centos7-zen2\r\n                ^hwloc\r\n                ^libelf@0.8.13%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^perl-data-dumper@2.173%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^python@3.8.11%gcc@10.3.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib arch=linux-centos7-zen2\r\n                    ^bzip2@1.0.8%gcc@10.3.0~debug~pic+shared arch=linux-centos7-zen2\r\n                        ^diffutils@3.7%gcc@10.3.0 arch=linux-centos7-zen2\r\n                            ^libiconv@1.16%gcc@10.3.0 arch=linux-centos7-zen2\r\n                    ^expat@2.3.0%gcc@10.3.0+libbsd arch=linux-centos7-zen2\r\n                        ^libbsd\r\n                    ^gettext@0.21%gcc@10.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-centos7-zen2\r\n                        ^libxml2@2.9.10%gcc@10.3.0~python arch=linux-centos7-zen2\r\n                            ^xz@5.2.5%gcc@10.3.0~pic libs=shared,static arch=linux-centos7-zen2\r\n                        ^tar\r\n                    ^libffi@3.3%gcc@10.3.0 arch=linux-centos7-zen2\r\n                    ^sqlite@3.35.5%gcc@10.3.0+column_metadata+fts~functions~rtree arch=linux-centos7-zen2\r\n                    ^util-linux-uuid@2.36.2%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^z3@4.8.9%gcc@10.3.0~gmp~ipo+python build_type=RelWithDebInfo arch=linux-centos7-zen2\r\n                    ^py-setuptools@44.1.0%gcc@10.3.0 arch=linux-centos7-zen2\r\n            ^rocm-cmake@4.2.0%gcc@10.3.0~ipo+ldconfig build_type=Release arch=linux-centos7-zen2\r\n            ^rocm-device-libs@4.2.0%gcc@10.3.0~ipo build_type=Release arch=linux-centos7-zen2\r\n                ^texinfo@6.5%gcc@10.3.0 arch=linux-centos7-zen2\r\n        ^hip-rocclr@4.2.0%gcc@10.3.0~ipo build_type=RelWithDebInfo arch=linux-centos7-zen2\r\n            ^hsa-rocr-dev@4.2.0%gcc@10.3.0+image~ipo+shared build_type=Release arch=linux-centos7-zen2\r\n                ^hsakmt-roct@4.2.0%gcc@10.3.0~ipo+shared build_type=Release arch=linux-centos7-zen2\r\n                    ^numactl@2.0.14%gcc@10.3.0 arch=linux-centos7-zen2\r\n                        ^autoconf@2.69%gcc@10.3.0 arch=linux-centos7-zen2\r\n                            ^m4@1.4.19%gcc@10.3.0+sigsegv arch=linux-centos7-zen2\r\n                                ^libsigsegv\r\n                        ^automake@1.16.3%gcc@10.3.0 arch=linux-centos7-zen2\r\n                        ^libtool@2.4.6%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^xxd\r\n            ^mesa18@18.3.6%gcc@10.3.0+glx~llvm~opengles+osmesa swr=none arch=linux-centos7-zen2\r\n                ^binutils@2.36.1%gcc@10.3.0~gas~gold~headers~interwork~ld~libiberty~lto+nls+plugins libs=shared,static arch=linux-centos7-zen2\r\n                ^bison@3.7.6%gcc@10.3.0 arch=linux-centos7-zen2\r\n                ^flex@2.6.4%gcc@10.3.0+lex~nls arch=linux-centos7-zen2\r\n                    ^findutils@4.8.0%gcc@10.3.0 arch=linux-centos7-zen2\r\n                    ^help2man\r\n                ^glproto@1.4.14:\r\n                    ^util-macros\r\n                ^libx11@1.6:\r\n                    ^inputproto\r\n                    ^kbproto\r\n                    ^libxcb@1.1.92:\r\n                        ^libpthread-stubs\r\n                        ^libxau@0.99.2:\r\n                            ^xproto@7.0.17:\r\n                        ^libxdmcp\r\n                        ^xcb-proto\r\n                    ^xextproto@7.1.99:\r\n                    ^xtrans\r\n                ^libxext\r\n                ^py-mako@1.1.4%gcc@10.3.0 arch=linux-centos7-zen2\r\n                    ^py-markupsafe@1.1.1%gcc@10.3.0 arch=linux-centos7-zen2\r\n\r\n\r\nhip requires llvm-amdgpu variant +rocm-device-libs, but spec asked for ~rocm-device-libs\r\n```\r\nWhen changing `concretization: together` to `concretization: separately` the concretization succeeds but wants to install muliple instances of `llvm-amdgpu` (and possible other packages, haven't checked).\r\n\r\n### Information on your system\r\n```\r\n$ spack debug report\r\n* **Spack:** 0.16.2-3395-59eea28\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos7-zen2\r\n* **Concretizer:** original\r\n```\r\n### General information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [ ] I have uploaded the build log and environment files\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "performed_via_github_app": null
}