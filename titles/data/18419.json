{
    "url": "https://api.github.com/repos/spack/spack/issues/18419",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/18419/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/18419/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/18419/events",
    "html_url": "https://github.com/spack/spack/issues/18419",
    "id": 689235497,
    "node_id": "MDU6SXNzdWU2ODkyMzU0OTc=",
    "number": 18419,
    "title": "Strange concretization error \"Invalid Version range\" due to slack version specification of the external dependency",
    "user": {
        "login": "albestro",
        "id": 9337627,
        "node_id": "MDQ6VXNlcjkzMzc2Mjc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/9337627?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/albestro",
        "html_url": "https://github.com/albestro",
        "followers_url": "https://api.github.com/users/albestro/followers",
        "following_url": "https://api.github.com/users/albestro/following{/other_user}",
        "gists_url": "https://api.github.com/users/albestro/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/albestro/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/albestro/subscriptions",
        "organizations_url": "https://api.github.com/users/albestro/orgs",
        "repos_url": "https://api.github.com/users/albestro/repos",
        "events_url": "https://api.github.com/users/albestro/events{/privacy}",
        "received_events_url": "https://api.github.com/users/albestro/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2020-08-31T14:06:15Z",
    "updated_at": "2020-08-31T15:50:19Z",
    "closed_at": "2020-08-31T15:50:19Z",
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "I noticed a strange behavior with version ranges. After some troubleshooting (thanks @haampie), we found the root reason in my configuration, but I think it is worth mentioning what happened.\r\n\r\nWhat happened is that due to my `packages.yaml` configuration having a \"superficially\" described version (i.e. `python@3`), the package `weechat` containing the directive `depends_on(\"python@3.5:\")` caused\r\n\r\n```console\r\n$ spack spec weechat\r\n...\r\n==> Error: Invalid Version range: 3.5:3\r\n```\r\n\r\nChanging in `package.yaml` to `python@3.8.5` solved the problem.\r\n\r\nI know it is a good practice to give as much details as it is possible when specifying an external package, but I think it is worth mentioning this behavior since I found the error message misleading. Even after understanding the root of the problem, I'm still thinking that it was not the kind of error message I would have expected (e.g. I think it is a failed constraint, isn't it?).\r\n\r\n### Steps to reproduce the issue\r\n\r\nFor the sake of the example, I will target `weechat ^ python`, but I don't think it is related to a specific pair. \r\n\r\nThe main requirement for reproducing it, I think it is having an external `python` package in `packages.yaml` with a partially specified version (i.e. `python@3`).\r\n\r\n### Error Message\r\n\r\n```console\r\n$ spack --debug --stacktrace spec weechat\r\n...\r\nTraceback (most recent call last):\r\n  File \"/Users/ialberto/spack/bin/spack\", line 64, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/Users/ialberto/spack/lib/spack/spack/main.py\", line 762, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/main.py\", line 490, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/cmd/spec.py\", line 103, in spec\r\n    spec.concretize()\r\n  File \"/Users/ialberto/spack/lib/spack/spack/spec.py\", line 2211, in concretize\r\n    self._expand_virtual_packages(concretizer),\r\n  File \"/Users/ialberto/spack/lib/spack/spack/spec.py\", line 2132, in _expand_virtual_packages\r\n    copy.normalize(force=True)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/spec.py\", line 2695, in normalize\r\n    any_change = self._normalize_helper(\r\n  File \"/Users/ialberto/spack/lib/spack/spack/spec.py\", line 2633, in _normalize_helper\r\n    changed |= self._merge_dependency(\r\n  File \"/Users/ialberto/spack/lib/spack/spack/spec.py\", line 2569, in _merge_dependency\r\n    changed |= spec_deps[dep.name].constrain(dep)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/spec.py\", line 2797, in constrain\r\n    changed |= self.versions.intersect(other.versions)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 89, in coercing_method\r\n    return method(a, b, *args, **kwargs)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 753, in intersect\r\n    isection = self.intersection(other)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 89, in coercing_method\r\n    return method(a, b, *args, **kwargs)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 744, in intersection\r\n    result.add(s.intersection(o))\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 92, in coercing_method\r\n    return getattr(ca, method.__name__)(cb, *args, **kwargs)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 89, in coercing_method\r\n    return method(a, b, *args, **kwargs)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 559, in intersection\r\n    return VersionRange(start, end)\r\n  File \"/Users/ialberto/spack/lib/spack/spack/version.py\", line 389, in __init__\r\n    raise ValueError(\"Invalid Version range: %s\" % self)\r\nValueError: Invalid Version range: 3.5:3\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.15.4-770-c07204d66\r\n* **Python:** 3.8.5\r\n* **Platform:** darwin-mojave-skylake\r\n\r\n`packages.yaml` file\r\n```yaml\r\npackages:\r\n...\r\n  python:\r\n    externals:\r\n    - spec: python@3\r\n      prefix: /usr/local/\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output",
    "performed_via_github_app": null
}