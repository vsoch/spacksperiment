{
    "url": "https://api.github.com/repos/spack/spack/issues/6844",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/6844/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/6844/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/6844/events",
    "html_url": "https://github.com/spack/spack/issues/6844",
    "id": 286526021,
    "node_id": "MDU6SXNzdWUyODY1MjYwMjE=",
    "number": 6844,
    "title": "install error of cmake when being built with clang",
    "user": {
        "login": "adamryczkowski",
        "id": 4469707,
        "node_id": "MDQ6VXNlcjQ0Njk3MDc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4469707?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamryczkowski",
        "html_url": "https://github.com/adamryczkowski",
        "followers_url": "https://api.github.com/users/adamryczkowski/followers",
        "following_url": "https://api.github.com/users/adamryczkowski/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamryczkowski/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamryczkowski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamryczkowski/subscriptions",
        "organizations_url": "https://api.github.com/users/adamryczkowski/orgs",
        "repos_url": "https://api.github.com/users/adamryczkowski/repos",
        "events_url": "https://api.github.com/users/adamryczkowski/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamryczkowski/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 446616547,
            "node_id": "MDU6TGFiZWw0NDY2MTY1NDc=",
            "url": "https://api.github.com/repos/spack/spack/labels/build-error",
            "name": "build-error",
            "color": "ff3300",
            "default": false,
            "description": null
        },
        {
            "id": 654034395,
            "node_id": "MDU6TGFiZWw2NTQwMzQzOTU=",
            "url": "https://api.github.com/repos/spack/spack/labels/clang",
            "name": "clang",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 508566016,
            "node_id": "MDU6TGFiZWw1MDg1NjYwMTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/cmake",
            "name": "cmake",
            "color": "c2e0c6",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 13,
    "created_at": "2018-01-06T22:32:50Z",
    "updated_at": "2018-04-09T10:26:23Z",
    "closed_at": "2018-02-07T13:23:52Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "### Expected Result\r\n\r\nAnother copy of cmake, this time compiled by clang, so it is compatible (?) with other tools compiled by clang.\r\n\r\n### Actual Result\r\n\r\nError message:\r\n\r\n```\r\n$ spack install cmake %clang\r\n==> pkgconf is already installed in /home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/pkgconf-1.3.10-zlgzluamtcabo2vyo57qhhj6yd5oplyu\r\n==> ncurses is already installed in /home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/ncurses-6.0-tiaueorrfuqqqeloeuxo5tcvegqoxwfh\r\n==> zlib is already installed in /home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/zlib-1.2.11-zuqta7aud7s4ocpzltoc3pyfhw465i3k\r\n==> openssl is already installed in /home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/openssl-1.0.2n-zs7htqz3eeji3ronliga45lef3w7fg5k\r\n==> Installing cmake\r\n==> Using cached archive: /home/aryczkowski/spack/var/spack/cache/cmake/cmake-3.10.0.tar.gz\r\n==> Staging archive: /home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0.tar.gz\r\n==> Created stage in /home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf\r\n==> No patches needed for cmake\r\n==> Building cmake [Package]\r\n==> Executing phase: 'bootstrap'\r\n==> Error: ProcessError: Command exited with status 7:\r\n    './bootstrap' '--prefix=/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf' '--parallel=8' '--no-system-libs' '--no-qt-gui' '--' '-DCMAKE_USE_OPENSSL=ON'\r\n\r\n1 error found in build log:\r\n     1     ==> Executing phase: 'bootstrap'\r\n     2     ==> './bootstrap' '--prefix=/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf' '--parallel=8' '--no-system-libs' '--no-qt-gui' '--' '-DCMAKE_USE_OPENSSL=ON'\r\n     3     ---------------------------------------------\r\n     4     CMake 3.10.0, Copyright 2000-2017 Kitware, Inc. and Contributors\r\n     5     C compiler on this system is: /home/aryczkowski/spack/lib/spack/env/clang/clang\r\n     6     ---------------------------------------------\r\n  >> 7     Error when bootstrapping CMake:\r\n     8     Cannot find a C++ compiler supporting C++11 on this system.\r\n     9     Please specify one using environment variable CXX.\r\n     10    See cmake_bootstrap.log for compilers attempted.\r\n     11    ---------------------------------------------\r\n     12    Log of errors: /tmp/aryczkowski/spack-stage/spack-stage-X9MXul/cmake-3.10.0/Bootstrap.cmk/cmake_bootstrap.log\r\n     13    ---------------------------------------------\r\n\r\nSee build log for details:\r\n  /home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/spack-build.out\r\n```\r\n\r\nWhen I execute the bootstrap step manually I get further:\r\n\r\n```\r\nexport CC=$(which clang); export CXX=$(which clang++); './bootstrap' '--prefix=/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/clang-5.0.0/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf' '--parallel=8' '--no-system-libs' '--no-qt-gui' '--' '-DCMAKE_USE_OPENSSL=ON'\r\n---------------------------------------------\r\nCMake 3.10.0, Copyright 2000-2017 Kitware, Inc. and Contributors\r\nC compiler on this system is: /home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang  \r\nC++ compiler on this system is: /home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++  -std=gnu++1z \r\nMakefile processor on this system is: make\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++ has setenv\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++ has unsetenv\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++ does not have environ in stdlib.h\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++ has stl wstring\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++ does not have <ext/stdio_filebuf.h>\r\n---------------------------------------------\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++  -std=gnu++1z     -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Bootstrap.cmk   -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Source   -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Source/LexerParser   -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Utilities  -c /home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Source/cmAddCustomCommandCommand.cxx -o cmAddCustomCommandCommand.o\r\n/home/aryczkowski/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-6.3.0/llvm-5.0.0-xvd4hgsum6zvi7ny6sd5rdwgani2oubv/bin/clang++  -std=gnu++1z     -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Bootstrap.cmk   -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Source   -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Source/LexerParser   -I/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Utilities  -c /home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/Source/cmAddCustomTargetCommand.cxx -o cmAddCustomTargetCommand.o\r\n...\r\n```\r\n\r\n...but unfortunately the bootstrap process fails anyway with\r\n\r\n```\r\n...\r\n-- Looking for connect in socket;dl\r\n-- Looking for connect in socket;dl - not found\r\n-- Looking for gethostbyname in c\r\n-- Looking for gethostbyname in c - found\r\n-- Looking for recv in network;dl\r\n-- Looking for recv in network;dl - not found\r\n-- Looking for gethostname\r\n-- Looking for gethostname - found\r\nCMake Error at Modules/FindPackageHandleStandardArgs.cmake:137 (message):\r\n  Could NOT find OpenSSL, try to set the path to OpenSSL root folder in the\r\n  system variable OPENSSL_ROOT_DIR (missing: OPENSSL_CRYPTO_LIBRARY\r\n  OPENSSL_INCLUDE_DIR)\r\nCall Stack (most recent call first):\r\n  Modules/FindPackageHandleStandardArgs.cmake:378 (_FPHSA_FAILURE_MESSAGE)\r\n  Modules/FindOpenSSL.cmake:390 (find_package_handle_standard_args)\r\n  Utilities/cmcurl/CMakeLists.txt:459 (find_package)\r\n\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/home/aryczkowski/spack/var/spack/stage/cmake-3.10.0-dbjzmqxyvikdwpyo6dsjqhmoh6dxc6nf/cmake-3.10.0/CMakeFiles/CMakeError.log\".\r\n---------------------------------------------\r\nError when bootstrapping CMake:\r\nProblem while running initial CMake\r\n---------------------------------------------\r\n```\r\n\r\nbut that is irrelevant I hope.\r\n\r\n### Steps to reproduce the issue\r\n\r\nI can reproduce the issue in many ways, the most straightforward is just\r\n\r\n1. Install vanilla Ubuntu with `build-essential and python-minimal`\r\n2. Install and load spack into the bash session\r\n3. Install gcc@6.3.0 by spack (so it stays as compatible, as possible) to compile llvm\r\n4. Install llvm@5.0.0\r\n5. `spack install cmake %clang`\r\n\r\n### Information on your system\r\n\r\nJust plain Ubuntu 16.04 64bit is sufficient to duplicate, but I can replicate the same error on an HPC machine:\r\n\r\n```\r\n$ uname -r\r\n2.6.32-431.20.3.el6.x86_64\r\n\r\n$ lsb_release -a\r\nLSB Version:\t:base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarch\r\nDistributor ID:\tScientific\r\nDescription:\tScientific Linux release 6.4 (Carbon)\r\nRelease:\t6.4\r\nCodename:\tCarbon\r\n```\r\n\r\nNothing customized on either machine.\r\n\r\n-----\r\n\r\nI am trying to install flang. Since neither `spack install flang` nor `spack install flang %gcc@6.3.0` works, I try compile it via llvm. Unfortunately I fail during compilation of cmake. \r\n\r\n  ",
    "performed_via_github_app": null
}