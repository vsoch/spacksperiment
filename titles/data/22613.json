{
    "url": "https://api.github.com/repos/spack/spack/issues/22613",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/22613/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/22613/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/22613/events",
    "html_url": "https://github.com/spack/spack/issues/22613",
    "id": 843525503,
    "node_id": "MDU6SXNzdWU4NDM1MjU1MDM=",
    "number": 22613,
    "title": "Clingo concretizer does not respect hashes in spec",
    "user": {
        "login": "adamjstewart",
        "id": 12021217,
        "node_id": "MDQ6VXNlcjEyMDIxMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/12021217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adamjstewart",
        "html_url": "https://github.com/adamjstewart",
        "followers_url": "https://api.github.com/users/adamjstewart/followers",
        "following_url": "https://api.github.com/users/adamjstewart/following{/other_user}",
        "gists_url": "https://api.github.com/users/adamjstewart/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/adamjstewart/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/adamjstewart/subscriptions",
        "organizations_url": "https://api.github.com/users/adamjstewart/orgs",
        "repos_url": "https://api.github.com/users/adamjstewart/repos",
        "events_url": "https://api.github.com/users/adamjstewart/events{/privacy}",
        "received_events_url": "https://api.github.com/users/adamjstewart/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446623646,
            "node_id": "MDU6TGFiZWw0NDY2MjM2NDY=",
            "url": "https://api.github.com/repos/spack/spack/labels/concretization",
            "name": "concretization",
            "color": "006b75",
            "default": false,
            "description": null
        },
        {
            "id": 446626162,
            "node_id": "MDU6TGFiZWw0NDY2MjYxNjI=",
            "url": "https://api.github.com/repos/spack/spack/labels/hashes",
            "name": "hashes",
            "color": "9a69b7",
            "default": false,
            "description": null
        },
        {
            "id": 446630556,
            "node_id": "MDU6TGFiZWw0NDY2MzA1NTY=",
            "url": "https://api.github.com/repos/spack/spack/labels/specs",
            "name": "specs",
            "color": "b60205",
            "default": false,
            "description": null
        },
        {
            "id": 1433532775,
            "node_id": "MDU6TGFiZWwxNDMzNTMyNzc1",
            "url": "https://api.github.com/repos/spack/spack/labels/triage",
            "name": "triage",
            "color": "ed9793",
            "default": false,
            "description": "The issue needs to be prioritized"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "tgamblin",
        "id": 299842,
        "node_id": "MDQ6VXNlcjI5OTg0Mg==",
        "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tgamblin",
        "html_url": "https://github.com/tgamblin",
        "followers_url": "https://api.github.com/users/tgamblin/followers",
        "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
        "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
        "organizations_url": "https://api.github.com/users/tgamblin/orgs",
        "repos_url": "https://api.github.com/users/tgamblin/repos",
        "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tgamblin/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "tgamblin",
            "id": 299842,
            "node_id": "MDQ6VXNlcjI5OTg0Mg==",
            "avatar_url": "https://avatars.githubusercontent.com/u/299842?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/tgamblin",
            "html_url": "https://github.com/tgamblin",
            "followers_url": "https://api.github.com/users/tgamblin/followers",
            "following_url": "https://api.github.com/users/tgamblin/following{/other_user}",
            "gists_url": "https://api.github.com/users/tgamblin/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/tgamblin/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/tgamblin/subscriptions",
            "organizations_url": "https://api.github.com/users/tgamblin/orgs",
            "repos_url": "https://api.github.com/users/tgamblin/repos",
            "events_url": "https://api.github.com/users/tgamblin/events{/privacy}",
            "received_events_url": "https://api.github.com/users/tgamblin/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 4,
    "created_at": "2021-03-29T16:11:20Z",
    "updated_at": "2021-07-26T19:49:36Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "The new concretizer does not respect hashes of installed packages in the spec. With the old concretizer, it was possible to reuse previously-installed packages by explicitly specifying the hash of the package. This is no longer possible with the new concretizer.\r\n\r\n### Steps to reproduce the issue\r\n\r\n1. `spack install B`, keep track of the hash of this installation\r\n2. Add a new variant to package B\r\n3. `spack install A ^B/hash` for a package A that depends on B\r\n\r\n### Error Message\r\n\r\nHere is an example with Python. Note that since the time Python was installed, the `openssl` dependency added a new `~docs` variant:\r\n```console\r\n$ spack find -lvd /3auqbnq\r\n==> 1 installed package\r\n-- darwin-catalina-x86_64 / apple-clang@12.0.0 ------------------\r\n3auqbnq python@3.8.7+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87\r\nbdm4oka     apple-libuuid@1353.100.2\r\n6ntaixw     bzip2@1.0.8+shared\r\ns5jmr4n     expat@2.2.10~libbsd\r\ndf3hxmr     gdbm@1.18.1\r\n4d3hjqd         readline@8.0\r\neli4aax             ncurses@6.2~symlinks+termlib\r\ndti2z6r     gettext@0.21+bzip2+curses+git~libunistring+libxml2+tar+xz\r\nxrjlxcv         libiconv@1.16\r\ndqzlvh6         libxml2@2.9.10~python\r\ngfa5h76             xz@5.2.5~pic\r\nx2anksg             zlib@1.2.11+optimize+pic+shared\r\ndc675hk         tar@1.32\r\n5ye4c7r     libffi@3.3 patches=26f26c6f29a7ce9bf370ad3ab2610f99365b4bdd7b82e7c31df41a3370d685c0\r\n2qhvtbw     openssl@1.1.1j+systemcerts\r\nu72xuye     sqlite@3.34.0+column_metadata+fts~functions~rtree\r\n$ spack spec -lI py-setuptools ^/3auqbnq\r\nInput spec\r\n--------------------------------\r\n -   py-setuptools\r\n[+]      ^python@3.8.7%apple-clang@12.0.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87 arch=darwin-catalina-x86_64\r\n[+]          ^apple-libuuid@1353.100.2%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]          ^bzip2@1.0.8%apple-clang@12.0.0+shared arch=darwin-catalina-x86_64\r\n[+]          ^expat@2.2.10%apple-clang@12.0.0~libbsd arch=darwin-catalina-x86_64\r\n[+]          ^gdbm@1.18.1%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]              ^readline@8.0%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]                  ^ncurses@6.2%apple-clang@12.0.0~symlinks+termlib arch=darwin-catalina-x86_64\r\n[+]          ^gettext@0.21%apple-clang@12.0.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=darwin-catalina-x86_64\r\n[+]              ^libiconv@1.16%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]              ^libxml2@2.9.10%apple-clang@12.0.0~python arch=darwin-catalina-x86_64\r\n[+]                  ^xz@5.2.5%apple-clang@12.0.0~pic arch=darwin-catalina-x86_64\r\n[+]                  ^zlib@1.2.11%apple-clang@12.0.0+optimize+pic+shared arch=darwin-catalina-x86_64\r\n[+]              ^tar@1.32%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]          ^libffi@3.3%apple-clang@12.0.0 patches=26f26c6f29a7ce9bf370ad3ab2610f99365b4bdd7b82e7c31df41a3370d685c0 arch=darwin-catalina-x86_64\r\n[+]          ^openssl@1.1.1j%apple-clang@12.0.0+systemcerts arch=darwin-catalina-x86_64\r\n[+]          ^sqlite@3.34.0%apple-clang@12.0.0+column_metadata+fts~functions~rtree arch=darwin-catalina-x86_64\r\n\r\nConcretized\r\n--------------------------------\r\n -   ghaihoj  py-setuptools@50.3.2%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n -   hw2eka5      ^python@3.8.7%apple-clang@12.0.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87 arch=darwin-catalina-x86_64\r\n[+]  bdm4oka          ^apple-libuuid@1353.100.2%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  6ntaixw          ^bzip2@1.0.8%apple-clang@12.0.0+shared arch=darwin-catalina-x86_64\r\n[+]  6xq3pjn              ^diffutils@3.7%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  xrjlxcv                  ^libiconv@1.16%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  s5jmr4n          ^expat@2.2.10%apple-clang@12.0.0~libbsd arch=darwin-catalina-x86_64\r\n[+]  df3hxmr          ^gdbm@1.18.1%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  4d3hjqd              ^readline@8.0%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  eli4aax                  ^ncurses@6.2%apple-clang@12.0.0~symlinks+termlib arch=darwin-catalina-x86_64\r\n[+]  zhcbxzn                      ^pkgconf@1.7.3%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  dti2z6r          ^gettext@0.21%apple-clang@12.0.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=darwin-catalina-x86_64\r\n[+]  dqzlvh6              ^libxml2@2.9.10%apple-clang@12.0.0~python arch=darwin-catalina-x86_64\r\n[+]  gfa5h76                  ^xz@5.2.5%apple-clang@12.0.0~pic arch=darwin-catalina-x86_64\r\n[+]  x2anksg                  ^zlib@1.2.11%apple-clang@12.0.0+optimize+pic+shared arch=darwin-catalina-x86_64\r\n[+]  dc675hk              ^tar@1.32%apple-clang@12.0.0 arch=darwin-catalina-x86_64\r\n[+]  5ye4c7r          ^libffi@3.3%apple-clang@12.0.0 patches=26f26c6f29a7ce9bf370ad3ab2610f99365b4bdd7b82e7c31df41a3370d685c0 arch=darwin-catalina-x86_64\r\n[+]  6p633mh          ^openssl@1.1.1j%apple-clang@12.0.0~docs+systemcerts arch=darwin-catalina-x86_64\r\n[+]  b7bd5lo              ^perl@5.32.1%apple-clang@12.0.0+cpanm+shared+threads arch=darwin-catalina-x86_64\r\n[+]  shevodc                  ^berkeley-db@18.1.40%apple-clang@12.0.0~docs patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=darwin-catalina-x86_64\r\n[+]  u72xuye          ^sqlite@3.34.0%apple-clang@12.0.0+column_metadata+fts~functions~rtree arch=darwin-catalina-x86_64\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.1-1942-f9cc073be0\r\n* **Python:** 3.8.7\r\n* **Platform:** darwin-catalina-ivybridge\r\n* **Concretizer:** clingo\r\n\r\n### Additional information\r\n\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output",
    "performed_via_github_app": null
}