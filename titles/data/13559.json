{
    "url": "https://api.github.com/repos/spack/spack/issues/13559",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13559/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13559/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13559/events",
    "html_url": "https://github.com/spack/spack/issues/13559",
    "id": 517321102,
    "node_id": "MDU6SXNzdWU1MTczMjExMDI=",
    "number": 13559,
    "title": "pybind11: fix get_include()",
    "user": {
        "login": "ax3l",
        "id": 1353258,
        "node_id": "MDQ6VXNlcjEzNTMyNTg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1353258?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ax3l",
        "html_url": "https://github.com/ax3l",
        "followers_url": "https://api.github.com/users/ax3l/followers",
        "following_url": "https://api.github.com/users/ax3l/following{/other_user}",
        "gists_url": "https://api.github.com/users/ax3l/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ax3l/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ax3l/subscriptions",
        "organizations_url": "https://api.github.com/users/ax3l/orgs",
        "repos_url": "https://api.github.com/users/ax3l/repos",
        "events_url": "https://api.github.com/users/ax3l/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ax3l/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        },
        {
            "id": 446619758,
            "node_id": "MDU6TGFiZWw0NDY2MTk3NTg=",
            "url": "https://api.github.com/repos/spack/spack/labels/python",
            "name": "python",
            "color": "c2e0c6",
            "default": false,
            "description": null
        },
        {
            "id": 729584669,
            "node_id": "MDU6TGFiZWw3Mjk1ODQ2Njk=",
            "url": "https://api.github.com/repos/spack/spack/labels/update-package",
            "name": "update-package",
            "color": "c68137",
            "default": false,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "ax3l",
        "id": 1353258,
        "node_id": "MDQ6VXNlcjEzNTMyNTg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1353258?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ax3l",
        "html_url": "https://github.com/ax3l",
        "followers_url": "https://api.github.com/users/ax3l/followers",
        "following_url": "https://api.github.com/users/ax3l/following{/other_user}",
        "gists_url": "https://api.github.com/users/ax3l/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ax3l/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ax3l/subscriptions",
        "organizations_url": "https://api.github.com/users/ax3l/orgs",
        "repos_url": "https://api.github.com/users/ax3l/repos",
        "events_url": "https://api.github.com/users/ax3l/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ax3l/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "ax3l",
            "id": 1353258,
            "node_id": "MDQ6VXNlcjEzNTMyNTg=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1353258?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/ax3l",
            "html_url": "https://github.com/ax3l",
            "followers_url": "https://api.github.com/users/ax3l/followers",
            "following_url": "https://api.github.com/users/ax3l/following{/other_user}",
            "gists_url": "https://api.github.com/users/ax3l/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/ax3l/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/ax3l/subscriptions",
            "organizations_url": "https://api.github.com/users/ax3l/orgs",
            "repos_url": "https://api.github.com/users/ax3l/repos",
            "events_url": "https://api.github.com/users/ax3l/events{/privacy}",
            "received_events_url": "https://api.github.com/users/ax3l/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 5,
    "created_at": "2019-11-04T18:17:47Z",
    "updated_at": "2019-11-06T06:15:14Z",
    "closed_at": "2019-11-06T06:15:14Z",
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "The `py-pybind11` package has a python module helper of the form:\r\n\r\n```python\r\nimport pybind11 as py\r\nprint(py.get_include())\r\n```\r\n\r\nwhich helps downstream, if they are not using the CMake config package (which probably everyone is using), to query the install location.\r\n\r\n`get_include()` currently points to the spec's Python include location instead of the package's include.\r\n\r\nDiff for a new unit test:\r\n```diff\r\ndiff --git a/var/spack/repos/builtin/packages/py-pybind11/package.py b/var/spack/repos/builtin/packages/py-pybind11/package.py\r\nindex cd482ceb3..0a86afb97 100644\r\n--- a/var/spack/repos/builtin/packages/py-pybind11/package.py\r\n+++ b/var/spack/repos/builtin/packages/py-pybind11/package.py\r\n@@ -60,3 +60,17 @@ class PyPybind11(CMakePackage):\r\n         super(PyPybind11, self).install(spec, prefix)\r\n         setup_py('install', '--single-version-externally-managed', '--root=/',\r\n                  '--prefix={0}'.format(prefix))\r\n+\r\n+    @run_after('install')\r\n+    @on_package_attributes(run_tests=True)\r\n+    def test(self):\r\n+        with working_dir('spack-test', create=True):\r\n+            # test include helper points to right location\r\n+            module = \"pybind11\"\r\n+            python = Executable(self.spec['python'].command.path)\r\n+            python('-c', 'import {0}'.format(module))\r\n+            inc = python('-c', 'import {0} as py; print(py.get_include())'.format(\r\n+                module), output=str)\r\n+            print(\"INC:\")\r\n+            print(inc)\r\n+            assert inc == self.prefix.include\r\n```\r\n\r\nSimilar to:\r\n- https://github.com/conda-forge/pybind11-feedstock/pull/32\r\n- https://github.com/pybind/pybind11/pull/1877",
    "performed_via_github_app": null
}