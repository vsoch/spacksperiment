{
    "url": "https://api.github.com/repos/spack/spack/issues/13649",
    "repository_url": "https://api.github.com/repos/spack/spack",
    "labels_url": "https://api.github.com/repos/spack/spack/issues/13649/labels{/name}",
    "comments_url": "https://api.github.com/repos/spack/spack/issues/13649/comments",
    "events_url": "https://api.github.com/repos/spack/spack/issues/13649/events",
    "html_url": "https://github.com/spack/spack/issues/13649",
    "id": 520060481,
    "node_id": "MDU6SXNzdWU1MjAwNjA0ODE=",
    "number": 13649,
    "title": "\"spack install\" aborts when installed software contains dangling symlink",
    "user": {
        "login": "mgjf",
        "id": 20599174,
        "node_id": "MDQ6VXNlcjIwNTk5MTc0",
        "avatar_url": "https://avatars.githubusercontent.com/u/20599174?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mgjf",
        "html_url": "https://github.com/mgjf",
        "followers_url": "https://api.github.com/users/mgjf/followers",
        "following_url": "https://api.github.com/users/mgjf/following{/other_user}",
        "gists_url": "https://api.github.com/users/mgjf/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mgjf/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mgjf/subscriptions",
        "organizations_url": "https://api.github.com/users/mgjf/orgs",
        "repos_url": "https://api.github.com/users/mgjf/repos",
        "events_url": "https://api.github.com/users/mgjf/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mgjf/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 73908754,
            "node_id": "MDU6TGFiZWw3MzkwODc1NA==",
            "url": "https://api.github.com/repos/spack/spack/labels/bug",
            "name": "bug",
            "color": "fc2929",
            "default": true,
            "description": null
        }
    ],
    "state": "closed",
    "locked": false,
    "assignee": {
        "login": "becker33",
        "id": 13971568,
        "node_id": "MDQ6VXNlcjEzOTcxNTY4",
        "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/becker33",
        "html_url": "https://github.com/becker33",
        "followers_url": "https://api.github.com/users/becker33/followers",
        "following_url": "https://api.github.com/users/becker33/following{/other_user}",
        "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
        "organizations_url": "https://api.github.com/users/becker33/orgs",
        "repos_url": "https://api.github.com/users/becker33/repos",
        "events_url": "https://api.github.com/users/becker33/events{/privacy}",
        "received_events_url": "https://api.github.com/users/becker33/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "becker33",
            "id": 13971568,
            "node_id": "MDQ6VXNlcjEzOTcxNTY4",
            "avatar_url": "https://avatars.githubusercontent.com/u/13971568?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/becker33",
            "html_url": "https://github.com/becker33",
            "followers_url": "https://api.github.com/users/becker33/followers",
            "following_url": "https://api.github.com/users/becker33/following{/other_user}",
            "gists_url": "https://api.github.com/users/becker33/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/becker33/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/becker33/subscriptions",
            "organizations_url": "https://api.github.com/users/becker33/orgs",
            "repos_url": "https://api.github.com/users/becker33/repos",
            "events_url": "https://api.github.com/users/becker33/events{/privacy}",
            "received_events_url": "https://api.github.com/users/becker33/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 1,
    "created_at": "2019-11-08T14:57:42Z",
    "updated_at": "2019-11-11T23:47:48Z",
    "closed_at": "2019-11-11T23:47:48Z",
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "On one of my systems, \"spack install gcc\" consistently fails with an error\r\n\r\n==> Error: FileNotFoundError: [Errno 2] No such file or directory:  '.../spack/opt/spack/linux-ubuntu18.04-sandybridge/gcc-7.4.0/gcc-9.2.0-hazow2qor6gvdcxds2ds7wsvufigvclz/lib/gcc/x86_64-pc-linux-gnu/9.2.0/include-fixed/python3.6'\r\n\r\nIt turns out that the \"fixincludes\" process (https://gcc.gnu.org/onlinedocs/gcc/Fixed-Headers.html) inappropriately creates a dangling symlink \"python3.6 -> python3.6m\" in the include-fixed directory. The system's /usr/include contains this symlink, which points to a directory containing a number of header files which are part of Ubuntu's libpython3.6-dev package.\r\n\r\nWhile I cannot recreate this behaviour on several other test servers, the existence of a dangling symlink in the installed software tree should not cause \"spack install\" to fail.\r\n\r\n\r\n### Steps to reproduce the issue\r\n\r\nThe following is a minimal synthetic example to demonstrate this behaviour. See attached file makedang.txt .\r\n\r\n```console\r\n#!/bin/bash\r\n  \r\nset -ex\r\nversion=0.0.1\r\nname=dangsym\r\nmkdir $name-$version\r\ncd $name-$version\r\n\r\ncat > configure <<'EOF'\r\n#!/bin/bash\r\necho \"this is the dangsym configure script\"\r\necho \"args:\" \"$@\"\r\ncase \"$1\" in\r\n--prefix*)\r\n  prefix=${1#--prefix=}\r\n;;\r\nesac\r\n\r\ncat > install.sh <<STOP\r\nset -ex\r\nmkdir -p $prefix\r\ncd $prefix\r\ntouch file.abc\r\nln -s b a  # create dangling symlink\r\nls -l\r\necho \"install complete\"\r\nexit 0\r\nSTOP\r\n\r\nchmod +x install.sh\r\nEOF\r\n\r\nchmod +x configure\r\n\r\ncat > Makefile <<'EOF'\r\n.SILENT: all\r\nall: ; echo nothing to make\r\ninstall: ; ./install.sh\r\nEOF\r\n\r\ncd ..\r\ntar cvfz $name-$version.tar.gz $name-$version\r\nmv $name-$version.tar.gz /tmp\r\n\r\necho \"for spack create just accept the defaults\"\r\nspack create file://localhost/tmp/$name-$version.tar.gz\r\nspack install --verbose $name\r\n\r\n```\r\n\r\n### Error Message\r\n\r\nOn a pristine Spack (releases/v0.13) installation, copy attached script and execute it\r\n\r\n```console\r\nbash ./makedang.txt\r\n[...]\r\nspec : dangsym@0.0.1%gcc@7.4.0 arch=linux-ubuntu18.04-sandybridge\r\n==> Error: FileNotFoundError: [Errno 2] No such file or directory: '/home/user/spack/test1/spack/opt/spack/linux-ubuntu18.04-sandybridge/gcc-7.4.0/dangsym-0.0.1-qhz4ajbcsouinxcejbjtc6kygokp2kwh/a'\r\n\r\n/home/user/spack/test1/spack/lib/spack/spack/package.py:1718, in build_process:\r\n       1715                    echo = logger.echo\r\n       1716                    self.log()\r\n       1717\r\n  >>   1718                # Run post install hooks before build stage is removed.\r\n       1719                spack.hooks.post_install(self.spec)\r\n       1720\r\n       1721            # Stop timer.\r\n\r\nSee build log for details:\r\n  /tmp/user/spack-stage/spack-stage-dangsym-0.0.1-qhz4ajbcsouinxcejbjtc6kygokp2kwh/spack-build-out.txt\r\n```\r\n\r\nThe log file contains no error messages.\r\n\r\n### Information on your system\r\n\r\nuser@ubuntu18043server:~$ cat /etc/os-release \r\nNAME=\"Ubuntu\"\r\nVERSION=\"18.04.3 LTS (Bionic Beaver)\"\r\nID=ubuntu\r\nID_LIKE=debian\r\nPRETTY_NAME=\"Ubuntu 18.04.3 LTS\"\r\nVERSION_ID=\"18.04\"\r\nHOME_URL=\"https://www.ubuntu.com/\"\r\nSUPPORT_URL=\"https://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\r\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\r\nVERSION_CODENAME=bionic\r\nUBUNTU_CODENAME=bionic\r\n\r\nThis is a fresh Spack install (git clone https://github.com/spack/spack.git; git checkout releases/v0.13) with no modifications.\r\n\r\n\r\n[makedang.txt](https://github.com/spack/spack/files/3824998/makedang.txt)\r\n",
    "performed_via_github_app": null
}